---
title: Met Elasticsearch als een Service Fabric-toepassingsarchief trace | Microsoft Docs
description: Beschrijft hoe Service Fabric-toepassingen Elasticsearch en Kibana op te slaan, index, en doorzoeken toepassingstraceringen (Logboeken) kunnen gebruiken
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: 2d2ceceea131b41ad1a1735aaa2a859d035ab098
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="a905c-103">Gebruik Elasticsearch als een tracering van de Service Fabric-toepassing opslaan</span><span class="sxs-lookup"><span data-stu-id="a905c-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="a905c-104">Inleiding</span><span class="sxs-lookup"><span data-stu-id="a905c-104">Introduction</span></span>
<span data-ttu-id="a905c-105">Dit artikel wordt beschreven hoe [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) toepassingen kunnen gebruikmaken van **Elasticsearch** en **Kibana** voor opslag voor servertoepassingen trace indexeren en zoeken.</span><span class="sxs-lookup"><span data-stu-id="a905c-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="a905c-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is een open source, gedistribueerde en schaalbare realtime zoekresultaten en analyse-engine die geschikt zijn voor deze taak.</span><span class="sxs-lookup"><span data-stu-id="a905c-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="a905c-107">Deze kan worden geïnstalleerd op Windows- en Linux virtuele machines in Microsoft Azure wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="a905c-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="a905c-108">Elasticsearch kan efficiënt verwerken *gestructureerde* traceringen geproduceerd met behulp van technologieën zoals **Event Tracing voor Windows (ETW)**.</span><span class="sxs-lookup"><span data-stu-id="a905c-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="a905c-109">ETW wordt gebruikt door de Service Fabric-runtime bron diagnostische gegevens (traceringen).</span><span class="sxs-lookup"><span data-stu-id="a905c-109">ETW is used by Service Fabric runtime to source diagnostic information (traces).</span></span> <span data-ttu-id="a905c-110">Het is de aanbevolen methode voor Service Fabric-toepassingen met hun diagnostische gegevens te bron.</span><span class="sxs-lookup"><span data-stu-id="a905c-110">It is the recommended method for Service Fabric applications to source their diagnostic information, too.</span></span> <span data-ttu-id="a905c-111">Kan gebruikmaken van hetzelfde mechanisme voor correlatie tussen runtime verstrekt en toepassing opgegeven traceringen, en wordt probleemoplossing eenvoudiger.</span><span class="sxs-lookup"><span data-stu-id="a905c-111">Using the same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="a905c-112">Sjablonen voor service Fabric-project in Visual Studio een logboekregistratie API opnemen (op basis van de .NET **EventSource** klasse) die ETW traceringen standaard verzendt.</span><span class="sxs-lookup"><span data-stu-id="a905c-112">Service Fabric project templates in Visual Studio include a logging API (based on the .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="a905c-113">Voor een algemeen overzicht van Service Fabric-toepassing voor het traceren met behulp van ETW, Zie [controle en diagnose van services in de instellingen voor een lokale computer ontwikkeling](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="a905c-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="a905c-114">Voor de traceringen worden weergegeven in Elasticsearch moeten worden vastgelegd op de knooppunten van het Service Fabric in realtime (terwijl de toepassing wordt uitgevoerd) en verzonden naar een eindpunt Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="a905c-114">For the traces to show up in Elasticsearch, they need to be captured at the Service Fabric cluster nodes in real time (while the application is running) and sent to an Elasticsearch endpoint.</span></span> <span data-ttu-id="a905c-115">Er zijn twee belangrijke opties voor het vastleggen van trace:</span><span class="sxs-lookup"><span data-stu-id="a905c-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="a905c-116">**Proces trace vastleggen**</span><span class="sxs-lookup"><span data-stu-id="a905c-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="a905c-117">De toepassing of preciezer, serviceproces is verantwoordelijk voor het verzenden van de diagnostische gegevens naar de store trace (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="a905c-117">The application, or more precisely, service process, is responsible for sending out the diagnostic data to the trace store (Elasticsearch).</span></span>
* <span data-ttu-id="a905c-118">**Out of process-trace vastleggen**</span><span class="sxs-lookup"><span data-stu-id="a905c-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="a905c-119">Een afzonderlijke agent is het vastleggen van traces van de service of meer werkprocessen en ze worden verzonden naar de trace-store.</span><span class="sxs-lookup"><span data-stu-id="a905c-119">A separate agent is capturing traces from the service process or processes and sending them to the trace store.</span></span>

<span data-ttu-id="a905c-120">Hieronder, er wordt beschreven hoe u Elasticsearch op Azure instellen, de professionals bespreken en nadelen voor beide opties vastleggen en wordt uitgelegd hoe u een Service Fabric-service om gegevens te verzenden naar Elasticsearch configureren.</span><span class="sxs-lookup"><span data-stu-id="a905c-120">Below, we describe how to set up Elasticsearch on Azure, discuss the pros and cons for both capture options, and explain how to configure a Service Fabric service to send data to Elasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="a905c-121">Instellen van Elasticsearch op Azure</span><span class="sxs-lookup"><span data-stu-id="a905c-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="a905c-122">De eenvoudigste manier voor het instellen van de service Elasticsearch in Azure is via [ **Azure Resource Manager-sjablonen**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a905c-122">The most straightforward way to set up the Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="a905c-123">Een uitgebreide [Quick Start Azure Resource Manager-sjabloon voor Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is beschikbaar via de Azure Quickstart-opslagplaats voor sjablonen.</span><span class="sxs-lookup"><span data-stu-id="a905c-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="a905c-124">Deze sjabloon maakt gebruik van afzonderlijke storage-accounts voor schaaleenheden (groepen van knooppunten).</span><span class="sxs-lookup"><span data-stu-id="a905c-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="a905c-125">Deze kan ook afzonderlijke client en serverknooppunten met verschillende configuraties en verschillende aantallen gegevensschijven gekoppeld inrichten.</span><span class="sxs-lookup"><span data-stu-id="a905c-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="a905c-126">Hier, gebruiken we een andere sjabloon, de zogeheten **ES MultiNode** van de [Azure diagnostische hulpprogramma's voor opslagplaats](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="a905c-126">Here, we use another template, called **ES-MultiNode** from the [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="a905c-127">Deze sjabloon is eenvoudiger te gebruiken en een beveiligd door HTTP basisverificatie Elasticsearch-cluster wordt gemaakt.</span><span class="sxs-lookup"><span data-stu-id="a905c-127">This template is easier to use, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="a905c-128">Voordat u doorgaat, download u de opslagplaats vanuit GitHub op uw computer (door de opslagplaats klonen of downloaden van een zipbestand).</span><span class="sxs-lookup"><span data-stu-id="a905c-128">Before you proceed, download the repository from GitHub to your machine (by either cloning the repository or downloading a zip file).</span></span> <span data-ttu-id="a905c-129">De sjabloon ES MultiNode bevindt zich in de map met dezelfde naam.</span><span class="sxs-lookup"><span data-stu-id="a905c-129">The ES-MultiNode template is located in the folder with the same name.</span></span>

### <a name="prepare-a-machine-to-run-elasticsearch-installation-scripts"></a><span data-ttu-id="a905c-130">Voorbereiden van een machine Elasticsearch installatiescripts uitvoeren</span><span class="sxs-lookup"><span data-stu-id="a905c-130">Prepare a machine to run Elasticsearch installation scripts</span></span>
<span data-ttu-id="a905c-131">De eenvoudigste manier om het gebruik van de sjabloon ES MultiNode is via een opgegeven Azure PowerShell-script aangeroepen `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="a905c-131">The easiest way to use the ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="a905c-132">Als u wilt dit script gebruiken, moet u PowerShell-modules en hulpprogramma installeren **openssl**.</span><span class="sxs-lookup"><span data-stu-id="a905c-132">To use this script, you need to install PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="a905c-133">De laatste is nodig voor het maken van een SSH-sleutel die kan worden gebruikt voor het beheren van uw cluster Elasticsearch op afstand.</span><span class="sxs-lookup"><span data-stu-id="a905c-133">The latter is needed for creating an SSH key that can be used to administer your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="a905c-134">`CreateElasticSearchCluster`script is ontworpen voor eenvoudig te gebruiken met de sjabloon ES MultiNode van een Windows-machine.</span><span class="sxs-lookup"><span data-stu-id="a905c-134">`CreateElasticSearchCluster` script is designed for ease of use with the ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="a905c-135">Het is mogelijk de sjabloon wilt gebruiken op een niet-Windows-machine, maar in dit scenario ligt buiten het bereik van dit artikel.</span><span class="sxs-lookup"><span data-stu-id="a905c-135">It is possible to use the template on a non-Windows machine, but that scenario is beyond the scope of this article.</span></span>

1. <span data-ttu-id="a905c-136">Als u dit nog niet hebt ze al hebt geïnstalleerd, installeert u [ **Azure PowerShell-modules**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="a905c-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="a905c-137">Wanneer u wordt gevraagd, klikt u op **uitvoeren**, klikt u vervolgens **installeren**.</span><span class="sxs-lookup"><span data-stu-id="a905c-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="a905c-138">Azure PowerShell 1.3 of hoger is vereist.</span><span class="sxs-lookup"><span data-stu-id="a905c-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="a905c-139">De **openssl** hulpprogramma is opgenomen in de distributie van [ **Git voor Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="a905c-139">The **openssl** tool is included in the distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="a905c-140">Als u dit nog niet hebt gedaan, installeert u [Git voor Windows](http://www.git-scm.com/downloads) nu.</span><span class="sxs-lookup"><span data-stu-id="a905c-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="a905c-141">(De standaard installatieopties zijn OK).</span><span class="sxs-lookup"><span data-stu-id="a905c-141">(The default installation options are OK.)</span></span>
3. <span data-ttu-id="a905c-142">Ervan uitgaande dat Git is geïnstalleerd maar niet is opgenomen in het systeempad bevindt, opent u een Microsoft Azure PowerShell-venster en voer de volgende opdrachten:</span><span class="sxs-lookup"><span data-stu-id="a905c-142">Assuming that Git has been installed but not included in the system path, open a Microsoft Azure PowerShell window and run the following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="a905c-143">Vervang de `<Git installation folder>` met de Git-locatie op uw computer; de standaardwaarde is **'C:\Program Files\Git'**.</span><span class="sxs-lookup"><span data-stu-id="a905c-143">Replace the `<Git installation folder>` with the Git location on your machine; the default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="a905c-144">Noteer de puntkomma aan het begin van het eerste pad.</span><span class="sxs-lookup"><span data-stu-id="a905c-144">Note the semicolon character at the beginning of the first path.</span></span>
4. <span data-ttu-id="a905c-145">Zorg ervoor dat u bent aangemeld bij Azure (via [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) en dat u het abonnement dat moet worden gebruikt voor het maken van het cluster elastische Search hebt geselecteerd.</span><span class="sxs-lookup"><span data-stu-id="a905c-145">Ensure that you are logged on to Azure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected the subscription that should be used to create your Elastic Search cluster.</span></span> <span data-ttu-id="a905c-146">U kunt controleren of het juiste abonnement is geselecteerd met `Get-AzureRmContext` en `Get-AzureRmSubscription` cmdlets.</span><span class="sxs-lookup"><span data-stu-id="a905c-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="a905c-147">Als u dit nog niet hebt gedaan, moet u de huidige map wijzigen naar de map ES MultiNode.</span><span class="sxs-lookup"><span data-stu-id="a905c-147">If you haven't done so already, change the current directory to the ES-MultiNode folder.</span></span>

### <a name="run-the-createelasticsearchcluster-script"></a><span data-ttu-id="a905c-148">Voer het script CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="a905c-148">Run the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="a905c-149">Voordat u het script uitvoert, opent u de `azuredeploy-parameters.json` bestand en controleer of geef waarden op voor de scriptparameters.</span><span class="sxs-lookup"><span data-stu-id="a905c-149">Before you run the script, open the `azuredeploy-parameters.json` file and verify or provide values for the script parameters.</span></span> <span data-ttu-id="a905c-150">De volgende parameters zijn beschikbaar:</span><span class="sxs-lookup"><span data-stu-id="a905c-150">The following parameters are provided:</span></span>

| <span data-ttu-id="a905c-151">Parameternaam</span><span class="sxs-lookup"><span data-stu-id="a905c-151">Parameter Name</span></span> | <span data-ttu-id="a905c-152">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="a905c-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="a905c-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="a905c-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="a905c-154">De naam die wordt gebruikt voor het maken van de openbaar zichtbaar DNS-naam voor het cluster elastische zoeken (door het Azure-regio domein toe te voegen aan de opgegeven naam).</span><span class="sxs-lookup"><span data-stu-id="a905c-154">The name that is used to create the publicly visible DNS name for the Elastic Search cluster (by appending the Azure region domain to the provided name).</span></span> <span data-ttu-id="a905c-155">Als deze parameterwaarde is 'myBigCluster' en de gekozen Azure-regio VS-West, is de resulterende DNS-naam voor het cluster myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="a905c-155">For example, if this parameter value is "myBigCluster" and the chosen Azure region is West US, the resulting DNS name for the cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="a905c-156">Deze naam fungeert ook als de naam van een basis voor veel artefacten die zijn gekoppeld aan het cluster elastische zoeken, zoals gegevens knooppuntnamen.</span><span class="sxs-lookup"><span data-stu-id="a905c-156">This name also serves as a root name for many artifacts associated with the Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="a905c-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="a905c-157">adminUsername</span></span> |<span data-ttu-id="a905c-158">De naam van de administrator-account voor het beheren van het cluster elastische zoeken (bijbehorende SSH-sleutels worden automatisch gegenereerd).</span><span class="sxs-lookup"><span data-stu-id="a905c-158">The name of the administrator account for managing the Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="a905c-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="a905c-159">dataNodeCount</span></span> |<span data-ttu-id="a905c-160">Het aantal knooppunten in het cluster elastische zoeken.</span><span class="sxs-lookup"><span data-stu-id="a905c-160">The number of nodes in the Elastic Search cluster.</span></span> <span data-ttu-id="a905c-161">De huidige versie van het script wordt geen onderscheid gemaakt tussen knooppunten, gegevens en de query. alle knooppunten afspelen beide rollen.</span><span class="sxs-lookup"><span data-stu-id="a905c-161">The current version of the script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="a905c-162">Standaard ingesteld op 3 knooppunten.</span><span class="sxs-lookup"><span data-stu-id="a905c-162">Defaults to 3 nodes.</span></span> |
| <span data-ttu-id="a905c-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="a905c-163">dataDiskSize</span></span> |<span data-ttu-id="a905c-164">De grootte van gegevensschijven (in GB) die voor elk gegevensknooppunt is toegewezen.</span><span class="sxs-lookup"><span data-stu-id="a905c-164">The size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="a905c-165">Elk knooppunt ontvangt 4 gegevensschijven exclusief toegewezen aan elastische Search-service.</span><span class="sxs-lookup"><span data-stu-id="a905c-165">Each node receives 4 data disks, exclusively dedicated to Elastic Search service.</span></span> |
| <span data-ttu-id="a905c-166">Regio</span><span class="sxs-lookup"><span data-stu-id="a905c-166">region</span></span> |<span data-ttu-id="a905c-167">De naam van de Azure-regio waar het cluster elastische zoeken moet zich bevinden.</span><span class="sxs-lookup"><span data-stu-id="a905c-167">The name of Azure region where the Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="a905c-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="a905c-168">esUserName</span></span> |<span data-ttu-id="a905c-169">De gebruikersnaam van de gebruiker die is geconfigureerd voor toegang tot cluster ES (afhankelijk van de basisverificatie voor HTTP).</span><span class="sxs-lookup"><span data-stu-id="a905c-169">The user name of the user that is configured to have access to ES cluster (subject to HTTP basic authentication).</span></span> <span data-ttu-id="a905c-170">Het wachtwoord is geen onderdeel van het parameterbestand en moet worden opgegeven wanneer `CreateElasticSearchCluster` script wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="a905c-170">The password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="a905c-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="a905c-171">vmSizeDataNodes</span></span> |<span data-ttu-id="a905c-172">De grootte van de virtuele machine van Azure voor de clusterknooppunten elastische zoeken.</span><span class="sxs-lookup"><span data-stu-id="a905c-172">The Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="a905c-173">De standaardwaarde Standard_D2.</span><span class="sxs-lookup"><span data-stu-id="a905c-173">Defaults to Standard_D2.</span></span> |

<span data-ttu-id="a905c-174">U bent nu klaar om uit te voeren van het script.</span><span class="sxs-lookup"><span data-stu-id="a905c-174">Now you are ready to run the script.</span></span> <span data-ttu-id="a905c-175">Geef de volgende opdracht:</span><span class="sxs-lookup"><span data-stu-id="a905c-175">Issue the following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="a905c-176">waar</span><span class="sxs-lookup"><span data-stu-id="a905c-176">where</span></span> 

| <span data-ttu-id="a905c-177">De parameternaam script</span><span class="sxs-lookup"><span data-stu-id="a905c-177">Script Parameter Name</span></span> | <span data-ttu-id="a905c-178">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="a905c-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="a905c-179">De naam van de Azure-resourcegroep die alle resources van elastische zoeken cluster bevat.</span><span class="sxs-lookup"><span data-stu-id="a905c-179">The name of the Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="a905c-180">De naam van de Azure-regio waar het cluster elastische zoeken moet worden gemaakt.</span><span class="sxs-lookup"><span data-stu-id="a905c-180">The name of the Azure region where the Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="a905c-181">Het wachtwoord voor de gebruiker elastische zoeken.</span><span class="sxs-lookup"><span data-stu-id="a905c-181">The password for the Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="a905c-182">Als u een NullReferenceException van de cmdlet Test-AzureResourceGroup krijgt, u aanmelden bij Azure bent vergeten (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="a905c-182">If you get a NullReferenceException from the Test-AzureResourceGroup cmdlet, you have forgotten to log on to Azure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="a905c-183">Als u krijgt een fout in het script wordt uitgevoerd en u bepalen dat de fout is veroorzaakt door een parameterwaarde verkeerde sjabloon, het parameterbestand corrigeren en het script opnieuw uitgevoerd met een andere Resourcegroepnaam in.</span><span class="sxs-lookup"><span data-stu-id="a905c-183">If you get an error from running the script and you determine that the error was caused by a wrong template parameter value, correct the parameter file and run the script again with a different resource group name.</span></span> <span data-ttu-id="a905c-184">U kunt ook opnieuw gebruiken dezelfde naam van de resourcegroep en het script opruimen van de oude heeft door toe te voegen de `-RemoveExistingResourceGroup` parameter voor het aanroepen van het script.</span><span class="sxs-lookup"><span data-stu-id="a905c-184">You can also reuse the same resource group name and have the script clean up the old one by adding the `-RemoveExistingResourceGroup` parameter to the script invocation.</span></span>

### <a name="result-of-running-the-createelasticsearchcluster-script"></a><span data-ttu-id="a905c-185">Resultaat van het uitvoeren van het script CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="a905c-185">Result of running the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="a905c-186">Nadat u de `CreateElasticSearchCluster` script, de volgende belangrijke artefacten worden gemaakt.</span><span class="sxs-lookup"><span data-stu-id="a905c-186">After you run the `CreateElasticSearchCluster` script, the following main artifacts will be created.</span></span> <span data-ttu-id="a905c-187">In dit voorbeeld gaan we ervan uit dat u 'myBigCluster' hebt gebruikt als de waarde van de `dnsNameForLoadBalancerIP` parameter en of de regio waar u het cluster hebt gemaakt VS-West.</span><span class="sxs-lookup"><span data-stu-id="a905c-187">For this example we assume that you have used "myBigCluster" as the value of the `dnsNameForLoadBalancerIP` parameter and that the region where you created the cluster is West US.</span></span>

| <span data-ttu-id="a905c-188">Artefacten</span><span class="sxs-lookup"><span data-stu-id="a905c-188">Artifact</span></span> | <span data-ttu-id="a905c-189">De naam, locatie en opmerkingen</span><span class="sxs-lookup"><span data-stu-id="a905c-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="a905c-190">SSH-sleutel voor extern beheer</span><span class="sxs-lookup"><span data-stu-id="a905c-190">SSH key for remote administration</span></span> |<span data-ttu-id="a905c-191">myBigCluster.key-bestand (in de map van waaruit de CreateElasticSearchCluster wordt uitgevoerd).</span><span class="sxs-lookup"><span data-stu-id="a905c-191">myBigCluster.key file (in the directory from which the CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="a905c-192">Deze sleutel bestand kan verbinding maken (via het knooppunt admin) en het knooppunt beheer worden gebruikt voor gegevensknooppunten in het cluster.</span><span class="sxs-lookup"><span data-stu-id="a905c-192">This key file can be used to connect to the admin node and (through the admin node) to data nodes in the cluster.</span></span> |
| <span data-ttu-id="a905c-193">Admin-knooppunt</span><span class="sxs-lookup"><span data-stu-id="a905c-193">Admin node</span></span> |<span data-ttu-id="a905c-194">myBigCluster admin.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="a905c-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="a905c-195">Een speciale virtuele machine voor extern beheer van het cluster voor Elasticsearch--het enige dat externe SSH-verbindingen toestaat.</span><span class="sxs-lookup"><span data-stu-id="a905c-195">A dedicated VM for remote Elasticsearch cluster administration--the only one that allows external SSH connections.</span></span> <span data-ttu-id="a905c-196">Deze wordt uitgevoerd op hetzelfde virtuele netwerk als alle knooppunten van het Elasticsearch, maar kunnen de services Elasticsearch kan niet worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="a905c-196">It runs on the same virtual network as all the Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="a905c-197">Gegevensknooppunten</span><span class="sxs-lookup"><span data-stu-id="a905c-197">Data nodes</span></span> |<span data-ttu-id="a905c-198">myBigCluster1...</span><span class="sxs-lookup"><span data-stu-id="a905c-198">myBigCluster1 …</span></span> <span data-ttu-id="a905c-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="a905c-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="a905c-200">Van gegevensknooppunten die fungeren als Elasticsearch en Kibana services worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="a905c-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="a905c-201">U kunt verbinding maken via SSH op elk knooppunt, maar alleen via het knooppunt beheer.</span><span class="sxs-lookup"><span data-stu-id="a905c-201">You can connect via SSH to each node, but only via the admin node.</span></span> |
| <span data-ttu-id="a905c-202">Elasticsearch cluster</span><span class="sxs-lookup"><span data-stu-id="a905c-202">Elasticsearch cluster</span></span> |<span data-ttu-id="a905c-203">http://myBigCluster.westus.cloudapp.Azure.com/ES/</span><span class="sxs-lookup"><span data-stu-id="a905c-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="a905c-204">Het primaire eindpunt voor het cluster Elasticsearch (Let op het achtervoegsel /es).</span><span class="sxs-lookup"><span data-stu-id="a905c-204">The primary endpoint for the Elasticsearch cluster (note the /es suffix).</span></span> <span data-ttu-id="a905c-205">Het is beveiligd met eenvoudige HTTP-verificatie (de referenties zijn de opgegeven esUserName/esPassword parameters van de sjabloon ES MultiNode).</span><span class="sxs-lookup"><span data-stu-id="a905c-205">It is protected by basic HTTP authentication (the credentials were the specified esUserName/esPassword parameters of the ES-MultiNode template).</span></span> <span data-ttu-id="a905c-206">Het cluster heeft ook de kop invoegtoepassing geïnstalleerd (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) voor elementaire Clusterbeheer.</span><span class="sxs-lookup"><span data-stu-id="a905c-206">The cluster has also the head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="a905c-207">Kibana-service</span><span class="sxs-lookup"><span data-stu-id="a905c-207">Kibana service</span></span> |<span data-ttu-id="a905c-208">http://myBigCluster.westus.cloudapp.Azure.com</span><span class="sxs-lookup"><span data-stu-id="a905c-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="a905c-209">De service Kibana is ingesteld om gegevens uit het gemaakte Elasticsearch cluster weer te geven.</span><span class="sxs-lookup"><span data-stu-id="a905c-209">The Kibana service is set up to show data from the created Elasticsearch cluster.</span></span> <span data-ttu-id="a905c-210">Het is beveiligd door de dezelfde referenties voor verificatie als het cluster zelf.</span><span class="sxs-lookup"><span data-stu-id="a905c-210">It is protected by the same authentication credentials as the cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="a905c-211">In-process versus out of process-trace vastleggen</span><span class="sxs-lookup"><span data-stu-id="a905c-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="a905c-212">In de inleiding gezegd twee manieren om diagnostische gegevens te verzamelen: in-process- en out-of-process.</span><span class="sxs-lookup"><span data-stu-id="a905c-212">In the introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="a905c-213">Elk heeft sterke en zwakke punten.</span><span class="sxs-lookup"><span data-stu-id="a905c-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="a905c-214">Voordelen van de **proces trace vastleggen** omvatten:</span><span class="sxs-lookup"><span data-stu-id="a905c-214">Advantages of the **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="a905c-215">*Eenvoudige configuratie en implementatie*</span><span class="sxs-lookup"><span data-stu-id="a905c-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="a905c-216">De configuratie van verzamelen van diagnostische gegevens net is onderdeel van de configuratie van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="a905c-216">The configuration of diagnostic data collection is just part of the application configuration.</span></span> <span data-ttu-id="a905c-217">Het is gemakkelijk altijd het ' om synchroon te houden "met de rest van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="a905c-217">It is easy to always keep it "in sync" with the rest of the application.</span></span>
   * <span data-ttu-id="a905c-218">Configuratie van per toepassing of per-service is eenvoudig haalbare.</span><span class="sxs-lookup"><span data-stu-id="a905c-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="a905c-219">Out of process-trace vastleggen moet meestal een afzonderlijke implementatie en configuratie van de diagnostische agent, die een extra beheertaak en een mogelijke oorzaak van fouten is.</span><span class="sxs-lookup"><span data-stu-id="a905c-219">Out-of-process trace capturing usually requires a separate deployment and configuration of the diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="a905c-220">De agent op bepaalde technologie kunt vaak slechts één exemplaar van de agent per virtuele machine (knooppunt).</span><span class="sxs-lookup"><span data-stu-id="a905c-220">The particular agent technology often allows only one instance of the agent per virtual machine (node).</span></span> <span data-ttu-id="a905c-221">Dit betekent dat de configuratie voor het verzamelen van diagnostische configuratie wordt gedeeld door alle toepassingen en services die op dat knooppunt worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="a905c-221">This means that configuration for the collection of the diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="a905c-222">*Flexibiliteit*</span><span class="sxs-lookup"><span data-stu-id="a905c-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="a905c-223">De toepassing de gegevens kan verzenden, waar nodig om te gaan, zolang er is een clientbibliotheek die ondersteuning biedt voor het opslagsysteem van gerichte gegevens.</span><span class="sxs-lookup"><span data-stu-id="a905c-223">The application can send the data wherever it needs to go, as long as there is a client library that supports the targeted data storage system.</span></span> <span data-ttu-id="a905c-224">Nieuwe sinks kunnen worden toegevoegd naar wens.</span><span class="sxs-lookup"><span data-stu-id="a905c-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="a905c-225">Complexe regels voor het vastleggen, filteren en samenvoegen van gegevens kunnen worden geïmplementeerd.</span><span class="sxs-lookup"><span data-stu-id="a905c-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="a905c-226">Het vastleggen van een out-of-process trace wordt vaak beperkt door de gegevens put die ondersteuning biedt voor de agent.</span><span class="sxs-lookup"><span data-stu-id="a905c-226">An out-of-process trace capturing is often limited by the data sinks that the agent supports.</span></span> <span data-ttu-id="a905c-227">Sommige agents worden uitgebreid.</span><span class="sxs-lookup"><span data-stu-id="a905c-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="a905c-228">*Toegang tot interne toepassingsgegevens en -context*</span><span class="sxs-lookup"><span data-stu-id="a905c-228">*Access to internal application data and context*</span></span>
   
   * <span data-ttu-id="a905c-229">Het diagnostische subsysteem uitvoering binnen het proces van de toepassing/service kan eenvoudig de traceringen met contextafhankelijke informatie verbeteren.</span><span class="sxs-lookup"><span data-stu-id="a905c-229">The diagnostic subsystem running inside the application/service process can easily augment the traces with contextual information.</span></span>
   * <span data-ttu-id="a905c-230">In de out-of-process-methode, moet de gegevens worden verzonden naar een agent via een mechanisme voor communicatie tussen processen, zoals Event Tracing voor Windows.</span><span class="sxs-lookup"><span data-stu-id="a905c-230">In the out-of-process approach, the data must be sent to an agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="a905c-231">Dit mechanisme kan aanvullende beperkingen opleggen.</span><span class="sxs-lookup"><span data-stu-id="a905c-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="a905c-232">Voordelen van de **out of process-tracering vast te leggen** omvatten:</span><span class="sxs-lookup"><span data-stu-id="a905c-232">Advantages of the **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="a905c-233">*De mogelijkheid voor het bewaken van de toepassing en verzamelen crashdumps*</span><span class="sxs-lookup"><span data-stu-id="a905c-233">*The ability to monitor the application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="a905c-234">Tracering in-process vastleggen mogelijk mislukt als de toepassing niet kan worden gestart of is vastgelopen.</span><span class="sxs-lookup"><span data-stu-id="a905c-234">In-process trace capturing may be unsuccessful if the application fails to start or crashes.</span></span> <span data-ttu-id="a905c-235">Een onafhankelijke agent heeft een veel grotere kans van het vastleggen van cruciaal belang voor probleemoplossing.</span><span class="sxs-lookup"><span data-stu-id="a905c-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="a905c-236">*Vervaldatum, robuustheid en beproefde prestaties*</span><span class="sxs-lookup"><span data-stu-id="a905c-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="a905c-237">Een agent die is ontwikkeld door een leverancier platform (zoals Microsoft Azure Diagnostics-agent) is onderworpen aan strengere testen en strijd te beperken.</span><span class="sxs-lookup"><span data-stu-id="a905c-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject to rigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="a905c-238">Met de in proces tracering vast te leggen, extra op worden gelet om ervoor te zorgen dat de activiteit van het verzenden van diagnostische gegevens van een toepassingsproces niet leiden tot met de belangrijkste taken van de toepassing problemen of problemen met timing- of Prestatieweergave veroorzaken.</span><span class="sxs-lookup"><span data-stu-id="a905c-238">With in-process trace capturing, care must be taken to ensure that the activity of sending diagnostic data from an application process does not interfere with the application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="a905c-239">Een agent onafhankelijk uitgevoerd minder gevoelig is voor deze problemen en is speciaal ontworpen voor het beperken van de invloed ervan op het systeem.</span><span class="sxs-lookup"><span data-stu-id="a905c-239">An independently running agent is less prone to these issues and is specifically designed to limit its impact on the system.</span></span>

<span data-ttu-id="a905c-240">Het is mogelijk om te combineren en profiteren van beide benaderingen.</span><span class="sxs-lookup"><span data-stu-id="a905c-240">It is possible to combine and benefit from both approaches.</span></span> <span data-ttu-id="a905c-241">Inderdaad, mogelijk de beste oplossing voor veel toepassingen.</span><span class="sxs-lookup"><span data-stu-id="a905c-241">Indeed, it might be the best solution for many applications.</span></span>

<span data-ttu-id="a905c-242">Hier, gebruiken we de **Microsoft.Diagnostic.Listeners bibliotheek** en de in-process-tracering vastleggen om gegevens te verzenden vanuit een Service Fabric-toepassing naar een cluster Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="a905c-242">Here, we use the **Microsoft.Diagnostic.Listeners library** and the in-process trace capturing to send data from a Service Fabric application to an Elasticsearch cluster.</span></span>

## <a name="use-the-listeners-library-to-send-diagnostic-data-to-elasticsearch"></a><span data-ttu-id="a905c-243">Gebruik van de bibliotheek Listeners diagnostische gegevens verzenden naar Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="a905c-243">Use the Listeners library to send diagnostic data to Elasticsearch</span></span>
<span data-ttu-id="a905c-244">De bibliotheek Microsoft.Diagnostic.Listeners maakt deel uit van de voorbeeldtoepassing Service Fabric PartyCluster.</span><span class="sxs-lookup"><span data-stu-id="a905c-244">The Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="a905c-245">Om deze te gebruiken:</span><span class="sxs-lookup"><span data-stu-id="a905c-245">To use it:</span></span>

1. <span data-ttu-id="a905c-246">Download [het voorbeeld PartyCluster](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) vanuit GitHub.</span><span class="sxs-lookup"><span data-stu-id="a905c-246">Download [the PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="a905c-247">De projecten Microsoft.Diagnostics.Listeners en Microsoft.Diagnostics.Listeners.Fabric (hele mappen) kopiëren vanuit de map van de steekproef PartyCluster naar de oplossingenmap van de toepassing die u moet de gegevens verzenden naar Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="a905c-247">Copy the Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from the PartyCluster sample directory to the solution folder of the application that is supposed to send the data to Elasticsearch.</span></span>
3. <span data-ttu-id="a905c-248">Open de doel-oplossing, met de rechtermuisknop op het knooppunt van de oplossing in Solution Explorer en kiest u **bestaand Project toevoegen**.</span><span class="sxs-lookup"><span data-stu-id="a905c-248">Open the target solution, right-click the solution node in the Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="a905c-249">Het project Microsoft.Diagnostics.Listeners toevoegen aan de oplossing.</span><span class="sxs-lookup"><span data-stu-id="a905c-249">Add the Microsoft.Diagnostics.Listeners project to the solution.</span></span> <span data-ttu-id="a905c-250">Herhaal dezelfde voor het project Microsoft.Diagnostics.Listeners.Fabric.</span><span class="sxs-lookup"><span data-stu-id="a905c-250">Repeat the same for the Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="a905c-251">Project een verwijzing van uw service-projecten toevoegen aan de twee projecten toegevoegd.</span><span class="sxs-lookup"><span data-stu-id="a905c-251">Add a project reference from your service project(s) to the two added projects.</span></span> <span data-ttu-id="a905c-252">(Elke service die u moet gegevens verzenden naar Elasticsearch moet verwijzen naar Microsoft.Diagnostics.EventListeners en Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="a905c-252">(Each service that is supposed to send data to Elasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Projectverwijzingen aan Microsoft.Diagnostics.EventListeners en Microsoft.Diagnostics.EventListeners.Fabric tapewisselaars][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="a905c-254">Service Fabric algemene beschikbaarheid release en Microsoft.Diagnostics.Tracing Nuget-pakket</span><span class="sxs-lookup"><span data-stu-id="a905c-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="a905c-255">Toepassingen die zijn gemaakt met de release van Service Fabric algemene beschikbaarheid (2.0.135, en met 31 maart 2016 wordt uitgebracht) doel **.NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="a905c-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="a905c-256">Deze versie is de hoogste versie van .NET Framework ondersteund door Azure op het moment van de GA-release.</span><span class="sxs-lookup"><span data-stu-id="a905c-256">This version is the highest version of the .NET Framework supported by Azure at the time of the GA release.</span></span> <span data-ttu-id="a905c-257">Deze versie van het framework helaas beschikt niet over bepaalde EventListener APIs die de bibliotheek Microsoft.Diagnostics.Listeners nodig heeft.</span><span class="sxs-lookup"><span data-stu-id="a905c-257">Unfortunately, this version of the framework lacks certain EventListener APIs that the Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="a905c-258">Omdat nauw EventSource (het onderdeel dat de basis vormt van de logboekregistratie van API's in de Fabric-toepassingen) en EventListener zijn gekoppeld, moet elk project dat gebruikmaakt van de bibliotheek Microsoft.Diagnostics.Listeners een alternatieve implementatie van EventSource gebruiken.</span><span class="sxs-lookup"><span data-stu-id="a905c-258">Because EventSource (the component that forms the basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses the Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="a905c-259">Deze implementatie wordt geleverd door de **Microsoft.Diagnostics.Tracing Nuget-pakket**, opgestelde door Microsoft.</span><span class="sxs-lookup"><span data-stu-id="a905c-259">This implementation is provided by the **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="a905c-260">Het pakket is volledig achterwaarts compatibel met EventSource opgenomen in het kader, dus er zijn geen codewijzigingen mag alleen waarnaar wordt verwezen naamruimte wijzigingen nodig.</span><span class="sxs-lookup"><span data-stu-id="a905c-260">The package is fully backward-compatible with EventSource included in the framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="a905c-261">Om te starten met de Microsoft.Diagnostics.Tracing-implementatie van de klasse EventSource, volg deze stappen voor elk serviceproject dat u moet gegevens verzenden naar Elasticsearch:</span><span class="sxs-lookup"><span data-stu-id="a905c-261">To start using the Microsoft.Diagnostics.Tracing implementation of the EventSource class, follow these steps for each service project that needs to send data to Elasticsearch:</span></span>

1. <span data-ttu-id="a905c-262">Met de rechtermuisknop op de service-project en kies **Nuget-pakketten beheren**.</span><span class="sxs-lookup"><span data-stu-id="a905c-262">Right-click on the service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="a905c-263">Overschakelen naar de pakketbron nuget.org (indien deze nog niet is geselecteerd) en zoek naar '**Microsoft.Diagnostics.Tracing**'.</span><span class="sxs-lookup"><span data-stu-id="a905c-263">Switch to the nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="a905c-264">Installeer de `Microsoft.Diagnostics.Tracing.EventSource` -pakket (en de bijbehorende afhankelijkheden).</span><span class="sxs-lookup"><span data-stu-id="a905c-264">Install the `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="a905c-265">Open de **ServiceEventSource.cs** of **ActorEventSource.cs** bestand in uw serviceproject en vervang de `using System.Diagnostics.Tracing` richtlijn boven op het bestand met de `using Microsoft.Diagnostics.Tracing` richtlijn.</span><span class="sxs-lookup"><span data-stu-id="a905c-265">Open the **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace the `using System.Diagnostics.Tracing` directive on top of the file with the `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="a905c-266">Deze stappen worden niet nodig eenmaal de **.NET Framework 4.6** wordt ondersteund door Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="a905c-266">These steps will not be necessary once the **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="a905c-267">Elasticsearch listener instantiëring en configuratie</span><span class="sxs-lookup"><span data-stu-id="a905c-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="a905c-268">De laatste stap voor het verzenden van diagnostische gegevens naar Elasticsearch is geen exemplaar maken van `ElasticSearchListener` en configureer deze met Elasticsearch verbindingsgegevens.</span><span class="sxs-lookup"><span data-stu-id="a905c-268">The final step for sending diagnostic data to Elasticsearch is to create an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="a905c-269">De listener worden automatisch alle gebeurtenissen geregistreerd die zijn gegenereerd via EventSource klassen die zijn gedefinieerd in het serviceproject.</span><span class="sxs-lookup"><span data-stu-id="a905c-269">The listener automatically captures all events raised via EventSource classes defined in the service project.</span></span> <span data-ttu-id="a905c-270">Het moet actief zijn tijdens de levensduur van de service, zodat de beste plaats om deze te maken in de code van de initialisatie van de service.</span><span class="sxs-lookup"><span data-stu-id="a905c-270">It needs to be alive during the lifetime of the service, so the best place to create it is in the service initialization code.</span></span> <span data-ttu-id="a905c-271">De van de initialisatiecode voor een stateless service kan uitzien na de benodigde wijzigingen (toevoegingen die zijn uiteengezet in opmerkingen die beginnen met `****`):</span><span class="sxs-lookup"><span data-stu-id="a905c-271">Here is how the initialization code for a stateless service could look after the necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add the following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is the entry point of the service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // The ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name to a .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of the class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that the ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="a905c-272">Elasticsearch verbindingsgegevens moeten worden geplaatst in een aparte sectie in het configuratiebestand van de service (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="a905c-272">Elasticsearch connection data should be put in a separate section in the service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="a905c-273">De naam van de sectie moet overeenkomen met de waarde die is doorgegeven aan de `FabricConfigurationProvider` -constructor aan, bijvoorbeeld:</span><span class="sxs-lookup"><span data-stu-id="a905c-273">The name of the section must correspond to the value passed to the `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="a905c-274">De waarden van `serviceUri`, `userName` en `password` parameters overeenkomen met de Elasticsearch cluster eindpuntadres, Elasticsearch gebruikersnaam en wachtwoord, respectievelijk.</span><span class="sxs-lookup"><span data-stu-id="a905c-274">The values of `serviceUri`, `userName` and `password` parameters correspond to the Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="a905c-275">`indexNamePrefix`is het voorvoegsel voor Elasticsearch indexen; de bibliotheek Microsoft.Diagnostics.Listeners maakt dagelijks een nieuwe index voor de gegevens.</span><span class="sxs-lookup"><span data-stu-id="a905c-275">`indexNamePrefix` is the prefix for Elasticsearch indexes; the Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="a905c-276">Verificatie</span><span class="sxs-lookup"><span data-stu-id="a905c-276">Verification</span></span>
<span data-ttu-id="a905c-277">Dat is alles.</span><span class="sxs-lookup"><span data-stu-id="a905c-277">That's it!</span></span> <span data-ttu-id="a905c-278">Nu wanneer de service wordt uitgevoerd, wordt er gestart traceringen verzenden naar de Elasticsearch-service dat is opgegeven in de configuratie.</span><span class="sxs-lookup"><span data-stu-id="a905c-278">Now, whenever the service is run, it starts sending traces to the Elasticsearch service specified in the configuration.</span></span> <span data-ttu-id="a905c-279">U kunt controleren of dit door het openen van de UI Kibana die zijn gekoppeld aan de doelinstantie Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="a905c-279">You can verify this by opening the Kibana UI associated with the target Elasticsearch instance.</span></span> <span data-ttu-id="a905c-280">In ons voorbeeld is het adres van de pagina http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="a905c-280">In our example, the page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="a905c-281">Controleer of de geïndexeerd met het voorvoegsel van de gekozen voor de `ElasticSearchListener` exemplaar inderdaad zijn gemaakt en gevuld met gegevens.</span><span class="sxs-lookup"><span data-stu-id="a905c-281">Check that indexes with the name prefix chosen for the `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Kibana tonen PartyCluster toepassingsgebeurtenissen][2]

## <a name="next-steps"></a><span data-ttu-id="a905c-283">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="a905c-283">Next steps</span></span>
* [<span data-ttu-id="a905c-284">Meer informatie over het diagnosticeren en controleren van een Service Fabric-service</span><span class="sxs-lookup"><span data-stu-id="a905c-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png
