---
title: aaaService Fabric back-up en herstel | Microsoft Docs
description: Conceptuele documentatie voor Service Fabric-back-up en herstel
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: subramar,jessebenson
ms.assetid: 91ea6ca4-cc2a-4155-9823-dcbd0b996349
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 08/18/2017
ms.author: mcoskun
ms.openlocfilehash: e502b59c84999c3fe825167383f00a5ebd70c9b5
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="back-up-and-restore-reliable-services-and-reliable-actors"></a><span data-ttu-id="004e2-103">Back-up en herstel Reliable Services en Reliable Actors</span><span class="sxs-lookup"><span data-stu-id="004e2-103">Back up and restore Reliable Services and Reliable Actors</span></span>
<span data-ttu-id="004e2-104">Azure Service Fabric is een hoge beschikbaarheid-platform die zijn gerepliceerd Hallo status over meerdere knooppunten toomaintain deze hoge beschikbaarheid.</span><span class="sxs-lookup"><span data-stu-id="004e2-104">Azure Service Fabric is a high-availability platform that replicates hello state across multiple nodes toomaintain this high availability.</span></span>  <span data-ttu-id="004e2-105">Dus zelfs als een knooppunt in het Hallo-cluster is mislukt, Hallo services kunnen blijven toobe beschikbaar.</span><span class="sxs-lookup"><span data-stu-id="004e2-105">Thus, even if one node in hello cluster fails, hello services continue toobe available.</span></span> <span data-ttu-id="004e2-106">Bij deze ingebouwde redundantie geleverd door Hallo platform is mogelijk niet voldoende is voor sommige, in bepaalde gevallen is het wenselijk voor Hallo service tooback van gegevens (tooan externe store).</span><span class="sxs-lookup"><span data-stu-id="004e2-106">While this in-built redundancy provided by hello platform may be sufficient for some, in certain cases it is desirable for hello service tooback up data (tooan external store).</span></span>

> [!NOTE]
> <span data-ttu-id="004e2-107">Het is essentieel toobackup en herstellen van uw gegevens (en de test werkt zoals verwacht) zodat u vanaf gegevensverlies herstellen kunt.</span><span class="sxs-lookup"><span data-stu-id="004e2-107">It is critical toobackup and restore your data (and test that it works as expected) so you can recover from data loss scenarios.</span></span>
> 
> 

<span data-ttu-id="004e2-108">Bijvoorbeeld, kunt een service tooback van gegevens in de volgorde tooprotect van Hallo volgen scenario's:</span><span class="sxs-lookup"><span data-stu-id="004e2-108">For example, a service may want tooback up data in order tooprotect from hello following scenarios:</span></span>

- <span data-ttu-id="004e2-109">In de gebeurtenis Hallo van Hallo permanent verlies van een volledige Service Fabric-cluster.</span><span class="sxs-lookup"><span data-stu-id="004e2-109">In hello event of hello permanent loss of an entire Service Fabric cluster.</span></span>
- <span data-ttu-id="004e2-110">Permanent verlies van een meerderheid van Hallo replica's van de partitie van een service</span><span class="sxs-lookup"><span data-stu-id="004e2-110">Permanent loss of a majority of hello replicas of a service partition</span></span>
- <span data-ttu-id="004e2-111">Administratieve fouten waarbij Hallo status per ongeluk wordt verwijderd of beschadigd.</span><span class="sxs-lookup"><span data-stu-id="004e2-111">Administrative errors whereby hello state accidentally gets deleted or corrupted.</span></span> <span data-ttu-id="004e2-112">Dit kan bijvoorbeeld gebeuren als een beheerder met voldoende bevoegdheden ten onrechte Hallo-service worden verwijderd.</span><span class="sxs-lookup"><span data-stu-id="004e2-112">For example, this may happen if an administrator with sufficient privilege erroneously deletes hello service.</span></span>
- <span data-ttu-id="004e2-113">Fouten in Hallo-service die leiden gegevensbeschadiging van tot.</span><span class="sxs-lookup"><span data-stu-id="004e2-113">Bugs in hello service that cause data corruption.</span></span> <span data-ttu-id="004e2-114">Dit kan bijvoorbeeld gebeuren wanneer een code-upgrade van service wordt gestart met het schrijven van beschadigde gegevens tooa betrouwbare verzameling.</span><span class="sxs-lookup"><span data-stu-id="004e2-114">For example, this may happen when a service code upgrade starts writing faulty data tooa Reliable Collection.</span></span> <span data-ttu-id="004e2-115">In dat geval beide code Hallo en Hallo gegevens mogelijk toobe tooan teruggezet eerdere status.</span><span class="sxs-lookup"><span data-stu-id="004e2-115">In such a case, both hello code and hello data may have toobe reverted tooan earlier state.</span></span>
- <span data-ttu-id="004e2-116">De gegevensverwerking is offline.</span><span class="sxs-lookup"><span data-stu-id="004e2-116">Offline data processing.</span></span> <span data-ttu-id="004e2-117">Handige toohave offline verwerking van gegevens voor business intelligence die plaatsvindt afzonderlijk uit Hallo-service die Hallo gegevens genereert mogelijk.</span><span class="sxs-lookup"><span data-stu-id="004e2-117">It might be convenient toohave offline processing of data for business intelligence that happens separately from hello service that generates hello data.</span></span>

<span data-ttu-id="004e2-118">Hallo Backup/Restore-functie kunt services is gebaseerd op Hallo betrouwbare Services API toocreate en terugzetten van back-ups.</span><span class="sxs-lookup"><span data-stu-id="004e2-118">hello Backup/Restore feature allows services built on hello Reliable Services API toocreate and restore backups.</span></span> <span data-ttu-id="004e2-119">Hallo toestaan back-API's die worden geleverd door Hallo platform backup(s) van status van een service-partitie, zonder blokkerende lees- of schrijfbewerkingen.</span><span class="sxs-lookup"><span data-stu-id="004e2-119">hello backup APIs provided by hello platform allow backup(s) of a service partition's state, without blocking read or write operations.</span></span> <span data-ttu-id="004e2-120">Hallo-API's van de partitie van een service status toobe hersteld op basis van een gekozen back-up maken terugzetten.</span><span class="sxs-lookup"><span data-stu-id="004e2-120">hello restore APIs allow a service partition's state toobe restored from a chosen backup.</span></span>

## <a name="types-of-backup"></a><span data-ttu-id="004e2-121">Typen back-ups</span><span class="sxs-lookup"><span data-stu-id="004e2-121">Types of Backup</span></span>
<span data-ttu-id="004e2-122">Er zijn twee opties voor back-up: volledige en incrementele.</span><span class="sxs-lookup"><span data-stu-id="004e2-122">There are two backup options: Full and Incremental.</span></span>
<span data-ttu-id="004e2-123">Een volledige back-up is een back-up waarin alle Hallo gegevens die nodig zijn toorecreate Hallo status van replica Hallo: controlepunten en alle records in het logboek.</span><span class="sxs-lookup"><span data-stu-id="004e2-123">A full backup is a backup that contains all hello data required toorecreate hello state of hello replica: checkpoints and all log records.</span></span>
<span data-ttu-id="004e2-124">Omdat het Hallo controlepunten en Hallo logboekbestanden heeft, kan een volledige back-up kan worden hersteld door zelf.</span><span class="sxs-lookup"><span data-stu-id="004e2-124">Since it has hello checkpoints and hello log, a full backup can be restored by itself.</span></span>

<span data-ttu-id="004e2-125">Hallo probleem met volledige back-ups ontstaat wanneer Hallo controlepunten groot zijn.</span><span class="sxs-lookup"><span data-stu-id="004e2-125">hello problem with full backups arises when hello checkpoints are large.</span></span>
<span data-ttu-id="004e2-126">Een replica met 16 GB status heeft bijvoorbeeld controlepunten die ongeveer too16 GB samen.</span><span class="sxs-lookup"><span data-stu-id="004e2-126">For example, a replica that has 16 GB of state will have checkpoints that add up approximately too16 GB.</span></span>
<span data-ttu-id="004e2-127">Als we een beoogd herstelpunt van vijf minuten hebt, moet Hallo replica toobe een back-up om de vijf minuten.</span><span class="sxs-lookup"><span data-stu-id="004e2-127">If we have a Recovery Point Objective of five minutes, hello replica needs toobe backed up every five minutes.</span></span>
<span data-ttu-id="004e2-128">Telkens wanneer er een back-up moet toocopy 16 GB van controlepunten Daarnaast too50 MB (met behulp van configureerbare `CheckpointThresholdInMB`) aan logboeken.</span><span class="sxs-lookup"><span data-stu-id="004e2-128">Each time it backs up it needs toocopy 16 GB of checkpoints in addition too50 MB (configurable using `CheckpointThresholdInMB`) worth of logs.</span></span>

![Voorbeeld van de volledige back-up.](media/service-fabric-reliable-services-backup-restore/FullBackupExample.PNG)

<span data-ttu-id="004e2-130">Hallo oplossing toothis probleem is incrementele back-ups wanneer back-up bevat alleen logboekrecords Hallo gewijzigd sinds de laatste back-up Hallo.</span><span class="sxs-lookup"><span data-stu-id="004e2-130">hello solution toothis problem is incremental backups, where backup only contains hello changed log records since hello last backup.</span></span>

![Incrementele back-voorbeeld.](media/service-fabric-reliable-services-backup-restore/IncrementalBackupExample.PNG)

<span data-ttu-id="004e2-132">Aangezien incrementele back-ups worden enkel wijzigingen sinds Hallo laatste back-up (omvat geen controlepunten Hallo), ze toobe sneller vaak maar ze kunnen niet worden teruggezet op hun eigen.</span><span class="sxs-lookup"><span data-stu-id="004e2-132">Since incremental backups are only changes since hello last backup (does not include hello checkpoints), they tend toobe faster but they cannot be restored on their own.</span></span>
<span data-ttu-id="004e2-133">toorestore een incrementele back-up, Hallo volledige back-keten is vereist.</span><span class="sxs-lookup"><span data-stu-id="004e2-133">toorestore an incremental backup, hello entire backup chain is required.</span></span>
<span data-ttu-id="004e2-134">Een back-keten is een keten van back-ups die beginnen met een volledige back-up en gevolgd door een aantal aaneengesloten incrementele back-ups.</span><span class="sxs-lookup"><span data-stu-id="004e2-134">A backup chain is a chain of backups starting with a full backup and followed by a number of contiguous incremental backups.</span></span>

## <a name="backup-reliable-services"></a><span data-ttu-id="004e2-135">Back-Reliable Services</span><span class="sxs-lookup"><span data-stu-id="004e2-135">Backup Reliable Services</span></span>
<span data-ttu-id="004e2-136">Hallo service auteur heeft volledig beheer van wanneer toomake back-ups en waar back-ups worden opgeslagen.</span><span class="sxs-lookup"><span data-stu-id="004e2-136">hello service author has full control of when toomake backups and where backups will be stored.</span></span>

<span data-ttu-id="004e2-137">een back-up toostart, Hallo-service moet tooinvoke Hallo overgenomen lidfunctie `BackupAsync`.</span><span class="sxs-lookup"><span data-stu-id="004e2-137">toostart a backup, hello service needs tooinvoke hello inherited member function `BackupAsync`.</span></span>  
<span data-ttu-id="004e2-138">Back-ups kunnen alleen vanaf de primaire replica's worden gemaakt, en ze vereisen schrijven status toobe verleend.</span><span class="sxs-lookup"><span data-stu-id="004e2-138">Backups can be made only from primary replicas, and they require write status toobe granted.</span></span>

<span data-ttu-id="004e2-139">Zoals hieronder aangegeven, `BackupAsync` wordt in een `BackupDescription` object, een waar een volledige of incrementele back-up, evenals een callback-functie opgeven kunt, `Func<< BackupInfo, CancellationToken, Task<bool>>>` die wordt geactiveerd wanneer de back-upmap Hallo lokaal is gemaakt en is klaar toobe verplaatst uit toosome externe opslag.</span><span class="sxs-lookup"><span data-stu-id="004e2-139">As shown below, `BackupAsync` takes in a `BackupDescription` object, where one can specify a full or incremental backup, as well as a callback function, `Func<< BackupInfo, CancellationToken, Task<bool>>>` that is invoked when hello backup folder has been created locally and is ready toobe moved out toosome external storage.</span></span>

```csharp

BackupDescription myBackupDescription = new BackupDescription(backupOption.Incremental,this.BackupCallbackAsync);

await this.BackupAsync(myBackupDescription);

```

<span data-ttu-id="004e2-140">Aanvraag tootake met een incrementele back-up mislukken `FabricMissingFullBackupException`.</span><span class="sxs-lookup"><span data-stu-id="004e2-140">Request tootake an incremental backup can fail with `FabricMissingFullBackupException`.</span></span> <span data-ttu-id="004e2-141">Deze uitzondering geeft aan dat er een van de volgende dingen Hallo gebeurt:</span><span class="sxs-lookup"><span data-stu-id="004e2-141">This exception indicates that one of hello following things is happening:</span></span>

- <span data-ttu-id="004e2-142">Hallo replica is nooit gemaakt van een volledige back-up nadat primaire geworden,</span><span class="sxs-lookup"><span data-stu-id="004e2-142">hello replica has never taken a full backup since it has become primary,</span></span>
- <span data-ttu-id="004e2-143">aantal Hallo logboekregistratie records sinds de laatste back-up Hallo is afgekapt of</span><span class="sxs-lookup"><span data-stu-id="004e2-143">some of hello log records since hello last backup has been truncated or</span></span>
- <span data-ttu-id="004e2-144">replica Hallo doorgegeven `MaxAccumulatedBackupLogSizeInMB` limiet.</span><span class="sxs-lookup"><span data-stu-id="004e2-144">replica passed hello `MaxAccumulatedBackupLogSizeInMB` limit.</span></span>

<span data-ttu-id="004e2-145">Gebruikers kunnen verhogen Hallo kans kunnen toodo incrementele back-ups wordt door het configureren van `MinLogSizeInMB` of `TruncationThresholdFactor`.</span><span class="sxs-lookup"><span data-stu-id="004e2-145">Users can increase hello likelihood of being able toodo incremental backups by configuring `MinLogSizeInMB` or `TruncationThresholdFactor`.</span></span>
<span data-ttu-id="004e2-146">Houd er rekening mee dat deze waarden, Hallo per replica schijfgebruik verhoogt.</span><span class="sxs-lookup"><span data-stu-id="004e2-146">Note that increasing these values increases hello per replica disk usage.</span></span>
<span data-ttu-id="004e2-147">Zie voor meer informatie [betrouwbare configuratie van Services](service-fabric-reliable-services-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="004e2-147">For more information, see [Reliable Services Configuration](service-fabric-reliable-services-configuration.md)</span></span>

<span data-ttu-id="004e2-148">`BackupInfo`bevat informatie over Hallo back-up, inclusief locatie Hallo Hallo map Hallo runtime Hallo back-up opgeslagen (`BackupInfo.Directory`).</span><span class="sxs-lookup"><span data-stu-id="004e2-148">`BackupInfo` provides information regarding hello backup, including hello location of hello folder where hello runtime saved hello backup (`BackupInfo.Directory`).</span></span> <span data-ttu-id="004e2-149">Hallo-callback-functie kunt verplaatsen Hallo `BackupInfo.Directory` tooan externe winkel of een andere locatie.</span><span class="sxs-lookup"><span data-stu-id="004e2-149">hello callback function can move hello `BackupInfo.Directory` tooan external store or another location.</span></span>  <span data-ttu-id="004e2-150">Deze functie wordt ook een Boole-waarde die aangeeft of het kunnen toosuccessfully verplaatsen Hallo back-upmap tooits target-locatie.</span><span class="sxs-lookup"><span data-stu-id="004e2-150">This function also returns a bool that indicates whether it was able toosuccessfully move hello backup folder tooits target location.</span></span>

<span data-ttu-id="004e2-151">Hallo volgende code laat zien hoe Hallo `BackupCallbackAsync` methode gebruikte tooupload Hallo back-tooAzure opslag kan zijn:</span><span class="sxs-lookup"><span data-stu-id="004e2-151">hello following code demonstrates how hello `BackupCallbackAsync` method can be used tooupload hello backup tooAzure Storage:</span></span>

```csharp
private async Task<bool> BackupCallbackAsync(BackupInfo backupInfo, CancellationToken cancellationToken)
{
    var backupId = Guid.NewGuid();

    await externalBackupStore.UploadBackupFolderAsync(backupInfo.Directory, backupId, cancellationToken);

    return true;
}
```

<span data-ttu-id="004e2-152">In Hallo voorgaande voorbeeld `ExternalBackupStore` is Hallo voorbeeldklasse die is gebruikt toointerface met Azure Blob storage en `UploadBackupFolderAsync` is Hallo-methode die comprimeert Hallo-map en plaatst het in hello Azure Blob-opslag.</span><span class="sxs-lookup"><span data-stu-id="004e2-152">In hello preceeding example, `ExternalBackupStore` is hello sample class that is used toointerface with Azure Blob storage, and `UploadBackupFolderAsync` is hello method that compresses hello folder and places it in hello Azure Blob store.</span></span>

<span data-ttu-id="004e2-153">Opmerking:</span><span class="sxs-lookup"><span data-stu-id="004e2-153">Note that:</span></span>

  - <span data-ttu-id="004e2-154">Er mag slechts één back-upbewerking onderweg per replica op elk moment.</span><span class="sxs-lookup"><span data-stu-id="004e2-154">There can be only one backup operation in-flight per replica at any given time.</span></span> <span data-ttu-id="004e2-155">Meer dan één `BackupAsync` aanroep tegelijk genereert `FabricBackupInProgressException` toolimit inflight back-ups tooone.</span><span class="sxs-lookup"><span data-stu-id="004e2-155">More than one `BackupAsync` call at a time will throw `FabricBackupInProgressException` toolimit inflight backups tooone.</span></span>
  - <span data-ttu-id="004e2-156">Als een replica mislukt via tijdens een back-up uitgevoerd wordt, kan Hallo back-up niet zijn voltooid.</span><span class="sxs-lookup"><span data-stu-id="004e2-156">If a replica fails over while a backup is in progress, hello backup may not have been completed.</span></span> <span data-ttu-id="004e2-157">Zodra het Hallo-failover is voltooid, het is dus Hallo-service verantwoordelijkheid toorestart Hallo back-up door aan te roepen `BackupAsync` indien nodig.</span><span class="sxs-lookup"><span data-stu-id="004e2-157">Thus, once hello failover finishes, it is hello service's responsibility toorestart hello backup by invoking `BackupAsync` as necessary.</span></span>

## <a name="restore-reliable-services"></a><span data-ttu-id="004e2-158">Reliable Services herstellen</span><span class="sxs-lookup"><span data-stu-id="004e2-158">Restore Reliable Services</span></span>
<span data-ttu-id="004e2-159">In het algemeen Hallo gevallen wanneer u tooperform een herstelbewerking moet mogelijk worden onderverdeeld in een van deze categorieën:</span><span class="sxs-lookup"><span data-stu-id="004e2-159">In general, hello cases when you might need tooperform a restore operation fall into one of these categories:</span></span>

  - <span data-ttu-id="004e2-160">Hallo service partitioneren gegevens verloren gaan.</span><span class="sxs-lookup"><span data-stu-id="004e2-160">hello service partition lost data.</span></span> <span data-ttu-id="004e2-161">Hallo-schijf voor twee van de drie replica's voor een partitie (met inbegrip van de primaire replica Hallo) opgehaald bijvoorbeeld beschadigd of gewist.</span><span class="sxs-lookup"><span data-stu-id="004e2-161">For example, hello disk for two out of three replicas for a partition (including hello primary replica) gets corrupted or wiped.</span></span> <span data-ttu-id="004e2-162">de nieuwe primaire Hallo wellicht toorestore gegevens uit een back-up.</span><span class="sxs-lookup"><span data-stu-id="004e2-162">hello new primary may need toorestore data from a backup.</span></span>
  - <span data-ttu-id="004e2-163">de hele service Hallo gaat verloren.</span><span class="sxs-lookup"><span data-stu-id="004e2-163">hello entire service is lost.</span></span> <span data-ttu-id="004e2-164">Bijvoorbeeld, een beheerder Hallo hele service verwijdert en dus Hallo-service en Hallo gegevens moet toobe hersteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-164">For example, an administrator removes hello entire service and thus hello service and hello data need toobe restored.</span></span>
  - <span data-ttu-id="004e2-165">Hallo service gerepliceerd beschadigd toepassingsgegevens (bijv, vanwege een fout van toepassing).</span><span class="sxs-lookup"><span data-stu-id="004e2-165">hello service replicated corrupt application data (e.g., because of an application bug).</span></span> <span data-ttu-id="004e2-166">In dit geval Hallo-service heeft toobe bijgewerkt of teruggekeerde tooremove Hallo oorzaak van het Hallo-beschadiging en gegevens die niet beschadigd toobe hersteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-166">In this case, hello service has toobe upgraded or reverted tooremove hello cause of hello corruption, and non-corrupt data has toobe restored.</span></span>

<span data-ttu-id="004e2-167">Hoewel veel manieren mogelijk, bieden we enkele voorbeelden voor het gebruik van `RestoreAsync` toorecover van Hallo bovenstaande scenario's.</span><span class="sxs-lookup"><span data-stu-id="004e2-167">While many approaches are possible, we offer some examples on using `RestoreAsync` toorecover from hello above scenarios.</span></span>

## <a name="partition-data-loss-in-reliable-services"></a><span data-ttu-id="004e2-168">Partitie gegevensverlies in Reliable Services</span><span class="sxs-lookup"><span data-stu-id="004e2-168">Partition data loss in Reliable Services</span></span>
<span data-ttu-id="004e2-169">In dit geval Hallo runtime automatisch zou gegevensverlies Hallo detecteren en aanroepen Hallo `OnDataLossAsync` API.</span><span class="sxs-lookup"><span data-stu-id="004e2-169">In this case, hello runtime would automatically detect hello data loss and invoke hello `OnDataLossAsync` API.</span></span>

<span data-ttu-id="004e2-170">Hallo service auteur moet tooperform hello toorecover te volgen:</span><span class="sxs-lookup"><span data-stu-id="004e2-170">hello service author needs tooperform hello following toorecover:</span></span>

  - <span data-ttu-id="004e2-171">Hallo virtuele basisklassenmethode overschrijven `OnDataLossAsync`.</span><span class="sxs-lookup"><span data-stu-id="004e2-171">Override hello virtual base class method `OnDataLossAsync`.</span></span>
  - <span data-ttu-id="004e2-172">Hallo meest recente back-ups vinden in Hallo een externe locatie op waarin back-ups Hallo-service.</span><span class="sxs-lookup"><span data-stu-id="004e2-172">Find hello latest backup in hello external location that contains hello service's backups.</span></span>
  - <span data-ttu-id="004e2-173">Download de meest recente back-up hello (en decomprimeren Hallo back-up naar back-upmap Hallo als het is gecomprimeerd).</span><span class="sxs-lookup"><span data-stu-id="004e2-173">Download hello latest backup (and uncompress hello backup into hello backup folder if it was compressed).</span></span>
  - <span data-ttu-id="004e2-174">Hallo `OnDataLossAsync` methode biedt een `RestoreContext`.</span><span class="sxs-lookup"><span data-stu-id="004e2-174">hello `OnDataLossAsync` method provides a `RestoreContext`.</span></span> <span data-ttu-id="004e2-175">Hallo aanroepen `RestoreAsync` API op Hallo opgegeven `RestoreContext`.</span><span class="sxs-lookup"><span data-stu-id="004e2-175">Call hello `RestoreAsync` API on hello provided `RestoreContext`.</span></span>
  - <span data-ttu-id="004e2-176">Retourneert waar als de Hallo herstelbewerking is gelukt.</span><span class="sxs-lookup"><span data-stu-id="004e2-176">Return true if hello restoration was a success.</span></span>

<span data-ttu-id="004e2-177">Hieronder volgt een voorbeeld van de implementatie van Hallo `OnDataLossAsync` methode:</span><span class="sxs-lookup"><span data-stu-id="004e2-177">Following is an example implementation of hello `OnDataLossAsync` method:</span></span>

```csharp
protected override async Task<bool> OnDataLossAsync(RestoreContext restoreCtx, CancellationToken cancellationToken)
{
    var backupFolder = await this.externalBackupStore.DownloadLastBackupAsync(cancellationToken);

    var restoreDescription = new RestoreDescription(backupFolder);

    await restoreCtx.RestoreAsync(restoreDescription);

    return true;
}
```

<span data-ttu-id="004e2-178">`RestoreDescription`doorgegeven toohello `RestoreContext.RestoreAsync` aanroep van een lid genaamd bevat `BackupFolderPath`.</span><span class="sxs-lookup"><span data-stu-id="004e2-178">`RestoreDescription` passed in toohello `RestoreContext.RestoreAsync` call contains a member called `BackupFolderPath`.</span></span>
<span data-ttu-id="004e2-179">Bij het herstellen van een eenmalige volledige back-up, dit `BackupFolderPath` toohello lokale pad van Hallo map waarin uw volledige back-up moet worden ingesteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-179">When restoring a single full backup, this `BackupFolderPath` should be set toohello local path of hello folder that contains your full backup.</span></span>
<span data-ttu-id="004e2-180">Bij het herstellen van een volledige back-up en een aantal incrementele back-ups `BackupFolderPath` toohello lokale pad van Hallo map waarin niet alleen volledige back-up hello, maar ook alle Hallo incrementele back-ups moet worden ingesteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-180">When restoring a full backup and a number of incremental backups, `BackupFolderPath` should be set toohello local path of hello folder that not only contains hello full backup, but also all hello incremental backups.</span></span>
<span data-ttu-id="004e2-181">`RestoreAsync`aanroep kunt throw `FabricMissingFullBackupException` als hello `BackupFolderPath` opgegeven bevat geen een volledige back-up.</span><span class="sxs-lookup"><span data-stu-id="004e2-181">`RestoreAsync` call can throw `FabricMissingFullBackupException` if hello `BackupFolderPath` provided does not contain a full backup.</span></span>
<span data-ttu-id="004e2-182">Het kan ook de throw `ArgumentException` als `BackupFolderPath` heeft een verbroken keten van incrementele back-ups.</span><span class="sxs-lookup"><span data-stu-id="004e2-182">It can also throw `ArgumentException` if `BackupFolderPath` has a broken chain of incremental backups.</span></span>
<span data-ttu-id="004e2-183">Als het Hallo volledige back-up bevat, bijvoorbeeld Hallo eerst incrementele en Hallo derde incrementele back-up, maar er is geen Hallo tweede incrementele back-up.</span><span class="sxs-lookup"><span data-stu-id="004e2-183">For example, if it contains hello full backup, hello first incremental and hello third incremental backup but no hello second incremental backup.</span></span>

> [!NOTE]
> <span data-ttu-id="004e2-184">Hallo RestorePolicy is tooSafe standaard ingesteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-184">hello RestorePolicy is set tooSafe by default.</span></span>  <span data-ttu-id="004e2-185">Dit betekent dat Hallo `RestoreAsync` API met ArgumentException mislukken als er die back-upmap Hallo bevat een staat die ouder zijn dan of gelijk zijn toohello status van deze replica wordt gedetecteerd.</span><span class="sxs-lookup"><span data-stu-id="004e2-185">This means that hello `RestoreAsync` API will fail with ArgumentException if it detects that hello backup folder contains a state that is older than or equal toohello state contained in this replica.</span></span>  <span data-ttu-id="004e2-186">`RestorePolicy.Force`kan worden gebruikt tooskip deze veiligheidscontrole.</span><span class="sxs-lookup"><span data-stu-id="004e2-186">`RestorePolicy.Force` can be used tooskip this safety check.</span></span> <span data-ttu-id="004e2-187">Dit is opgegeven als onderdeel van `RestoreDescription`.</span><span class="sxs-lookup"><span data-stu-id="004e2-187">This is specified as part of `RestoreDescription`.</span></span>
> 

## <a name="deleted-or-lost-service"></a><span data-ttu-id="004e2-188">Verwijderde of verloren-service</span><span class="sxs-lookup"><span data-stu-id="004e2-188">Deleted or lost service</span></span>
<span data-ttu-id="004e2-189">Als een service wordt verwijderd, moet u eerst opnieuw maken Hallo service voordat Hallo gegevens kunnen worden hersteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-189">If a service is removed, you must first re-create hello service before hello data can be restored.</span></span>  <span data-ttu-id="004e2-190">Het is belangrijk toocreate Hallo service Hello dezelfde configuratie, bijvoorbeeld partitieschema, zodat die gegevens Hallo naadloos kan worden hersteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-190">It is important toocreate hello service with hello same configuration, e.g., partitioning scheme, so that hello data can be restored seamlessly.</span></span>  <span data-ttu-id="004e2-191">Zodra het Hallo-service is, Hallo API toorestore gegevens (`OnDataLossAsync` hierboven) heeft toobe aangeroepen voor elke partitie van deze service.</span><span class="sxs-lookup"><span data-stu-id="004e2-191">Once hello service is up, hello API toorestore data (`OnDataLossAsync` above) has toobe invoked on every partition of this service.</span></span> <span data-ttu-id="004e2-192">Een manier om dat te bereiken dit is met behulp van `[FabricClient.TestManagementClient.StartPartitionDataLossAsync](https://msdn.microsoft.com/library/mt693569.aspx)` op elke partitie.</span><span class="sxs-lookup"><span data-stu-id="004e2-192">One way of achieving this is by using `[FabricClient.TestManagementClient.StartPartitionDataLossAsync](https://msdn.microsoft.com/library/mt693569.aspx)` on every partition.</span></span>  

<span data-ttu-id="004e2-193">Vanaf dit punt is de implementatie Hallo hetzelfde als Hallo bovenstaande scenario.</span><span class="sxs-lookup"><span data-stu-id="004e2-193">From this point, implementation is hello same as hello above scenario.</span></span> <span data-ttu-id="004e2-194">Elke partitie moet toorestore Hallo laatste relevante back-up van Hallo externe winkel.</span><span class="sxs-lookup"><span data-stu-id="004e2-194">Each partition needs toorestore hello latest relevant backup from hello external store.</span></span> <span data-ttu-id="004e2-195">Een voorbehoud is deze ID is mogelijk nu gewijzigd, omdat Hallo runtime partitie-id dynamisch maakt Hallo-partitie.</span><span class="sxs-lookup"><span data-stu-id="004e2-195">One caveat is that hello partition ID may have now changed, since hello runtime creates partition IDs dynamically.</span></span> <span data-ttu-id="004e2-196">Hallo-service moet dus toostore Hallo juiste partitiegegevens en service naam tooidentify Hallo juist meest recente back-toorestore uit voor elke partitie.</span><span class="sxs-lookup"><span data-stu-id="004e2-196">Thus, hello service needs toostore hello appropriate partition information and service name tooidentify hello correct latest backup toorestore from for each partition.</span></span>

> [!NOTE]
> <span data-ttu-id="004e2-197">Het wordt niet aangeraden toouse `FabricClient.ServiceManager.InvokeDataLossAsync` op elke partitie toorestore Hallo hele service, omdat dat de clusterstatus mogelijk beschadigd.</span><span class="sxs-lookup"><span data-stu-id="004e2-197">It is not recommended toouse `FabricClient.ServiceManager.InvokeDataLossAsync` on each partition toorestore hello entire service, since that may corrupt your cluster state.</span></span>
> 

## <a name="replication-of-corrupt-application-data"></a><span data-ttu-id="004e2-198">Replicatie van gegevens beschadigd toepassing</span><span class="sxs-lookup"><span data-stu-id="004e2-198">Replication of corrupt application data</span></span>
<span data-ttu-id="004e2-199">Als de upgrade van de toepassing hello zojuist is geïmplementeerd, heeft een fout, die mogelijk leiden tot beschadiging van gegevens.</span><span class="sxs-lookup"><span data-stu-id="004e2-199">If hello newly deployed application upgrade has a bug, that may cause corruption of data.</span></span> <span data-ttu-id="004e2-200">Bijvoorbeeld, een upgrade van de toepassing mogelijk gaan tooupdate elke telefoon nummer record in een betrouwbare woordenlijst met een ongeldige netnummer.</span><span class="sxs-lookup"><span data-stu-id="004e2-200">For example, an application upgrade may start tooupdate every phone number record in a Reliable Dictionary with an invalid area code.</span></span>  <span data-ttu-id="004e2-201">In dit geval worden Hallo ongeldige telefoonnummers gerepliceerd sinds de Service Fabric is niet bekend met Hallo aard van Hallo-gegevens die worden opgeslagen.</span><span class="sxs-lookup"><span data-stu-id="004e2-201">In this case, hello invalid phone numbers will be replicated since Service Fabric is not aware of hello nature of hello data that is being stored.</span></span>

<span data-ttu-id="004e2-202">Hallo eerst te beginnen toodo nadat u deze een egregious fout die ervoor zorgt gegevensbeschadiging dat detecteren toofreeze Hallo service is op toepassingsniveau Hallo en, indien mogelijk toohello versie van Hallo toepassingscode die geen Hallo bug niet bijwerken.</span><span class="sxs-lookup"><span data-stu-id="004e2-202">hello first thing toodo after you detect such an egregious bug that causes data corruption is toofreeze hello service at hello application level and, if possible, upgrade toohello version of hello application code that does not have hello bug.</span></span>  <span data-ttu-id="004e2-203">Zelfs nadat het Hallo-servicecode is opgelost, Hallo gegevens zijn mogelijk nog steeds beschadigd en gegevens moet daarom mogelijk toobe hersteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-203">However, even after hello service code is fixed, hello data may still be corrupt and thus data may need toobe restored.</span></span>  <span data-ttu-id="004e2-204">In dergelijke gevallen niet mogelijk voldoende toorestore Hallo meest recente back-up, sinds de meest recente back-ups Hallo ook mogelijk beschadigd.</span><span class="sxs-lookup"><span data-stu-id="004e2-204">In such cases, it may not be sufficient toorestore hello latest backup, since hello latest backups may also be corrupt.</span></span>  <span data-ttu-id="004e2-205">U hebt dus toofind Hallo laatste back-up die is gemaakt voordat het Hallo-gegevens zijn beschadigd.</span><span class="sxs-lookup"><span data-stu-id="004e2-205">Thus, you have toofind hello last backup that was made before hello data got corrupted.</span></span>

<span data-ttu-id="004e2-206">Als u niet zeker welke back-ups zijn beschadigd weet, kan u een nieuwe Service Fabric-cluster implementeren en herstel van Hallo back-ups van betrokken partities net als Hallo hierboven 'Deleted of verloren service' scenario.</span><span class="sxs-lookup"><span data-stu-id="004e2-206">If you are not sure which backups are corrupt, you could deploy a new Service Fabric cluster and restore hello backups of affected partitions just like hello above "Deleted or lost service" scenario.</span></span>  <span data-ttu-id="004e2-207">Voor elke partitie terug te zetten van Hallo back-ups van de meest recente toohello Hallo minste.</span><span class="sxs-lookup"><span data-stu-id="004e2-207">For each partition, start restoring hello backups from hello most recent toohello least.</span></span> <span data-ttu-id="004e2-208">Als u een back-up die geen Hallo beschadiging heeft gevonden, verplaatsen en verwijderen alle back-ups van deze partitie die recenter (dan back-up waren).</span><span class="sxs-lookup"><span data-stu-id="004e2-208">Once you find a backup that does not have hello corruption, move/delete all backups of this partition that were more recent (than that backup).</span></span> <span data-ttu-id="004e2-209">Herhaal dit proces voor elke partitie.</span><span class="sxs-lookup"><span data-stu-id="004e2-209">Repeat this process for each partition.</span></span> <span data-ttu-id="004e2-210">Nu als `OnDataLossAsync` wordt aangeroepen op Hallo partitie in een productiecluster Hallo Hallo laatste back-up gevonden in Hallo externe store Hallo een verzameld door Hallo hierboven proces zijn.</span><span class="sxs-lookup"><span data-stu-id="004e2-210">Now, when `OnDataLossAsync` is called on hello partition in hello production cluster, hello last backup found in hello external store will be hello one picked by hello above process.</span></span>

<span data-ttu-id="004e2-211">Nu Hallo stappen voor het Hallo 'Deleted of verloren service' sectie kan worden gebruikt toorestore Hallo status van de servicestatus toohello Hallo voordat Hallo buggy code beschadigd Hallo status.</span><span class="sxs-lookup"><span data-stu-id="004e2-211">Now, hello steps in hello "Deleted or lost service" section can be used toorestore hello state of hello service toohello state before hello buggy code corrupted hello state.</span></span>

<span data-ttu-id="004e2-212">Opmerking:</span><span class="sxs-lookup"><span data-stu-id="004e2-212">Note that:</span></span>

  - <span data-ttu-id="004e2-213">Wanneer u herstelt, is er is een kans dat Hallo back-up wordt hersteld ouder dan Hallo status van Hallo partitie voordat Hallo gegevens verloren gegaan.</span><span class="sxs-lookup"><span data-stu-id="004e2-213">When you restore, there is a chance that hello backup being restored is older than hello state of hello partition before hello data was lost.</span></span> <span data-ttu-id="004e2-214">Daarom moet u weer alleen als een laatste toevlucht toorecover zo veel mogelijk gegevens mogelijk.</span><span class="sxs-lookup"><span data-stu-id="004e2-214">Because of this, you should restore only as a last resort toorecover as much data as possible.</span></span>
  - <span data-ttu-id="004e2-215">Hallo tekenreeks met Hallo back-upmap pad en hello paden van bestanden in de back-upmap Hallo kunnen niet groter zijn dan 255 tekens, afhankelijk van Hallo FabricDataRoot pad en de lengte van de naam van het toepassingstype.</span><span class="sxs-lookup"><span data-stu-id="004e2-215">hello string that represents hello backup folder path and hello paths of files inside hello backup folder can be greater than 255 characters, depending on hello FabricDataRoot path and Application Type name's length.</span></span> <span data-ttu-id="004e2-216">Hierdoor kunnen sommige .NET-methoden zoals `Directory.Move`, toothrow hello `PathTooLongException` uitzondering.</span><span class="sxs-lookup"><span data-stu-id="004e2-216">This can cause some .NET methods, like `Directory.Move`, toothrow hello `PathTooLongException` exception.</span></span> <span data-ttu-id="004e2-217">Er is een oplossing toodirectly aanroepen kan kernel32-API's, zoals `CopyFile`.</span><span class="sxs-lookup"><span data-stu-id="004e2-217">One workaround is toodirectly call kernel32 APIs, like `CopyFile`.</span></span>

## <a name="backup-and-restore-reliable-actors"></a><span data-ttu-id="004e2-218">Back-up en herstel Reliable Actors</span><span class="sxs-lookup"><span data-stu-id="004e2-218">Backup and restore Reliable Actors</span></span>


<span data-ttu-id="004e2-219">Betrouwbare actoren Framework is ingebouwd in Reliable Services.</span><span class="sxs-lookup"><span data-stu-id="004e2-219">Reliable Actors Framework is built on top of Reliable Services.</span></span> <span data-ttu-id="004e2-220">Hallo ActorService die als host fungeert voor Hallo actor(s) is een stateful betrouwbare service.</span><span class="sxs-lookup"><span data-stu-id="004e2-220">hello ActorService which hosts hello actor(s) is a stateful reliable service.</span></span> <span data-ttu-id="004e2-221">Daarom alle Hallo back-up en herstel functionaliteit beschikbaar zijn in Reliable Services is ook beschikbaar tooReliable actoren (met uitzondering van het gedrag dat specifieke state-provider zijn).</span><span class="sxs-lookup"><span data-stu-id="004e2-221">Hence, all hello backup and restore functionality available in Reliable Services is also available tooReliable Actors (except behaviors that are state provider specific).</span></span> <span data-ttu-id="004e2-222">Sinds de back-ups zullen worden uitgevoerd op basis van de per-partitie, statussen voor alle actoren in de betreffende partitie, worden back-up (en herstel lijkt en gebeurt op basis van per partitie).</span><span class="sxs-lookup"><span data-stu-id="004e2-222">Since backups will be taken on a per-partition basis, states for all actors in that partition will be backed up (and restoration is similar and will happen on a per-partition basis).</span></span> <span data-ttu-id="004e2-223">tooperform back-up/herstel, Hallo service-eigenaar moet een aangepaste actor serviceklasse die is afgeleid van klasse ActorService maken en vervolgens back-up/herstel vergelijkbare tooReliable Services zoals hierboven is beschreven in de vorige secties.</span><span class="sxs-lookup"><span data-stu-id="004e2-223">tooperform backup/restore, hello service owner should create a custom actor service class that derives from ActorService class and then do backup/restore similar tooReliable Services as described above in previous sections.</span></span>

```csharp
class MyCustomActorService : ActorService
{
     public MyCustomActorService(StatefulServiceContext context, ActorTypeInformation actorTypeInfo)
            : base(context, actorTypeInfo)
     {                  
     }
    
    //
   // Method overrides and other code.
    //
}
```

<span data-ttu-id="004e2-224">Wanneer u een aangepaste actor serviceklasse maakt, moet u tooregister dat ook bij het registreren van Hallo actor.</span><span class="sxs-lookup"><span data-stu-id="004e2-224">When you create a custom actor service class, you need tooregister that as well when registering hello actor.</span></span>

```csharp
ActorRuntime.RegisterActorAsync<MyActor>(
   (context, typeInfo) => new MyCustomActorService(context, typeInfo)).GetAwaiter().GetResult();
```

<span data-ttu-id="004e2-225">Hallo standaard state-provider voor Reliable Actors is `KvsActorStateProvider`.</span><span class="sxs-lookup"><span data-stu-id="004e2-225">hello default state provider for Reliable Actors is `KvsActorStateProvider`.</span></span> <span data-ttu-id="004e2-226">Incrementele back-up is niet standaard ingeschakeld voor `KvsActorStateProvider`.</span><span class="sxs-lookup"><span data-stu-id="004e2-226">Incremental backup is not enabled by default for `KvsActorStateProvider`.</span></span> <span data-ttu-id="004e2-227">U kunt de incrementele back-up inschakelen door het maken van `KvsActorStateProvider` met Hallo de desbetreffende instelling in de constructor en vervolgens doorgeeft tooActorService constructor zoals weergegeven in het volgende codefragment:</span><span class="sxs-lookup"><span data-stu-id="004e2-227">You can enable incremental backup by creating `KvsActorStateProvider` with hello appropriate setting in its constructor and then passing it tooActorService constructor as shown in following code snippet:</span></span>

```csharp
class MyCustomActorService : ActorService
{
     public MyCustomActorService(StatefulServiceContext context, ActorTypeInformation actorTypeInfo)
            : base(context, actorTypeInfo, null, null, new KvsActorStateProvider(true)) // Enable incremental backup
     {                  
     }
    
    //
   // Method overrides and other code.
    //
}
```

<span data-ttu-id="004e2-228">Nadat de incrementele back-up is ingeschakeld, duurt een incrementele back-up voor een van de volgende redenen mislukken met FabricMissingFullBackupException en moet u tootake een volledige back-up voordat u incrementele backup(s):</span><span class="sxs-lookup"><span data-stu-id="004e2-228">After incremental backup has been enabled, taking an incremental backup can fail with FabricMissingFullBackupException for one of following reasons and you will need tootake a full backup before taking incremental backup(s):</span></span>

  - <span data-ttu-id="004e2-229">Hallo replica heeft nooit genomen voor een volledige back-up nadat primaire werd.</span><span class="sxs-lookup"><span data-stu-id="004e2-229">hello replica has never taken a full backup since it became primary.</span></span>
  - <span data-ttu-id="004e2-230">Aantal logboekrecords Hallo zijn afgebroken sinds laatste back-up is gemaakt.</span><span class="sxs-lookup"><span data-stu-id="004e2-230">Some of hello log records were truncated since last backup was taken.</span></span>

<span data-ttu-id="004e2-231">Wanneer incrementele back-up is ingeschakeld, `KvsActorStateProvider` gebruikt geen circulaire buffer toomanage het logboek vastgelegd en regelmatig worden afgekapt.</span><span class="sxs-lookup"><span data-stu-id="004e2-231">When incremental backup is enabled, `KvsActorStateProvider` does not use circular buffer toomanage its log records and periodically truncates it.</span></span> <span data-ttu-id="004e2-232">Als geen back-up wordt gemaakt door gebruiker gedurende een periode van 45 minuten, wordt in Hallo systeem automatisch wordt afgekapt Hallo logboekrecords.</span><span class="sxs-lookup"><span data-stu-id="004e2-232">If no backup is taken by user for a period of 45 minutes, hello system automatically truncates hello log records.</span></span> <span data-ttu-id="004e2-233">Dit interval kan worden geconfigureerd door op te geven `logTrunctationIntervalInMinutes` in `KvsActorStateProvider` constructor (vergelijkbaar toowhen incrementele back-up inschakelen).</span><span class="sxs-lookup"><span data-stu-id="004e2-233">This interval can be configured by specifying `logTrunctationIntervalInMinutes` in `KvsActorStateProvider` constructor (similar toowhen enabling incremental backup).</span></span> <span data-ttu-id="004e2-234">Hallo logboekrecords kunnen ook ophalen afgekapt als primaire replica moet toobuild aan een andere replica door te sturen alle bijbehorende gegevens.</span><span class="sxs-lookup"><span data-stu-id="004e2-234">hello log records may also get truncated if primary replica need toobuild another replica by sending all its data.</span></span>

<span data-ttu-id="004e2-235">Bij het uitvoeren van herstel van een back-keten vergelijkbare tooReliable Services moet Hallo BackupFolderPath submappen met een submap met de volledige back-up en anderen submappen met incrementele backup(s) bevatten.</span><span class="sxs-lookup"><span data-stu-id="004e2-235">When doing restore from a backup chain, similar tooReliable Services, hello BackupFolderPath should contain subdirectories with one subdirectory containing full backup and others subdirectories containing incremental backup(s).</span></span> <span data-ttu-id="004e2-236">Hallo terugzetten API genereert FabricException met het bijbehorende bericht als Hallo upketen validatie mislukt.</span><span class="sxs-lookup"><span data-stu-id="004e2-236">hello restore API will throw FabricException with appropriate error message if hello backup chain validation fails.</span></span> 

> [!NOTE]
> <span data-ttu-id="004e2-237">`KvsActorStateProvider`momenteel worden Hallo optie RestorePolicy.Safe genegeerd.</span><span class="sxs-lookup"><span data-stu-id="004e2-237">`KvsActorStateProvider` currently ignores hello option RestorePolicy.Safe.</span></span> <span data-ttu-id="004e2-238">Ondersteuning voor deze functie is in een toekomstige release gepland.</span><span class="sxs-lookup"><span data-stu-id="004e2-238">Support for this feature is planned in an upcoming release.</span></span>
> 

## <a name="testing-backup-and-restore"></a><span data-ttu-id="004e2-239">Testen van back-up en herstel</span><span class="sxs-lookup"><span data-stu-id="004e2-239">Testing Backup and Restore</span></span>
<span data-ttu-id="004e2-240">Het is belangrijk tooensure die kritieke gegevens worden back-up en kan worden hersteld vanuit.</span><span class="sxs-lookup"><span data-stu-id="004e2-240">It is important tooensure that critical data is being backed up, and can be restored from.</span></span> <span data-ttu-id="004e2-241">Dit kan worden gedaan door aan te roepen Hallo `Start-ServiceFabricPartitionDataLoss` cmdlet in PowerShell die verlies van gegevens in een bepaalde partitie tootest veroorzaken kan of Hallo gegevens back-up en herstel functionaliteit voor uw service werkt zoals verwacht.</span><span class="sxs-lookup"><span data-stu-id="004e2-241">This can be done by invoking hello `Start-ServiceFabricPartitionDataLoss` cmdlet in PowerShell that can induce data loss in a particular partition tootest whether hello data backup and restore functionality for your service is working as expected.</span></span>  <span data-ttu-id="004e2-242">Het is ook mogelijk tooprogrammatically aanroepen verlies van gegevens en herstel van die gebeurtenis ook.</span><span class="sxs-lookup"><span data-stu-id="004e2-242">It is also possible tooprogrammatically invoke data loss and restore from that event as well.</span></span>

> [!NOTE]
> <span data-ttu-id="004e2-243">U vindt een Voorbeeldimplementatie van back-up en herstel functionaliteit in Hallo Reference-Web-App op GitHub.</span><span class="sxs-lookup"><span data-stu-id="004e2-243">You can find a sample implementation of backup and restore functionality in hello Web Reference App on GitHub.</span></span> <span data-ttu-id="004e2-244">Zie Hallo `Inventory.Service` service voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="004e2-244">Please look at hello `Inventory.Service` service for more details.</span></span>
> 
> 

## <a name="under-hello-hood-more-details-on-backup-and-restore"></a><span data-ttu-id="004e2-245">Achter de schermen Hallo: meer informatie over back-up en herstel</span><span class="sxs-lookup"><span data-stu-id="004e2-245">Under hello hood: more details on backup and restore</span></span>
<span data-ttu-id="004e2-246">Hier volgt een aantal meer informatie over back-up en herstel.</span><span class="sxs-lookup"><span data-stu-id="004e2-246">Here's some more details on backup and restore.</span></span>

### <a name="backup"></a><span data-ttu-id="004e2-247">Back-up</span><span class="sxs-lookup"><span data-stu-id="004e2-247">Backup</span></span>
<span data-ttu-id="004e2-248">Hallo betrouwbare status Manager biedt Hallo mogelijkheid toocreate consistent back-ups zonder blokkering van een lees- of schrijfbewerkingen.</span><span class="sxs-lookup"><span data-stu-id="004e2-248">hello Reliable State Manager provides hello ability toocreate consistent backups without blocking any read or write operations.</span></span> <span data-ttu-id="004e2-249">toodo dus hierbij wordt gebruikgemaakt van een mechanisme controlepunt- en logboekbestanden.</span><span class="sxs-lookup"><span data-stu-id="004e2-249">toodo so, it utilizes a checkpoint and log persistence mechanism.</span></span>  <span data-ttu-id="004e2-250">Hallo betrouwbare statusbeheer fuzzy (lightweight) controlepunten bij bepaalde punten toorelieve druk uit Hallo transactionele logboek neemt en hersteltijden te verbeteren.</span><span class="sxs-lookup"><span data-stu-id="004e2-250">hello Reliable State Manager takes fuzzy (lightweight) checkpoints at certain points toorelieve pressure from hello transactional log and improve recovery times.</span></span>  <span data-ttu-id="004e2-251">Wanneer `BackupAsync` wordt aangeroepen, Hallo betrouwbare statusbeheer Hiermee geeft u alle objecten van betrouwbare toocopy hun meest recente controlepunt bestanden tooa lokale back-upmap.</span><span class="sxs-lookup"><span data-stu-id="004e2-251">When `BackupAsync` is called, hello Reliable State Manager instructs all Reliable objects toocopy their latest checkpoint files tooa local backup folder.</span></span>  <span data-ttu-id="004e2-252">Hallo betrouwbare status Manager kopieert vervolgens alle logboekrecords Hallo 'start aanwijzer' toohello nieuwste logboekrecord vanaf in Hallo back-upmap.</span><span class="sxs-lookup"><span data-stu-id="004e2-252">Then, hello Reliable State Manager copies all log records, starting from hello "start pointer" toohello latest log record into hello backup folder.</span></span>  <span data-ttu-id="004e2-253">Aangezien alle Hallo logboekrecords van de meest recente logboekrecord toohello zijn opgenomen in Hallo back-up en Hallo betrouwbare statusbeheer vooraf geschreven logboekregistratie behoudt, Hallo betrouwbare status Manager zorgt ervoor dat alle transacties die toegewezen zijn (`CommitAsync` heeft geretourneerd met succes) zijn opgenomen in Hallo back-up.</span><span class="sxs-lookup"><span data-stu-id="004e2-253">Since all hello log records up toohello latest log record are included in hello backup and hello Reliable State Manager preserves write-ahead logging, hello Reliable State Manager guarantees that all transactions that are committed (`CommitAsync` has returned successfully) are included in hello backup.</span></span>

<span data-ttu-id="004e2-254">De transactie die na doorvoeren `BackupAsync` mei is aangeroepen of mogelijk niet in Hallo back-up.</span><span class="sxs-lookup"><span data-stu-id="004e2-254">Any transaction that commits after `BackupAsync` has been called may or may not be in hello backup.</span></span>  <span data-ttu-id="004e2-255">Zodra het Hallo lokale back-upmap is gevuld door Hallo platform (dat wil zeggen, lokale back-up is voltooid door de runtime Hallo), back-callback Hallo-service is aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="004e2-255">Once hello local backup folder has been populated by hello platform (i.e., local backup is completed by hello runtime), hello service's backup callback is invoked.</span></span>  <span data-ttu-id="004e2-256">Deze retouraanroep is verantwoordelijk voor het verplaatsen van Hallo back-upmap tooan externe locatie bevindt, zoals Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="004e2-256">This callback is responsible for moving hello backup folder tooan external location such as Azure Storage.</span></span>

### <a name="restore"></a><span data-ttu-id="004e2-257">Herstellen</span><span class="sxs-lookup"><span data-stu-id="004e2-257">Restore</span></span>
<span data-ttu-id="004e2-258">Hallo betrouwbare status Manager biedt Hallo mogelijkheid toorestore vanuit een back-up met behulp van Hallo `RestoreAsync` API.</span><span class="sxs-lookup"><span data-stu-id="004e2-258">hello Reliable State Manager provides hello ability toorestore from a backup by using hello `RestoreAsync` API.</span></span>  
<span data-ttu-id="004e2-259">Hallo `RestoreAsync` methode op `RestoreContext` kunnen worden aangeroepen alleen Hallo `OnDataLossAsync` methode.</span><span class="sxs-lookup"><span data-stu-id="004e2-259">hello `RestoreAsync` method on `RestoreContext` can be called only inside hello `OnDataLossAsync` method.</span></span>
<span data-ttu-id="004e2-260">Hallo bool geretourneerd door `OnDataLossAsync` geeft aan of Hallo-service de status van een externe bron hersteld.</span><span class="sxs-lookup"><span data-stu-id="004e2-260">hello bool returned by `OnDataLossAsync` indicates whether hello service restored its state from an external source.</span></span>
<span data-ttu-id="004e2-261">Als hello `OnDataLossAsync` true retourneert, Service Fabric alle andere replica's van deze primaire opnieuw opgebouwd.</span><span class="sxs-lookup"><span data-stu-id="004e2-261">If hello `OnDataLossAsync` returns true, Service Fabric will rebuild all other replicas from this primary.</span></span> <span data-ttu-id="004e2-262">Service Fabric zorgt ervoor dat replica's die worden ontvangen `OnDataLossAsync` aanroepen van eerste overgang toohello primaire rol, maar zijn niet verleend status lezen of schrijven status.</span><span class="sxs-lookup"><span data-stu-id="004e2-262">Service Fabric ensures that replicas that will receive `OnDataLossAsync` call first transition toohello primary role but are not granted read status or write status.</span></span>
<span data-ttu-id="004e2-263">Dit houdt in dat voor StatefulService implementeerders, `RunAsync` wordt niet aangeroepen tot `OnDataLossAsync` met succes wordt voltooid.</span><span class="sxs-lookup"><span data-stu-id="004e2-263">This implies that for StatefulService implementers, `RunAsync` will not be called until `OnDataLossAsync` finishes successfully.</span></span>
<span data-ttu-id="004e2-264">Vervolgens `OnDataLossAsync` wordt aangeroepen op de nieuwe primaire Hallo.</span><span class="sxs-lookup"><span data-stu-id="004e2-264">Then, `OnDataLossAsync` will be invoked on hello new primary.</span></span>
<span data-ttu-id="004e2-265">Totdat een service deze API is (met retourneert true of false voltooit) en relevante Hallo-herconfiguratie is voltooid, wordt Hallo API behouden wordt aangeroepen één tegelijk.</span><span class="sxs-lookup"><span data-stu-id="004e2-265">Until a service completes this API successfully (by returning true or false) and finishes hello relevant reconfiguration, hello API will keep being called one at a time.</span></span>

<span data-ttu-id="004e2-266">`RestoreAsync`alle bestaande status in Hallo primaire replica die is aangeroepen op eerst verwijderd.</span><span class="sxs-lookup"><span data-stu-id="004e2-266">`RestoreAsync` first drops all existing state in hello primary replica that it was called on.</span></span>  
<span data-ttu-id="004e2-267">Hallo betrouwbare statusbeheer maakt vervolgens alle Hallo betrouwbare objecten die zijn opgenomen in de back-upmap Hallo.</span><span class="sxs-lookup"><span data-stu-id="004e2-267">Then hello Reliable State Manager creates all hello Reliable objects that exist in hello backup folder.</span></span>  
<span data-ttu-id="004e2-268">Hallo betrouwbare objecten zijn vervolgens gebruiksaanwijzing toorestore uit hun controlepunten in de back-upmap Hallo.</span><span class="sxs-lookup"><span data-stu-id="004e2-268">Next, hello Reliable objects are instructed toorestore from their checkpoints in hello backup folder.</span></span>  
<span data-ttu-id="004e2-269">Ten slotte Hallo betrouwbare status Manager een eigen staat vanuit Hallo logboekrecords in de back-upmap Hallo herstelt en wordt een herstelbewerking uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="004e2-269">Finally, hello Reliable State Manager recovers its own state from hello log records in hello backup folder and performs recovery.</span></span>  
<span data-ttu-id="004e2-270">Als onderdeel van het herstelproces Hallo zijn vanaf Hallo 'beginpunt' bewerkingen waarvoor logboekrecords doorvoeren in de back-upmap Hallo herhaald toohello betrouwbare objecten.</span><span class="sxs-lookup"><span data-stu-id="004e2-270">As part of hello recovery process, operations starting from hello "starting point" that have commit log records in hello backup folder are replayed toohello Reliable objects.</span></span>  
<span data-ttu-id="004e2-271">Deze stap zorgt ervoor dat Hallo herstelde status consistent is.</span><span class="sxs-lookup"><span data-stu-id="004e2-271">This step ensures that hello recovered state is consistent.</span></span>

## <a name="next-steps"></a><span data-ttu-id="004e2-272">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="004e2-272">Next steps</span></span>
  - [<span data-ttu-id="004e2-273">Betrouwbare verzamelingen</span><span class="sxs-lookup"><span data-stu-id="004e2-273">Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
  - [<span data-ttu-id="004e2-274">Betrouwbare Services snel starten</span><span class="sxs-lookup"><span data-stu-id="004e2-274">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  - [<span data-ttu-id="004e2-275">Betrouwbare Services meldingen</span><span class="sxs-lookup"><span data-stu-id="004e2-275">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
  - [<span data-ttu-id="004e2-276">Configuratie van betrouwbare Services</span><span class="sxs-lookup"><span data-stu-id="004e2-276">Reliable Services configuration</span></span>](service-fabric-reliable-services-configuration.md)
  - [<span data-ttu-id="004e2-277">Referentie voor ontwikkelaars voor betrouwbare verzamelingen</span><span class="sxs-lookup"><span data-stu-id="004e2-277">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

