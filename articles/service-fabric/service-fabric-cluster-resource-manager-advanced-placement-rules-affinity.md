---
title: Service Fabric Cluster Resource Manager - affiniteit | Microsoft Docs
description: Overzicht van de affiniteit voor Service Fabric-Services configureren
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 678073e1-d08d-46c4-a811-826e70aba6c4
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 3efda4ee4016245668e5da431d7b8868a21c790e
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/18/2017
---
# <a name="configuring-and-using-service-affinity-in-service-fabric"></a><span data-ttu-id="8b5be-103">Configureren en gebruiken van serviceaffiniteit in Service Fabric</span><span class="sxs-lookup"><span data-stu-id="8b5be-103">Configuring and using service affinity in Service Fabric</span></span>
<span data-ttu-id="8b5be-104">Affiniteit is een besturingselement die hoofdzakelijk wordt geleverd bij de overgang van grotere monolithische toepassingen in de cloud en microservices wereld vereenvoudigen.</span><span class="sxs-lookup"><span data-stu-id="8b5be-104">Affinity is a control that is provided mainly to help ease the transition of larger monolithic applications into the cloud and microservices world.</span></span> <span data-ttu-id="8b5be-105">Dit wordt ook gebruikt als een optimalisatie voor het verbeteren van de prestaties van services, maar in dat geval neveneffecten hebben.</span><span class="sxs-lookup"><span data-stu-id="8b5be-105">It is also used as an optimization for improving the performance of services, although doing so can have side effects.</span></span>

<span data-ttu-id="8b5be-106">Stel dat u u brengt een grotere app of een die zojuist is niet ontworpen voor microservices rekening naar Service Fabric (of een gedistribueerde omgeving).</span><span class="sxs-lookup"><span data-stu-id="8b5be-106">Let’s say you’re bringing a larger app, or one that just wasn’t designed with microservices in mind, to Service Fabric (or any distributed environment).</span></span> <span data-ttu-id="8b5be-107">Dit type overgang is gebruikelijk.</span><span class="sxs-lookup"><span data-stu-id="8b5be-107">This type of transition is common.</span></span> <span data-ttu-id="8b5be-108">U start door het opheffen van de hele app in de omgeving, het verpakken en soepel ervoor dat wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="8b5be-108">You start by lifting the entire app into the environment, packaging it, and making sure it is running smoothly.</span></span> <span data-ttu-id="8b5be-109">U start splitsen in verschillende kleinere services dat alle met elkaar communiceren.</span><span class="sxs-lookup"><span data-stu-id="8b5be-109">Then you start breaking it down into different smaller services that all talk to each other.</span></span>

<span data-ttu-id="8b5be-110">Uiteindelijk merkt u dat de toepassing enkele problemen ondervindt.</span><span class="sxs-lookup"><span data-stu-id="8b5be-110">Eventually you may find that the application is experiencing some issues.</span></span> <span data-ttu-id="8b5be-111">De problemen vallen gewoonlijk in een van deze categorieën:</span><span class="sxs-lookup"><span data-stu-id="8b5be-111">The issues usually fall into one of these categories:</span></span>

1. <span data-ttu-id="8b5be-112">Sommige onderdeel X in de app monolithische had een niet-gedocumenteerde afhankelijkheid voor Y-onderdeel en u deze onderdelen alleen omgezet in afzonderlijke services.</span><span class="sxs-lookup"><span data-stu-id="8b5be-112">Some component X in the monolithic app had an undocumented dependency on component Y, and you just turned those components into separate services.</span></span> <span data-ttu-id="8b5be-113">Aangezien deze services zijn nu wordt uitgevoerd op verschillende knooppunten in het cluster, zijn ze zijn verbroken.</span><span class="sxs-lookup"><span data-stu-id="8b5be-113">Since these services are now running on different nodes in the cluster, they're broken.</span></span>
2. <span data-ttu-id="8b5be-114">Deze onderdelen communiceren (lokale named-pipes | gedeeld geheugen | bestanden op schijf) en ze hoeven te worden kunnen nu schrijven naar een gedeelde lokale bron van de prestaties.</span><span class="sxs-lookup"><span data-stu-id="8b5be-114">These components communicate via (local named pipes | shared memory | files on disk) and they really need to be able to write to a shared local resource for performance reasons right now.</span></span> <span data-ttu-id="8b5be-115">Deze harde afhankelijkheid opgehaald later verwijderd, mogelijk.</span><span class="sxs-lookup"><span data-stu-id="8b5be-115">That hard dependency gets removed later, maybe.</span></span>
3. <span data-ttu-id="8b5be-116">Alles werkt prima, maar het blijkt dat deze twee componenten daadwerkelijk chatty/prestatiegebeurtenissen gevoelige zijn.</span><span class="sxs-lookup"><span data-stu-id="8b5be-116">Everything is fine, but it turns out that these two components are actually chatty/performance sensitive.</span></span> <span data-ttu-id="8b5be-117">Wanneer ze deze naar de afzonderlijke services verplaatst algemene toepassingsprestaties tanked of latentie verhoogd.</span><span class="sxs-lookup"><span data-stu-id="8b5be-117">When they moved them into separate services overall application performance tanked or latency increased.</span></span> <span data-ttu-id="8b5be-118">Daardoor voldoet de algehele toepassing niet aan de verwachtingen.</span><span class="sxs-lookup"><span data-stu-id="8b5be-118">As a result, the overall application is not meeting expectations.</span></span>

<span data-ttu-id="8b5be-119">In dergelijke gevallen we niet wilt kwijtraken ons refactoring werk en niet wilt terugkeren naar de monoliet.</span><span class="sxs-lookup"><span data-stu-id="8b5be-119">In these cases, we don’t want to lose our refactoring work, and don’t want to go back to the monolith.</span></span> <span data-ttu-id="8b5be-120">De laatste voorwaarde wenselijk zelfs als een gewone optimalisatie.</span><span class="sxs-lookup"><span data-stu-id="8b5be-120">The last condition may even be desirable as a plain optimization.</span></span> <span data-ttu-id="8b5be-121">Echter, totdat we de onderdelen natuurlijk werken als services kunnen ontwerpen (of de prestatieverwachtingen een andere manier kunnen worden opgelost) gaan we moeten sommige beeld krijgt van plaats.</span><span class="sxs-lookup"><span data-stu-id="8b5be-121">However, until we can redesign the components to work naturally as services (or until we can solve the performance expectations some other way) we're going to need some sense of locality.</span></span>

<span data-ttu-id="8b5be-122">Hoe pakt u dit aan?</span><span class="sxs-lookup"><span data-stu-id="8b5be-122">What to do?</span></span> <span data-ttu-id="8b5be-123">U kan ook proberen affiniteit inschakelen.</span><span class="sxs-lookup"><span data-stu-id="8b5be-123">Well, you could try turning on affinity.</span></span>

## <a name="how-to-configure-affinity"></a><span data-ttu-id="8b5be-124">Affiniteit configureren</span><span class="sxs-lookup"><span data-stu-id="8b5be-124">How to configure affinity</span></span>
<span data-ttu-id="8b5be-125">Als u affiniteit instelt, moet u een affiniteitsrelatie tussen twee verschillende services definiëren.</span><span class="sxs-lookup"><span data-stu-id="8b5be-125">To set up affinity, you define an affinity relationship between two different services.</span></span> <span data-ttu-id="8b5be-126">U kunt zien affiniteit als 'wijst' een service op een andere en spreken "deze service kan alleen uitgevoerd wanneer dat service wordt uitgevoerd."</span><span class="sxs-lookup"><span data-stu-id="8b5be-126">You can think of affinity as “pointing” one service at another and saying “This service can only run where that service is running.”</span></span> <span data-ttu-id="8b5be-127">Soms is affiniteit als een bovenliggende/onderliggende relatie (waar u wijst u de onderliggende op de bovenliggende).</span><span class="sxs-lookup"><span data-stu-id="8b5be-127">Sometimes we refer to affinity as a parent/child relationship (where you point the child at the parent).</span></span> <span data-ttu-id="8b5be-128">Affiniteit zorgt ervoor dat de replica's of exemplaren van een service zijn geplaatst op de knooppunten dezelfde als die van een andere service.</span><span class="sxs-lookup"><span data-stu-id="8b5be-128">Affinity ensures that the replicas or instances of one service are placed on the same nodes as those of another service.</span></span>

```csharp
ServiceCorrelationDescription affinityDescription = new ServiceCorrelationDescription();
affinityDescription.Scheme = ServiceCorrelationScheme.Affinity;
affinityDescription.ServiceName = new Uri("fabric:/otherApplication/parentService");
serviceDescription.Correlations.Add(affinityDescription);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

> [!NOTE]
> <span data-ttu-id="8b5be-129">Een onderliggende service alleen deel uitmaken van een relatie met één-relatie.</span><span class="sxs-lookup"><span data-stu-id="8b5be-129">A child service can only participate in a single affinity relationship.</span></span> <span data-ttu-id="8b5be-130">Als u wilt dat het kind tegelijk affiniteit worden gedefinieerd met twee bovenliggende services hebt u een aantal opties:</span><span class="sxs-lookup"><span data-stu-id="8b5be-130">If you wanted the child to be affinitized to two parent services at once you have a couple options:</span></span>
> - <span data-ttu-id="8b5be-131">De relaties reverse (hebben parentService1 en wijst u de huidige onderliggende service parentService2), of</span><span class="sxs-lookup"><span data-stu-id="8b5be-131">Reverse the relationships (have parentService1 and parentService2 point at the current child service), or</span></span>
> - <span data-ttu-id="8b5be-132">Een van de ouders aanwijzen als een hub met conventie en alle services, wijst u op of de service hebben.</span><span class="sxs-lookup"><span data-stu-id="8b5be-132">Designate one of the parents as a hub by convention and have all services point at that service.</span></span> 
>
> <span data-ttu-id="8b5be-133">Het resulterende plaatsingsgedrag in het cluster moet hetzelfde zijn.</span><span class="sxs-lookup"><span data-stu-id="8b5be-133">The resulting placement behavior in the cluster should be the same.</span></span>
>

## <a name="different-affinity-options"></a><span data-ttu-id="8b5be-134">Affiniteit van verschillende opties</span><span class="sxs-lookup"><span data-stu-id="8b5be-134">Different affinity options</span></span>
<span data-ttu-id="8b5be-135">Affiniteit wordt voorgesteld via een van de verschillende schema's voor correlatie en heeft twee verschillende modi.</span><span class="sxs-lookup"><span data-stu-id="8b5be-135">Affinity is represented via one of several correlation schemes, and has two different modes.</span></span> <span data-ttu-id="8b5be-136">De meest voorkomende modus van de affiniteit is zogeheten nonalignedaffinity zijn.</span><span class="sxs-lookup"><span data-stu-id="8b5be-136">The most common mode of affinity is what we call NonAlignedAffinity.</span></span> <span data-ttu-id="8b5be-137">In nonalignedaffinity zijn, worden de replica's of exemplaren van de andere services op de dezelfde knooppunten geplaatst.</span><span class="sxs-lookup"><span data-stu-id="8b5be-137">In NonAlignedAffinity, the replicas or instances of the different services are placed on the same nodes.</span></span> <span data-ttu-id="8b5be-138">De andere modus is AlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="8b5be-138">The other mode is AlignedAffinity.</span></span> <span data-ttu-id="8b5be-139">Uitgelijnde affiniteit is nuttig alleen met stateful services.</span><span class="sxs-lookup"><span data-stu-id="8b5be-139">Aligned Affinity is useful only with stateful services.</span></span> <span data-ttu-id="8b5be-140">Configureren van twee stateful services om de affiniteit hebben uitgelijnd zorgt ervoor dat de primaire van die services op de knooppunten elkaar zijn geplaatst.</span><span class="sxs-lookup"><span data-stu-id="8b5be-140">Configuring two stateful services to have aligned affinity ensures that the primaries of those services are placed on the same nodes as each other.</span></span> <span data-ttu-id="8b5be-141">Het is ook ervoor zorgt dat elk paar secundaire replica's voor deze services op de dezelfde knooppunten worden geplaatst.</span><span class="sxs-lookup"><span data-stu-id="8b5be-141">It also causes each pair of secondaries for those services to be placed on the same nodes.</span></span> <span data-ttu-id="8b5be-142">Het is ook mogelijk (hoewel minder algemeen) nonalignedaffinity zijn voor stateful services configureren.</span><span class="sxs-lookup"><span data-stu-id="8b5be-142">It is also possible (though less common) to configure NonAlignedAffinity for stateful services.</span></span> <span data-ttu-id="8b5be-143">De andere replica's van de twee stateful services wordt uitgevoerd op de dezelfde knooppunten voor nonalignedaffinity zijn, maar hun primaire kunnen terechtkomen op verschillende knooppunten.</span><span class="sxs-lookup"><span data-stu-id="8b5be-143">For NonAlignedAffinity, the different replicas of the two stateful services would run on the same nodes, but their primaries could end up on different nodes.</span></span>

<span data-ttu-id="8b5be-144"><center>
![Affiniteit tussen modi en de gevolgen ervan][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="8b5be-144"><center>
![Affinity Modes and Their Effects][Image1]
</center></span></span>

### <a name="best-effort-desired-state"></a><span data-ttu-id="8b5be-145">Beste toestand van de moeite gewenst</span><span class="sxs-lookup"><span data-stu-id="8b5be-145">Best effort desired state</span></span>
<span data-ttu-id="8b5be-146">Een affiniteitsrelatie is zo goed mogelijke poging.</span><span class="sxs-lookup"><span data-stu-id="8b5be-146">An affinity relationship is best effort.</span></span> <span data-ttu-id="8b5be-147">Biedt geen dezelfde waarborgen van onderbrengen of betrouwbaarheid waarop in dezelfde uitvoerbaar proces komt.</span><span class="sxs-lookup"><span data-stu-id="8b5be-147">It does not provide the same guarantees of collocation or reliability that running in the same executable process does.</span></span> <span data-ttu-id="8b5be-148">De services in een affiniteitsrelatie zijn fundamenteel andere entiteiten die mislukken en onafhankelijk van elkaar worden verplaatst.</span><span class="sxs-lookup"><span data-stu-id="8b5be-148">The services in an affinity relationship are fundamentally different entities that can fail and be moved independently.</span></span> <span data-ttu-id="8b5be-149">Een affiniteitsrelatie kan ook afbreken, hoewel deze einden tijdelijk zijn.</span><span class="sxs-lookup"><span data-stu-id="8b5be-149">An affinity relationship could also break, though these breaks are temporary.</span></span> <span data-ttu-id="8b5be-150">Beperkingen van de capaciteit kunnen bijvoorbeeld betekenen dat slechts een deel van de serviceobjecten in de affiniteitsrelatie op een bepaald knooppunt past.</span><span class="sxs-lookup"><span data-stu-id="8b5be-150">For example, capacity limitations may mean that only some of the service objects in the affinity relationship can fit on a given node.</span></span> <span data-ttu-id="8b5be-151">In dergelijke gevallen zelfs als er een affiniteitsrelatie aanwezig is, is worden deze niet afgedwongen als gevolg van de andere beperkingen.</span><span class="sxs-lookup"><span data-stu-id="8b5be-151">In these cases even though there's an affinity relationship in place, it can't be enforced due to the other constraints.</span></span> <span data-ttu-id="8b5be-152">Als het is mogelijk om dit te doen, wordt de schending automatisch later gecorrigeerd.</span><span class="sxs-lookup"><span data-stu-id="8b5be-152">If it is possible to do so, the violation is automatically corrected later.</span></span>

### <a name="chains-vs-stars"></a><span data-ttu-id="8b5be-153">Ketens versus sterren</span><span class="sxs-lookup"><span data-stu-id="8b5be-153">Chains vs. stars</span></span>
<span data-ttu-id="8b5be-154">De Cluster Resource Manager is vandaag de dag niet kunnen model-ketens van affiniteit relaties.</span><span class="sxs-lookup"><span data-stu-id="8b5be-154">Today the Cluster Resource Manager isn't able to model chains of affinity relationships.</span></span> <span data-ttu-id="8b5be-155">Dit betekent dat een service die een onderliggend element in een affiniteitsrelatie is niet een bovenliggend item in een andere affiniteitsrelatie.</span><span class="sxs-lookup"><span data-stu-id="8b5be-155">What this means is that a service that is a child in one affinity relationship can’t be a parent in another affinity relationship.</span></span> <span data-ttu-id="8b5be-156">Als u dit type relatie modelleren wilt, hebt u effectief als het model als een ster in plaats van een keten.</span><span class="sxs-lookup"><span data-stu-id="8b5be-156">If you want to model this type of relationship, you effectively have to model it as a star, rather than a chain.</span></span> <span data-ttu-id="8b5be-157">Voor het verplaatsen van een keten een ster, de laagste onderliggende zou bovenliggend element zijn van het eerste onderliggende bovenliggende in plaats daarvan.</span><span class="sxs-lookup"><span data-stu-id="8b5be-157">To move from a chain to a star, the bottommost child would be parented to the first child’s parent instead.</span></span> <span data-ttu-id="8b5be-158">Afhankelijk van de organisatie van uw services, moet u wellicht dat meerdere keren doen.</span><span class="sxs-lookup"><span data-stu-id="8b5be-158">Depending on the arrangement of your services, you may have to do this multiple times.</span></span> <span data-ttu-id="8b5be-159">Als er geen service natuurlijke bovenliggende, is het wellicht een die als een tijdelijke aanduiding fungeert te maken.</span><span class="sxs-lookup"><span data-stu-id="8b5be-159">If there's no natural parent service, you may have to create one that serves as a placeholder.</span></span> <span data-ttu-id="8b5be-160">Afhankelijk van uw vereisten, u kunt ook om te zoeken naar [toepassingsgroepen](service-fabric-cluster-resource-manager-application-groups.md).</span><span class="sxs-lookup"><span data-stu-id="8b5be-160">Depending on your requirements, you may also want to look into [Application Groups](service-fabric-cluster-resource-manager-application-groups.md).</span></span>

<span data-ttu-id="8b5be-161"><center>
![Vs ketens. De sterren in de Context van affiniteit van relaties][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="8b5be-161"><center>
![Chains vs. Stars in the Context of Affinity Relationships][Image2]
</center></span></span>

<span data-ttu-id="8b5be-162">Iets anders te weten over affiniteit relaties vandaag is dat ze gericht zijn.</span><span class="sxs-lookup"><span data-stu-id="8b5be-162">Another thing to note about affinity relationships today is that they are directional.</span></span> <span data-ttu-id="8b5be-163">Dit betekent dat de regel affiniteit alleen wordt afgedwongen dat het onderliggende element met de bovenliggende geplaatst.</span><span class="sxs-lookup"><span data-stu-id="8b5be-163">This means that the affinity rule only enforces that the child placed with the parent.</span></span> <span data-ttu-id="8b5be-164">Niet kan worden gegarandeerd dat de bovenliggende met de onderliggende bevindt.</span><span class="sxs-lookup"><span data-stu-id="8b5be-164">It does not ensure that the parent is located with the child.</span></span> <span data-ttu-id="8b5be-165">Het is ook belangrijk te weten dat de affiniteitsrelatie kan niet perfecte of direct afgedwongen worden omdat verschillende services met verschillende levenscycli hebt en kunnen mislukken en afzonderlijk verplaatsen.</span><span class="sxs-lookup"><span data-stu-id="8b5be-165">It is also important to note that the affinity relationship can't be perfect or instantly enforced since different services have with different lifecycles and can fail and move independently.</span></span> <span data-ttu-id="8b5be-166">Stel dat de bovenliggende plotseling wordt overgenomen door een ander knooppunt omdat deze is vastgelopen.</span><span class="sxs-lookup"><span data-stu-id="8b5be-166">For example, let's say the parent suddenly fails over to another node because it crashed.</span></span> <span data-ttu-id="8b5be-167">De Cluster Resource Manager en Failover Manager verwerken van de failover eerst sinds houden de services, consistente, en de prioriteit is beschikbaar.</span><span class="sxs-lookup"><span data-stu-id="8b5be-167">The Cluster Resource Manager and Failover Manager handle the failover first, since keeping the services up, consistent, and available is the priority.</span></span> <span data-ttu-id="8b5be-168">Zodra de failover is voltooid, wordt de affiniteitsrelatie is verbroken, maar de Cluster Resource Manager denkt dat alles is voldoende totdat deze merkt dat het kind niet opgeslagen met de bovenliggende is.</span><span class="sxs-lookup"><span data-stu-id="8b5be-168">Once the failover completes, the affinity relationship is broken, but the Cluster Resource Manager thinks everything is fine until it notices that the child is not located with the parent.</span></span> <span data-ttu-id="8b5be-169">Dit soort controles worden regelmatig uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="8b5be-169">These sorts of checks are performed periodically.</span></span> <span data-ttu-id="8b5be-170">Meer informatie over hoe de beperkingen worden geëvalueerd in de Cluster Resource Manager is beschikbaar in [in dit artikel](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), en [deze](service-fabric-cluster-resource-manager-balancing.md) wordt gesproken meer over het configureren van de waarop deze beperkingen zijn uitgebracht geëvalueerd.</span><span class="sxs-lookup"><span data-stu-id="8b5be-170">More information on how the Cluster Resource Manager evaluates constraints is available in [this article](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), and [this one](service-fabric-cluster-resource-manager-balancing.md) talks more about how to configure the cadence on which these constraints are evaluated.</span></span>   


### <a name="partitioning-support"></a><span data-ttu-id="8b5be-171">Ondersteuning voor partitioneren</span><span class="sxs-lookup"><span data-stu-id="8b5be-171">Partitioning support</span></span>
<span data-ttu-id="8b5be-172">Het laatste dat opvalt over de affiniteit is die affiniteit relaties worden niet ondersteund wanneer het bovenliggende item is gepartitioneerd.</span><span class="sxs-lookup"><span data-stu-id="8b5be-172">The final thing to notice about affinity is that affinity relationships aren’t supported where the parent is partitioned.</span></span> <span data-ttu-id="8b5be-173">Gepartitioneerde bovenliggende services mogelijk uiteindelijk wordt ondersteund, maar tegenwoordig het is niet toegestaan.</span><span class="sxs-lookup"><span data-stu-id="8b5be-173">Partitioned parent services may be supported eventually, but today it is not allowed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8b5be-174">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="8b5be-174">Next steps</span></span>
- <span data-ttu-id="8b5be-175">Voor meer informatie over het configureren van services, [meer informatie over het configureren van Services](service-fabric-cluster-resource-manager-configure-services.md)</span><span class="sxs-lookup"><span data-stu-id="8b5be-175">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="8b5be-176">Voor het beperken van services voor een klein aantal machines of samenvoegen van het laden van services, gebruik [toepassingsgroepen](service-fabric-cluster-resource-manager-application-groups.md)</span><span class="sxs-lookup"><span data-stu-id="8b5be-176">To limit services to a small set of machines or aggregating the load of services, use [Application Groups](service-fabric-cluster-resource-manager-application-groups.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resrouce-manager-affinity-modes.png
[Image2]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resource-manager-chains-vs-stars.png