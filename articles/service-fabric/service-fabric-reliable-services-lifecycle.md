---
title: aaaOverview van Hallo levenscyclus van Azure Service Fabric Reliable Services | Microsoft Docs
description: Meer informatie over Hallo levenscyclus van andere gebeurtenissen in betrouwbare Service Fabric-services
services: Service-Fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: vturecek;
ms.assetid: 
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 0d75ed5ee7cda85ac9af6a02e160727277804a2b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="reliable-services-lifecycle-overview"></a><span data-ttu-id="7f313-103">Overzicht van de levenscyclus van betrouwbare services</span><span class="sxs-lookup"><span data-stu-id="7f313-103">Reliable services lifecycle overview</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="7f313-104">C# op Windows</span><span class="sxs-lookup"><span data-stu-id="7f313-104">C# on Windows</span></span>](service-fabric-reliable-services-lifecycle.md)
> * [<span data-ttu-id="7f313-105">Java op Linux</span><span class="sxs-lookup"><span data-stu-id="7f313-105">Java on Linux</span></span>](service-fabric-reliable-services-lifecycle-java.md)
>
>

<span data-ttu-id="7f313-106">Wanneer u nadenkt over Hallo levenscycli van Reliable Services, zijn Hallo basisprincipes van de levenscyclus van Hallo Hallo belangrijkste.</span><span class="sxs-lookup"><span data-stu-id="7f313-106">When thinking about hello lifecycles of Reliable Services, hello basics of hello lifecycle are hello most important.</span></span> <span data-ttu-id="7f313-107">In het algemeen:</span><span class="sxs-lookup"><span data-stu-id="7f313-107">In general:</span></span>

- <span data-ttu-id="7f313-108">Tijdens het opstarten</span><span class="sxs-lookup"><span data-stu-id="7f313-108">During Startup</span></span>
  - <span data-ttu-id="7f313-109">Services zijn gebouwd</span><span class="sxs-lookup"><span data-stu-id="7f313-109">Services are constructed</span></span>
  - <span data-ttu-id="7f313-110">Ze hebben een kans tooconstruct en nul of meer listeners retourneren</span><span class="sxs-lookup"><span data-stu-id="7f313-110">They have an opportunity tooconstruct and return zero or more listeners</span></span>
  - <span data-ttu-id="7f313-111">Elke geretourneerde luisteraars worden geopend, zodat de communicatie met de Hallo-service</span><span class="sxs-lookup"><span data-stu-id="7f313-111">Any returned listeners are opened, allowing communication with hello service</span></span>
  - <span data-ttu-id="7f313-112">Hallo-Service RunAsync methode wordt aangeroepen, zodat Hallo service toodo langlopende of werk op de achtergrond</span><span class="sxs-lookup"><span data-stu-id="7f313-112">hello Service's RunAsync method is called, allowing hello service toodo long running or background work</span></span>
- <span data-ttu-id="7f313-113">Tijdens het afsluiten</span><span class="sxs-lookup"><span data-stu-id="7f313-113">During shutdown</span></span>
  - <span data-ttu-id="7f313-114">Hallo annulering token doorgegeven tooRunAsync wordt geannuleerd en Hallo-listeners zijn gesloten</span><span class="sxs-lookup"><span data-stu-id="7f313-114">hello cancellation token passed tooRunAsync is canceled, and hello listeners are closed</span></span>
  - <span data-ttu-id="7f313-115">Eenmaal is voltooid, wordt Hallo serviceobject zelf destructed</span><span class="sxs-lookup"><span data-stu-id="7f313-115">Once that is complete, hello service object itself is destructed</span></span>

<span data-ttu-id="7f313-116">Er zijn details rond Hallo exacte ordening van deze gebeurtenissen.</span><span class="sxs-lookup"><span data-stu-id="7f313-116">There are details around hello exact ordering of these events.</span></span> <span data-ttu-id="7f313-117">Hallo-volgorde van gebeurtenissen mogelijk in het bijzonder enigszins, afhankelijk van Hallo betrouwbare Service Stateless of Stateful wijzigen.</span><span class="sxs-lookup"><span data-stu-id="7f313-117">In particular, hello order of events may change slightly depending on whether hello Reliable Service is Stateless or Stateful.</span></span> <span data-ttu-id="7f313-118">Daarnaast hebben we voor stateful services toodeal met Hallo primaire wisselen scenario.</span><span class="sxs-lookup"><span data-stu-id="7f313-118">In addition, for stateful services, we have toodeal with hello Primary swap scenario.</span></span> <span data-ttu-id="7f313-119">Tijdens deze reeks Hallo-functie van primaire replica is overgedragen tooanother (of terugkomt) zonder Hallo-service is afgesloten.</span><span class="sxs-lookup"><span data-stu-id="7f313-119">During this sequence, hello role of Primary is transferred tooanother replica (or comes back) without hello service shutting down.</span></span> <span data-ttu-id="7f313-120">Ten slotte hebben we toothink over fout of storing voorwaarden.</span><span class="sxs-lookup"><span data-stu-id="7f313-120">Finally, we have toothink about error or failure conditions.</span></span>

## <a name="stateless-service-startup"></a><span data-ttu-id="7f313-121">Staatloze service is gestart</span><span class="sxs-lookup"><span data-stu-id="7f313-121">Stateless service startup</span></span>
<span data-ttu-id="7f313-122">levenscyclus van een staatloze service Hallo is zeer eenvoudig.</span><span class="sxs-lookup"><span data-stu-id="7f313-122">hello lifecycle of a stateless service is fairly straightforward.</span></span> <span data-ttu-id="7f313-123">Hier volgt Hallo volgorde van gebeurtenissen:</span><span class="sxs-lookup"><span data-stu-id="7f313-123">Here's hello order of events:</span></span>

1. <span data-ttu-id="7f313-124">Hallo wordt Service samengesteld</span><span class="sxs-lookup"><span data-stu-id="7f313-124">hello Service is constructed</span></span>
2. <span data-ttu-id="7f313-125">Klik in de parallelle twee dingen gebeuren:</span><span class="sxs-lookup"><span data-stu-id="7f313-125">Then, in parallel two things happen:</span></span>
    - <span data-ttu-id="7f313-126">`StatelessService.CreateServiceInstanceListeners()`wordt aangeroepen en elke geretourneerde luisteraars worden geopend.</span><span class="sxs-lookup"><span data-stu-id="7f313-126">`StatelessService.CreateServiceInstanceListeners()` is invoked and any returned listeners are Opened.</span></span> <span data-ttu-id="7f313-127">`ICommunicationListener.OpenAsync()`voor elke listener wordt aangeroepen</span><span class="sxs-lookup"><span data-stu-id="7f313-127">`ICommunicationListener.OpenAsync()` is called on each listener</span></span>
    - <span data-ttu-id="7f313-128">Hallo van service `StatelessService.RunAsync()` methode wordt aangeroepen</span><span class="sxs-lookup"><span data-stu-id="7f313-128">hello service's `StatelessService.RunAsync()` method is called</span></span>
3. <span data-ttu-id="7f313-129">Indien aanwezig, Hallo van service `StatelessService.OnOpenAsync()` methode wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-129">If present, hello service's `StatelessService.OnOpenAsync()` method is called.</span></span> <span data-ttu-id="7f313-130">Dit is een ongewoon onderdrukking, maar deze beschikbaar is.</span><span class="sxs-lookup"><span data-stu-id="7f313-130">This is an uncommon override, but it is available.</span></span>

<span data-ttu-id="7f313-131">Het is belangrijk toonote of er is geen ordening tussen Hallo aanroepen toocreate en open Hallo listeners en RunAsync.</span><span class="sxs-lookup"><span data-stu-id="7f313-131">It is important toonote that there is no ordering between hello calls toocreate and open hello listeners and RunAsync.</span></span> <span data-ttu-id="7f313-132">Hallo-listeners geopend voordat RunAsync wordt gestart.</span><span class="sxs-lookup"><span data-stu-id="7f313-132">hello listeners may open before RunAsync is started.</span></span> <span data-ttu-id="7f313-133">Op deze manier RunAsync mogelijk uiteindelijk aangeroepen voordat de communicatielisteners Hallo geopend zijn of zelfs is samengesteld.</span><span class="sxs-lookup"><span data-stu-id="7f313-133">Similarly, RunAsync may end up invoked before hello communication listeners are open or have even been constructed.</span></span> <span data-ttu-id="7f313-134">Als geen synchronisatie vereist is, is het een oefening toohello implementeerder gehandhaafd.</span><span class="sxs-lookup"><span data-stu-id="7f313-134">If any synchronization is required, it is left as an exercise toohello implementer.</span></span> <span data-ttu-id="7f313-135">Algemene oplossingen:</span><span class="sxs-lookup"><span data-stu-id="7f313-135">Common solutions:</span></span>

  - <span data-ttu-id="7f313-136">Soms werkt listeners alleen als andere informatie is gemaakt of gewerkte.</span><span class="sxs-lookup"><span data-stu-id="7f313-136">Sometimes listeners can't function until some other information is created or work done.</span></span> <span data-ttu-id="7f313-137">Voor stateless services die werk kan doorgaans worden uitgevoerd op andere locaties, zoals:</span><span class="sxs-lookup"><span data-stu-id="7f313-137">For stateless services that work can usually be done in other locations, such as:</span></span> 
    - <span data-ttu-id="7f313-138">in de constructor van het Hallo-service</span><span class="sxs-lookup"><span data-stu-id="7f313-138">in hello service's constructor</span></span>
    - <span data-ttu-id="7f313-139">tijdens het Hallo `CreateServiceInstanceListeners()` aanroepen</span><span class="sxs-lookup"><span data-stu-id="7f313-139">during hello `CreateServiceInstanceListeners()` call</span></span>
    - <span data-ttu-id="7f313-140">Als onderdeel van het Hallo-constructie van Hallo-listener zelf</span><span class="sxs-lookup"><span data-stu-id="7f313-140">as a part of hello construction of hello listener itself</span></span>
  - <span data-ttu-id="7f313-141">Soms wil hello code in RunAsync niet toostart totdat het Hallo-listeners zijn geopend.</span><span class="sxs-lookup"><span data-stu-id="7f313-141">Sometimes hello code in RunAsync does not want toostart until hello listeners are open.</span></span> <span data-ttu-id="7f313-142">In dit geval is aanvullende coördinatie nodig.</span><span class="sxs-lookup"><span data-stu-id="7f313-142">In this case additional coordination is necessary.</span></span> <span data-ttu-id="7f313-143">Een veelgebruikte oplossing is een aantal markering binnen Hallo-listeners die aangeeft wanneer ze zijn voltooid.</span><span class="sxs-lookup"><span data-stu-id="7f313-143">One common solution is some flag within hello listeners indicating when they have completed.</span></span> <span data-ttu-id="7f313-144">Deze markering wordt vervolgens gecontroleerd in RunAsync voordat u doorgaat tooactual werk.</span><span class="sxs-lookup"><span data-stu-id="7f313-144">This flag is then checked in RunAsync before continuing tooactual work.</span></span>

## <a name="stateless-service-shutdown"></a><span data-ttu-id="7f313-145">Afsluiten van de staatloze service</span><span class="sxs-lookup"><span data-stu-id="7f313-145">Stateless service shutdown</span></span>
<span data-ttu-id="7f313-146">Wanneer een stateless service wordt afgesloten, wordt hello hetzelfde patroon gevolgd, alleen in omgekeerde volgorde:</span><span class="sxs-lookup"><span data-stu-id="7f313-146">When shutting down a stateless service, hello same pattern is followed, just in reverse:</span></span>

1. <span data-ttu-id="7f313-147">Parallel</span><span class="sxs-lookup"><span data-stu-id="7f313-147">In parallel</span></span>
    - <span data-ttu-id="7f313-148">Alle open listeners worden gesloten.</span><span class="sxs-lookup"><span data-stu-id="7f313-148">Any open listeners are Closed.</span></span> <span data-ttu-id="7f313-149">`ICommunicationListener.CloseAsync()`voor elke listener wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-149">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="7f313-150">Hallo annulering token te doorgegeven`RunAsync()` is geannuleerd.</span><span class="sxs-lookup"><span data-stu-id="7f313-150">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="7f313-151">Controleren of Hallo annulering van token `IsCancellationRequested` eigenschap true retourneert, en als aangeroepen Hallo-token `ThrowIfCancellationRequested` methode er wordt een `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="7f313-151">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="7f313-152">Eenmaal `CloseAsync()` is voltooid op elke listener en `RunAsync()` ook is voltooid, Hallo-service `StatelessService.OnCloseAsync()` methode wordt aangeroepen, indien aanwezig.</span><span class="sxs-lookup"><span data-stu-id="7f313-152">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatelessService.OnCloseAsync()` method is called, if present.</span></span> <span data-ttu-id="7f313-153">Het is ongewoon toooverride `StatelessService.OnCloseAsync()`.</span><span class="sxs-lookup"><span data-stu-id="7f313-153">It is uncommon toooverride `StatelessService.OnCloseAsync()`.</span></span>
3. <span data-ttu-id="7f313-154">Na `StatelessService.OnCloseAsync()` is voltooid, Hallo serviceobject wordt destructed</span><span class="sxs-lookup"><span data-stu-id="7f313-154">After `StatelessService.OnCloseAsync()` completes, hello service object is destructed</span></span>

## <a name="stateful-service-startup"></a><span data-ttu-id="7f313-155">Stateful service starten</span><span class="sxs-lookup"><span data-stu-id="7f313-155">Stateful service Startup</span></span>
<span data-ttu-id="7f313-156">Stateful services hebben een vergelijkbaar patroon toostateless services, met enkele wijzigingen.</span><span class="sxs-lookup"><span data-stu-id="7f313-156">Stateful services have a similar pattern toostateless services, with a few changes.</span></span> <span data-ttu-id="7f313-157">Bij het opstarten van een stateful service, is Hallo volgorde van gebeurtenissen als volgt uit:</span><span class="sxs-lookup"><span data-stu-id="7f313-157">When starting up a stateful service, hello order of events is as follows:</span></span>

1. <span data-ttu-id="7f313-158">Hallo wordt Service samengesteld</span><span class="sxs-lookup"><span data-stu-id="7f313-158">hello Service is constructed</span></span>
2. <span data-ttu-id="7f313-159">`StatefulServiceBase.OnOpenAsync()`wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-159">`StatefulServiceBase.OnOpenAsync()` is called.</span></span> <span data-ttu-id="7f313-160">Dit is uncommonly overschreven in Hallo-service.</span><span class="sxs-lookup"><span data-stu-id="7f313-160">This is uncommonly overridden in hello service.</span></span>
3. <span data-ttu-id="7f313-161">Hallo plaats volgende parallel</span><span class="sxs-lookup"><span data-stu-id="7f313-161">hello following things happen in parallel</span></span>
    - <span data-ttu-id="7f313-162">`StatefulServiceBase.CreateServiceReplicaListeners()`wordt aangeroepen</span><span class="sxs-lookup"><span data-stu-id="7f313-162">`StatefulServiceBase.CreateServiceReplicaListeners()` is invoked</span></span> 
      - <span data-ttu-id="7f313-163">Als het Hallo-service is een primaire alle geretourneerde luisteraars geopend.</span><span class="sxs-lookup"><span data-stu-id="7f313-163">If hello service is a Primary all returned listeners are Opened.</span></span> <span data-ttu-id="7f313-164">`ICommunicationListener.OpenAsync()`voor elke listener wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-164">`ICommunicationListener.OpenAsync()` is called on each listener.</span></span>
      - <span data-ttu-id="7f313-165">Als Hallo-service een secundaire database is, alleen deze listeners gemarkeerd als `ListenOnSecondary = true` worden geopend.</span><span class="sxs-lookup"><span data-stu-id="7f313-165">If hello service is a Secondary, only those listeners marked as `ListenOnSecondary = true` are opened.</span></span> <span data-ttu-id="7f313-166">-Listeners die geopend op de secundaire replica's zijn met is minder gangbaar.</span><span class="sxs-lookup"><span data-stu-id="7f313-166">Having listeners that are open on Secondaries is less common.</span></span>
    - <span data-ttu-id="7f313-167">Hallo als Hallo Service momenteel van een primaire, Hallo service is `StatefulServiceBase.RunAsync()` methode wordt aangeroepen</span><span class="sxs-lookup"><span data-stu-id="7f313-167">hello if hello Service is currently a Primary, hello service's `StatefulServiceBase.RunAsync()` method is called</span></span>
4. <span data-ttu-id="7f313-168">Nadat alle replica-listener Hallo `OpenAsync()` aanroepen voltooien en `RunAsync()` wordt aangeroepen, `StatefulServiceBase.OnChangeRoleAsync()` wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-168">Once all hello replica listener's `OpenAsync()` calls complete and `RunAsync()` is called, `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="7f313-169">Dit is uncommonly overschreven in Hallo-service.</span><span class="sxs-lookup"><span data-stu-id="7f313-169">This is uncommonly overridden in hello service.</span></span>

<span data-ttu-id="7f313-170">Op dezelfde manier toostateless services, is er geen coördinatie tussen Hallo volgorde in welke Hallo listeners zijn gemaakt en geopend en wanneer RunAsync wordt genoemd.</span><span class="sxs-lookup"><span data-stu-id="7f313-170">Similarly toostateless services, there's no coordination between hello order in which hello listeners are created and opened and when RunAsync is called.</span></span> <span data-ttu-id="7f313-171">Als u moet coördinatie, kunnen Hallo oplossingen zijn veel Hallo dezelfde.</span><span class="sxs-lookup"><span data-stu-id="7f313-171">If you need coordination, hello solutions are much hello same.</span></span> <span data-ttu-id="7f313-172">Er is één extra aanvraag: zeggen dat Hallo aanroepen die binnenkomen bij de communicatielisteners Hallo informatie bewaard binnen enkele vereist [betrouwbare verzamelingen](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="7f313-172">THere is one additional case: say that hello calls arriving at hello communication listeners require information kept inside some [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="7f313-173">Omdat Hallo communicatielisteners kunnen openen voordat Hallo betrouwbare verzamelingen worden gelezen of geschreven en voordat RunAsync kan worden gestart, is enkele aanvullende coördinatie nodig.</span><span class="sxs-lookup"><span data-stu-id="7f313-173">Because hello communication listeners could open before hello reliable collections are readable or writeable, and before RunAsync could start, some additional coordination is necessary.</span></span> <span data-ttu-id="7f313-174">Hallo eenvoudigste en meest voorkomende oplossing is voor Hallo communicatie listeners tooreturn sommige foutcode die Hallo gebruikt tooknow tooretry Hallo clientaanvraag.</span><span class="sxs-lookup"><span data-stu-id="7f313-174">hello simplest and most common solution is for hello communication listeners tooreturn some error code that hello client uses tooknow tooretry hello request.</span></span>

## <a name="stateful-service-shutdown"></a><span data-ttu-id="7f313-175">Stateful service afsluiten</span><span class="sxs-lookup"><span data-stu-id="7f313-175">Stateful service Shutdown</span></span>
<span data-ttu-id="7f313-176">Op dezelfde manier tooStateless services, Hallo lifecycle gebeurtenissen tijdens het afsluiten zijn Hallo dezelfde als tijdens het opstarten, maar omgekeerd.</span><span class="sxs-lookup"><span data-stu-id="7f313-176">Similarly tooStateless services, hello lifecycle events during shutdown are hello same as during startup, but reversed.</span></span> <span data-ttu-id="7f313-177">Wanneer een stateful service wordt afgesloten, hello volgende gebeurtenissen:</span><span class="sxs-lookup"><span data-stu-id="7f313-177">When a stateful service is being shut down, hello following events occur:</span></span>

1. <span data-ttu-id="7f313-178">Parallel</span><span class="sxs-lookup"><span data-stu-id="7f313-178">In parallel</span></span>
    - <span data-ttu-id="7f313-179">Alle open listeners worden gesloten.</span><span class="sxs-lookup"><span data-stu-id="7f313-179">Any open listeners are Closed.</span></span> <span data-ttu-id="7f313-180">`ICommunicationListener.CloseAsync()`voor elke listener wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-180">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="7f313-181">Hallo annulering token te doorgegeven`RunAsync()` is geannuleerd.</span><span class="sxs-lookup"><span data-stu-id="7f313-181">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="7f313-182">Controleren of Hallo annulering van token `IsCancellationRequested` eigenschap true retourneert, en als aangeroepen Hallo-token `ThrowIfCancellationRequested` methode er wordt een `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="7f313-182">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="7f313-183">Eenmaal `CloseAsync()` is voltooid op elke listener en `RunAsync()` ook is voltooid, Hallo-service `StatefulServiceBase.OnChangeRoleAsync()` wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-183">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="7f313-184">(Dit is uncommonly overschreven in Hallo-service.)</span><span class="sxs-lookup"><span data-stu-id="7f313-184">(This is uncommonly overridden in hello service.)</span></span>
    - <span data-ttu-id="7f313-185">Wachten op RunAsync het toocomplete is alleen nodig als de replica van deze service een primaire is.</span><span class="sxs-lookup"><span data-stu-id="7f313-185">Waiting for RunAsync toocomplete is only necessary if this service replica was a Primary.</span></span>
3. <span data-ttu-id="7f313-186">Eenmaal Hallo `StatefulServiceBase.OnChangeRoleAsync()` methode is voltooid, hello `StatefulServiceBase.OnCloseAsync()` methode wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-186">Once hello `StatefulServiceBase.OnChangeRoleAsync()` method completes, hello `StatefulServiceBase.OnCloseAsync()` method is called.</span></span> <span data-ttu-id="7f313-187">Dit is een ongewoon onderdrukking, maar deze beschikbaar is.</span><span class="sxs-lookup"><span data-stu-id="7f313-187">This is an uncommon override, but it is available.</span></span>
3. <span data-ttu-id="7f313-188">Na `StatefulServiceBase.OnCloseAsync()` is voltooid, Hallo serviceobject wordt destructed.</span><span class="sxs-lookup"><span data-stu-id="7f313-188">After `StatefulServiceBase.OnCloseAsync()` completes, hello service object is destructed.</span></span>

## <a name="stateful-service-primary-swaps"></a><span data-ttu-id="7f313-189">Primaire worden verwisseld stateful service</span><span class="sxs-lookup"><span data-stu-id="7f313-189">Stateful service primary swaps</span></span>
<span data-ttu-id="7f313-190">Terwijl een stateful service wordt uitgevoerd, alleen hebben hello primaire replica's van die stateful services hun communicatielisteners geopend en hun RunAsync-methode aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-190">While a stateful service is running, only hello Primary replicas of that stateful services have their communication listeners opened and their RunAsync method called.</span></span> <span data-ttu-id="7f313-191">Secundaire zijn gebouwd, maar er worden geen verdere aanroepen niet zien.</span><span class="sxs-lookup"><span data-stu-id="7f313-191">Secondary are constructed but see no further calls.</span></span> <span data-ttu-id="7f313-192">Terwijl een stateful service echter wordt uitgevoerd, kunt welke replica is momenteel Hallo primaire wijzigen.</span><span class="sxs-lookup"><span data-stu-id="7f313-192">While a stateful service is running however, which replica is currently hello Primary can change.</span></span> <span data-ttu-id="7f313-193">Wat betekent dit in termen van Hallo lifecycle gebeurtenissen die een replica kunt zien? Hallo gedrag Hallo stateful replica ziet, is afhankelijk van de Hallo replica wordt gedegradeerd of gepromoveerd tijdens Hallo wisselen.</span><span class="sxs-lookup"><span data-stu-id="7f313-193">What does this mean in terms of hello lifecycle events that a replica can see? hello behavior hello stateful replica sees depends on whether it is hello replica being demoted or promoted during hello swap.</span></span>

### <a name="for-hello-primary-being-demoted"></a><span data-ttu-id="7f313-194">Voor primaire gedegradeerd Hallo</span><span class="sxs-lookup"><span data-stu-id="7f313-194">For hello primary being demoted</span></span>
<span data-ttu-id="7f313-195">Service Fabric moet deze replica toostop berichten worden verwerkt en eventuele achtergrondwerk hiervan is afgesloten.</span><span class="sxs-lookup"><span data-stu-id="7f313-195">Service Fabric needs this replica toostop processing messages and quit any background work it is doing.</span></span> <span data-ttu-id="7f313-196">Als gevolg hiervan wordt deze stap ziet er vergelijkbare toowhen Hallo service afgesloten.</span><span class="sxs-lookup"><span data-stu-id="7f313-196">As a result, this step looks similar toowhen hello service is being shut down.</span></span> <span data-ttu-id="7f313-197">Een verschil is dat Hallo-Service is niet destructed of gesloten nadat een secundaire database blijft.</span><span class="sxs-lookup"><span data-stu-id="7f313-197">One difference is that hello Service isn't destructed or closed since it remains as a Secondary.</span></span> <span data-ttu-id="7f313-198">Hallo volgende API's worden genoemd:</span><span class="sxs-lookup"><span data-stu-id="7f313-198">hello following APIs are called:</span></span>

1. <span data-ttu-id="7f313-199">Parallel</span><span class="sxs-lookup"><span data-stu-id="7f313-199">In parallel</span></span>
    - <span data-ttu-id="7f313-200">Alle open listeners worden gesloten.</span><span class="sxs-lookup"><span data-stu-id="7f313-200">Any open listeners are Closed.</span></span> <span data-ttu-id="7f313-201">`ICommunicationListener.CloseAsync()`voor elke listener wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-201">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="7f313-202">Hallo annulering token te doorgegeven`RunAsync()` is geannuleerd.</span><span class="sxs-lookup"><span data-stu-id="7f313-202">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="7f313-203">Controleren of Hallo annulering van token `IsCancellationRequested` eigenschap true retourneert, en als aangeroepen Hallo-token `ThrowIfCancellationRequested` methode er wordt een `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="7f313-203">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="7f313-204">Eenmaal `CloseAsync()` is voltooid op elke listener en `RunAsync()` ook is voltooid, Hallo-service `StatefulServiceBase.OnChangeRoleAsync()` wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-204">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="7f313-205">Dit is uncommonly overschreven in Hallo-service.</span><span class="sxs-lookup"><span data-stu-id="7f313-205">This is uncommonly overridden in hello service.</span></span>

### <a name="for-hello-secondary-being-promoted"></a><span data-ttu-id="7f313-206">Voor secundaire hello wordt gepromoveerd</span><span class="sxs-lookup"><span data-stu-id="7f313-206">For hello secondary being promoted</span></span>
<span data-ttu-id="7f313-207">Op deze manier Service Fabric moet deze replica toostart luisteren naar berichten op het Hallo-kabel en start u eventuele achtergrondtaken die het is belangrijk.</span><span class="sxs-lookup"><span data-stu-id="7f313-207">Similarly, Service Fabric needs this replica toostart listening for messages on hello wire and start any background tasks it cares about.</span></span> <span data-ttu-id="7f313-208">Zodoende kan dit proces lijkt vergelijkbare toowhen Hallo service hebt gemaakt, met uitzondering van die replica Hallo bestaat zelf al.</span><span class="sxs-lookup"><span data-stu-id="7f313-208">As a result, this process looks similar toowhen hello service is created, except that hello replica itself already exists.</span></span> <span data-ttu-id="7f313-209">Hallo volgende API's worden genoemd:</span><span class="sxs-lookup"><span data-stu-id="7f313-209">hello following APIs are called:</span></span>

1. <span data-ttu-id="7f313-210">Parallel</span><span class="sxs-lookup"><span data-stu-id="7f313-210">In parallel</span></span>
    - <span data-ttu-id="7f313-211">`StatefulServiceBase.CreateServiceReplicaListeners()`wordt aangeroepen en elke geretourneerde luisteraars worden geopend.</span><span class="sxs-lookup"><span data-stu-id="7f313-211">`StatefulServiceBase.CreateServiceReplicaListeners()` is invoked and any returned listeners are Opened.</span></span> <span data-ttu-id="7f313-212">`ICommunicationListener.OpenAsync()`voor elke listener wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-212">`ICommunicationListener.OpenAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="7f313-213">Hallo van service `StatefulServiceBase.RunAsync()` methode wordt aangeroepen</span><span class="sxs-lookup"><span data-stu-id="7f313-213">hello service's `StatefulServiceBase.RunAsync()` method is called</span></span>
2. <span data-ttu-id="7f313-214">Nadat alle replica-listener Hallo `OpenAsync()` aanroepen voltooien en `RunAsync()` is aangeroepen, `StatefulServiceBase.OnChangeRoleAsync()` wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="7f313-214">Once all hello replica listener's `OpenAsync()` calls complete and `RunAsync()` has been called,  `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="7f313-215">Dit is uncommonly overschreven in Hallo-service.</span><span class="sxs-lookup"><span data-stu-id="7f313-215">This is uncommonly overridden in hello service.</span></span>

### <a name="common-issues-during-stateful-service-shutdown-and-primary-demotion"></a><span data-ttu-id="7f313-216">Veelvoorkomende problemen tijdens het afsluiten van de stateful service en de primaire degradatie</span><span class="sxs-lookup"><span data-stu-id="7f313-216">Common issues during stateful service shutdown and primary demotion</span></span>
<span data-ttu-id="7f313-217">Service Fabric-wijzigingen Hallo primaire van een stateful service voor een aantal redenen.</span><span class="sxs-lookup"><span data-stu-id="7f313-217">Service Fabric changes hello Primary of a stateful service for a variety of reasons.</span></span> <span data-ttu-id="7f313-218">Hallo meest voorkomende zijn [cluster herverdeling](service-fabric-cluster-resource-manager-balancing.md) en [upgrade van de toepassing](service-fabric-application-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="7f313-218">hello most common are [cluster rebalancing](service-fabric-cluster-resource-manager-balancing.md) and [application upgrade](service-fabric-application-upgrade.md).</span></span> <span data-ttu-id="7f313-219">Tijdens deze bewerkingen (en tijdens het afsluiten van de normale service, zoals u zien zou als Hallo-service is verwijderd), is het belangrijk dat Hallo Hallo service ten opzichte van `CancellationToken`.</span><span class="sxs-lookup"><span data-stu-id="7f313-219">During these operations (as well as during normal service shutdown, like you'd see if hello service was deleted), it is important that hello service respect hello `CancellationToken`.</span></span> <span data-ttu-id="7f313-220">Services die door deze annulering niet correct verwerken wordt enkele problemen optreden.</span><span class="sxs-lookup"><span data-stu-id="7f313-220">Services that do not handle cancellation cleanly will experience several issues.</span></span> <span data-ttu-id="7f313-221">Deze bewerkingen niet in het bijzonder traag omdat Service Fabric wordt gewacht op Hallo services toostop probleemloos.</span><span class="sxs-lookup"><span data-stu-id="7f313-221">In particular, these operations will be slow since Service Fabric waits for hello services toostop gracefully.</span></span> <span data-ttu-id="7f313-222">Dit kan uiteindelijk leiden toofailed upgrades die time-out en terug te draaien.</span><span class="sxs-lookup"><span data-stu-id="7f313-222">This can ultimately lead toofailed upgrades that time out and roll back.</span></span> <span data-ttu-id="7f313-223">Fout toohonor Hallo annulering token kan ook leiden tot imbalanced clusters omdat Hallo services kunnen niet worden uitgevoerd omdat het duurt te lang toomove maar knooppunten hot krijgen ze ergens anders.</span><span class="sxs-lookup"><span data-stu-id="7f313-223">Failure toohonor hello cancellation token can also cause imbalanced clusters because nodes get hot but hello services can't be rebalanced since it takes too long toomove them elsewhere.</span></span> 

<span data-ttu-id="7f313-224">Aangezien Hallo services stateful, is het ook waarschijnlijk dat ze Hallo gebruiken [betrouwbare verzamelingen](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="7f313-224">Since hello services are stateful, it is also likely that they are using hello [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="7f313-225">In Service Fabric bij een primaire wordt gedegradeerd, is Hallo eerste dingen die plaatsvindt of de status van onderliggende schrijftoegang toohello is ingetrokken.</span><span class="sxs-lookup"><span data-stu-id="7f313-225">In Service Fabric, when a Primary is demoted, one of hello first things that happens is that write access toohello underlying state is revoked.</span></span> <span data-ttu-id="7f313-226">Dit leidt tweede reeks problemen die invloed op Hallo service lifecycle hebben kunnen tooa.</span><span class="sxs-lookup"><span data-stu-id="7f313-226">This leads tooa second set of issues that can impact hello service lifecycle.</span></span> <span data-ttu-id="7f313-227">Hallo verzamelingen return uitzonderingen op basis van Hallo timing en Hiermee wordt aangegeven of Hallo replica wordt verplaatst of afsluiten.</span><span class="sxs-lookup"><span data-stu-id="7f313-227">hello collections return Exceptions based on hello timing and whether hello replica is being moved or shut down.</span></span> <span data-ttu-id="7f313-228">Deze uitzonderingen moeten correct worden verwerkt.</span><span class="sxs-lookup"><span data-stu-id="7f313-228">These exceptions should be handled correctly.</span></span> <span data-ttu-id="7f313-229">Uitzonderingen in Service Fabric vallen in de permanente [(`FabricException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricexception?view=azure-dotnet) en tijdelijke [(`FabricTransientException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabrictransientexception?view=azure-dotnet) categorieën.</span><span class="sxs-lookup"><span data-stu-id="7f313-229">Exceptions thrown by Service Fabric fall into permanent [(`FabricException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricexception?view=azure-dotnet) and transient [(`FabricTransientException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabrictransientexception?view=azure-dotnet) categories.</span></span> <span data-ttu-id="7f313-230">Permanente uitzonderingen moeten worden geregistreerd en veroorzaakt tijdens het Hallo tijdelijke uitzonderingen worden geprobeerd op basis van bepaalde Pogingslogica.</span><span class="sxs-lookup"><span data-stu-id="7f313-230">Permanent exceptions should be logged and thrown, while hello transient exceptions may be retried based on some retry logic.</span></span>

<span data-ttu-id="7f313-231">Afhandeling van uitzonderingen Hallo die afkomstig van het gebruik van Hallo zijn `ReliableCollections` in combinatie met gebeurtenissen van de levenscyclus van de service is een belangrijk onderdeel van de testen en valideren van een betrouwbare Service.</span><span class="sxs-lookup"><span data-stu-id="7f313-231">Handling hello exceptions that come from use of hello `ReliableCollections` in conjunction with service lifecycle events is an important part of testing and validating a Reliable Service.</span></span> <span data-ttu-id="7f313-232">Hallo aanbeveling is altijd toorun uw service onder belasting tijdens het uitvoeren van upgrades en [chaos testen](service-fabric-controlled-chaos.md) voordat u ooit implementeert tooproduction.</span><span class="sxs-lookup"><span data-stu-id="7f313-232">hello recommendation is always toorun your service under load while performing upgrades and [chaos testing](service-fabric-controlled-chaos.md) before ever deploying tooproduction.</span></span> <span data-ttu-id="7f313-233">Deze eenvoudige stappen kunt u ervoor te zorgen dat uw service correct is geïmplementeerd en de levenscyclus van gebeurtenissen correct worden verwerkt.</span><span class="sxs-lookup"><span data-stu-id="7f313-233">These basic steps help ensure that your service is correctly implemented and handles lifecycle events correctly.</span></span>


## <a name="notes-on-service-lifecycle"></a><span data-ttu-id="7f313-234">Opmerkingen bij de levenscyclus van de service</span><span class="sxs-lookup"><span data-stu-id="7f313-234">Notes on service lifecycle</span></span>
  - <span data-ttu-id="7f313-235">Beide Hallo `RunAsync()` methode en Hallo `CreateServiceReplicaListeners/CreateServiceInstanceListeners` aanroepen zijn optioneel.</span><span class="sxs-lookup"><span data-stu-id="7f313-235">Both hello `RunAsync()` method and hello `CreateServiceReplicaListeners/CreateServiceInstanceListeners` calls are optional.</span></span> <span data-ttu-id="7f313-236">Een service kan één van deze beide of geen van beide hebben.</span><span class="sxs-lookup"><span data-stu-id="7f313-236">A service may have one of them, both, or neither.</span></span> <span data-ttu-id="7f313-237">Bijvoorbeeld, als het Hallo-service alle zijn werk in het antwoord toouser aanroepen doet, hoeft niet voor tooimplement `RunAsync()`.</span><span class="sxs-lookup"><span data-stu-id="7f313-237">For example, if hello service does all its work in response toouser calls, there is no need for it tooimplement `RunAsync()`.</span></span> <span data-ttu-id="7f313-238">Alleen Hallo communicatielisteners en hun bijbehorende code zijn nodig.</span><span class="sxs-lookup"><span data-stu-id="7f313-238">Only hello communication listeners and their associated code are necessary.</span></span> <span data-ttu-id="7f313-239">Op deze manier maken communicatielisteners retourneren is optioneel, want het Hallo-service mogelijk alleen de achtergrond toodo werken en hoeft dus alleen tooimplement`RunAsync()`</span><span class="sxs-lookup"><span data-stu-id="7f313-239">Similarly, creating and returning communication listeners is optional, as hello service may have only background work toodo, and so only needs tooimplement `RunAsync()`</span></span>
  - <span data-ttu-id="7f313-240">Is geldig voor een service-toocomplete `RunAsync()` is en dat het resultaat van deze.</span><span class="sxs-lookup"><span data-stu-id="7f313-240">It is valid for a service toocomplete `RunAsync()` successfully and return from it.</span></span> <span data-ttu-id="7f313-241">Voltooien is niet een voorwaarde is mislukt.</span><span class="sxs-lookup"><span data-stu-id="7f313-241">Completing is not a failure condition.</span></span> <span data-ttu-id="7f313-242">Voltooien van `RunAsync()` geeft aan dat de achtergrondwerk Hallo van Hallo-service is voltooid.</span><span class="sxs-lookup"><span data-stu-id="7f313-242">Completing `RunAsync()` indicates that hello background work of hello service has completed.</span></span> <span data-ttu-id="7f313-243">Voor betrouwbare stateful services `RunAsync()` opnieuw wordt aangeroepen als Hallo replica van primaire tooSecondary werden gedegradeerd en vervolgens back tooPrimary gepromoveerd.</span><span class="sxs-lookup"><span data-stu-id="7f313-243">For stateful reliable services, `RunAsync()` is called again if hello replica were demoted from Primary tooSecondary and then promoted back tooPrimary.</span></span>
  - <span data-ttu-id="7f313-244">Als een service afsluit `RunAsync()` door er een onverwachte uitzondering is opgetreden, betekent dit een fout.</span><span class="sxs-lookup"><span data-stu-id="7f313-244">If a service exits from `RunAsync()` by throwing some unexpected exception, this constitutes a failure.</span></span> <span data-ttu-id="7f313-245">Hallo-serviceobject wordt afgesloten en een statusfout gemeld.</span><span class="sxs-lookup"><span data-stu-id="7f313-245">hello service object is shut down and a health error reported.</span></span>
  - <span data-ttu-id="7f313-246">Hoewel er geen tijdslimiet bij het retourneren van deze methoden, kunt u onmiddellijk tooReliable verzamelingen verliezen Hallo mogelijkheid toowrite en daarom echte werk niet voltooien.</span><span class="sxs-lookup"><span data-stu-id="7f313-246">While there is no time limit on returning from these methods, you immediately lose hello ability toowrite tooReliable Collections and therefore cannot complete any real work.</span></span> <span data-ttu-id="7f313-247">Het is raadzaam dat u zo snel mogelijk na ontvangst van de annuleringsaanvraag Hallo terugkeren.</span><span class="sxs-lookup"><span data-stu-id="7f313-247">It is recommended that you return as quickly as possible upon receiving hello cancellation request.</span></span> <span data-ttu-id="7f313-248">Als uw service toothese API-aanroepen niet reageert binnen een redelijk tijdsbestek die service Fabric mogelijk geforceerd uw service beëindigen.</span><span class="sxs-lookup"><span data-stu-id="7f313-248">If your service does not respond toothese API calls in a reasonable amount of time Service Fabric may forcibly terminate your service.</span></span> <span data-ttu-id="7f313-249">Meestal gebeurt dit alleen tijdens toepassingsupgrades of wanneer een service wordt verwijderd.</span><span class="sxs-lookup"><span data-stu-id="7f313-249">Usually this only happens during application upgrades or when a service is being deleted.</span></span> <span data-ttu-id="7f313-250">Deze time-out is 15 minuten standaard.</span><span class="sxs-lookup"><span data-stu-id="7f313-250">This timeout is 15 minutes by default.</span></span>
  - <span data-ttu-id="7f313-251">Fouten in Hallo `OnCloseAsync()` pad leiden tot een `OnAbort()` wordt aangeroepen dit is een kans van de laatste kans best-effort voor Hallo tooclean up service en laat alle bronnen die ze hebben aangevraagd.</span><span class="sxs-lookup"><span data-stu-id="7f313-251">Failures in hello `OnCloseAsync()` path result in `OnAbort()` being called which is a last-chance best-effort opportunity for hello service tooclean up and release any resources that they have claimed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7f313-252">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="7f313-252">Next steps</span></span>
- [<span data-ttu-id="7f313-253">Inleiding tooReliable Services</span><span class="sxs-lookup"><span data-stu-id="7f313-253">Introduction tooReliable Services</span></span>](service-fabric-reliable-services-introduction.md)
- [<span data-ttu-id="7f313-254">Betrouwbare Services snel starten</span><span class="sxs-lookup"><span data-stu-id="7f313-254">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
- [<span data-ttu-id="7f313-255">Reliable Services geavanceerde gebruik</span><span class="sxs-lookup"><span data-stu-id="7f313-255">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)
