---
title: Tips voor betere prestaties - Azure Cosmos DB NoSQL | Microsoft Docs
description: Meer informatie over client-configuratieopties voor het verbeteren van de prestaties van Azure DB die Cosmos-database
keywords: voor de verbetering van prestaties van de database
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: a94cda90eca9dca2b93adb8f5091d829e7375aa5
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/03/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="ed039-104">Tips voor betere prestaties voor Azure Cosmos-DB</span><span class="sxs-lookup"><span data-stu-id="ed039-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="ed039-105">Azure Cosmos-database is een snelle en flexibele gedistribueerde database waarin naadloos met gegarandeerde latentie en doorvoer schaalt.</span><span class="sxs-lookup"><span data-stu-id="ed039-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="ed039-106">U beschikt niet over belangrijke architectuur wijzigen of complexe code schrijven om te schalen van uw database met Cosmos-DB.</span><span class="sxs-lookup"><span data-stu-id="ed039-106">You do not have to make major architecture changes or write complex code to scale your database with Cosmos DB.</span></span> <span data-ttu-id="ed039-107">Omhoog en omlaag schalen is net zo eenvoudig als het maken van één API-aanroep of [SDK-aanroep van methode](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="ed039-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="ed039-108">Omdat Cosmos DB wordt benaderd via het netwerk aanroepen zijn er echter clientzijde optimalisaties die voor optimale prestaties kunt u.</span><span class="sxs-lookup"><span data-stu-id="ed039-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance.</span></span>

<span data-ttu-id="ed039-109">Dus als u vraagt "hoe kan ik mijn de databaseprestaties verbeteren?"</span><span class="sxs-lookup"><span data-stu-id="ed039-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="ed039-110">Houd rekening met de volgende opties:</span><span class="sxs-lookup"><span data-stu-id="ed039-110">consider the following options:</span></span>

## <a name="networking"></a><span data-ttu-id="ed039-111">Netwerken</span><span class="sxs-lookup"><span data-stu-id="ed039-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="ed039-112">**Verbindingsbeleid: de modus rechtstreekse verbinding gebruiken**</span><span class="sxs-lookup"><span data-stu-id="ed039-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="ed039-113">Hoe een client verbinding maakt met Cosmos-DB heeft belangrijke gevolgen voor de prestaties, met name in termen van waargenomen-clientzijde latentie.</span><span class="sxs-lookup"><span data-stu-id="ed039-113">How a client connects to Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="ed039-114">Er zijn twee belangrijke configuratie-instellingen beschikbaar zijn voor het configureren van client verbindingsbeleid – de verbinding *modus* en de [verbinding *protocol*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="ed039-114">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="ed039-115">De twee modi beschikbaar zijn:</span><span class="sxs-lookup"><span data-stu-id="ed039-115">The two available modes are:</span></span>

   1. <span data-ttu-id="ed039-116">Gateway-modus (standaard)</span><span class="sxs-lookup"><span data-stu-id="ed039-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="ed039-117">Directe modus</span><span class="sxs-lookup"><span data-stu-id="ed039-117">Direct Mode</span></span>

      <span data-ttu-id="ed039-118">Gateway-modus wordt ondersteund op alle platforms van de SDK en de geconfigureerde standaardwaarde is.</span><span class="sxs-lookup"><span data-stu-id="ed039-118">Gateway Mode is supported on all SDK platforms and is the configured default.</span></span>  <span data-ttu-id="ed039-119">Als uw toepassing wordt uitgevoerd binnen een bedrijfsnetwerk met strikte firewallbeperkingen, is Gateway-modus de beste keuze, omdat maakt gebruik van de standaard HTTPS-poort en één eindpunt.</span><span class="sxs-lookup"><span data-stu-id="ed039-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="ed039-120">De verhouding prestaties is echter dat Gateway modus betrekking heeft op een extra netwerk-hop telkens wanneer gegevens worden gelezen of geschreven naar Cosmos-DB.</span><span class="sxs-lookup"><span data-stu-id="ed039-120">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Cosmos DB.</span></span> <span data-ttu-id="ed039-121">Daarom biedt directe modus betere prestaties vanwege minder netwerkhops.</span><span class="sxs-lookup"><span data-stu-id="ed039-121">Because of this, Direct Mode offers better performance due to fewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="ed039-122">**Verbindingsbeleid: gebruiken het TCP-protocol**</span><span class="sxs-lookup"><span data-stu-id="ed039-122">**Connection policy: Use the TCP protocol**</span></span>

    <span data-ttu-id="ed039-123">Wanneer u directe modus gebruikt, zijn er twee protocolopties beschikbaar:</span><span class="sxs-lookup"><span data-stu-id="ed039-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="ed039-124">TCP</span><span class="sxs-lookup"><span data-stu-id="ed039-124">TCP</span></span>
   * <span data-ttu-id="ed039-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ed039-125">HTTPS</span></span>

     <span data-ttu-id="ed039-126">Cosmos DB biedt een eenvoudige en RESTful-programmeermodel openen via HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ed039-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="ed039-127">Daarnaast biedt het een efficiënte TCP-protocol, dat is ook RESTful in het communicatiemodel en is beschikbaar via de SDK voor .NET-clients.</span><span class="sxs-lookup"><span data-stu-id="ed039-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span></span> <span data-ttu-id="ed039-128">Directe TCP- en HTTPS worden SSL gebruiken voor eerste authenticatie en versleuteling verkeer.</span><span class="sxs-lookup"><span data-stu-id="ed039-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="ed039-129">Gebruik indien mogelijk de TCP-protocol voor de beste prestaties.</span><span class="sxs-lookup"><span data-stu-id="ed039-129">For best performance, use the TCP protocol when possible.</span></span>

     <span data-ttu-id="ed039-130">Bij gebruik van TCP in de modus van de Gateway, TCP-poort 443 is de Cosmos-DB-poort en 10255 is de MongoDB-API-poort.</span><span class="sxs-lookup"><span data-stu-id="ed039-130">When using TCP in Gateway Mode, TCP Port 443 is the Cosmos DB port, and 10255 is the MongoDB API port.</span></span> <span data-ttu-id="ed039-131">Als u TCP in directe modus, behalve de poorten voor de Gateway, moet u ervoor zorgen de poort bereik tussen 10000 en 20000 is geopend, omdat de Cosmos-database maakt gebruik van dynamische TCP-poorten.</span><span class="sxs-lookup"><span data-stu-id="ed039-131">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="ed039-132">Als deze poorten niet geopend zijn en u probeert om TCP te gebruiken, ontvangt u een 503 Service niet beschikbaar-fout.</span><span class="sxs-lookup"><span data-stu-id="ed039-132">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="ed039-133">De Connectiviteitsmodus wordt geconfigureerd tijdens het samenstellen van de DocumentClient-exemplaar met de parameter ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="ed039-133">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span></span> <span data-ttu-id="ed039-134">Als de modus Direct wordt gebruikt, kan het Protocol ook worden ingesteld binnen de ConnectionPolicy-parameter.</span><span class="sxs-lookup"><span data-stu-id="ed039-134">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from the Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="ed039-135">Omdat TCP wordt alleen ondersteund in de directe modus als Gateway-modus wordt gebruikt, het HTTPS-protocol wordt altijd gebruikt om te communiceren met de Gateway en de waarde van het Protocol in de ConnectionPolicy wordt genegeerd.</span><span class="sxs-lookup"><span data-stu-id="ed039-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span></span>

    ![Afbeelding van het beleid van Azure DB die Cosmos-verbinding](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="ed039-137">**Aanroepen van OpenAsync om te voorkomen dat de latentie starten op de eerste aanvraag**</span><span class="sxs-lookup"><span data-stu-id="ed039-137">**Call OpenAsync to avoid startup latency on first request**</span></span>

    <span data-ttu-id="ed039-138">De eerste aanvraag heeft een hogere latentie standaard, omdat er voor het ophalen van de adres-routeringstabel.</span><span class="sxs-lookup"><span data-stu-id="ed039-138">By default, the first request has a higher latency because it has to fetch the address routing table.</span></span> <span data-ttu-id="ed039-139">Om te voorkomen dat deze latentie starten op de eerste aanvraag, moet u OpenAsync() als volgt één keer tijdens de initialisatie aanroepen.</span><span class="sxs-lookup"><span data-stu-id="ed039-139">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="ed039-140">**Clients in hetzelfde Azure-regio voor prestaties plaatsen**</span><span class="sxs-lookup"><span data-stu-id="ed039-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="ed039-141">Indien mogelijk, plaatst u toepassingen Cosmos DB aanroepen in dezelfde regio bevinden als de database van de Cosmos-database.</span><span class="sxs-lookup"><span data-stu-id="ed039-141">When possible, place any applications calling Cosmos DB in the same region as the Cosmos DB database.</span></span> <span data-ttu-id="ed039-142">Voor een geschatte vergelijking aanroepen naar Cosmos DB binnen dezelfde regio binnen 1-2 ms voltooid, maar de latentie tussen de West en oostkust van de VS is > 50 ms.</span><span class="sxs-lookup"><span data-stu-id="ed039-142">For an approximate comparison, calls to Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span></span> <span data-ttu-id="ed039-143">Deze latentie kan waarschijnlijk uit om aan te vragen variëren, afhankelijk van de route die door de aanvraag wordt uitgevoerd het doorgeven van de client aan de grens van de Azure-datacenter.</span><span class="sxs-lookup"><span data-stu-id="ed039-143">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span></span> <span data-ttu-id="ed039-144">De laagst mogelijke latentie wordt bereikt door ervoor te zorgen dat de aanroepende toepassing bevindt zich in dezelfde Azure-regio als de ingerichte Cosmos-DB-eindpunt.</span><span class="sxs-lookup"><span data-stu-id="ed039-144">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="ed039-145">Zie voor een lijst met beschikbare regio's, [Azure-gebieden](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="ed039-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="ed039-146">![Afbeelding van het beleid van Azure DB die Cosmos-verbinding](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="ed039-146">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="ed039-147">**Verhoog het aantal threads/taken**</span><span class="sxs-lookup"><span data-stu-id="ed039-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="ed039-148">Omdat aanroepen naar Azure Cosmos DB worden aangebracht via het netwerk, moet u wellicht de mate van parallelle uitvoering van uw verzoeken om te variëren, zodat de clienttoepassing nodig heeft voor het zeer weinig tijd wachten tussen aanvragen.</span><span class="sxs-lookup"><span data-stu-id="ed039-148">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span></span> <span data-ttu-id="ed039-149">Bijvoorbeeld als u. De NET [taak parallelle bibliotheek](https://msdn.microsoft.com//library/dd460717.aspx), maken in de volgorde van 100s van taken lezen of schrijven naar een Cosmos-DB.</span><span class="sxs-lookup"><span data-stu-id="ed039-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Cosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="ed039-150">Gebruik van de SDK</span><span class="sxs-lookup"><span data-stu-id="ed039-150">SDK Usage</span></span>
1. <span data-ttu-id="ed039-151">**De meest recente SDK installeren**</span><span class="sxs-lookup"><span data-stu-id="ed039-151">**Install the most recent SDK**</span></span>

    <span data-ttu-id="ed039-152">De Cosmos-DB SDK's zijn voortdurend wordt verbeterd, zodat de beste prestaties bieden.</span><span class="sxs-lookup"><span data-stu-id="ed039-152">The Cosmos DB SDKs are constantly being improved to provide the best performance.</span></span> <span data-ttu-id="ed039-153">Zie de [Cosmos DB SDK](documentdb-sdk-dotnet.md) pagina's om te bepalen van de meest recente SDK en verbeteringen controleren.</span><span class="sxs-lookup"><span data-stu-id="ed039-153">See the [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="ed039-154">**Een singleton Cosmos-DB-client gedurende de levensduur van uw toepassing gebruiken**</span><span class="sxs-lookup"><span data-stu-id="ed039-154">**Use a singleton Cosmos DB client for the lifetime of your application**</span></span>

    <span data-ttu-id="ed039-155">Houd er rekening mee dat elk exemplaar DocumentClient thread-veilige en efficiënte Verbindingsbeheer en adrescaching in directe modus wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="ed039-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="ed039-156">Zodat efficiënt Verbindingsbeheer en betere prestaties door DocumentClient verdient het gebruik van één exemplaar van de DocumentClient per AppDomain gedurende de levensduur van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="ed039-156">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="ed039-157">**System.Net MaxConnections per host verhogen als u de Gateway-modus**</span><span class="sxs-lookup"><span data-stu-id="ed039-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="ed039-158">DB cosmos-aanvragen worden gedaan via HTTPS/REST bij gebruik van Gateway-modus en zijn onderworpen aan de standaardlimiet verbinding per hostnaam of IP-adres.</span><span class="sxs-lookup"><span data-stu-id="ed039-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span></span> <span data-ttu-id="ed039-159">Mogelijk moet u de MaxConnections ingesteld op een hogere waarde (100-1000), zodat meerdere gelijktijdige verbindingen met Cosmos DB van de clientbibliotheek gebruikmaken kan.</span><span class="sxs-lookup"><span data-stu-id="ed039-159">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Cosmos DB.</span></span> <span data-ttu-id="ed039-160">In de .NET SDK 1.8.0 en hoger wordt met de standaardwaarde voor [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) 50 en de waarde wilt wijzigen, kunt u instellen de [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx)op een hogere waarde.</span><span class="sxs-lookup"><span data-stu-id="ed039-160">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span></span>   
4. <span data-ttu-id="ed039-161">**Parallelle query's voor gepartitioneerde verzamelingen afstemmen**</span><span class="sxs-lookup"><span data-stu-id="ed039-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="ed039-162">DocumentDB .NET SDK versie 1.9.0 en hoger ondersteuning parallelle query's waarmee u kunt een query uitvoeren op een gepartitioneerde verzameling worden parallel (Zie [werken met de SDK's](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) en de verwante [codevoorbeelden](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) voor meer informatie Info).</span><span class="sxs-lookup"><span data-stu-id="ed039-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="ed039-163">Parallelle query's zijn ontworpen voor betere Querylatentie en doorvoer via hun seriële equivalent.</span><span class="sxs-lookup"><span data-stu-id="ed039-163">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="ed039-164">Parallelle query's bieden twee parameters die gebruikers afstemmen kunnen om de vereisten (a) MaxDegreeOfParallelism aangepaste aanpassen: om te bepalen dat het maximum aantal partities vervolgens kan worden opgevraagd in parallel en (b) MaxBufferedItemCount: om te bepalen het aantal vooraf opgehaalde resultaten.</span><span class="sxs-lookup"><span data-stu-id="ed039-164">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span></span>

    <span data-ttu-id="ed039-165">(a) ***afstemmen MaxDegreeOfParallelism\: *** parallelle query werkt door meerdere partities parallel uitvoeren van query's.</span><span class="sxs-lookup"><span data-stu-id="ed039-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="ed039-166">Echter, gegevens van een afzonderlijke gepartitioneerde verzamelen ten opzichte van de query wordt opeenvolgend opgehaald.</span><span class="sxs-lookup"><span data-stu-id="ed039-166">However, data from an individual partitioned collect is fetched serially with respect to the query.</span></span> <span data-ttu-id="ed039-167">Dus heeft als u de MaxDegreeOfParallelism op het aantal partities de maximale kans op de meeste query zodat opgegeven alle andere voorwaarden system hetzelfde blijven.</span><span class="sxs-lookup"><span data-stu-id="ed039-167">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span></span> <span data-ttu-id="ed039-168">Als u het aantal partities niet weet, kunt u de MaxDegreeOfParallelism instellen op een groot aantal en het systeem de minimale (aantal partities, invoer van de gebruiker opgegeven) als de MaxDegreeOfParallelism kiest.</span><span class="sxs-lookup"><span data-stu-id="ed039-168">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="ed039-169">Het is belangrijk te weten dat parallelle query's de beste prestaties opleveren als de gegevens evenredig verdeeld over alle partities ten opzichte van de query.</span><span class="sxs-lookup"><span data-stu-id="ed039-169">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span></span> <span data-ttu-id="ed039-170">Als de gepartitioneerde verzameling zodanig dat alle of een meerderheid van de gegevens die door een query zijn geretourneerd voornamelijk in een paar partities (één partitie in ergste geval) en de prestaties van de query als knelpunt zou worden verwerkt door deze partities is gepartitioneerd.</span><span class="sxs-lookup"><span data-stu-id="ed039-170">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="ed039-171">(b) ***afstemmen MaxBufferedItemCount\: *** parallelle query is ontworpen om de resultaten vooraf ophaalt tijdens de huidige batch met resultaten wordt verwerkt door de client.</span><span class="sxs-lookup"><span data-stu-id="ed039-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span></span> <span data-ttu-id="ed039-172">Het vooraf ophalen helpt in algemene verbetering van de latentie van een query.</span><span class="sxs-lookup"><span data-stu-id="ed039-172">The pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="ed039-173">MaxBufferedItemCount is de parameter om het aantal vooraf opgehaalde resultaten te beperken.</span><span class="sxs-lookup"><span data-stu-id="ed039-173">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span></span> <span data-ttu-id="ed039-174">Instelling MaxBufferedItemCount met het verwachte aantal resultaten geretourneerd (of een hogere waarde), kunt de query voor het ontvangen van maximaal profiteren van het vooraf ophalen.</span><span class="sxs-lookup"><span data-stu-id="ed039-174">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="ed039-175">Houd er rekening mee dat vooraf ophalen werkt op dezelfde manier ongeacht de MaxDegreeOfParallelism, en er één buffer voor de gegevens van alle partities.</span><span class="sxs-lookup"><span data-stu-id="ed039-175">Note that pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span></span>  
5. <span data-ttu-id="ed039-176">**Schakel op de GC-serverzijde**</span><span class="sxs-lookup"><span data-stu-id="ed039-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="ed039-177">In sommige gevallen kan minder vaak uit garbagecollection helpen.</span><span class="sxs-lookup"><span data-stu-id="ed039-177">Reducing the frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="ed039-178">Stel in .NET, [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) op true.</span><span class="sxs-lookup"><span data-stu-id="ed039-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span></span>
6. <span data-ttu-id="ed039-179">**Backoff RetryAfter intervallen implementeren**</span><span class="sxs-lookup"><span data-stu-id="ed039-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="ed039-180">Tijdens het testen van prestaties, moet u load verhogen tot een klein aantal aanvragen ophalen beperkt.</span><span class="sxs-lookup"><span data-stu-id="ed039-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="ed039-181">Als beperkt, moet de clienttoepassing backoff op vertraging voor de server opgegeven interval.</span><span class="sxs-lookup"><span data-stu-id="ed039-181">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span></span> <span data-ttu-id="ed039-182">De backoff te respecteren, zorgt u ervoor dat u besteden aan de minimale hoeveelheid tijd wachten tussen nieuwe pogingen.</span><span class="sxs-lookup"><span data-stu-id="ed039-182">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="ed039-183">Ondersteuning voor nieuwe pogingen Groepsbeleid is opgenomen in versie 1.8.0 en hoger van de DocumentDB [.NET](documentdb-sdk-dotnet.md) en [Java](documentdb-sdk-java.md), versie 1.9.0 en hoger van de [Node.js](documentdb-sdk-node.md) en [Python ](documentdb-sdk-python.md), en alle ondersteunde versies van de [.NET Core](documentdb-sdk-dotnet-core.md) SDK's.</span><span class="sxs-lookup"><span data-stu-id="ed039-183">Retry policy support is included in Version 1.8.0 and above of the DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of the [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of the [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="ed039-184">Zie voor meer informatie [Exceeding gereserveerd doorvoerlimieten](request-units.md#RequestRateTooLarge) en [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="ed039-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="ed039-185">**Uitbreiden van de werkbelasting van uw client**</span><span class="sxs-lookup"><span data-stu-id="ed039-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="ed039-186">Als u op niveaus met hoge doorvoer testen wilt (> 50.000 RU/s), de clienttoepassing mogelijk het knelpunt als gevolg van de machine beperking af op CPU- of -gebruik.</span><span class="sxs-lookup"><span data-stu-id="ed039-186">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="ed039-187">Als u deze punt bereikt, kunt u blijven voor de push-het account Cosmos DB verder door het uitbreiden van uw clienttoepassingen op meerdere servers.</span><span class="sxs-lookup"><span data-stu-id="ed039-187">If you reach this point, you can continue to push the Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="ed039-188">**Cache document URI's voor lagere latentie mogelijk lezen**</span><span class="sxs-lookup"><span data-stu-id="ed039-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="ed039-189">Cache document URI's waar mogelijk voor de beste prestaties voor lezen.</span><span class="sxs-lookup"><span data-stu-id="ed039-189">Cache document URIs whenever possible for the best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="ed039-190">**De paginagrootte van de voor query's leestijd feeds voor betere prestaties afstemmen**</span><span class="sxs-lookup"><span data-stu-id="ed039-190">**Tune the page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="ed039-191">Bij het uitvoeren van een bulksgewijs documenten met behulp van de feed functionaliteit (bijvoorbeeld ReadDocumentFeedAsync) lezen of lezen bij de uitgifte van een DocumentDB SQL-query, worden de resultaten in een gesegmenteerde manier geretourneerd als de resultatenset is te groot is.</span><span class="sxs-lookup"><span data-stu-id="ed039-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, the results are returned in a segmented fashion if the result set is too large.</span></span> <span data-ttu-id="ed039-192">Standaard resultaten worden geretourneerd in segmenten van 100 items of 1 MB, eerst de limiet is bereikt.</span><span class="sxs-lookup"><span data-stu-id="ed039-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="ed039-193">Verminder het aantal netwerk retouren vereist voor het ophalen van alle toepasselijke resultaten, kunt u de paginagrootte met behulp van de aanvraagheader x-ms-max--aantal items en maximaal 1000 vergroten.</span><span class="sxs-lookup"><span data-stu-id="ed039-193">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using x-ms-max-item-count request header to up to 1000.</span></span> <span data-ttu-id="ed039-194">In gevallen waarin u wilt alleen enkele resultaten weer te geven bijvoorbeeld, als uw gebruikers-interface of toepassing API retourneert alleen 10 een tijd resulteert, u kunt ook de paginagrootte van de op 10 tot en met de doorvoer verbruikt voor leesbewerkingen en query's verminderen verlagen.</span><span class="sxs-lookup"><span data-stu-id="ed039-194">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="ed039-195">U kunt ook de paginagrootte met behulp van de beschikbare Cosmos-DB SDK's instellen.</span><span class="sxs-lookup"><span data-stu-id="ed039-195">You may also set the page size using the available Cosmos DB SDKs.</span></span>  <span data-ttu-id="ed039-196">Bijvoorbeeld:</span><span class="sxs-lookup"><span data-stu-id="ed039-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="ed039-197">**Verhoog het aantal threads/taken**</span><span class="sxs-lookup"><span data-stu-id="ed039-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="ed039-198">Zie [Verhoog het aantal threads/taken](#increase-threads) in de sectie over netwerken.</span><span class="sxs-lookup"><span data-stu-id="ed039-198">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span></span>

11. <span data-ttu-id="ed039-199">**Gebruik 64-bits host verwerken**</span><span class="sxs-lookup"><span data-stu-id="ed039-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="ed039-200">De DocumentDB SDK werkt in een 32-bits hostproces wanneer u de DocumentDB .NET SDK versie 1.11.4 gebruikt en hoger.</span><span class="sxs-lookup"><span data-stu-id="ed039-200">The DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="ed039-201">Als u over verschillende partitie query's gebruikt, wordt 64-bits host verwerken echter aanbevolen voor verbeterde prestaties.</span><span class="sxs-lookup"><span data-stu-id="ed039-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="ed039-202">De volgende soorten toepassingen hebben het hostproces van 32-bits als de standaardconfiguratie, om te wijzigen die in 64-bits, volg deze stappen uit op basis van het type van uw toepassing:</span><span class="sxs-lookup"><span data-stu-id="ed039-202">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span></span>

    - <span data-ttu-id="ed039-203">Voor uitvoerbare toepassingen kunt dit doen door het uitschakelen van de **liever 32-bits** optie in de **Projecteigenschappen** venster op de **bouwen** tabblad.</span><span class="sxs-lookup"><span data-stu-id="ed039-203">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span></span>

    - <span data-ttu-id="ed039-204">Voor VSTest op basis van de Testprojecten, kunt u dit doen door te selecteren **testen**->**instellingen testen**->**processorarchitectuur standaard als X64**, van de **Visual Studio Test** menuoptie.</span><span class="sxs-lookup"><span data-stu-id="ed039-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="ed039-205">Voor lokaal geïmplementeerde ASP.NET-webtoepassingen, kunt dit doen door het controleren van de **de 64-bits versie van IIS Express gebruiken voor websites en projecten**onder **extra**->**opties**  -> **Projecten en oplossingen**->**Web-projecten**.</span><span class="sxs-lookup"><span data-stu-id="ed039-205">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="ed039-206">Voor ASP.NET-webtoepassingen wordt geïmplementeerd in Azure, kan dit worden gedaan door het kiezen van de **Platform als 64-bits** in de **toepassingsinstellingen** in de Azure portal.</span><span class="sxs-lookup"><span data-stu-id="ed039-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="ed039-207">Indexeringsbeleid</span><span class="sxs-lookup"><span data-stu-id="ed039-207">Indexing Policy</span></span>
1. <span data-ttu-id="ed039-208">**Gebruik vertraagde indexering voor snellere piek tijd opname tarieven**</span><span class="sxs-lookup"><span data-stu-id="ed039-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="ed039-209">Cosmos DB kunt u opgeven – op het niveau verzameling – indexeringsbeleid, waarmee u als u wilt dat de documenten in een verzameling automatisch worden geïndexeerd of niet.</span><span class="sxs-lookup"><span data-stu-id="ed039-209">Cosmos DB allows you to specify – at the collection level – an indexing policy, which enables you to choose if you want the documents in a collection to be automatically indexed or not.</span></span>  <span data-ttu-id="ed039-210">U kunt bovendien ook tussen synchrone (consistente) en updates van de index asynchrone (Lazy).</span><span class="sxs-lookup"><span data-stu-id="ed039-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="ed039-211">De index wordt standaard synchroon bijgewerkt op elke invoegen, vervangen of verwijderen van een document aan de verzameling.</span><span class="sxs-lookup"><span data-stu-id="ed039-211">By default, the index is updated synchronously on each insert, replace, or delete of a document to the collection.</span></span> <span data-ttu-id="ed039-212">Synchroon modus maakt het mogelijk de query's te voldoen aan dezelfde [consistentieniveau](consistency-levels.md) als die van het document wordt gelezen zonder enige vertraging voor de index te 'lopen'.</span><span class="sxs-lookup"><span data-stu-id="ed039-212">Synchronously mode enables the queries to honor the same [consistency level](consistency-levels.md) as that of the document reads without any delay for the index to “catch up".</span></span>

    <span data-ttu-id="ed039-213">Vertraagde indexeren kan worden overwogen om scenario's waarin gegevens worden geschreven in bursts en gewenste om het werk dat nodig is tot inhoud van de index gedurende een langere periode af te schrijven.</span><span class="sxs-lookup"><span data-stu-id="ed039-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want to amortize the work required to index content over a longer period of time.</span></span> <span data-ttu-id="ed039-214">Vertraagde indexeren kunt u uw ingerichte doorvoer effectief gebruiken en dienen schrijfaanvragen piekuren met een minimale latentie.</span><span class="sxs-lookup"><span data-stu-id="ed039-214">Lazy indexing also allows you to use your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="ed039-215">Het is belangrijk te weten echter dat als vertraagde indexeren is ingeschakeld, queryresultaten uiteindelijk consistent, ongeacht de consistentieniveau geconfigureerd voor het account van de Cosmos-DB zijn.</span><span class="sxs-lookup"><span data-stu-id="ed039-215">It is important to note, however, that when lazy indexing is enabled, query results are eventually consistent regardless of the consistency level configured for the Cosmos DB account.</span></span>

    <span data-ttu-id="ed039-216">Daarom Consistent indexing-modus (IndexingPolicy.IndexingMode is ingesteld in Consistent) leidt ertoe dat de hoogste aanvraag eenheid kosten per schrijfbewerking tijdens het indexeren modus (IndexingPolicy.IndexingMode is ingesteld op Lazy) en geen indexering Lazy (IndexingPolicy.Automatic is ingesteld op False) hebben nul indexering kosten op het moment van schrijven.</span><span class="sxs-lookup"><span data-stu-id="ed039-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set to Consistent) incurs the highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set to Lazy) and no indexing (IndexingPolicy.Automatic is set to False) have zero indexing cost at the time of write.</span></span>
2. <span data-ttu-id="ed039-217">**Ongebruikte paden uitsluiten van indexering voor snellere schrijfbewerkingen**</span><span class="sxs-lookup"><span data-stu-id="ed039-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="ed039-218">Indexeringsbeleid cosmos van de database kunt u opgeven welke paden document wilt opnemen of uitsluiten door gebruik te indexeren paden (IndexingPolicy.IncludedPaths en IndexingPolicy.ExcludedPaths) te indexeren.</span><span class="sxs-lookup"><span data-stu-id="ed039-218">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="ed039-219">Het gebruik van de indexering van paden kunt bieden verbeterde schrijfprestaties en lagere opslagkosten voor index voor scenario's waarin de querypatronen tevoren bekend als indexering kosten rechtstreeks worden gecorreleerd met het aantal unieke paden die zijn geïndexeerd.</span><span class="sxs-lookup"><span data-stu-id="ed039-219">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span></span>  <span data-ttu-id="ed039-220">De volgende code ziet u bijvoorbeeld een hele sectie van de documenten (ook uitsluiten</span><span class="sxs-lookup"><span data-stu-id="ed039-220">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span></span> <span data-ttu-id="ed039-221">een substructuur) vanuit indexering met de ' * ' jokerteken.</span><span class="sxs-lookup"><span data-stu-id="ed039-221">a subtree) from indexing using the "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="ed039-222">Zie voor meer informatie [Azure Cosmos DB indexeren beleid](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="ed039-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="ed039-223">Doorvoer</span><span class="sxs-lookup"><span data-stu-id="ed039-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="ed039-224">**Meten en stemmen voor lagere aanvraag eenheden/seconde gebruik**</span><span class="sxs-lookup"><span data-stu-id="ed039-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="ed039-225">Cosmos DB biedt een uitgebreide reeks databasebewerkingen, met inbegrip van relationele en hiërarchische query's met UDF's, opgeslagen procedures en triggers – alle operationele op de documenten binnen een verzameling van de database.</span><span class="sxs-lookup"><span data-stu-id="ed039-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span></span> <span data-ttu-id="ed039-226">De kosten die zijn gekoppeld aan elk van deze bewerkingen varieert op basis van de CPU, IO en geheugen dat nodig is om de bewerking te voltooien.</span><span class="sxs-lookup"><span data-stu-id="ed039-226">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span></span> <span data-ttu-id="ed039-227">In plaats van het denken over en beheer van hardwareresources, kunt u een aanvraag-eenheid (RU) beschouwen als een enkele meting voor de resources die zijn vereist voor het uitvoeren van verschillende databasebewerkingen en de aanvraag voor een toepassing.</span><span class="sxs-lookup"><span data-stu-id="ed039-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span></span>

    <span data-ttu-id="ed039-228">[Aanvraageenheden](request-units.md) zijn ingericht voor het account van elke database op basis van het aantal eenheden voor capaciteit die u aanschaft.</span><span class="sxs-lookup"><span data-stu-id="ed039-228">[Request units](request-units.md) are provisioned for each database account based on the number of capacity units that you purchase.</span></span> <span data-ttu-id="ed039-229">Aanvraag eenheidsverbruik wordt geëvalueerd als een percentage per seconde.</span><span class="sxs-lookup"><span data-stu-id="ed039-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="ed039-230">Toepassingen die groter is dan het percentage van de eenheid ingerichte aanvragen voor het account beperkt is tot de snelheid onder het gereserveerde niveau voor het account zakt.</span><span class="sxs-lookup"><span data-stu-id="ed039-230">Applications that exceed the provisioned request unit rate for their account is limited until the rate drops below the reserved level for the account.</span></span> <span data-ttu-id="ed039-231">Als uw toepassing een hogere mate van doorvoer vereist, kunt u extra capaciteitseenheden aanschaffen.</span><span class="sxs-lookup"><span data-stu-id="ed039-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="ed039-232">De complexiteit van een query heeft gevolgen voor het aantal eenheden van de aanvraag voor een bewerking worden verbruikt.</span><span class="sxs-lookup"><span data-stu-id="ed039-232">The complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="ed039-233">Het aantal predicaten, aard van de predicaten, aantal UDF's en de grootte van de bron-gegevensset alle invloed hebben op de kosten van querybewerkingen.</span><span class="sxs-lookup"><span data-stu-id="ed039-233">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span></span>

    <span data-ttu-id="ed039-234">Voor het meten van de overhead van bewerkingen (maken, bijwerken of verwijderen) inspecteren van de header x-ms-aanvraag-kosten (of de equivalente RequestCharge-eigenschap in ResourceResponse<T> of FeedResponse<T> in de .NET SDK) voor het meten van het aantal aanvraageenheden verbruikt door deze bewerkingen.</span><span class="sxs-lookup"><span data-stu-id="ed039-234">To measure the overhead of any operation (create, update, or delete), inspect the x-ms-request-charge header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span></span>

    ```C#
    // Measure the performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure the performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="ed039-235">De aanvraag kosten geretourneerd in deze header is een fractie van de ingerichte doorvoer (dat wil zeggen, 2000 RUs / seconde).</span><span class="sxs-lookup"><span data-stu-id="ed039-235">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="ed039-236">Als de voorgaande query 1000 1KB-documenten retourneert, is de kosten van de bewerking 1000.</span><span class="sxs-lookup"><span data-stu-id="ed039-236">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span></span> <span data-ttu-id="ed039-237">Als zodanig binnen één seconde respecteert de-server slechts twee dergelijke aanvragen voordat de beperking van de volgende aanvragen.</span><span class="sxs-lookup"><span data-stu-id="ed039-237">As such, within one second, the server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="ed039-238">Zie voor meer informatie [Aanvraageenheden](request-units.md) en de [aanvraag eenheid Rekenmachine](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="ed039-238">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="ed039-239">**Verwerken frequentie beperken/aanvraagsnelheid te groot**</span><span class="sxs-lookup"><span data-stu-id="ed039-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="ed039-240">Wanneer een client probeert overschrijdt de gereserveerde doorvoer voor een account, is er geen verslechtering van prestaties optreedt op de server en geen gebruik van doorvoercapaciteit afgezien van het niveau van de gereserveerde.</span><span class="sxs-lookup"><span data-stu-id="ed039-240">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span></span> <span data-ttu-id="ed039-241">De server wordt optie preventief beëindigen van de aanvraag met RequestRateTooLarge (HTTP-statuscode 429) en de x-ms-opnieuw-na-ms-header die de hoeveelheid tijd in milliseconden, dat de gebruiker wachten moet voordat de aanvraag opnieuw proberen aangeeft retourneren.</span><span class="sxs-lookup"><span data-stu-id="ed039-241">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the x-ms-retry-after-ms header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="ed039-242">De SDK's alle impliciet dit antwoord catch, wordt de server opgegeven probeer het opnieuw nadat de header en de aanvraag opnieuw proberen.</span><span class="sxs-lookup"><span data-stu-id="ed039-242">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span></span> <span data-ttu-id="ed039-243">Tenzij uw account wordt door meerdere clients tegelijkertijd geopend, wordt de volgende poging slaagt.</span><span class="sxs-lookup"><span data-stu-id="ed039-243">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span></span>

    <span data-ttu-id="ed039-244">Als er meer dan één client cumulatief werken consistent boven het percentage aanvragen, het aantal nieuwe pogingen van standaard ingesteld op 9 intern door de client niet toereikend zijn; in dit geval, genereert de client een DocumentClientException met statuscode 429 tot de toepassing.</span><span class="sxs-lookup"><span data-stu-id="ed039-244">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span></span> <span data-ttu-id="ed039-245">Het aantal standaard pogingen kan worden gewijzigd door de RetryOptions op het exemplaar ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="ed039-245">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span></span> <span data-ttu-id="ed039-246">Standaard wordt de DocumentClientException met statuscode 429 na een cumulatieve wachttijd van 30 seconden geretourneerd, als de aanvraag blijft werken boven het percentage aanvragen.</span><span class="sxs-lookup"><span data-stu-id="ed039-246">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span></span> <span data-ttu-id="ed039-247">Dit gebeurt zelfs als het huidige aantal pogingen is kleiner dan het maximale aantal, worden deze de standaardwaarde van 9 of een door de gebruiker gedefinieerde waarde.</span><span class="sxs-lookup"><span data-stu-id="ed039-247">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="ed039-248">Terwijl het gedrag voor het automatisch opnieuw kan worden verbeterd tolerantie en bruikbaarheid voor de meeste toepassingen, kan deze op odds zijn bij het uitvoeren van prestatiebenchmarks, vooral wanneer latentie meten.</span><span class="sxs-lookup"><span data-stu-id="ed039-248">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="ed039-249">De latentie waargenomen-client wordt pieken als het experiment treffers in de beperking van de server en zorgt ervoor dat de client SDK achtergrond opnieuw proberen.</span><span class="sxs-lookup"><span data-stu-id="ed039-249">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span></span> <span data-ttu-id="ed039-250">Meten van de kosten die zijn geretourneerd door elke bewerking om te voorkomen latentiepieken tijdens prestaties experimenten, en zorg ervoor dat aanvragen worden gebruikt onder het gereserveerde percentage.</span><span class="sxs-lookup"><span data-stu-id="ed039-250">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span></span> <span data-ttu-id="ed039-251">Zie voor meer informatie [Aanvraageenheden](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="ed039-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="ed039-252">**Ontwerp voor kleinere documenten voor een hogere doorvoer**</span><span class="sxs-lookup"><span data-stu-id="ed039-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="ed039-253">De kosten van de aanvraag (dat wil zeggen aanvraagverwerking kosten) van een bepaalde bewerking wordt rechtstreeks gecorreleerd met de grootte van het document.</span><span class="sxs-lookup"><span data-stu-id="ed039-253">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span></span> <span data-ttu-id="ed039-254">Bewerkingen op grote documenten duurder dan bewerkingen voor kleine documenten.</span><span class="sxs-lookup"><span data-stu-id="ed039-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ed039-255">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="ed039-255">Next steps</span></span>
<span data-ttu-id="ed039-256">Zie voor een voorbeeldtoepassing gebruikt om te evalueren Cosmos DB voor scenario's met hoge prestaties op enkele clientcomputers, [prestaties en schaal testen met Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="ed039-256">For a sample application used to evaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="ed039-257">Zie ook voor meer informatie over het ontwerpen van uw aanvraag voor schaal en hoge prestaties, [partitionering en schalen in Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="ed039-257">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>
