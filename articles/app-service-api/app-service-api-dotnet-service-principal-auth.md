---
title: aaaService verificatie voor API Apps in Azure App Service | Microsoft Docs
description: Meer informatie over hoe tooprotect een API-app in Azure App Service voor scenario's voor service-naar-service.
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="9b0c5-103">Verificatie van service-principal voor API Apps in Azure App Service</span><span class="sxs-lookup"><span data-stu-id="9b0c5-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="9b0c5-104">Overzicht</span><span class="sxs-lookup"><span data-stu-id="9b0c5-104">Overview</span></span>
<span data-ttu-id="9b0c5-105">Dit artikel wordt uitgelegd hoe toouse App Service-verificatie voor *interne* toegang tot tooAPI apps.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="9b0c5-106">Een interne scenario is waar u een API-app die u toobe verbruikbare alleen door uw eigen toepassingscode wilt.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="9b0c5-107">Hallo aanbevolen manier tooimplement dit scenario in App Service toouse Azure AD tooprotect Hallo heet API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="9b0c5-108">U kunt Hallo beveiligd API-app met een bearer-token die u via Azure AD door het opgeven van de toepassings-id (service-principal) referenties aanroepen.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="9b0c5-109">Zie voor alternatieven toousing Azure AD, Hallo **authentication Service-naar-service** sectie Hallo [overzicht van Azure App Service-authenticatie](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="9b0c5-110">In dit artikel leert u het volgende:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="9b0c5-111">Hoe toouse Azure Active Directory (Azure AD) tooprotect een API-app van niet-geverifieerde toegang.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="9b0c5-112">Hoe tooconsume een beveiligde API-app uit een API-app, web-app of mobiele app met behulp van Azure AD-referenties voor service-principal (app-identiteit).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="9b0c5-113">Voor informatie over het tooconsume van een logische app, Zie [uw aangepaste API gebruiken die worden gehost op App Service met Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="9b0c5-114">Hoe toomake zorgen dat Hallo beschermd API-app kan niet worden aangeroepen vanuit een browser door gebruikers zijn aangemeld.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="9b0c5-115">Hoe toomake zorgen dat Hallo beschermd API-app kan alleen worden aangeroepen door een specifieke service-principal voor Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="9b0c5-116">Hallo artikel bestaat uit twee gedeelten:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-116">hello article contains two sections:</span></span>

* <span data-ttu-id="9b0c5-117">Hallo [hoe tooconfigure service-principal verificatie in Azure App Service](#authconfig) sectie wordt uitgelegd hoe u algemene tooconfigure verificatie voor een API-app, en hoe tooconsume Hallo beveiligd API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="9b0c5-118">Deze sectie is evenveel van toepassing tooall frameworks die worden ondersteund door App Service, waaronder .NET, Node.js en Java.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="9b0c5-119">Beginnen met Hallo [u doorgaat zelfstudies .NET-aan de slag Hallo](#tutorialstart) sectie Hallo zelfstudie leidt u door een 'interne toegang'-scenario voor een .NET-voorbeeldtoepassing die is uitgevoerd in App Service configureren.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="9b0c5-120"><a id="authconfig"></a>Hoe tooconfigure service-principal verificatie in Azure App Service</span><span class="sxs-lookup"><span data-stu-id="9b0c5-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="9b0c5-121">Deze sectie bevat algemene instructies die van toepassing zijn tooany API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="9b0c5-122">Ga te voor stappen specifieke toohello tooDo lijst .NET-voorbeeldtoepassing[u doorgaat Hallo .NET API Apps-zelfstudie reeks](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="9b0c5-123">In Hallo [Azure-portal](https://portal.azure.com/), navigeer toohello **instellingen** blade van Hallo API-app die u tooprotect wilt en gaat u naar Hallo **functies** sectie en klikt u op **Verificatie / autorisatie**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Verificatie/autorisatie in Azure-portal](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="9b0c5-125">In Hallo **verificatie / autorisatie** blade, klikt u op **op**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="9b0c5-126">In Hallo **tootake actie wanneer de aanvraag is niet geverifieerd** vervolgkeuzelijst, selecteer **aanmelden met Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="9b0c5-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="9b0c5-127">Onder **verificatieproviders**, selecteer **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Verificatie/autorisatie-blade in Azure-portal](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="9b0c5-129">Hallo configureren **Azure Active Directory-instellingen** blade toocreate een nieuwe Azure AD-toepassing, of gebruik een bestaande Azure AD-toepassing als u al hebt dat u wilt dat toouse.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="9b0c5-130">Interne scenario's omvatten doorgaans een API-app aanroepen van een API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="9b0c5-131">U kunt afzonderlijke Azure AD-toepassingen voor elke API-app of slechts één Azure AD-toepassing.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="9b0c5-132">Zie voor gedetailleerde instructies voor deze blade [hoe tooconfigure uw App Service-toepassing toouse Azure Active Directory-aanmelding](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="9b0c5-133">Wanneer u met de Hallo verificatie provider configuratie blade bent klaar, klikt u op **OK**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="9b0c5-134">In Hallo **verificatie / autorisatie** blade, klikt u op **opslaan**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Op Opslaan klikken](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="9b0c5-136">Wanneer dit wordt gedaan, staat App Service alleen aanvragen van aanroepfuncties in Azure AD-tenant Hallo geconfigureerd.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="9b0c5-137">Geen verificatie of autorisatie-code is vereist in Hallo beveiligd API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="9b0c5-138">Hallo bearer-token wordt doorgegeven toohello API-app samen met veelgebruikte claims in HTTP-headers en kunt u deze informatie weer in code toovalidate die aanvragen afkomstig van een bepaalde aanroeper, zoals een service-principal zijn lezen.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="9b0c5-139">Deze functionaliteit verificatie werkt Hallo dezelfde manier voor alle talen die App-service ondersteunt, zoals .NET, Node.js en Java.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="9b0c5-140">Hoe tooconsume Hallo beveiligd API-app</span><span class="sxs-lookup"><span data-stu-id="9b0c5-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="9b0c5-141">Hallo aanroeper moet een Azure AD-bearer-token met API-aanroepen opgeven.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="9b0c5-142">tooget bearer-token met behulp van service-principal referenties, Hallo aanroeper gebruikmaakt van Active Directory Authentication Library (ADAL voor [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), of [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="9b0c5-143">een token tooget, Hallo-code die ADAL-aanroepen biedt tooADAL Hallo volgende informatie:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="9b0c5-144">Hallo-naam van uw Azure AD-tenant.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="9b0c5-145">Hallo-ID en client clientgeheim (app-sleutel) van hello Azure AD-app die is gekoppeld aan de aanroeper Hallo.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="9b0c5-146">client-ID van Azure AD-toepassing die is gekoppeld aan Hallo HALLO hallo beveiligd API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="9b0c5-147">(Als slechts één Azure AD-toepassing wordt gebruikt, dit is Hallo dezelfde client-ID als een voor de aanroeper Hallo Hallo.)</span><span class="sxs-lookup"><span data-stu-id="9b0c5-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="9b0c5-148">Deze waarden zijn beschikbaar in hello Azure AD-pagina's van Hallo [klassieke Azure-portal](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="9b0c5-149">Zodra het Hallo-token is aangeschaft, Hallo aanroeper opgenomen in de met HTTP-aanvragen in Hallo autorisatie-header.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="9b0c5-150">App Service Hallo token valideert en kunnen Hallo aanvragen tooreach Hallo beveiligd API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="9b0c5-151">Hoe tooprotect Hallo API-app tegen toegang door gebruikers in Hallo die dezelfde tenant</span><span class="sxs-lookup"><span data-stu-id="9b0c5-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="9b0c5-152">Bearer-tokens voor gebruikers in dezelfde tenant worden beschouwd als geldig voor Hallo Hallo beveiligd API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="9b0c5-153">Als u wilt dat tooensure die alleen een service-principal kunt aanroepen Hallo beveiligde API-app, het toevoegen van de code in Hallo beschermd API app toovalidate Hallo claims van Hallo-token te volgen:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="9b0c5-154">`appid`client-ID van hello Azure AD-toepassing die is gekoppeld aan de aanroeper Hallo Hallo moet.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="9b0c5-155">`oid`(`objectidentifier`) moet Hallo service principal-ID van de aanroepfunctie Hallo.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="9b0c5-156">App Service biedt ook Hallo `objectidentifier` claim in de header Hallo X-MS-CLIENT-PRINCIPAL-ID.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="9b0c5-157">Hoe tooprotect Hallo API-app van toegang tot de browser</span><span class="sxs-lookup"><span data-stu-id="9b0c5-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="9b0c5-158">Als u claims in de code in Hallo beveiligd API-app niet valideren, en als u een afzonderlijke Azure AD-toepassing voor Hallo beveiligd API-app, zorg ervoor dat hello Azure AD-toepassing antwoord-URL is Hallo niet hetzelfde als het Hallo-API-app basis-URL.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="9b0c5-159">Als Hallo antwoord-URL rechtstreeks toohello beveiligd API-app verwijst, kan een gebruiker in Hallo dezelfde Azure AD-tenant toohello API-app bladeren, aanmelden en roepen Hallo-API.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="9b0c5-160"><a id="tutorialstart"></a>U kunt doorgaan zelfstudie Hallo .NET API Apps-reeks</span><span class="sxs-lookup"><span data-stu-id="9b0c5-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="9b0c5-161">Als u Hallo Node.js of Java zelfstudie reeksen voor API-apps volgt, gaat u verder toohello [Vervolgstappen](#next-steps) sectie.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="9b0c5-162">Hallo rest van dit artikel wordt voortgezet Hallo .NET API Apps-zelfstudie reeks en wordt ervan uitgegaan dat u Hallo hebt voltooid [gebruiker verificatie zelfstudie](app-service-api-dotnet-user-principal-auth.md) en Hallo-voorbeeldtoepassing die is uitgevoerd in Azure met gebruikersverificatie hebben ingeschakeld.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="9b0c5-163">Verificatie in Azure instellen</span><span class="sxs-lookup"><span data-stu-id="9b0c5-163">Set up authentication in Azure</span></span>
<span data-ttu-id="9b0c5-164">In deze sectie u App Service zo configureren dat alleen HTTP-aanvragen kunt u tooreach Hallo API app voor de gegevenslaag Hallo zijn Hallo waarden die u geldige Azure hebt AD-bearer-tokens.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="9b0c5-165">In Hallo volgende sectie, Hallo middelste laag API app toosend toepassing referenties tooAzure AD configureren, weer een bearer-token verkrijgen en Hallo bearer-token toohello gegevens laag API-app verzenden.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="9b0c5-166">Dit proces wordt weergegeven in Hallo-diagram.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-166">This process is illustrated in hello diagram.</span></span>

![Service-verificatiediagram](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="9b0c5-168">Als u problemen bij de volgende zelfstudie Hallo-instructies, Zie Hallo [probleemoplossing](#troubleshooting) sectie aan einde van de zelfstudie Hallo Hallo.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="9b0c5-169">In Hallo [Azure-portal](https://portal.azure.com/), navigeer toohello **instellingen** blade van Hallo API-app die u voor Hallo ToDoListDataAPI (gegevenslaag) API-app gemaakt en klik vervolgens op **instellingen**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="9b0c5-170">In Hallo **instellingen** blade, zoeken Hallo **functies** sectie en klik vervolgens op **verificatie / autorisatie**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Verificatie/autorisatie in Azure-portal](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="9b0c5-172">In Hallo **verificatie / autorisatie** blade, klikt u op **op**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="9b0c5-173">In Hallo **tootake actie wanneer de aanvraag is niet geverifieerd** vervolgkeuzelijst, selecteer **aanmelden met Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="9b0c5-174">Dit is Hallo instelling zorgt ervoor dat de App Service-tooensure die alleen aanvragen reach Hallo API-app geverifieerde.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="9b0c5-175">Voor aanvragen met geldig bearer-tokens, App Service doorgegeven Hallo tokens langs toohello API-app en HTTP-headers met veelgebruikte claims toomake gevuld die informatie gemakkelijker beschikbaar tooyour code.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="9b0c5-176">Onder **verificatieproviders**, klikt u op **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Verificatie/autorisatie-blade in Azure-portal](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="9b0c5-178">In Hallo **Azure Active Directory-instellingen** blade, klikt u op **Express**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="9b0c5-179">Hello **Express** optie Azure automatisch een AAD-toepassing maken in uw Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="9b0c5-180">U hebt geen toocreate een tenant, omdat elke Azure-account automatisch een heeft.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="9b0c5-181">Onder **beheermodus**, klikt u op **nieuwe AD-App maken** als deze niet is geselecteerd.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="9b0c5-182">Hallo-portal kunt aansluiten Hallo **App maken** invoervak met een standaardwaarde.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="9b0c5-183">Naam standaard hello Azure AD-toepassing hello dezelfde als Hallo API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="9b0c5-184">Als u liever, kunt u een andere naam.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-184">If you prefer, you can enter a different name.</span></span>
   
    ![Azure AD-instellingen](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="9b0c5-186">**Opmerking**: als alternatief kunt u een Azure AD van één toepassing voor zowel Hallo aanroepen API-app en Hallo beveiligd API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="9b0c5-187">Als u met deze alternatieve hebt gekozen, moet u niet Hallo **nieuwe AD-App maken** optie hier omdat u al een Azure AD-toepassing eerder in Hallo gebruiker verificatie zelfstudie hebt gemaakt.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="9b0c5-188">Voor deze zelfstudie maakt u afzonderlijke Azure AD-toepassingen voor de aanroepen van API-app en Hallo Hallo beveiligd API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="9b0c5-189">Maak een notitie van Hallo waarde in Hallo **App maken** invoervak; u moet deze AAD-toepassing in opzoeken Hallo klassieke Azure-portal later.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="9b0c5-190">Klik op **OK**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-190">Click **OK**.</span></span>
10. <span data-ttu-id="9b0c5-191">In Hallo **verificatie / autorisatie** blade, klikt u op **opslaan**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Op Opslaan klikken](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="9b0c5-193">App Service gemaakt in een Azure Active Directory-toepassing met **aanmeldings-URL** en **antwoord-URL** toohello-URL van uw API-app worden automatisch ingesteld.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="9b0c5-194">de laatste waarde Hallo kan gebruikers in uw AAD-tenant toolog in en toegang Hallo API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="9b0c5-195">Controleer of dat die Hallo API-app is beveiligd</span><span class="sxs-lookup"><span data-stu-id="9b0c5-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="9b0c5-196">Ga in een browser toohello-URL van Hallo API-app: in Hallo **API-app** blade in hello Azure-portal, klikt u op de koppeling onder Hallo **URL**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="9b0c5-197">U bent omgeleide tooa aanmeldingsscherm omdat niet-geverifieerde aanvragen tooreach Hallo API-app niet zijn toegestaan.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="9b0c5-198">Als uw browser Ga toohello Swagger-gebruikersinterface, uw browser mogelijk al aangemeld--in dat geval open een InPrivate- of Incognito-venster en ga toohello Swagger-gebruikersinterface-URL.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="9b0c5-199">Meld u aan met de referenties van een gebruiker in uw AAD-tenant.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="9b0c5-200">Wanneer u bent aangemeld, wordt de pagina 'gemaakt' hello weergegeven in Hallo browser.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="9b0c5-201">Hallo ToDoListAPI-project tooacquire configureren en stuurt hello Azure AD-token</span><span class="sxs-lookup"><span data-stu-id="9b0c5-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="9b0c5-202">In deze sectie u Hallo volgende taken:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="9b0c5-203">Voeg code toe in Hallo middelste laag API-app die gebruikmaakt van Azure AD-toepassing referenties tooacquire een token en verzenden dat met HTTP-aanvragen API-app voor de laag toohello gegevens.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="9b0c5-204">Hallo-referenties die u moet ophalen uit Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="9b0c5-205">Geef referenties op Hallo in Azure App Service runtime omgevingsinstellingen in Hallo middelste laag API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="9b0c5-206">Hallo ToDoListAPI-project tooacquire configureren en stuurt hello Azure AD-token</span><span class="sxs-lookup"><span data-stu-id="9b0c5-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="9b0c5-207">Controleer Hallo volgende wijzigingen in Hallo ToDoListAPI-project in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="9b0c5-208">Verwijder de opmerkingen in alle code in Hallo Hallo *ServicePrincipal.cs* bestand.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="9b0c5-209">Dit is Hallo-code die gebruikmaakt van ADAL voor .NET tooacquire hello Azure AD bearer-token.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="9b0c5-210">Dit maakt gebruik van verschillende configuratiewaarden die u later in hello Azure runtime-omgeving hebt ingesteld.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="9b0c5-211">Dit is Hallo code:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="9b0c5-212">**Opmerking:** deze code vereist Hallo ADAL voor .NET-NuGet-pakket (Microsoft.IdentityModel.Clients.ActiveDirectory) dat al is geïnstalleerd in Hallo-project.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="9b0c5-213">Als u dit project helemaal maakt, hebt u tooinstall dit pakket.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="9b0c5-214">Dit pakket wordt niet automatisch geïnstalleerd door Hallo API-app-nieuw project-sjabloon.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="9b0c5-215">In *domeincontrollers/ToDoListController*, Opmerking verwijderen Hallo-code in Hallo `NewDataAPIClient` methode waarmee Hallo token tooHTTP aanvragen in Hallo autorisatie-header worden toegevoegd.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="9b0c5-216">Hallo ToDoListAPI-project implementeert.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="9b0c5-217">(Met de rechtermuisknop op het Hallo-project en klik vervolgens op **publiceren > publiceren**.)</span><span class="sxs-lookup"><span data-stu-id="9b0c5-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="9b0c5-218">Visual Studio implementeert Hallo-project en basis-URL in een browser toohello van web-app wordt geopend.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="9b0c5-219">Hier ziet een fout 403-pagina normaal voor een poging toogo tooa Web API basis-URL vanuit een browser is.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="9b0c5-220">De browser sluiten Hallo.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="9b0c5-221">Azure AD-configuratiewaarden ophalen</span><span class="sxs-lookup"><span data-stu-id="9b0c5-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="9b0c5-222">In Hallo [klassieke Azure-portal](https://manage.windowsazure.com/), gaat u te**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="9b0c5-223">Op Hallo **Directory** tabblad, klikt u op uw AAD-tenant.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="9b0c5-224">Klik op **toepassingen > Mijn bedrijf eigenaar is van toepassingen**, en klik vervolgens op het vinkje Hallo.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="9b0c5-225">Klik op Hallo naam Hallo die Azure voor u gemaakt wanneer u verificatie voor Hallo ToDoListDataAPI (gegevenslaag) API-app hebt ingeschakeld in de lijst met toepassingen Hallo.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="9b0c5-226">Klik op Hallo **configureren** tabblad.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="9b0c5-227">Kopiëren Hallo **Client-ID** waarde en sla deze ergens kunt u dit uit later downloaden.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="9b0c5-228">In de klassieke Azure-portal Hallo terug toohello lijst met **toepassingen mijn bedrijf eigenaar is van**, en klik op Hallo AAD-toepassing die u hebt gemaakt voor Hallo middelste laag API-app ToDoListAPI (Hallo dat u niet in de vorige zelfstudie Hallo hebt gemaakt Hallo dat die u in deze zelfstudie hebt gemaakt).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="9b0c5-229">Klik op Hallo **configureren** tabblad.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="9b0c5-230">Kopiëren Hallo **Client-ID** waarde en sla deze ergens kunt u dit uit later downloaden.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="9b0c5-231">Onder **sleutels**, selecteer **1 jaar** van Hallo **Selecteer duur** vervolgkeuzelijst.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="9b0c5-232">Klik op **Opslaan**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-232">Click **Save**.</span></span>
    
     ![App-sleutel genereren](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="9b0c5-234">Kopieer de sleutelwaarde Hallo en sla deze ergens die kunt u dit uit later downloaden.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Kopiëren van de nieuwe app-sleutel](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="9b0c5-236">Azure AD-instellingen configureren in Hallo middelste laag API app runtime-omgeving</span><span class="sxs-lookup"><span data-stu-id="9b0c5-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="9b0c5-237">Ga toohello [Azure-portal](https://portal.azure.com/), en navigeert u vervolgens toohello **API-App** blade voor Hallo API-app die als host fungeert voor project van Hallo TodoListAPI (middelste laag).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="9b0c5-238">Klik op **Instellingen > Toepassingsinstellingen**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="9b0c5-239">In Hallo **appinstellingen** sectie, Hallo volgende sleutels en waarden toevoegen:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="9b0c5-240">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-240">**Key**</span></span> | <span data-ttu-id="9b0c5-241">IDA instantie:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="9b0c5-242">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-242">**Value**</span></span> |<span data-ttu-id="9b0c5-243">https://login.microsoftonline.com/ {uw Azure AD-tenant name}</span><span class="sxs-lookup"><span data-stu-id="9b0c5-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="9b0c5-244">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-244">**Example**</span></span> |<span data-ttu-id="9b0c5-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="9b0c5-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="9b0c5-246">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-246">**Key**</span></span> | <span data-ttu-id="9b0c5-247">IDA ClientId:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="9b0c5-248">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-248">**Value**</span></span> |<span data-ttu-id="9b0c5-249">Client-ID van Hallo aanroepen van toepassing (middelste laag - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="9b0c5-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="9b0c5-250">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-250">**Example**</span></span> |<span data-ttu-id="9b0c5-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="9b0c5-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="9b0c5-252">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-252">**Key**</span></span> | <span data-ttu-id="9b0c5-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="9b0c5-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="9b0c5-254">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-254">**Value**</span></span> |<span data-ttu-id="9b0c5-255">App-sleutel Hallo aanroepen van toepassing (middelste laag - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="9b0c5-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="9b0c5-256">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-256">**Example**</span></span> |<span data-ttu-id="9b0c5-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="9b0c5-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="9b0c5-258">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-258">**Key**</span></span> | <span data-ttu-id="9b0c5-259">IDA Resource:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="9b0c5-260">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-260">**Value**</span></span> |<span data-ttu-id="9b0c5-261">Client-ID van aangeroepen toepassing hello (gegevenslaag - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="9b0c5-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="9b0c5-262">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-262">**Example**</span></span> |<span data-ttu-id="9b0c5-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="9b0c5-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="9b0c5-264">**Opmerking**: voor `ida:Resource`, zorg ervoor dat u gebruikt naam van de toepassing hello **client-ID** en niet de **App ID URI**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="9b0c5-265">`ida:ClientId`en `ida:Resource` zijn verschillende waarden voor deze zelfstudie omdat u werkt met afzonderlijke applicaations Azure AD voor de middelste laag Hallo en de gegevenslaag.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="9b0c5-266">Als u één Azure AD-toepassing voor het aanroepen van API-app en Hallo Hallo beveiligd API-app, gebruikt u dezelfde in beide waarde Hallo `ida:ClientId` en `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="9b0c5-267">Hallo code gebruikt ConfigurationManager tooget deze waarden, zodat kan worden opgeslagen in Web.config-bestand van het project Hallo of in hello Azure runtime-omgeving.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="9b0c5-268">Terwijl een ASP.NET-toepassing in Azure App Service wordt uitgevoerd, overschrijven de instellingen voor automatisch instellingen uit Web.config. Omgevingsinstellingen zijn doorgaans een [tooa Web.config-bestand ten opzichte van een veiliger manier toostore gevoelige informatie](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="9b0c5-269">Klik op **Opslaan**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-269">Click **Save**.</span></span>
   
    ![Op Opslaan klikken](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="9b0c5-271">Hallo toepassing testen</span><span class="sxs-lookup"><span data-stu-id="9b0c5-271">Test hello application</span></span>
1. <span data-ttu-id="9b0c5-272">Ga in een browser toohello HTTPS-URL van Hallo AngularJS-front-end web-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="9b0c5-273">Klik op Hallo **tooDo lijst** tabblad en meld u aan met referenties voor een gebruiker in uw Azure AD-tenant.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="9b0c5-274">Taak items tooverify die toepassing hello werkt toevoegen.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![pagina van de lijst met tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="9b0c5-276">Als de toepassing hello niet werkt zoals verwacht, Controleer alle Hallo-instellingen die u hebt ingevoerd in hello Azure-portal.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="9b0c5-277">Als alle Hallo instellingen toobe juist wordt weergegeven, Zie Hallo [probleemoplossing](#troubleshooting) verderop in deze zelfstudie.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="9b0c5-278">Hallo-API-app beveiligen tegen toegang tot de browser</span><span class="sxs-lookup"><span data-stu-id="9b0c5-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="9b0c5-279">Voor deze zelfstudie die u hebt gemaakt een afzonderlijke Azure AD-toepassing voor Hallo ToDoListDataAPI (gegevenslaag) API-app.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="9b0c5-280">Als u hebt gezien, wanneer de App Service een AAD-toepassing maakt configureert het Hallo-AAD-toepassing op een manier die een gebruiker toogo toohello van API-app-URL in een browser en meld schakelt op.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="9b0c5-281">Dit betekent dat het is mogelijk voor gebruikers in uw Azure AD-tenant, niet alleen een service-principal, tooaccess Hallo API.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="9b0c5-282">Als u toegang tot de tooprevent browser wilt zonder code schrijven in Hallo API-app beveiligd, kunt u Hallo **antwoord-URL** in AAD-toepassing hello zodat deze van Hallo API-app verschilt basis-URL.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="9b0c5-283">Toegang tot de browser uitschakelen</span><span class="sxs-lookup"><span data-stu-id="9b0c5-283">Disable browser access</span></span>
1. <span data-ttu-id="9b0c5-284">In Hallo klassieke portal **configureren** voor Hallo AAD-toepassing die is gemaakt voor Hallo TodoListService en wijzig de waarde in Hallo Hallo **antwoord-URL** zodat het een geldige URL, maar niet Hallo API-app van veld DE URL.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="9b0c5-285">Klik op **Opslaan**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="9b0c5-286">Controleer of toegang tot de browser niet meer werkt</span><span class="sxs-lookup"><span data-stu-id="9b0c5-286">Verify browser access no longer works</span></span>
<span data-ttu-id="9b0c5-287">Eerder gecontroleerd dat kunt u toohello API-app-URL gaan vanuit een browser door met de referenties van een afzonderlijke gebruiker aanmeldt.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="9b0c5-288">In deze sectie, controleert u of dit is niet langer mogelijk.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="9b0c5-289">Ga toohello-URL van de API-app Hallo opnieuw in een nieuw browservenster.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="9b0c5-290">Aanmelden bij gevraagd toodo dus.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="9b0c5-291">Aanmelding is geslaagd, maar tooan foutpagina leidt.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="9b0c5-292">U kunt Hallo AAD-app hebt geconfigureerd, zodat gebruikers in Hallo AAD-tenant kunnen niet aanmelden en toegang Hallo API vanuit een browser.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="9b0c5-293">U kunt nog steeds toegang tot Hallo API-app met behulp van een token voor principal op service, waarmee u controleren kunt door te gaan toohello van web-app-URL en meer taakitems toe te voegen.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="9b0c5-294">Beperken van toegang tooa bepaalde service-principal</span><span class="sxs-lookup"><span data-stu-id="9b0c5-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="9b0c5-295">Momenteel aanroeper die een token kan krijgen voor een gebruiker of service-principal in uw Azure AD-tenant hello TodoListDataAPI (gegevenslaag) API-app kunt aanroepen.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="9b0c5-296">Hier kunt u ervoor dat Hallo API app voor de gegevenslaag accepteert alleen aanroepen van Hallo TodoListAPI (middelste laag) API-app, en alleen vanuit een bepaalde service-principal toomake.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="9b0c5-297">U kunt deze beperkingen toevoegen door toe te voegen code toovalidate hello `appid` en `objectidentifier` claims op binnenkomende oproepen.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="9b0c5-298">Voor deze zelfstudie plaatsen u Hallo-code die app-ID en de service-principal-ID rechtstreeks in uw domeincontroller acties worden gevalideerd.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="9b0c5-299">Alternatieven zijn toouse een aangepaste `Authorize` kenmerk of toodo deze validatie in uw takenreeksen opstarten (bijvoorbeeld OWIN middleware).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="9b0c5-300">Zie voor een voorbeeld van de laatste Hallo [deze voorbeeldtoepassing](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="9b0c5-301">Hallo na wijzigingen toohello TodoListDataAPI-project maken</span><span class="sxs-lookup"><span data-stu-id="9b0c5-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="9b0c5-302">Open Hallo *Controllers/TodoListController.cs* bestand.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="9b0c5-303">Verwijder de opmerkingen in Hallo-regels die ingesteld `trustedCallerClientId` en `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="9b0c5-304">Verwijder de opmerkingen in Hallo-code in Hallo CheckCallerId methode.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="9b0c5-305">Deze methode wordt aangeroepen bij Hallo begin van elke actiemethode in het Hallo-controller.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="9b0c5-306">Hallo ToDoListDataAPI project tooAzure App Service implementeren.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="9b0c5-307">Ga in uw browser toohello AngularJS-front-end van web-app HTTPS-URL en klik in de Hallo-startpagina op Hallo **tooDo lijst** tabblad.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="9b0c5-308">Hallo toepassing werkt niet omdat aanroepen toohello back-end mislukken.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="9b0c5-309">nieuwe code Hallo werkelijke appid en objectidentifier wordt gecontroleerd, maar deze heeft nog geen Hallo juiste waarden toocheck ze tegen.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="9b0c5-310">Hallo-browser de Console hulpprogramma's voor ontwikkelaars rapporten dat die Hallo-server retourneert een 401 HTTP-fout.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Fout in Developer Tools Console](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="9b0c5-312">In de stappen te volgen Hallo configureert u Hallo verwachte waarden.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="9b0c5-313">Met Azure AD PowerShell, Hallo waarde ophalen van Hallo service principal voor hello Azure AD-toepassing die u hebt gemaakt voor Hallo TodoListWebApp project.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="9b0c5-314">a.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-314">a.</span></span> <span data-ttu-id="9b0c5-315">Voor instructies over het tooinstall Azure PowerShell en verbinding maken met abonnement tooyour, Zie [Azure PowerShell gebruiken met Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="9b0c5-316">b.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-316">b.</span></span> <span data-ttu-id="9b0c5-317">een lijst met de service-principals tooget uitvoeren Hallo `Login-AzureRmAccount` opdracht in en klik vervolgens Hallo `Get-AzureRmADServicePrincipal` opdracht.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="9b0c5-318">c.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-318">c.</span></span> <span data-ttu-id="9b0c5-319">Hallo objectid voor Hallo service-principal van Hallo TodoListAPI toepassing vinden en opslaan in een locatie die u later kunt kopiëren uit.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="9b0c5-320">Navigeer in hello Azure-portal, toohello-blade API-app voor Hallo API-app die u hebt geïmplementeerd Hallo ToDoListDataAPI-project.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="9b0c5-321">Klik op **instellingen > Toepassingsinstellingen**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="9b0c5-322">In Hallo **appinstellingen** sectie, Hallo volgende sleutels en waarden toevoegen:</span><span class="sxs-lookup"><span data-stu-id="9b0c5-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="9b0c5-323">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-323">**Key**</span></span> | <span data-ttu-id="9b0c5-324">TODO:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="9b0c5-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="9b0c5-325">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-325">**Value**</span></span> |<span data-ttu-id="9b0c5-326">Service-principal-id van het aanroepen van toepassing</span><span class="sxs-lookup"><span data-stu-id="9b0c5-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="9b0c5-327">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-327">**Example**</span></span> |<span data-ttu-id="9b0c5-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="9b0c5-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="9b0c5-329">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-329">**Key**</span></span> | <span data-ttu-id="9b0c5-330">TODO:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="9b0c5-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="9b0c5-331">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-331">**Value**</span></span> |<span data-ttu-id="9b0c5-332">Client-ID van het aanroepen van de toepassing - gekopieerd vanuit Hallo TodoListAPI Azure AD-toepassing</span><span class="sxs-lookup"><span data-stu-id="9b0c5-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="9b0c5-333">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="9b0c5-333">**Example**</span></span> |<span data-ttu-id="9b0c5-334">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="9b0c5-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="9b0c5-335">Klik op **Opslaan**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-335">Click **Save**.</span></span>
    
     ![Op Opslaan klikken](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="9b0c5-337">In uw browser terug toohello van web-app-URL en in de startpagina Hallo op Hallo **tooDo lijst** tabblad.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="9b0c5-338">Deze toepassing hello werkt zoals verwacht omdat Hallo aanroeper vertrouwde app-ID en service-principal-ID Hallo verwachte waarden.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![pagina van de lijst met tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="9b0c5-340">Hallo-projecten helemaal bouwen</span><span class="sxs-lookup"><span data-stu-id="9b0c5-340">Building hello projects from scratch</span></span>
<span data-ttu-id="9b0c5-341">Hallo twee Web API-projecten zijn gemaakt met behulp van Hallo **Azure API-App** sjabloon en vervang Hallo standaard waarden domeincontroller met een domeincontroller ToDoList project.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="9b0c5-342">Voor het verkrijgen van Azure AD-service-principal tokens in de project ToDoListAPI Hallo Hallo [Active Directory Authentication Library (ADAL) voor .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet-pakket is geïnstalleerd.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="9b0c5-343">Zie voor een single-page application ' AngularJS informatie over het te maken met een Web-API-back-end zoals ToDoListAngular, [handen op Lab: bouwen van een enkele toepassing pagina WACHTWOORDVERIFICATIE met ASP.NET Web API en Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="9b0c5-344">Voor informatie over het tooadd verificatiecode van Azure AD, Zie [beveiligen AngularJS één pagina Apps met Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="9b0c5-345">Problemen oplossen</span><span class="sxs-lookup"><span data-stu-id="9b0c5-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="9b0c5-346">Zorg ervoor dat u en niet door elkaar ToDoListAPI (middelste laag) ToDoListDataAPI (gegevenslaag).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="9b0c5-347">Bijvoorbeeld: in deze zelfstudie u verificatie toohello gegevens laag API-app toevoegen **maar Hallo app-sleutel moet afkomstig zijn van Azure AD-toepassing die u hebt gemaakt voor de middelste laag API-app Hallo Hallo**.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9b0c5-348">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="9b0c5-348">Next steps</span></span>
<span data-ttu-id="9b0c5-349">Dit is de laatste zelfstudie Hallo in Hallo reeks API-Apps.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="9b0c5-350">Zie voor meer informatie over Azure Active Directory Hallo resources te volgen.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="9b0c5-351">Azure AD ontwikkelaarshandleiding</span><span class="sxs-lookup"><span data-stu-id="9b0c5-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="9b0c5-352">Azure AD-scenario 's</span><span class="sxs-lookup"><span data-stu-id="9b0c5-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="9b0c5-353">Azure AD-voorbeelden</span><span class="sxs-lookup"><span data-stu-id="9b0c5-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="9b0c5-354">Hallo [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) voorbeeld lijkt toowhat wordt weergegeven in deze zelfstudie, maar zonder verificatie van App Service.</span><span class="sxs-lookup"><span data-stu-id="9b0c5-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="9b0c5-355">Voor informatie over andere manieren toodeploy Visual Studio-projecten tooAPI-apps met behulp van Visual Studio of [implementatie automatiseren](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) van een [broncodebeheersysteem](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), Zie [hoe toodeploy een Azure App Service-app](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="9b0c5-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

