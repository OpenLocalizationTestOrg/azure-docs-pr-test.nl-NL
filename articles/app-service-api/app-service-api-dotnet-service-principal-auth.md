---
title: Verificatie van service-principal voor API Apps in Azure App Service | Microsoft Docs
description: Informatie over het beveiligen van een API-app in Azure App Service voor scenario's voor service-naar-service.
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 95653287546bbe358111ed16af0c30a53caff2b5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="ceeb2-103">Verificatie van service-principal voor API Apps in Azure App Service</span><span class="sxs-lookup"><span data-stu-id="ceeb2-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="ceeb2-104">Overzicht</span><span class="sxs-lookup"><span data-stu-id="ceeb2-104">Overview</span></span>
<span data-ttu-id="ceeb2-105">In dit artikel wordt uitgelegd hoe u App Service-verificatie voor *interne* toegang tot API-apps.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-105">This article explains how to use App Service authentication for *internal* access to API apps.</span></span> <span data-ttu-id="ceeb2-106">Een interne scenario is waar u een API-app die u wilt worden alleen door uw eigen toepassingscode verbruikbare hebt.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-106">An internal scenario is where you have an API app that you want to be consumable only by your own application code.</span></span> <span data-ttu-id="ceeb2-107">De aanbevolen manier om dit scenario implementeren in App Service wordt opgeroepen API-app beveiligen met Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-107">The recommended way to implement this scenario in App Service is to use Azure AD to protect the called API app.</span></span> <span data-ttu-id="ceeb2-108">U kunt de API-app met een bearer-token die u via Azure AD door het opgeven van de toepassings-id (service-principal) referenties beveiligde aanroepen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-108">You call the protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="ceeb2-109">Zie voor alternatieven voor het gebruik van Azure AD de **authentication Service-naar-serviceconnector** sectie van de [overzicht van Azure App Service-authenticatie](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-109">For alternatives to using Azure AD, see the **Service-to-service authentication** section of the [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="ceeb2-110">In dit artikel leert u het volgende:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="ceeb2-111">Het gebruik van Azure Active Directory (Azure AD) voor een API-app beveiligen tegen niet-geverifieerde toegang.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-111">How to use Azure Active Directory (Azure AD) to protect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="ceeb2-112">Klik hier voor meer informatie over het gebruiken van een beveiligde API-app van een API-app, web-app of mobiele app via Azure AD-referenties voor service-principal (app-identiteit).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-112">How to consume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="ceeb2-113">Zie voor meer informatie over het gebruiken van een logische app [uw aangepaste API gebruiken die worden gehost op App Service met Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-113">For information about how to consume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="ceeb2-114">Hoe om ervoor te zorgen dat de beveiligde API-app kan niet worden aangeroepen vanuit een browser door aangemelde gebruikers.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-114">How to make sure that the protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="ceeb2-115">Hoe om ervoor te zorgen dat de beveiligde API-app kan alleen worden aangeroepen door een specifieke Azure AD service-principal.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-115">How to make sure that the protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="ceeb2-116">Het artikel bestaat uit twee gedeelten:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-116">The article contains two sections:</span></span>

* <span data-ttu-id="ceeb2-117">De [verificatie van de service-principal configureren in Azure App Service](#authconfig) sectie in het algemeen wordt uitgelegd hoe authentication configureren voor elke API-app en de beveiligde API-app gebruiken.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-117">The [How to configure service principal authentication in Azure App Service](#authconfig) section explains in general how to configure authentication for any API app, and how to consume the protected API app.</span></span> <span data-ttu-id="ceeb2-118">Deze sectie is evenveel van toepassing op alle frameworks die worden ondersteund door App Service, waaronder .NET, Node.js en Java.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-118">This section applies equally to all frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="ceeb2-119">Beginnen met de [u doorgaat met de zelfstudies .NET aan de slag](#tutorialstart) sectie de zelfstudie leidt u door een 'interne toegang'-scenario voor een .NET-voorbeeldtoepassing die is uitgevoerd in App Service configureren.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-119">Starting with the [Continuing the .NET getting-started tutorials](#tutorialstart) section, the tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="ceeb2-120"><a id="authconfig"></a>Verificatie van de service-principal in Azure App Service configureren</span><span class="sxs-lookup"><span data-stu-id="ceeb2-120"><a id="authconfig"></a> How to configure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="ceeb2-121">Deze sectie bevat algemene instructies die betrekking hebben op elke API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-121">This section provides general instructions that apply to any API app.</span></span> <span data-ttu-id="ceeb2-122">Voor specifieke stappen voor de voorbeeldtoepassing te doen lijst-.NET, gaat u naar [u doorgaat met de .NET API Apps zelfstudie reeks](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-122">For steps specific to the To Do List .NET sample application, go to [Continuing the .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="ceeb2-123">In de [Azure-portal](https://portal.azure.com/), gaat u naar de **instellingen** blade van de API-app die u wilt beveiligen en gaat u naar de **functies** sectie en klik op **verificatie / autorisatie**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-123">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you want to protect, and then find the **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Verificatie/autorisatie in Azure-portal](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="ceeb2-125">In de **verificatie / autorisatie** blade, klikt u op **op**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-125">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="ceeb2-126">In de **te ondernemen actie wanneer de aanvraag is niet geverifieerd** vervolgkeuzelijst, selecteer **aanmelden met Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="ceeb2-126">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="ceeb2-127">Onder **verificatieproviders**, selecteer **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Verificatie/autorisatie-blade in Azure-portal](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="ceeb2-129">Configureer de **Azure Active Directory-instellingen** blade Maak een nieuwe Azure AD-toepassing, of gebruik een bestaande Azure AD-toepassing als u al hebt die u wilt gebruiken.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-129">Configure the **Azure Active Directory Settings** blade to create a new Azure AD application, or use an existing Azure AD application if you already have one that you want to use.</span></span>
   
    <span data-ttu-id="ceeb2-130">Interne scenario's omvatten doorgaans een API-app aanroepen van een API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="ceeb2-131">U kunt afzonderlijke Azure AD-toepassingen voor elke API-app of slechts één Azure AD-toepassing.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="ceeb2-132">Zie voor gedetailleerde instructies voor deze blade [het configureren van uw App Service-toepassing voor het gebruik van Azure Active Directory-aanmelding](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-132">For detailed instructions on this blade, see [How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="ceeb2-133">Wanneer u met de blade verificatie provider configuratie bent klaar, klikt u op **OK**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-133">When you're done with the authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="ceeb2-134">In de **verificatie / autorisatie** blade, klikt u op **opslaan**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-134">In the **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Op Opslaan klikken](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="ceeb2-136">Wanneer dit wordt gedaan, App Service kunt alleen aanvragen van aanroepfuncties in de geconfigureerde Azure AD-tenant.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-136">When this is done, App Service only allows requests from callers in the configured Azure AD tenant.</span></span> <span data-ttu-id="ceeb2-137">Geen verificatie of autorisatie-code is vereist in de beveiligde API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-137">No authentication or authorization code is required in the protected API app.</span></span> <span data-ttu-id="ceeb2-138">De bearer-token wordt doorgegeven aan de API-app samen met vaak gebruikte claims in HTTP-headers en kunt u die informatie in de code te valideren dat verzoeken afkomstig van een bepaalde aanroeper, zoals een service-principal zijn lezen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-138">The bearer token is passed to the API app along with commonly used claims in HTTP headers, and you can read that information in code to validate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="ceeb2-139">Deze functionaliteit verificatie werkt op dezelfde manier voor alle talen die App-service wordt ondersteund, waaronder .NET, Node.js en Java.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-139">This authentication functionality works the same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-to-consume-the-protected-api-app"></a><span data-ttu-id="ceeb2-140">De beveiligde API-app gebruiken</span><span class="sxs-lookup"><span data-stu-id="ceeb2-140">How to consume the protected API app</span></span>
<span data-ttu-id="ceeb2-141">De aanroeper moet een Azure AD-bearer-token met API-aanroepen opgeven.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-141">The caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="ceeb2-142">Als u een bearer-token met behulp van service-principal referenties, de aanroeper maakt gebruik van Active Directory Authentication Library (ADAL voor [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), of [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-142">To get a bearer token using service principal credentials, the caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="ceeb2-143">Als u een token, bevat de code die ADAL-aanroepen adal de volgende informatie:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-143">To get a token, the code that calls ADAL provides to ADAL the following information:</span></span>

* <span data-ttu-id="ceeb2-144">De naam van uw Azure AD-tenant.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-144">The name of your Azure AD tenant.</span></span>
* <span data-ttu-id="ceeb2-145">De client-ID en clientgeheim (app-sleutel) van de Azure AD-app die is gekoppeld aan de aanroeper.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-145">The client ID and client secret (app key) of the Azure AD app associated with the caller.</span></span>
* <span data-ttu-id="ceeb2-146">De client-ID van de Azure AD-toepassing die is gekoppeld aan de beveiligde API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-146">The client ID of the Azure AD application associated with the protected API app.</span></span> <span data-ttu-id="ceeb2-147">(Als slechts één Azure AD-toepassing wordt gebruikt, is dit de dezelfde client-ID als voor de aanroeper.)</span><span class="sxs-lookup"><span data-stu-id="ceeb2-147">(If just one Azure AD application is used, this is the same client ID as the one for the caller.)</span></span>

<span data-ttu-id="ceeb2-148">Deze waarden zijn beschikbaar in de Azure AD's van de [klassieke Azure-portal](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-148">These values are available in the Azure AD pages of the [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="ceeb2-149">Wanneer het token heeft aangeschaft, wordt het in de aanroeper bevat met HTTP-aanvragen in de autorisatie-header.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-149">Once the token has been acquired, the caller includes it with HTTP requests in the Authorization header.</span></span>  <span data-ttu-id="ceeb2-150">App Service valideert het token en kunnen de aanvragen voor het bereiken van de beveiligde API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-150">App Service validates the token and allows the requests to reach the protected API app.</span></span>

#### <a name="how-to-protect-the-api-app-from-access-by-users-in-the-same-tenant"></a><span data-ttu-id="ceeb2-151">Het beveiligen van de API-app tegen toegang door gebruikers in dezelfde tenant</span><span class="sxs-lookup"><span data-stu-id="ceeb2-151">How to protect the API app from access by users in the same tenant</span></span>
<span data-ttu-id="ceeb2-152">Voor gebruikers in dezelfde tenant-Bearer-tokens als geldig beschouwd voor het beveiligde API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-152">Bearer tokens for users in the same tenant are considered valid for the protected API app.</span></span>  <span data-ttu-id="ceeb2-153">Als u wilt om ervoor te zorgen dat alleen een service-principal beveiligde API-app kunt aanroepen, moet u code toevoegen in de beveiligde API-app voor het valideren van de volgende claims uit het token:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-153">If you want to ensure that only a service principal can call the protected API app, add code in the protected API app to validate the following claims from the token:</span></span>

* <span data-ttu-id="ceeb2-154">`appid`moet u de client-ID van de Azure AD-toepassing die is gekoppeld aan de aanroeper.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-154">`appid` should be the client ID of the Azure AD application that is associated with the caller.</span></span> 
* <span data-ttu-id="ceeb2-155">`oid`(`objectidentifier`) moet de service-principal-ID van de aanroepfunctie.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-155">`oid` (`objectidentifier`) should be the service principal ID of the caller.</span></span> 

<span data-ttu-id="ceeb2-156">App Service biedt ook de `objectidentifier` claim in de header X-MS-CLIENT-PRINCIPAL-ID.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-156">App Service also provides the `objectidentifier` claim in the X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-to-protect-the-api-app-from-browser-access"></a><span data-ttu-id="ceeb2-157">Het beveiligen van de API-app van toegang tot de browser</span><span class="sxs-lookup"><span data-stu-id="ceeb2-157">How to protect the API app from browser access</span></span>
<span data-ttu-id="ceeb2-158">Als u claims in de code in de beveiligde API-app niet valideren, en als u een afzonderlijke Azure AD-toepassing voor de beveiligde API-app, zorg ervoor dat de Azure AD-toepassing antwoord-URL is niet hetzelfde zijn als de basis-URL van de API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-158">If you don't validate claims in code in the protected API app, and if you use a separate Azure AD application for the protected API app, make sure that the Azure AD application's Reply URL is not the same as the API app's base URL.</span></span> <span data-ttu-id="ceeb2-159">Als de antwoord-URL rechtstreeks naar de beveiligde API-app verwijst, kan een gebruiker in de dezelfde Azure AD-tenant Blader naar de API-app, aanmelden en is de API aanroepen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-159">If the Reply URL points directly to the protected API app, a user in the same Azure AD tenant could browse to the API app, log on, and successfully call the API.</span></span>

## <span data-ttu-id="ceeb2-160"><a id="tutorialstart"></a>U kunt doorgaan de zelfstudie reeks .NET API-Apps</span><span class="sxs-lookup"><span data-stu-id="ceeb2-160"><a id="tutorialstart"></a> Continuing the .NET API Apps tutorial series</span></span>
<span data-ttu-id="ceeb2-161">Als u de zelfstudie reeks Node.js of Java voor API-apps volgt, gaat u naar de [Vervolgstappen](#next-steps) sectie.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-161">If you are following the Node.js or Java tutorial series for API apps, skip to the [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="ceeb2-162">De rest van dit artikel wordt de .NET API Apps zelfstudie reeks voortgezet en wordt ervan uitgegaan dat u hebt voltooid de [gebruiker verificatie zelfstudie](app-service-api-dotnet-user-principal-auth.md) en hebben de voorbeeldtoepassing die u uitvoert in Azure met de verificatie van de gebruiker is ingeschakeld.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-162">The remainder of this article continues the .NET API Apps tutorial series and assumes that you have completed the [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have the sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="ceeb2-163">Verificatie in Azure instellen</span><span class="sxs-lookup"><span data-stu-id="ceeb2-163">Set up authentication in Azure</span></span>
<span data-ttu-id="ceeb2-164">In deze sectie u App Service zo configureren dat alleen HTTP-aanvragen dat kunt u de API app voor de gegevenslaag bereiken zijn degene die geldig Azure zijn AD-bearer-tokens.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-164">In this section you configure App Service so that the only HTTP requests it allows to reach the data tier API app are the ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="ceeb2-165">In de volgende sectie configureert u de API-app voor de middelste laag toepassing referenties te verzenden naar Azure AD, weer een bearer-token verkrijgen en de bearer-token verzenden naar de API app voor de gegevenslaag.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-165">In the following section, you configure the middle tier API app to send application credentials to Azure AD, get back a bearer token, and send the bearer token to the data tier API app.</span></span> <span data-ttu-id="ceeb2-166">Dit proces wordt weergegeven in het diagram.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-166">This process is illustrated in the diagram.</span></span>

![Service-verificatiediagram](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="ceeb2-168">Als u problemen ondervindt tijdens de zelfstudie aanwijzingen, raadpleegt u de [probleemoplossing](#troubleshooting) sectie aan het einde van de zelfstudie.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-168">If you run into problems while following the tutorial directions, see the [Troubleshooting](#troubleshooting) section at the end of the tutorial.</span></span> 

1. <span data-ttu-id="ceeb2-169">In de [Azure-portal](https://portal.azure.com/), gaat u naar de **instellingen** blade van de API-app die u voor de ToDoListDataAPI (gegevenslaag) API-app gemaakt en klik vervolgens op **instellingen**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-169">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you created for the ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="ceeb2-170">In de **instellingen** blade vinden de **functies** sectie en klik vervolgens op **verificatie / autorisatie**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-170">In the **Settings** blade, find the **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Verificatie/autorisatie in Azure-portal](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="ceeb2-172">In de **verificatie / autorisatie** blade, klikt u op **op**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-172">In the **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="ceeb2-173">In de **te ondernemen actie wanneer de aanvraag is niet geverifieerd** vervolgkeuzelijst, selecteer **aanmelden met Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-173">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="ceeb2-174">Dit is de instelling zorgt ervoor dat de App-Service om ervoor te zorgen dat alleen aanvragen reach API-app geverifieerde.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-174">This is the setting that causes App Service to ensure that only authenticated requests reach the API app.</span></span> <span data-ttu-id="ceeb2-175">Voor aanvragen met geldig bearer-tokens, App Service de tokens langs wordt doorgegeven aan de API-app en HTTP-headers met veelgebruikte claims die informatie gemakkelijker om beschikbaar te maken aan uw code wordt gevuld.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-175">For requests that have valid bearer tokens, App Service passes the tokens along to the API app and populates HTTP headers with commonly used claims to make that information more easily available to your code.</span></span>
5. <span data-ttu-id="ceeb2-176">Onder **verificatieproviders**, klikt u op **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Verificatie/autorisatie-blade in Azure-portal](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="ceeb2-178">In de **Azure Active Directory-instellingen** blade, klikt u op **Express**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-178">In the **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="ceeb2-179">Met de **Express** optie Azure automatisch een AAD-toepassing maken in uw Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-179">With the **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="ceeb2-180">U hoeft te maken van een tenant omdat elke Azure-account automatisch een heeft.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-180">You don't have to create a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="ceeb2-181">Onder **beheermodus**, klikt u op **nieuwe AD-App maken** als deze niet is geselecteerd.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="ceeb2-182">De portal kunt aansluiten de **App maken** invoervak met een standaardwaarde.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-182">The portal plugs the **Create App** input box with a default value.</span></span> <span data-ttu-id="ceeb2-183">Standaard is de Azure AD-toepassing naam hetzelfde zijn als de API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-183">By default, the Azure AD application is named the same as the API app.</span></span> <span data-ttu-id="ceeb2-184">Als u liever, kunt u een andere naam.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-184">If you prefer, you can enter a different name.</span></span>
   
    ![Azure AD-instellingen](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="ceeb2-186">**Opmerking**: als alternatief kunt u een Azure AD van één toepassing voor zowel de aanroepende API-app en de beveiligde API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-186">**Note**: As an alternative, you could use a single Azure AD application for both the calling API app and the protected API app.</span></span> <span data-ttu-id="ceeb2-187">Als u met deze alternatieve hebt gekozen, moet u niet de **nieuwe AD-App maken** optie hier omdat u al een Azure AD-toepassing eerder in de gebruiker authenticatie-zelfstudie hebt gemaakt.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-187">If you chose that alternative, you would not need the **Create New AD App** option here because you already created an Azure AD application earlier in the user authentication tutorial.</span></span> <span data-ttu-id="ceeb2-188">Voor deze zelfstudie gebruikt u Azure AD-toepassingen voor de aanroepende API-app en de beveiligde API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-188">For this tutorial, you'll use separate Azure AD applications for the calling API app and the protected API app.</span></span>
8. <span data-ttu-id="ceeb2-189">Noteer de waarde die is in de **App maken** invoervak; u moet deze AAD-toepassing in de klassieke Azure portal later opzoeken.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-189">Make a note of the value that is in the **Create App** input box; you'll look up this AAD application in the Azure classic portal later.</span></span>
9. <span data-ttu-id="ceeb2-190">Klik op **OK**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-190">Click **OK**.</span></span>
10. <span data-ttu-id="ceeb2-191">In de **verificatie / autorisatie** blade, klikt u op **opslaan**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-191">In the **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Op Opslaan klikken](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="ceeb2-193">App Service gemaakt in een Azure Active Directory-toepassing met **aanmeldings-URL** en **antwoord-URL** automatisch ingesteld op de URL van uw API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set to the URL of your API app.</span></span> <span data-ttu-id="ceeb2-194">De laatste waarde kan gebruikers in uw AAD-tenant kunnen aanmelden en toegang tot de API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-194">The latter value enables users in your AAD tenant to log in and access the API app.</span></span>

### <a name="verify-that-the-api-app-is-protected"></a><span data-ttu-id="ceeb2-195">Controleren of de API-app is beveiligd</span><span class="sxs-lookup"><span data-stu-id="ceeb2-195">Verify that the API app is protected</span></span>
1. <span data-ttu-id="ceeb2-196">Ga in een browser naar de URL van de API-app: in de **API-app** blade in de Azure-portal klikt u op de koppeling onder **URL**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-196">In a browser go to the URL of the API app: in the **API app** blade in the Azure portal, click the link under **URL**.</span></span> 
   
    <span data-ttu-id="ceeb2-197">U wordt omgeleid naar een aanmeldingsscherm omdat niet-geverifieerde aanvragen zijn niet toegestaan voor het bereiken van de API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-197">You are redirected to a login screen because unauthenticated requests are not allowed to reach the API app.</span></span> 
   
    <span data-ttu-id="ceeb2-198">Als uw browser naar de Swagger-gebruikersinterface gaat, kan al uw browser worden geregistreerd op--in dat geval open een InPrivate- of Incognito-venster en Ga naar de URL van de Swagger-gebruikersinterface.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-198">If your browser does go to the Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go to the Swagger UI URL.</span></span>
2. <span data-ttu-id="ceeb2-199">Meld u aan met de referenties van een gebruiker in uw AAD-tenant.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="ceeb2-200">Wanneer u bent aangemeld, wordt de pagina 'is gemaakt' in de browser weergegeven.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-200">When you're logged on, the "successfully created" page appears in the browser.</span></span>

## <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="ceeb2-201">Het project ToDoListAPI om toegang te verkrijgen en stuurt het token Azure AD configureren</span><span class="sxs-lookup"><span data-stu-id="ceeb2-201">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="ceeb2-202">In deze sectie kunt u de volgende taken uitvoeren:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-202">In this section you do the following tasks:</span></span>

* <span data-ttu-id="ceeb2-203">Voeg code toe in de middelste laag API-app die gebruikmaakt van Azure AD-toepassing-referenties voor een token verkrijgen en verzenden met HTTP-aanvragen naar de API app voor de gegevenslaag.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-203">Add code in the middle tier API app that uses Azure AD application credentials to acquire a token and send it with HTTP requests to the data tier API app.</span></span>
* <span data-ttu-id="ceeb2-204">De referenties die u moet ophalen uit Azure AD.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-204">Get the credentials you need from Azure AD.</span></span>
* <span data-ttu-id="ceeb2-205">Voer de referenties in Azure App Service-runtime-omgevingsinstellingen in de middelste laag API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-205">Enter the credentials into Azure App Service runtime environment settings in the middle tier API app.</span></span> 

### <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="ceeb2-206">Het project ToDoListAPI om toegang te verkrijgen en stuurt het token Azure AD configureren</span><span class="sxs-lookup"><span data-stu-id="ceeb2-206">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="ceeb2-207">De volgende wijzigingen aanbrengen in het project ToDoListAPI in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-207">Make the following changes in the ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="ceeb2-208">Verwijder de opmerkingen in alle van de code in de *ServicePrincipal.cs* bestand.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-208">Uncomment all of the code in the *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="ceeb2-209">Dit is de code die gebruikmaakt van ADAL voor .NET te verkrijgen van de Azure AD-bearer-token.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-209">This is the code that uses ADAL for .NET to acquire the Azure AD bearer token.</span></span>  <span data-ttu-id="ceeb2-210">Dit maakt gebruik van verschillende configuratiewaarden die u later in de Azure-runtime-omgeving hebt ingesteld.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-210">It uses several configuration values that you'll set in the Azure runtime environment later.</span></span> <span data-ttu-id="ceeb2-211">Dit is de code:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-211">Here's the code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="ceeb2-212">**Opmerking:** deze code vereist de ADAL voor .NET-NuGet-pakket (Microsoft.IdentityModel.Clients.ActiveDirectory) dat al is geïnstalleerd in het project.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-212">**Note:** This code requires the ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in the project.</span></span> <span data-ttu-id="ceeb2-213">Als u dit project helemaal maakt, moet u dit pakket installeert.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-213">If you were creating this project from scratch, you would have to install this package.</span></span> <span data-ttu-id="ceeb2-214">Dit pakket wordt niet automatisch geïnstalleerd door de sjabloon API app nieuw project.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-214">This package is not automatically installed by the API app new-project template.</span></span>
2. <span data-ttu-id="ceeb2-215">In *domeincontrollers/ToDoListController*, herstel de code in de `NewDataAPIClient` methode waarmee het token wordt toegevoegd aan de HTTP-aanvragen in de autorisatie-header.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-215">In *Controllers/ToDoListController*, uncomment the code in the `NewDataAPIClient` method that adds the token to HTTP requests in the authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="ceeb2-216">Implementeer het project ToDoListAPI.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-216">Deploy the ToDoListAPI project.</span></span> <span data-ttu-id="ceeb2-217">(Met de rechtermuisknop op het project en klik vervolgens op **publiceren > publiceren**.)</span><span class="sxs-lookup"><span data-stu-id="ceeb2-217">(Right-click the project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="ceeb2-218">Visual Studio implementeert het project en opent een browservenster met de basis-URL van de web-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-218">Visual Studio deploys the project and opens a browser to the web app's base URL.</span></span> <span data-ttu-id="ceeb2-219">Hier ziet een fout 403-pagina normaal voor een poging is om naar een Web-API basis-URL vanuit een browser.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-219">This will show a 403 error page, which is normal for an attempt to go to a Web API base URL from a browser.</span></span>
4. <span data-ttu-id="ceeb2-220">Sluit de browser.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-220">Close the browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="ceeb2-221">Azure AD-configuratiewaarden ophalen</span><span class="sxs-lookup"><span data-stu-id="ceeb2-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="ceeb2-222">In de [klassieke Azure-portal](https://manage.windowsazure.com/), gaat u naar **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-222">In the [Azure classic portal](https://manage.windowsazure.com/), go to **Azure Active Directory**.</span></span>
2. <span data-ttu-id="ceeb2-223">Op de **Directory** tabblad, klikt u op uw AAD-tenant.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-223">On the **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="ceeb2-224">Klik op **toepassingen > Mijn bedrijf eigenaar is van toepassingen**, en klik vervolgens op het vinkje.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-224">Click **Applications > Applications my company owns**, and then click the check mark.</span></span>
4. <span data-ttu-id="ceeb2-225">Klik op de naam van de gebruiker die Azure voor u gemaakt wanneer u verificatie voor de ToDoListDataAPI (gegevenslaag) API-app hebt ingeschakeld in de lijst met toepassingen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-225">In the list of applications, click the name of the one that Azure created for you when you enabled authentication for the ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="ceeb2-226">Klik op het tabblad **Configureren**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-226">Click the **Configure** tab.</span></span>
6. <span data-ttu-id="ceeb2-227">Kopieer de **Client-ID** waarde en sla deze ergens kunt u dit uit later downloaden.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-227">Copy the **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="ceeb2-228">In het Azure classic portal Ga terug naar de lijst met **toepassingen mijn bedrijf eigenaar is van**, en klik op de AAD-toepassing die u hebt gemaakt voor de middelste laag API-app ToDoListAPI (de tekst die u in de vorige zelfstudie hebt gemaakt, niet de tekst die u in deze zelfstudie hebt gemaakt).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-228">In the Azure classic portal go back to the list of **Applications my company owns**, and click the AAD application that you created for the middle tier ToDoListAPI API app (the one you created in the previous tutorial, not the one you created in this tutorial).</span></span>
8. <span data-ttu-id="ceeb2-229">Klik op het tabblad **Configureren**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-229">Click the **Configure** tab.</span></span>
9. <span data-ttu-id="ceeb2-230">Kopieer de **Client-ID** waarde en sla deze ergens kunt u dit uit later downloaden.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-230">Copy the **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="ceeb2-231">Onder **sleutels**, selecteer **1 jaar** van de **Selecteer duur** vervolgkeuzelijst.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-231">Under **keys**, select **1 year** from the **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="ceeb2-232">Klik op **Opslaan**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-232">Click **Save**.</span></span>
    
     ![App-sleutel genereren](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="ceeb2-234">Kopieer de sleutelwaarde en sla deze ergens die kunt u dit uit later downloaden.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-234">Copy the key value and save it someplace you can get it from later.</span></span>
    
     ![Kopiëren van de nieuwe app-sleutel](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-the-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="ceeb2-236">Azure AD-instellingen configureren in de middelste laag API-app-runtime-omgeving</span><span class="sxs-lookup"><span data-stu-id="ceeb2-236">Configure Azure AD settings in the middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="ceeb2-237">Ga naar de [Azure-portal](https://portal.azure.com/), en navigeer vervolgens naar de **API-App** blade voor de API-app die als host fungeert voor het project TodoListAPI (middelste laag).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-237">Go to the [Azure portal](https://portal.azure.com/), and then navigate to the **API App** blade for the API app that hosts the TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="ceeb2-238">Klik op **Instellingen > Toepassingsinstellingen**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="ceeb2-239">In de **appinstellingen** sectie, het toevoegen van de volgende sleutels en waarden:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-239">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="ceeb2-240">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-240">**Key**</span></span> | <span data-ttu-id="ceeb2-241">IDA instantie:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="ceeb2-242">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-242">**Value**</span></span> |<span data-ttu-id="ceeb2-243">https://login.microsoftonline.com/ {uw Azure AD-tenant name}</span><span class="sxs-lookup"><span data-stu-id="ceeb2-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="ceeb2-244">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-244">**Example**</span></span> |<span data-ttu-id="ceeb2-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="ceeb2-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="ceeb2-246">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-246">**Key**</span></span> | <span data-ttu-id="ceeb2-247">IDA ClientId:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ceeb2-248">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-248">**Value**</span></span> |<span data-ttu-id="ceeb2-249">Client-ID van de aanroepende toepassing (middelste laag - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="ceeb2-249">Client ID of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="ceeb2-250">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-250">**Example**</span></span> |<span data-ttu-id="ceeb2-251">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="ceeb2-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="ceeb2-252">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-252">**Key**</span></span> | <span data-ttu-id="ceeb2-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="ceeb2-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="ceeb2-254">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-254">**Value**</span></span> |<span data-ttu-id="ceeb2-255">App-sleutel van de aanroepende toepassing (middelste laag - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="ceeb2-255">App key of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="ceeb2-256">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-256">**Example**</span></span> |<span data-ttu-id="ceeb2-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="ceeb2-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="ceeb2-258">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-258">**Key**</span></span> | <span data-ttu-id="ceeb2-259">IDA Resource:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="ceeb2-260">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-260">**Value**</span></span> |<span data-ttu-id="ceeb2-261">Client-ID van de toepassing genoemd (gegevenslaag - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="ceeb2-261">Client ID of the called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="ceeb2-262">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-262">**Example**</span></span> |<span data-ttu-id="ceeb2-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span><span class="sxs-lookup"><span data-stu-id="ceeb2-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="ceeb2-264">**Opmerking**: voor `ida:Resource`, zorg ervoor dat u de aangeroepen toepassing gebruiken **client-ID** en niet de **App ID URI**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-264">**Note**: For `ida:Resource`, make sure you use the called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="ceeb2-265">`ida:ClientId`en `ida:Resource` zijn verschillende waarden voor deze zelfstudie omdat u werkt met afzonderlijke applicaations Azure AD voor de middelste laag en de gegevenslaag.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for the middle tier and data tier.</span></span> <span data-ttu-id="ceeb2-266">Als u één Azure AD-toepassing voor de aanroepende API-app en de beveiligde API-app, gebruikt u dezelfde waarde in beide `ida:ClientId` en `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-266">If you were using a single Azure AD application for the calling API app and the protected API app, you would use the same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="ceeb2-267">De code gebruikt ConfigurationManager ophalen van deze waarden, zodat kan worden opgeslagen in Web.config-bestand van het project of in de Azure-runtime-omgeving.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-267">The code uses ConfigurationManager to get these values, so they could be stored in the project's Web.config file or in the Azure runtime environment.</span></span> <span data-ttu-id="ceeb2-268">Terwijl een ASP.NET-toepassing in Azure App Service wordt uitgevoerd, overschrijven de instellingen voor automatisch instellingen uit Web.config.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config.</span></span> <span data-ttu-id="ceeb2-269">Omgevingsinstellingen zijn doorgaans een [veiliger manier voor het opslaan van vertrouwelijke gegevens vergeleken met een Web.config-bestand](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-269">Environment settings are generally a [more secure way to store sensitive information compared to a Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="ceeb2-270">Klik op **Opslaan**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-270">Click **Save**.</span></span>
   
    ![Op Opslaan klikken](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-the-application"></a><span data-ttu-id="ceeb2-272">De toepassing testen</span><span class="sxs-lookup"><span data-stu-id="ceeb2-272">Test the application</span></span>
1. <span data-ttu-id="ceeb2-273">Ga in een browser naar de HTTPS-URL van de AngularJS-front-end web-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-273">In a browser go to the HTTPS URL of the AngularJS front end web app.</span></span>
2. <span data-ttu-id="ceeb2-274">Klik op de **To Do List** tabblad en meld u aan met referenties voor een gebruiker in uw Azure AD-tenant.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-274">Click the **To Do List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="ceeb2-275">Toevoegen van taakitems om te controleren of de toepassing werkt.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-275">Add to-do items to verify that the application is working.</span></span>
   
    ![Takenlijstpagina](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="ceeb2-277">Als de toepassing niet werkt zoals verwacht, Controleer alle instellingen die u hebt ingevoerd in de Azure-portal.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-277">If the application doesn't work as expected, double-check all of the settings you entered in the Azure portal.</span></span> <span data-ttu-id="ceeb2-278">Als u alle instellingen correct lijken, raadpleegt u de [probleemoplossing](#troubleshooting) verderop in deze zelfstudie.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-278">If all of the settings appear to be correct, see the [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-the-api-app-from-browser-access"></a><span data-ttu-id="ceeb2-279">De API-app beveiligen tegen toegang tot de browser</span><span class="sxs-lookup"><span data-stu-id="ceeb2-279">Protect the API app from browser access</span></span>
<span data-ttu-id="ceeb2-280">Voor deze zelfstudie die u hebt gemaakt een afzonderlijke Azure AD-toepassing voor de ToDoListDataAPI (gegevenslaag) API-app.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-280">For this tutorial you created a separate Azure AD application for the ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="ceeb2-281">Als u hebt gezien, wanneer de App Service een AAD-toepassing maakt, configureert het AAD-toepassing op een manier waarmee een gebruiker gaat u naar de API-app-URL in een browser en meld u aan.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-281">As you've seen, when App Service creates an AAD application, it configures the AAD application in a way that enables a user to go to the API app's URL in a browser and log on.</span></span> <span data-ttu-id="ceeb2-282">Dit betekent dat het is mogelijk voor gebruikers in uw Azure AD-tenant, niet alleen een service-principal, voor toegang tot de API.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-282">That means it's possible for an end user in your Azure AD tenant, not just a service principal, to access the API.</span></span> 

<span data-ttu-id="ceeb2-283">Als u voorkomen dat toegang tot de browser wilt zonder de code schrijven in de beveiligde API-app, kunt u de **antwoord-URL** in de AAD-toepassing zodat deze van de API-app verschilt basis-URL.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-283">If you want to prevent browser access without writing any code in the protected API app, you can change the **Reply URL** in the AAD application so that it's different from the API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="ceeb2-284">Toegang tot de browser uitschakelen</span><span class="sxs-lookup"><span data-stu-id="ceeb2-284">Disable browser access</span></span>
1. <span data-ttu-id="ceeb2-285">In de klassieke portal **configureren** voor de AAD-toepassing die is gemaakt voor de TodoListService en wijzig de waarde in de **antwoord-URL** veld zodat het een geldige URL, maar niet de API-app-URL.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-285">In the classic portal's **Configure** tab for the AAD application that was created for the TodoListService, change the value in the **Reply URL** field so that it is a valid URL but not the API app's URL.</span></span>
2. <span data-ttu-id="ceeb2-286">Klik op **Opslaan**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-286">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="ceeb2-287">Controleer of toegang tot de browser niet meer werkt</span><span class="sxs-lookup"><span data-stu-id="ceeb2-287">Verify browser access no longer works</span></span>
<span data-ttu-id="ceeb2-288">Eerder gecontroleerd dat u naar de API-app-URL vanuit een browser gaat door met de referenties van een afzonderlijke gebruiker aanmeldt.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-288">Earlier you verified that you can go to the API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="ceeb2-289">In deze sectie, controleert u of dit is niet langer mogelijk.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-289">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="ceeb2-290">In een nieuw browservenster en gaat u naar de URL van de API-app opnieuw.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-290">In a new browser window, go to the URL of the API app again.</span></span>
2. <span data-ttu-id="ceeb2-291">Registreren in wanneer u daarom wordt gevraagd.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-291">Log in when prompted to do so.</span></span>
3. <span data-ttu-id="ceeb2-292">Aanmelding is geslaagd, maar leidt tot een foutpagina.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-292">Login succeeds but leads to an error page.</span></span>
   
    <span data-ttu-id="ceeb2-293">U kunt de AAD-app hebt geconfigureerd, zodat gebruikers in de AAD-tenant kunnen niet aanmelden en toegang de API vanuit een browser tot.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-293">You've configured the AAD app so that users in the AAD tenant cannot log in and access the API from a browser.</span></span> <span data-ttu-id="ceeb2-294">U kunt nog steeds toegang tot de API-app met behulp van een token voor principal op service, waarmee u controleren kunt door te gaan naar de web-app-URL en meer taakitems toe te voegen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-294">You can still access the API app by using a service principal token, which you can verify by going to the web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-to-a-particular-service-principal"></a><span data-ttu-id="ceeb2-295">Beperk de toegang tot een bepaalde service-principal</span><span class="sxs-lookup"><span data-stu-id="ceeb2-295">Restrict access to a particular service principal</span></span>
<span data-ttu-id="ceeb2-296">Momenteel aanroeper die een token kan krijgen voor een gebruiker of service-principal in uw Azure AD-tenant de TodoListDataAPI (gegevenslaag) API-app kunt aanroepen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-296">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call the TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="ceeb2-297">Het is raadzaam om ervoor te zorgen dat de API app voor de gegevenslaag accepteert alleen aanroepen vanuit de app TodoListAPI (middelste laag) API, en alleen vanuit een bepaalde service-principal.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-297">You might want to make sure that the data tier API app only accepts calls from the TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="ceeb2-298">U kunt deze beperkingen toevoegen door toe te voegen code voor het valideren van de `appid` en `objectidentifier` claims op binnenkomende oproepen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-298">You can add these restrictions by adding code to validate the `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="ceeb2-299">Voor deze zelfstudie kunt u de code te valideren en app-ID en service-principal-ID rechtstreeks in uw domeincontroller acties plaatsen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-299">For this tutorial you put the code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="ceeb2-300">Alternatieven zijn gebruik van een aangepaste `Authorize` kenmerk of het uitvoeren van deze validatie het opstarten (bijvoorbeeld OWIN middleware) takenreeksen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-300">Alternatives are to use a custom `Authorize` attribute or to do this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="ceeb2-301">Zie voor een voorbeeld van de laatste [deze voorbeeldtoepassing](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-301">For an example of the latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="ceeb2-302">De volgende wijzigingen aanbrengen in het project TodoListDataAPI.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-302">Make the following changes to the TodoListDataAPI project.</span></span>

1. <span data-ttu-id="ceeb2-303">Open de *Controllers/TodoListController.cs* bestand.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-303">Open the *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="ceeb2-304">Verwijder de opmerkingen in de regels die ingesteld `trustedCallerClientId` en `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-304">Uncomment the lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="ceeb2-305">Herstel de code in de methode CheckCallerId.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-305">Uncomment the code in the CheckCallerId method.</span></span> <span data-ttu-id="ceeb2-306">Deze methode is aangeroepen aan het begin van elke actiemethode in de controller.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-306">This method is called at the start of every action method in the controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "The appID or service principal ID is not the expected value." });
            }
        }
4. <span data-ttu-id="ceeb2-307">Implementeer het project ToDoListDataAPI in Azure App Service opnieuw.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-307">Redeploy the ToDoListDataAPI project to Azure App Service.</span></span>
5. <span data-ttu-id="ceeb2-308">In de browser, Ga naar HTTPS-URL van de AngularJS-front-end web app en in de startpagina klikt u op de **To Do List** tabblad.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-308">In your browser, go to the AngularJS front end web app's HTTPS URL, and in the home page click the **To Do List** tab.</span></span>
   
    <span data-ttu-id="ceeb2-309">De toepassing werkt niet omdat aanroepen naar de back-end mislukken.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-309">The application doesn't work because calls to the back end are failing.</span></span> <span data-ttu-id="ceeb2-310">De nieuwe code is werkelijke appid en objectidentifier controleren maar nog geen deze de juiste waarden om te controleren ze tegen.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-310">The new code is checking actual appid and objectidentifier but it doesn't yet have the correct values to check them against.</span></span> <span data-ttu-id="ceeb2-311">De browser die de Console hulpprogramma's voor ontwikkelaars rapporteert dat de server een 401 HTTP-fout retourneert.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-311">The browser Developer Tools Console reports that the server is returning an HTTP 401 error.</span></span>
   
    ![Fout in Developer Tools Console](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="ceeb2-313">In de volgende stappen configureert u de verwachte waarden.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-313">In the following steps you configure the expected values.</span></span>
6. <span data-ttu-id="ceeb2-314">Met Azure AD PowerShell, haal de waarde van de service-principal voor de Azure AD-toepassing die u hebt gemaakt voor het project TodoListWebApp.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-314">Using Azure AD PowerShell, get the value of the service principal for the Azure AD application that you created for the TodoListWebApp project.</span></span>
   
    <span data-ttu-id="ceeb2-315">a.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-315">a.</span></span> <span data-ttu-id="ceeb2-316">Zie voor instructies over hoe u Azure PowerShell installeren en verbinding maken met uw abonnement, [Azure PowerShell gebruiken met Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-316">For instructions on how to install Azure PowerShell and connect to your subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="ceeb2-317">b.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-317">b.</span></span> <span data-ttu-id="ceeb2-318">Als u een lijst met de service-principals, uitvoeren van de `Login-AzureRmAccount` opdracht en vervolgens de `Get-AzureRmADServicePrincipal` opdracht.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-318">To get a list of service principals, execute the `Login-AzureRmAccount` command and then the `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="ceeb2-319">c.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-319">c.</span></span> <span data-ttu-id="ceeb2-320">De object-id vinden voor de service-principal van de toepassing TodoListAPI en opslaan in een locatie die u later kunt kopiëren uit.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-320">Find the objectid for the service principal of the TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="ceeb2-321">Navigeer naar de blade API-app voor de API-app die u hebt geïmplementeerd op het project ToDoListDataAPI in de Azure portal.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-321">In the Azure portal, navigate to the API app blade for the API app that you deployed the ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="ceeb2-322">Klik op **instellingen > Toepassingsinstellingen**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-322">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="ceeb2-323">In de **appinstellingen** sectie, het toevoegen van de volgende sleutels en waarden:</span><span class="sxs-lookup"><span data-stu-id="ceeb2-323">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="ceeb2-324">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-324">**Key**</span></span> | <span data-ttu-id="ceeb2-325">TODO:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="ceeb2-325">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ceeb2-326">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-326">**Value**</span></span> |<span data-ttu-id="ceeb2-327">Service-principal-id van het aanroepen van toepassing</span><span class="sxs-lookup"><span data-stu-id="ceeb2-327">Service principal id of calling application</span></span> |
   | <span data-ttu-id="ceeb2-328">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-328">**Example**</span></span> |<span data-ttu-id="ceeb2-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="ceeb2-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="ceeb2-330">**Sleutel**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-330">**Key**</span></span> | <span data-ttu-id="ceeb2-331">TODO:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="ceeb2-331">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="ceeb2-332">**Waarde**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-332">**Value**</span></span> |<span data-ttu-id="ceeb2-333">Client-ID van het aanroepen van de toepassing - gekopieerd uit de TodoListAPI Azure AD-toepassing</span><span class="sxs-lookup"><span data-stu-id="ceeb2-333">Client ID of calling application - copied from the TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="ceeb2-334">**Voorbeeld**</span><span class="sxs-lookup"><span data-stu-id="ceeb2-334">**Example**</span></span> |<span data-ttu-id="ceeb2-335">960adec2-b74a-484a-960adec2-b74a-484a</span><span class="sxs-lookup"><span data-stu-id="ceeb2-335">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="ceeb2-336">Klik op **Opslaan**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-336">Click **Save**.</span></span>
    
     ![Op Opslaan klikken](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="ceeb2-338">Klik in de startpagina en in uw browser, Ga terug naar de web-app-URL op de **To Do List** tabblad.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-338">In your browser, return to the web app's URL, and in the home page click the **To Do List** tab.</span></span>
    
     <span data-ttu-id="ceeb2-339">Deze tijd de toepassing werkt zoals verwacht, omdat de aanroeper vertrouwde app-ID en service-principal-ID zijn de verwachte waarden.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-339">This time the application works as expected because the trusted caller app ID and service principal ID are the expected values.</span></span>
    
     ![Takenlijstpagina](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-the-projects-from-scratch"></a><span data-ttu-id="ceeb2-341">Het bouwen van de projecten maken</span><span class="sxs-lookup"><span data-stu-id="ceeb2-341">Building the projects from scratch</span></span>
<span data-ttu-id="ceeb2-342">De twee Web API-projecten zijn gemaakt met behulp van de **Azure API-App** project sjabloon en de waarden van standaard domeincontroller vervangen door een ToDoList-controller.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-342">The two Web API projects were created by using the **Azure API App** project template and replacing the default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="ceeb2-343">Voor het verkrijgen van Azure AD-service-principal tokens in het project ToDoListAPI de [Active Directory Authentication Library (ADAL) voor .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet-pakket is geïnstalleerd.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-343">For acquiring Azure AD service principal tokens in the ToDoListAPI project, the [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="ceeb2-344">Zie voor meer informatie over het maken van een AngularJS-toepassing voor één pagina met een Web-API-back-end zoals ToDoListAngular [handen op Lab: bouwen van een enkele toepassing pagina WACHTWOORDVERIFICATIE met ASP.NET Web API en Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-344">For information about how to  create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="ceeb2-345">Zie voor meer informatie over het toevoegen van Azure AD-verificatiecode [beveiligen AngularJS één pagina Apps met Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-345">For information about how to add Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="ceeb2-346">Problemen oplossen</span><span class="sxs-lookup"><span data-stu-id="ceeb2-346">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="ceeb2-347">Zorg ervoor dat u en niet door elkaar ToDoListAPI (middelste laag) ToDoListDataAPI (gegevenslaag).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-347">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="ceeb2-348">Bijvoorbeeld: in deze zelfstudie u verificatie toevoegen aan de gegevens laag API-app **, maar de app-sleutel moet afkomstig zijn van de Azure AD-toepassing die u hebt gemaakt voor de middelste laag API-app**.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-348">For example, in this tutorial you add authentication to the data tier API app, **but the app key must come from the Azure AD application that you created for the middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ceeb2-349">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="ceeb2-349">Next steps</span></span>
<span data-ttu-id="ceeb2-350">Dit is de laatste zelfstudie in de reeks API-Apps.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-350">This is the last tutorial in the API Apps series.</span></span> 

<span data-ttu-id="ceeb2-351">Zie de volgende bronnen voor meer informatie over Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-351">For more information about Azure Active Directory, see the following resources.</span></span>

* [<span data-ttu-id="ceeb2-352">Azure AD ontwikkelaarshandleiding</span><span class="sxs-lookup"><span data-stu-id="ceeb2-352">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="ceeb2-353">Azure AD-scenario 's</span><span class="sxs-lookup"><span data-stu-id="ceeb2-353">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="ceeb2-354">Azure AD-voorbeelden</span><span class="sxs-lookup"><span data-stu-id="ceeb2-354">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="ceeb2-355">De [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) voorbeeld is vergelijkbaar met wat wordt weergegeven in deze zelfstudie, maar zonder verificatie van App Service.</span><span class="sxs-lookup"><span data-stu-id="ceeb2-355">The [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar to what is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="ceeb2-356">Voor informatie over andere manieren voor het implementeren van Visual Studio-projecten in API-apps met behulp van Visual Studio of [implementatie automatiseren](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) van een [broncodebeheersysteem](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), Zie [het implementeren van een Azure App Service-app](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="ceeb2-356">For information about other ways to deploy Visual Studio projects to API apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How to deploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>

