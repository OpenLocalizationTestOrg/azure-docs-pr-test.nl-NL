---
title: 'Azure AD Connect: Het herstellen van LocalDB van 10 GB limiet probleem | Microsoft Docs'
description: Dit onderwerp wordt beschreven hoe u Azure AD Connect-synchronisatieservice herstellen wanneer er 10GB LocalDB probleem beperken.
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 08e682c51b12d4506019d2f6b68e1eae0798b990
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-how-to-recover-from-localdb-10-gb-limit"></a><span data-ttu-id="9dc94-103">Azure AD Connect: Het herstellen van 10 GB-limiet LocalDB</span><span class="sxs-lookup"><span data-stu-id="9dc94-103">Azure AD Connect: How to recover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="9dc94-104">Azure AD Connect vereist een SQL Server-database voor het opslaan van identiteitsgegevens.</span><span class="sxs-lookup"><span data-stu-id="9dc94-104">Azure AD Connect requires a SQL Server database to store identity data.</span></span> <span data-ttu-id="9dc94-105">U kunt de standaard SQL Server 2012 Express LocalDB gebruiken die samen met Azure AD Connect is geïnstalleerd, maar ook uw eigen volledige SQL.</span><span class="sxs-lookup"><span data-stu-id="9dc94-105">You can either use the default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="9dc94-106">Voor SQL Server Express geldt een limiet van 10 GB.</span><span class="sxs-lookup"><span data-stu-id="9dc94-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="9dc94-107">Wanneer u LocalDB gebruikt en deze limiet is bereikt, kan de Azure AD Connect-synchronisatieservice niet langer starten of goed synchroniseren.</span><span class="sxs-lookup"><span data-stu-id="9dc94-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="9dc94-108">Dit artikel bevat de herstelstappen.</span><span class="sxs-lookup"><span data-stu-id="9dc94-108">This article provides the recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="9dc94-109">Symptomen</span><span class="sxs-lookup"><span data-stu-id="9dc94-109">Symptoms</span></span>
<span data-ttu-id="9dc94-110">Er zijn twee algemene symptomen:</span><span class="sxs-lookup"><span data-stu-id="9dc94-110">There are two common symptoms:</span></span>

* <span data-ttu-id="9dc94-111">Azure AD Connect-synchronisatieservice **wordt uitgevoerd** maar niet kan worden gesynchroniseerd met *'gestopt-database-schijf-volledig'* fout.</span><span class="sxs-lookup"><span data-stu-id="9dc94-111">Azure AD Connect Synchronization Service **is running** but fails to synchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="9dc94-112">Azure AD Connect-synchronisatieservice **kan niet worden gestart**.</span><span class="sxs-lookup"><span data-stu-id="9dc94-112">Azure AD Connect Synchronization Service **is unable to start**.</span></span> <span data-ttu-id="9dc94-113">Wanneer u probeert de service te starten, mislukt met de gebeurtenis 6323 en foutbericht *"de server een fout opgetreden omdat SQL Server geen schijfruimte meer heeft."*</span><span class="sxs-lookup"><span data-stu-id="9dc94-113">When you attempt to start the service, it fails with event 6323 and error message *"The server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="9dc94-114">Korte termijn herstelstappen</span><span class="sxs-lookup"><span data-stu-id="9dc94-114">Short-term recovery steps</span></span>
<span data-ttu-id="9dc94-115">Deze sectie bevat de stappen voor het vrijmaken van DB vereiste ruimte voor Azure AD Connect-synchronisatieservice bewerking hervatten.</span><span class="sxs-lookup"><span data-stu-id="9dc94-115">This section provides the steps to reclaim DB space required for Azure AD Connect Synchronization Service to resume operation.</span></span> <span data-ttu-id="9dc94-116">De stappen omvatten:</span><span class="sxs-lookup"><span data-stu-id="9dc94-116">The steps include:</span></span>
1. [<span data-ttu-id="9dc94-117">De status van de synchronisatieservice bepalen</span><span class="sxs-lookup"><span data-stu-id="9dc94-117">Determine the Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="9dc94-118">De database te verkleinen</span><span class="sxs-lookup"><span data-stu-id="9dc94-118">Shrink the database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="9dc94-119">Uitvoeren van de gegevens van geschiedenis verwijderen</span><span class="sxs-lookup"><span data-stu-id="9dc94-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="9dc94-120">Geef een kortere bewaarperiode voor gegevens van de geschiedenis uitvoeren</span><span class="sxs-lookup"><span data-stu-id="9dc94-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-the-synchronization-service-status"></a><span data-ttu-id="9dc94-121">De status van de synchronisatieservice bepalen</span><span class="sxs-lookup"><span data-stu-id="9dc94-121">Determine the Synchronization Service status</span></span>
<span data-ttu-id="9dc94-122">Bepaal eerst of de synchronisatie-Service nog wordt uitgevoerd of niet:</span><span class="sxs-lookup"><span data-stu-id="9dc94-122">First, determine whether the Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="9dc94-123">Meld u aan bij uw Azure AD Connect-server als beheerder.</span><span class="sxs-lookup"><span data-stu-id="9dc94-123">Log in to your Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="9dc94-124">Ga naar **Service Control Manager**.</span><span class="sxs-lookup"><span data-stu-id="9dc94-124">Go to **Service Control Manager**.</span></span>

3. <span data-ttu-id="9dc94-125">Controleer de status van **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="9dc94-125">Check the status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="9dc94-126">Als deze wordt uitgevoerd, niet stoppen en start de service.</span><span class="sxs-lookup"><span data-stu-id="9dc94-126">If it is running, do not stop or restart the service.</span></span> <span data-ttu-id="9dc94-127">Overslaan [verkleinen van de database](#shrink-the-database) stap en gaat u naar [verwijderen uitvoeren geschiedenisgegevens](#delete-run-history-data) stap.</span><span class="sxs-lookup"><span data-stu-id="9dc94-127">Skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="9dc94-128">Als deze niet wordt uitgevoerd, probeert u de service te starten.</span><span class="sxs-lookup"><span data-stu-id="9dc94-128">If it is not running, try to start the service.</span></span> <span data-ttu-id="9dc94-129">Als de service is gestart, gaat u verder [verkleinen van de database](#shrink-the-database) stap en gaat u naar [verwijderen uitvoeren geschiedenisgegevens](#delete-run-history-data) stap.</span><span class="sxs-lookup"><span data-stu-id="9dc94-129">If the service starts successfully, skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="9dc94-130">Ga anders verder met [verkleinen van de database](#shrink-the-database) stap.</span><span class="sxs-lookup"><span data-stu-id="9dc94-130">Otherwise, continue with [Shrink the database](#shrink-the-database) step.</span></span>

### <a name="shrink-the-database"></a><span data-ttu-id="9dc94-131">De database te verkleinen</span><span class="sxs-lookup"><span data-stu-id="9dc94-131">Shrink the database</span></span>
<span data-ttu-id="9dc94-132">Gebruik de verkleiningsbewerking voldoende ruimte DB starten van de synchronisatieservice vrijmaken.</span><span class="sxs-lookup"><span data-stu-id="9dc94-132">Use the Shrink operation to free up enough DB space to start the Synchronization Service.</span></span> <span data-ttu-id="9dc94-133">Het vrijgemaakt DB-ruimte door het verwijderen van spaties in de database.</span><span class="sxs-lookup"><span data-stu-id="9dc94-133">It frees up DB space by removing whitespaces in the database.</span></span> <span data-ttu-id="9dc94-134">Deze stap is best-effort als is er geen garantie dat u altijd ruimte kunt herstellen.</span><span class="sxs-lookup"><span data-stu-id="9dc94-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="9dc94-135">Lees dit artikel voor meer informatie over de verkleiningsbewerking [verkleinen van een database](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="9dc94-135">To learn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9dc94-136">Deze stap overslaan als u krijgt de synchronisatieservice om uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="9dc94-136">Skip this step if you can get the Synchronization Service to run.</span></span> <span data-ttu-id="9dc94-137">Dit wordt niet aanbevolen voor het verkleinen van de SQL-database zoals tot slechte prestaties vanwege de fragmentatie van de toegenomen leiden kan.</span><span class="sxs-lookup"><span data-stu-id="9dc94-137">It is not recommended to shrink the SQL DB as it can lead to poor performance due to increased fragmentation.</span></span>

<span data-ttu-id="9dc94-138">De naam van de database gemaakt voor Azure AD Connect is **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="9dc94-138">The name of the database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="9dc94-139">Als u wilt een verkleiningsbewerking uitvoeren, moet u zich aanmeldt als de rol sysadmin of de DBO van de database.</span><span class="sxs-lookup"><span data-stu-id="9dc94-139">To perform a Shrink operation, you must log in either as the sysadmin or DBO of the database.</span></span> <span data-ttu-id="9dc94-140">Tijdens de installatie van Azure AD Connect, worden de volgende accounts sysadmin-rechten verleend:</span><span class="sxs-lookup"><span data-stu-id="9dc94-140">During Azure AD Connect installation, the following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="9dc94-141">Lokale beheerders</span><span class="sxs-lookup"><span data-stu-id="9dc94-141">Local Administrators</span></span>
* <span data-ttu-id="9dc94-142">Het gebruikersaccount dat is gebruikt voor het uitvoeren van Azure AD Connect-installatie.</span><span class="sxs-lookup"><span data-stu-id="9dc94-142">The user account that was used to run Azure AD Connect installation.</span></span>
* <span data-ttu-id="9dc94-143">De synchronisatie-serviceaccount die wordt gebruikt als de context van Azure AD Connect-synchronisatieservice.</span><span class="sxs-lookup"><span data-stu-id="9dc94-143">The Sync Service account that is used as the operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="9dc94-144">De lokale groep ADSyncAdmins die is gemaakt tijdens de installatie.</span><span class="sxs-lookup"><span data-stu-id="9dc94-144">The local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="9dc94-145">Maak een back-up van de database door te kopiëren **ADSync.mdf** en **ADSync_log.ldf** bestanden onder `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` naar een veilige locatie.</span><span class="sxs-lookup"><span data-stu-id="9dc94-145">Back up the database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` to a safe location.</span></span>

2. <span data-ttu-id="9dc94-146">Start een nieuwe PowerShell-sessie.</span><span class="sxs-lookup"><span data-stu-id="9dc94-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="9dc94-147">Navigeer naar de map `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="9dc94-147">Navigate to folder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="9dc94-148">Start **sqlcmd** hulpprogramma met de opdracht `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, met de referenties van een sysadmin of de DBO-database.</span><span class="sxs-lookup"><span data-stu-id="9dc94-148">Start **sqlcmd** utility by running the command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using the credential of a sysadmin or the database DBO.</span></span>

5. <span data-ttu-id="9dc94-149">Voor het verkleinen van de database, op het sqlcmd-opdrachtprompt (1 >), voer `DBCC Shrinkdatabase(ADSync,1);`, gevolgd door `GO` in de volgende regel.</span><span class="sxs-lookup"><span data-stu-id="9dc94-149">To shrink the database, at the sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in the next line.</span></span>

6. <span data-ttu-id="9dc94-150">Als de bewerking voltooid is, probeert u de synchronisatie-Service opnieuw starten.</span><span class="sxs-lookup"><span data-stu-id="9dc94-150">If the operation is successful, try to start the Synchronization Service again.</span></span> <span data-ttu-id="9dc94-151">Als u de Synchronization Service starten kunt, gaat u naar [verwijderen uitvoeren geschiedenisgegevens](#delete-run-history-data) stap.</span><span class="sxs-lookup"><span data-stu-id="9dc94-151">If you can start the Synchronization Service, go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="9dc94-152">Als dat niet het geval is, moet u contact op met ondersteuning.</span><span class="sxs-lookup"><span data-stu-id="9dc94-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="9dc94-153">Uitvoeren van de gegevens van geschiedenis verwijderen</span><span class="sxs-lookup"><span data-stu-id="9dc94-153">Delete run history data</span></span>
<span data-ttu-id="9dc94-154">Standaard behoudt Azure AD Connect up aan zeven dagen aan gegevens uitvoeringsgeschiedenis.</span><span class="sxs-lookup"><span data-stu-id="9dc94-154">By default, Azure AD Connect retains up to seven days’ worth of run history data.</span></span> <span data-ttu-id="9dc94-155">In deze stap wordt de uitvoeringsgeschiedenis-gegevens om de ingenomen ruimte DB zodat Azure AD Connect-synchronisatieservice kunt starten synchroniseren opnieuw te verwijderen.</span><span class="sxs-lookup"><span data-stu-id="9dc94-155">In this step, we delete the run history data to reclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="9dc94-156">Start **Synchronization Service Manager** gaat u naar START → Synchronization Service.</span><span class="sxs-lookup"><span data-stu-id="9dc94-156">Start **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

2.  <span data-ttu-id="9dc94-157">Ga naar de **Operations** tabblad.</span><span class="sxs-lookup"><span data-stu-id="9dc94-157">Go to the **Operations** tab.</span></span>

3.  <span data-ttu-id="9dc94-158">Onder **acties**, selecteer **wissen wordt uitgevoerd**...</span><span class="sxs-lookup"><span data-stu-id="9dc94-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="9dc94-159">U kunt kiezen **wissen van alle sessies** of **wissen wordt uitgevoerd voordat er... <date>**  optie.</span><span class="sxs-lookup"><span data-stu-id="9dc94-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="9dc94-160">Het wordt aanbevolen dat u start door het wissen van gegevens van geschiedenis die ouder dan twee dagen zijn worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="9dc94-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="9dc94-161">Als u DB grootte probleem ondervindt doorgaat, kiest u de **wissen van alle sessies** optie.</span><span class="sxs-lookup"><span data-stu-id="9dc94-161">If you continue to run into DB size issue, then choose the **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="9dc94-162">Geef een kortere bewaarperiode voor gegevens van de geschiedenis uitvoeren</span><span class="sxs-lookup"><span data-stu-id="9dc94-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="9dc94-163">Deze stap is de kans na meerdere synchronisatiecycli die worden uitgevoerd in de limiet van 10 GB-probleem.</span><span class="sxs-lookup"><span data-stu-id="9dc94-163">This step is to reduce the likelihood of running into the 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="9dc94-164">Open een nieuw PowerShell-sessie.</span><span class="sxs-lookup"><span data-stu-id="9dc94-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="9dc94-165">Voer `Get-ADSyncScheduler` en noteer de eigenschap PurgeRunHistoryInterval, waarmee de huidige bewaarperiode.</span><span class="sxs-lookup"><span data-stu-id="9dc94-165">Run `Get-ADSyncScheduler` and take note of the PurgeRunHistoryInterval property, which specifies the current retention period.</span></span>

3. <span data-ttu-id="9dc94-166">Voer `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` in te stellen de bewaarperiode op twee dagen.</span><span class="sxs-lookup"><span data-stu-id="9dc94-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` to set the retention period to two days.</span></span> <span data-ttu-id="9dc94-167">Pas de bewaarperiode naar gelang van toepassing.</span><span class="sxs-lookup"><span data-stu-id="9dc94-167">Adjust the retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-to-full-sql"></a><span data-ttu-id="9dc94-168">Op lange termijn oplossing: migreren naar een volledige SQL</span><span class="sxs-lookup"><span data-stu-id="9dc94-168">Long-term solution – Migrate to full SQL</span></span>
<span data-ttu-id="9dc94-169">In het algemeen is het probleem indicatief 10 GB-databasegrootte is niet meer voldoende voor Azure AD Connect te synchroniseren van uw lokale Active Directory naar Azure AD.</span><span class="sxs-lookup"><span data-stu-id="9dc94-169">In general, the issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect to synchronize your on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="9dc94-170">Het is raadzaam dat u overschakelt naar de volledige versie van SQL server.</span><span class="sxs-lookup"><span data-stu-id="9dc94-170">It is recommended that you switch to using the full version of SQL server.</span></span> <span data-ttu-id="9dc94-171">U kunt de LocalDB van een bestaande Azure AD Connect-implementatie niet rechtstreeks vervangen door de database van de volledige versie van SQL.</span><span class="sxs-lookup"><span data-stu-id="9dc94-171">You cannot directly replace the LocalDB of an existing Azure AD Connect deployment with the database of the full version of SQL.</span></span> <span data-ttu-id="9dc94-172">In plaats daarvan implementeert u een nieuwe Azure AD Connect-server met de volledige SQL.</span><span class="sxs-lookup"><span data-stu-id="9dc94-172">Instead, you must deploy a new Azure AD Connect server with the full version of SQL.</span></span> <span data-ttu-id="9dc94-173">U doet er verstandig aan een swingmigratie uit te voeren, waarbij de nieuwe Azure AD Connect-server (met SQL-database) wordt geïmplementeerd als testserver, naast de bestaande Azure AD Connect-server (met LocalDB).</span><span class="sxs-lookup"><span data-stu-id="9dc94-173">It is recommended that you do a swing migration where the new Azure AD Connect server (with SQL DB) is deployed as a staging server, next to the existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="9dc94-174">Zie het artikel [Aangepaste installatie van Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom) voor instructies over het configureren van externe SQL met Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="9dc94-174">For instruction on how to configure remote SQL with Azure AD Connect, refer to article [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="9dc94-175">Zie het artikel [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration) (Azure AD Connect: upgraden van een vorige naar de meest recente versie) voor instructies over swingmigratie voor een Azure AD Connect-upgrade.</span><span class="sxs-lookup"><span data-stu-id="9dc94-175">For instructions on swing migration for Azure AD Connect upgrade, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="9dc94-176">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="9dc94-176">Next steps</span></span>
<span data-ttu-id="9dc94-177">Lees meer over het [integreren van uw on-premises identiteiten met Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="9dc94-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>
