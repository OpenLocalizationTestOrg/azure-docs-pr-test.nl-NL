---
title: Handleiding voor ontwikkelaars voor voorwaardelijke toegang van Azure Active Directory | Microsoft Docs
description: Handleiding voor ontwikkelaars en scenario's voor voorwaardelijke toegang van Azure AD
services: active-directory
keywords: 
author: danieldobalian
manager: mbaldwin
editor: PatAltimore
ms.author: dadobali
ms.date: 07/19/2017
ms.assetid: 115bdab2-e1fd-4403-ac15-d4195e24ac95
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.openlocfilehash: b8fac1b258535fd668b45acbe2c1c8580fb8a340
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/18/2017
---
# <a name="developer-guidance-for-azure-active-directory-conditional-access"></a><span data-ttu-id="3a644-103">Handleiding voor ontwikkelaars voor voorwaardelijke toegang van Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="3a644-103">Developer Guidance for Azure Active Directory Conditional Access</span></span>

<span data-ttu-id="3a644-104">Azure Active Directory (AD) biedt verschillende manieren voor het beveiligen van uw app en het beveiligen van een service.</span><span class="sxs-lookup"><span data-stu-id="3a644-104">Azure Active Directory (AD) offers several ways to secure your app and protect a service.</span></span>  <span data-ttu-id="3a644-105">Een van deze unieke functies is voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-105">One of these unique features is conditional access.</span></span>  <span data-ttu-id="3a644-106">Voorwaardelijke toegang kan ontwikkelaars en enterprise-klanten te beschermen services in een groot aantal manieren:</span><span class="sxs-lookup"><span data-stu-id="3a644-106">Conditional access enables developers and enterprise customers to protect services in a multitude of ways including:</span></span>

* <span data-ttu-id="3a644-107">Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="3a644-107">Multi-factor authentication</span></span>
* <span data-ttu-id="3a644-108">Zodat alleen Intune ingeschreven apparaten hebben toegang tot specifieke services</span><span class="sxs-lookup"><span data-stu-id="3a644-108">Allowing only Intune enrolled devices to access specific services</span></span>
* <span data-ttu-id="3a644-109">Beperken van de gebruikerslocaties en IP-adresbereiken</span><span class="sxs-lookup"><span data-stu-id="3a644-109">Restricting user locations and IP ranges</span></span>

<span data-ttu-id="3a644-110">Zie voor meer informatie over de volledige functionaliteit van voorwaardelijke toegang [voorwaardelijke toegang in de klassieke Azure portal](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="3a644-110">For more information on the full capabilities of conditional access, see [Conditional access in the Azure classic portal](../active-directory-conditional-access.md).</span></span> 

<span data-ttu-id="3a644-111">In dit artikel richten we op wat voorwaardelijke toegang betekent dat ontwikkelaars bouwen van apps voor Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3a644-111">In this article, we focus on what conditional access means to developers building apps for Azure AD.</span></span>  <span data-ttu-id="3a644-112">Er wordt vanuit gegaan kennis van [één](active-directory-integrating-applications.md) en [multitenant](active-directory-devhowto-multi-tenant-overview.md) apps en [algemene patronen voor verificatie](active-directory-authentication-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="3a644-112">It assumes knowledge of [single](active-directory-integrating-applications.md) and [multi-tenant](active-directory-devhowto-multi-tenant-overview.md) apps and [common authentication patterns](active-directory-authentication-scenarios.md).</span></span>

<span data-ttu-id="3a644-113">We je Duik in de impact van de toegang tot resources die u hebt geen controle over waarvoor beleid voor voorwaardelijke toegang toegepast.</span><span class="sxs-lookup"><span data-stu-id="3a644-113">We'll dive into the impact of accessing resources you don't have control over that may have conditional access policies applied.</span></span>  <span data-ttu-id="3a644-114">Bovendien verkennen we de implicaties van voorwaardelijke toegang in de op namens-stroom, web-apps, toegang tot Microsoft Graph en het aanroepen van API's.</span><span class="sxs-lookup"><span data-stu-id="3a644-114">Moreover, we explore the implications of conditional access in the on-behalf-of flow, web apps, accessing the Microsoft Graph, and calling APIs.</span></span>

## <a name="how-does-conditional-access-impact-an-app"></a><span data-ttu-id="3a644-115">Hoe beïnvloedt voorwaardelijke toegang tot een app</span><span class="sxs-lookup"><span data-stu-id="3a644-115">How does conditional access impact an app?</span></span>

### <a name="app-topologies-impacted"></a><span data-ttu-id="3a644-116">App-topologieën beïnvloed</span><span class="sxs-lookup"><span data-stu-id="3a644-116">App topologies impacted</span></span>

<span data-ttu-id="3a644-117">In de meest voorkomende gevallen voorwaardelijke toegang wordt het gedrag van een app niet gewijzigd of eventuele wijzigingen van de ontwikkelaar vereist.</span><span class="sxs-lookup"><span data-stu-id="3a644-117">In most common cases, conditional access does not change an app's behavior or requires any changes from the developer.</span></span>  <span data-ttu-id="3a644-118">Wanneer een app, indirect of op de achtergrond een token voor een service vraagt vereist een app alleen in bepaalde gevallen codewijzigingen voor het afhandelen van voorwaardelijke toegang 'uitdagingen'.</span><span class="sxs-lookup"><span data-stu-id="3a644-118">Only in certain cases when an app indirectly or silently requests a token for a service, an app requires code changes to handle conditional access "challenges".</span></span>  <span data-ttu-id="3a644-119">Het is mogelijk net zo eenvoudig als het uitvoeren van een aanvraag voor interactief aanmelden.</span><span class="sxs-lookup"><span data-stu-id="3a644-119">It may be as simple as performing an interactive sign-in request.</span></span> 

<span data-ttu-id="3a644-120">De volgende scenario's vereist in het bijzonder code voor het verwerken van voorwaardelijke toegang 'uitdagingen':</span><span class="sxs-lookup"><span data-stu-id="3a644-120">Specifically, the following scenarios require code to handle conditional access "challenges":</span></span> 

* <span data-ttu-id="3a644-121">Apps toegang tot Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="3a644-121">Apps accessing the Microsoft Graph</span></span>
* <span data-ttu-id="3a644-122">Apps voor het uitvoeren van de op namens-stroom</span><span class="sxs-lookup"><span data-stu-id="3a644-122">Apps performing the on-behalf-of flow</span></span>
* <span data-ttu-id="3a644-123">Apps toegang krijgen tot meerdere services/bronnen</span><span class="sxs-lookup"><span data-stu-id="3a644-123">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="3a644-124">Apps van één pagina met ADAL.js</span><span class="sxs-lookup"><span data-stu-id="3a644-124">Single page apps using ADAL.js</span></span>

<span data-ttu-id="3a644-125">Voorwaardelijke toegang beleidsregels kunnen worden toegepast op de app, maar kunnen ook worden toegepast op een web-API uw app wordt geopend.</span><span class="sxs-lookup"><span data-stu-id="3a644-125">Conditional access policies can be applied to the app, but also can be applied to a web API your app accesses.</span></span> <span data-ttu-id="3a644-126">Raadpleeg voor meer informatie over het configureren van beleid voor voorwaardelijke toegang, [aan de slag met Azure Active Directory voorwaardelijke toegang](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span><span class="sxs-lookup"><span data-stu-id="3a644-126">To learn more about how to configure a conditional access policy, please see [Getting started with Azure Active Directory Conditional Access](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span></span>

<span data-ttu-id="3a644-127">Afhankelijk van het scenario met een enterprise-klanten toepassen en beleidsregels voor voorwaardelijke toegang op elk gewenst moment verwijderen.</span><span class="sxs-lookup"><span data-stu-id="3a644-127">Depending on the scenario, an enterprise customer can apply and remove conditional access policies at any time.</span></span>  <span data-ttu-id="3a644-128">Om uw app om te blijven functioneren als een nieuw beleid wordt toegepast, moet u de verwerking van de 'uitdaging' implementeren.</span><span class="sxs-lookup"><span data-stu-id="3a644-128">In order for your app to continue functioning when a new policy is applied, you need to implement the "challenge" handling.</span></span> <span data-ttu-id="3a644-129">De volgende voorbeelden ziet challenge-verwerking.</span><span class="sxs-lookup"><span data-stu-id="3a644-129">The following examples illustrate challenge handling.</span></span> 

### <a name="conditional-access-examples"></a><span data-ttu-id="3a644-130">Voorbeelden van voorwaardelijke toegang</span><span class="sxs-lookup"><span data-stu-id="3a644-130">Conditional access examples</span></span>

<span data-ttu-id="3a644-131">Sommige scenario's vereist codewijzigingen voor het afhandelen van voorwaardelijke toegang, terwijl anderen werken zoals is.</span><span class="sxs-lookup"><span data-stu-id="3a644-131">Some scenarios require code changes to handle conditional access whereas others work as is.</span></span>  <span data-ttu-id="3a644-132">Hier volgen enkele scenario's met behulp van voorwaardelijke toegang voor multi-factor Authentication waarmee enig inzicht in het verschil.</span><span class="sxs-lookup"><span data-stu-id="3a644-132">Here are a few scenarios using conditional access to do multi-factor authentication that gives some insight into the difference.</span></span>

* <span data-ttu-id="3a644-133">U maakt een één-tenant iOS-app en toepassen van beleid voor voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-133">You are building a single-tenant iOS app and apply a conditional access policy.</span></span>  <span data-ttu-id="3a644-134">De app een gebruiker zich aanmeldt en geen toegang vragen tot een API.</span><span class="sxs-lookup"><span data-stu-id="3a644-134">The app signs in a user and doesn't request access to an API.</span></span>  <span data-ttu-id="3a644-135">Wanneer de gebruiker zich aanmeldt, wordt het beleid wordt automatisch geactiveerd en wordt de gebruiker moet multi-factor authentication (MFA) uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="3a644-135">When the user signs in, the policy is automatically invoked and the user needs to perform multi-factor authentication (MFA).</span></span> 
* <span data-ttu-id="3a644-136">U maakt een multitenant-web-app die gebruikmaakt van Microsoft Graph voor toegang tot Exchange, andere services.</span><span class="sxs-lookup"><span data-stu-id="3a644-136">You are building a multi-tenant web app that uses the Microsoft Graph to access Exchange, among other services.</span></span>  <span data-ttu-id="3a644-137">Een enterprise-klanten die deze app aanneemt Hiermee stelt u een beleid op SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="3a644-137">An enterprise customer who adopts this app sets a policy on SharePoint Online.</span></span>  <span data-ttu-id="3a644-138">Als de web-app een token voor MS Graph vraagt, een beleid op een Microsoft-Service wordt toegepast (specifiek services die toegankelijk zijn via grafiek).</span><span class="sxs-lookup"><span data-stu-id="3a644-138">When the web app requests a token for MS Graph, a policy on any Microsoft Service is applied (specifically services that can be accessed through graph).</span></span>  <span data-ttu-id="3a644-139">Deze door eindgebruikers wordt gevraagd om MFA.</span><span class="sxs-lookup"><span data-stu-id="3a644-139">This end-user is prompted for MFA.</span></span> <span data-ttu-id="3a644-140">In het geval is, de eindgebruiker is aangemeld met een geldige tokens, een claims 'uitdaging' wordt geretourneerd naar de web-app.</span><span class="sxs-lookup"><span data-stu-id="3a644-140">In the case, the end-user is signed in with valid tokens, a claims "challenge" is returned to the web app.</span></span>  
* <span data-ttu-id="3a644-141">U maakt een systeemeigen app die gebruikmaakt van een service voor de middelste laag voor toegang tot Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="3a644-141">You are building a native app that uses a middle tier service to access the Microsoft Graph.</span></span>  <span data-ttu-id="3a644-142">Een klant enterprise op het gebruik van deze app bedrijf geldt een beleid voor Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="3a644-142">An enterprise customer at the company using this app applies a policy to Exchange Online.</span></span>  <span data-ttu-id="3a644-143">Wanneer een eindgebruiker zich aanmeldt, wordt de systeemeigen app vraagt om toegang tot de middelste laag en stuurt het token.</span><span class="sxs-lookup"><span data-stu-id="3a644-143">When an end-user signs in, the native app requests access to the middle tier and sends the token.</span></span>  <span data-ttu-id="3a644-144">De middelste laag wordt uitgevoerd op namens-stroom voor het aanvragen van toegang tot de MS Graph.</span><span class="sxs-lookup"><span data-stu-id="3a644-144">The middle tier performs on-behalf-of flow to request access to the MS Graph.</span></span>  <span data-ttu-id="3a644-145">Op dit moment wordt een claims 'uitdaging' geverifieerd op de middelste laag.</span><span class="sxs-lookup"><span data-stu-id="3a644-145">At this point, a claims "challenge" is presented to the middle tier.</span></span> <span data-ttu-id="3a644-146">De uitdaging waar wordt de middelste laag teruggestuurd naar de systeemeigen app, die behoeften te voldoen aan het beleid voor voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-146">The middle tier sends the challenge back to the native app, which needs to comply with the conditional access policy.</span></span>

### <a name="complying-with-a-conditional-access-policy"></a><span data-ttu-id="3a644-147">Voldoen aan beleid voor voorwaardelijke toegang</span><span class="sxs-lookup"><span data-stu-id="3a644-147">Complying with a conditional access policy</span></span>

<span data-ttu-id="3a644-148">Beleid voor voorwaardelijke toegang wordt voor verschillende andere app topologieën geëvalueerd wanneer de sessie tot stand is gebracht.</span><span class="sxs-lookup"><span data-stu-id="3a644-148">For several different app topologies, a conditional access policy is evaluated when the session is established.</span></span>  <span data-ttu-id="3a644-149">Als een beleid voor voorwaardelijke toegang is van invloed op de granulatie van apps en services, afhankelijk het punt waarop deze wordt aangeroepen van geheugenlatentie het scenario dat u probeert te bereiken.</span><span class="sxs-lookup"><span data-stu-id="3a644-149">As a conditional access policy operates on the granularity of apps and services, the point at which it is invoked depends heavily on the scenario you're trying to accomplish.</span></span>

<span data-ttu-id="3a644-150">Wanneer uw app probeert te krijgen tot een service met een beleid voor voorwaardelijke toegang, ondervinden het moeilijk voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-150">When your app attempts to access a service with a conditional access policy, it may encounter a conditional access challenge.</span></span>  <span data-ttu-id="3a644-151">Deze uitdaging wordt gecodeerd in de `claims` parameter die wordt geleverd in een antwoord van Azure AD of Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="3a644-151">This challenge is encoded in the `claims` parameter that comes in a response from Azure AD or the Microsoft Graph.</span></span>  <span data-ttu-id="3a644-152">Hier volgt een voorbeeld van deze uitdaging parameter:</span><span class="sxs-lookup"><span data-stu-id="3a644-152">Here's an example of this challenge parameter:</span></span> 

```
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="3a644-153">Ontwikkelaars kunnen de deze uitdaging en voegt deze naar een nieuwe aanvraag naar Azure AD.</span><span class="sxs-lookup"><span data-stu-id="3a644-153">Developers can take this challenge and append it onto a new request to Azure AD.</span></span>  <span data-ttu-id="3a644-154">Deze status wordt doorgegeven, wordt geen actie nodig om te voldoen aan het beleid voor voorwaardelijke toegang van de eindgebruiker gevraagd.</span><span class="sxs-lookup"><span data-stu-id="3a644-154">Passing this state prompts the end-user to perform any action necessary to comply with the conditional access policy.</span></span> <span data-ttu-id="3a644-155">Details van de fout en het uitpakken van de parameter worden in de volgende scenario's beschreven.</span><span class="sxs-lookup"><span data-stu-id="3a644-155">In the following scenarios, specifics of the error and how to extract the parameter are explained.</span></span> 

## <a name="scenarios"></a><span data-ttu-id="3a644-156">Scenario's</span><span class="sxs-lookup"><span data-stu-id="3a644-156">Scenarios</span></span>

### <a name="prerequisites"></a><span data-ttu-id="3a644-157">Vereisten</span><span class="sxs-lookup"><span data-stu-id="3a644-157">Prerequisites</span></span>

<span data-ttu-id="3a644-158">Voorwaardelijke toegang van Azure AD is een functie die is opgenomen in [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span><span class="sxs-lookup"><span data-stu-id="3a644-158">Azure AD conditional access is a feature included in [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span></span>  <span data-ttu-id="3a644-159">U kunt meer informatie over het licentievereisten in de [niet-gelicentieerde gebruiksrapport](../active-directory-conditional-access-unlicensed-usage-report.md).</span><span class="sxs-lookup"><span data-stu-id="3a644-159">You can learn more about licensing requirements in the [unlicensed usage report](../active-directory-conditional-access-unlicensed-usage-report.md).</span></span>  <span data-ttu-id="3a644-160">Ontwikkelaars kunnen worden gekoppeld aan de [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), waaronder een gratis abonnement op de Enterprise Mobility Suite waaronder Azure AD Premium.</span><span class="sxs-lookup"><span data-stu-id="3a644-160">Developers can join the [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), which includes a free subscription to the Enterprise Mobility Suite which includes Azure AD Premium.</span></span>

### <a name="considerations-for-specific-scenarios"></a><span data-ttu-id="3a644-161">Overwegingen voor het specifieke scenario 's</span><span class="sxs-lookup"><span data-stu-id="3a644-161">Considerations for specific scenarios</span></span>

<span data-ttu-id="3a644-162">De volgende informatie is alleen van toepassing in deze scenario's voor voorwaardelijke toegang:</span><span class="sxs-lookup"><span data-stu-id="3a644-162">The following information only applies in these conditional access scenarios:</span></span>

* <span data-ttu-id="3a644-163">Apps toegang tot Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="3a644-163">Apps accessing the Microsoft Graph</span></span>
* <span data-ttu-id="3a644-164">Apps voor het uitvoeren van de op namens-stroom</span><span class="sxs-lookup"><span data-stu-id="3a644-164">Apps performing the on-behalf-of flow</span></span>
* <span data-ttu-id="3a644-165">Apps toegang krijgen tot meerdere services/bronnen</span><span class="sxs-lookup"><span data-stu-id="3a644-165">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="3a644-166">Apps van één pagina met ADAL.js</span><span class="sxs-lookup"><span data-stu-id="3a644-166">Single page apps using ADAL.js</span></span>

<span data-ttu-id="3a644-167">In de volgende secties je krijgt in algemene scenario's waarin complexere zijn.</span><span class="sxs-lookup"><span data-stu-id="3a644-167">In the following sections, we'll get into common scenarios in which are more complex.</span></span>  <span data-ttu-id="3a644-168">De kern van het besturingssysteem principe is voorwaardelijk beleid wordt geëvalueerd op het moment dat het token is aangevraagd voor de service die toegepast is, tenzij het wordt geopend via de Microsoft Graph beleid voor voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-168">The core operating principle is conditional access policies are evaluated at the time the token is requested for the service that has a conditional access policy applied unless it's being accessed through the Microsoft Graph.</span></span>

### <a name="scenario-app-accessing-the-microsoft-graph"></a><span data-ttu-id="3a644-169">Scenario: App toegang tot Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="3a644-169">Scenario: App accessing the Microsoft Graph</span></span>

<span data-ttu-id="3a644-170">In dit scenario doorlopen we het geval wanneer een web-app aanvragen toegang naar de Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="3a644-170">In this scenario, we walk through the case when a web app requests access to the Microsoft Graph.</span></span> <span data-ttu-id="3a644-171">Beleid voor voorwaardelijke toegang kan in dit geval worden toegewezen aan SharePoint, Exchange of een andere service die wordt geopend als een werklast via Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="3a644-171">The conditional access policy in this case could be assigned to SharePoint, Exchange, or some other service that is accessed as a workload through the Microsoft Graph.</span></span>  <span data-ttu-id="3a644-172">In dit voorbeeld gaan we ervan uit dat er is een beleid voor voorwaardelijke toegang op Sharepoint Online.</span><span class="sxs-lookup"><span data-stu-id="3a644-172">In this example, let's assume there's a conditional access policy on Sharepoint Online.</span></span>

![App-toegang tot het diagram voor Microsoft Graph](media/active-directory-conditional-access-developer/app-accessing-microsoft-graph-scenario.png)

<span data-ttu-id="3a644-174">De app verzoekt eerst autorisatie voor Microsoft Graph waarvoor toegang tot een downstream werkbelasting zonder voorwaardelijke toegang is vereist.</span><span class="sxs-lookup"><span data-stu-id="3a644-174">The app first requests authorization to the Microsoft Graph which requires accessing a downstream workload without conditional access.</span></span>  <span data-ttu-id="3a644-175">De aanvraag kan worden uitgevoerd zonder een beleid wordt aangeroepen en de app-tokens ontvangen voor Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="3a644-175">The request succeeds without invoking any policy and the app receives tokens for Microsoft Graph.</span></span>  <span data-ttu-id="3a644-176">De app kan het toegangstoken op dit moment gebruiken in een bearer-aanvraag voor het eindpunt aangevraagd.</span><span class="sxs-lookup"><span data-stu-id="3a644-176">At this point, the app may use the access token in a bearer request for the endpoint requested.</span></span> <span data-ttu-id="3a644-177">Nu nodig de app toegang heeft tot een Sharepoint Online-eindpunt van Microsoft Graph, bijvoorbeeld:`https://graph.microsoft.com/v1.0/me/mySite`</span><span class="sxs-lookup"><span data-stu-id="3a644-177">Now, the app needs to access a Sharepoint Online endpoint of Microsoft Graph, for example: `https://graph.microsoft.com/v1.0/me/mySite`</span></span>

<span data-ttu-id="3a644-178">De app heeft al een geldig token voor Microsoft Graph, zodat deze de nieuwe aanvraag uitvoeren kan zonder een nieuw token worden verleend.</span><span class="sxs-lookup"><span data-stu-id="3a644-178">The app already has a valid token for the Microsoft Graph, so it can perform the new request without being issued a new token.</span></span> <span data-ttu-id="3a644-179">Deze aanvraag is mislukt en claims moeilijk is uitgegeven door Microsoft Graph in de vorm van een HTTP 403-verboden met een ```WWW-Authenticate``` uitdaging.</span><span class="sxs-lookup"><span data-stu-id="3a644-179">This request fails and a claims challenge is issued from Microsoft Graph in the form of an HTTP 403 Forbidden with a ```WWW-Authenticate``` challenge.</span></span>
<span data-ttu-id="3a644-180">Hier volgt een voorbeeld van het antwoord:</span><span class="sxs-lookup"><span data-stu-id="3a644-180">Here's an example of the response:</span></span> 

```
HTTP 403; Forbidden 
error=insufficient_claims
www-authenticate="Bearer realm="", authorization_uri="https://login.windows.net/common/oauth2/authorize", client_id="<GUID>", error=insufficient_claims, claims={"access_token":{"polids":{"essential":true,"values":["<GUID>"]}}}"
```

<span data-ttu-id="3a644-181">De uitdaging van claims is opgenomen in de ```WWW-Authenticate``` koptekst, die het uitpakken van de claims-parameter voor de volgende aanvraag kan worden geparseerd.</span><span class="sxs-lookup"><span data-stu-id="3a644-181">The claims challenge is inside the ```WWW-Authenticate``` header, which can be parsed to extract the claims parameter for the next request.</span></span>  <span data-ttu-id="3a644-182">Zodra deze wordt toegevoegd aan de nieuwe aanvraag, Azure AD, kent het beleid voor voorwaardelijke toegang evalueren als u de gebruiker zich aanmeldt en de app is nu in overeenstemming met het beleid voor voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-182">Once it's appended to the new request, Azure AD knows to evaluate the conditional access policy when signing in the user and the app is now in compliance with the conditional access policy.</span></span>  <span data-ttu-id="3a644-183">De aanvraag voor het Sharepoint Online-eindpunt herhalende slaagt.</span><span class="sxs-lookup"><span data-stu-id="3a644-183">Repeating the request to the Sharepoint Online endpoint succeeds.</span></span>

<span data-ttu-id="3a644-184">Voor de codevoorbeelden die laten zien hoe u de uitdaging claims verwerken, raadpleegt u de [.NET bureaublad codevoorbeeld](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) voor ADAL .NET of de [codevoorbeeld-op-andere gebruikers-of](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) voor ADAL .NET.</span><span class="sxs-lookup"><span data-stu-id="3a644-184">For code samples that demonstrate how to handle the claims challenge, refer to the [.NET Desktop code sample](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) for ADAL .NET or the [On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) for ADAL .NET.</span></span>

### <a name="scenario-app-performing-the-on-behalf-of-flow"></a><span data-ttu-id="3a644-185">Scenario: App uitvoeren van de op namens-stroom</span><span class="sxs-lookup"><span data-stu-id="3a644-185">Scenario: App performing the on-behalf-of flow</span></span>

<span data-ttu-id="3a644-186">In dit scenario doorlopen we het geval waarbij een systeemeigen app een/API-webservice roept.</span><span class="sxs-lookup"><span data-stu-id="3a644-186">In this scenario, we walk through the case in which a native app calls a web service/API.</span></span>  <span data-ttu-id="3a644-187">Op zijn beurt deze service biedt [de ' op namens-' stroom](active-directory-authentication-scenarios.md#application-types-and-scenarios) een downstream service aanroepen.</span><span class="sxs-lookup"><span data-stu-id="3a644-187">In turn, this service does [the "on-behalf-of" flow](active-directory-authentication-scenarios.md#application-types-and-scenarios) to call a downstream service.</span></span>  <span data-ttu-id="3a644-188">In ons geval we onze beleid voor voorwaardelijke toegang hebt toegepast op de downstream-service (Web API 2) en een systeemeigen app in plaats van een server/daemon-app gebruikt.</span><span class="sxs-lookup"><span data-stu-id="3a644-188">In our case, we've applied our conditional access policy to the downstream service (Web API 2) and are using a native app rather than a server/daemon app.</span></span> 

![Uitvoeren van het stroomdiagram op-andere gebruikers-of App](media/active-directory-conditional-access-developer/app-performing-on-behalf-of-scenario.png)

<span data-ttu-id="3a644-190">De eerste tokenaanvraag voor Web-API-1 wordt de eindgebruiker voor multi-factor authentication niet gevraagd als Web-API 1 de downstream-API niet altijd mogelijk bereikt.</span><span class="sxs-lookup"><span data-stu-id="3a644-190">The initial token request for Web API 1 does not prompt the end-user for multi-factor authentication as Web API 1 may not always hit the downstream API.</span></span>  <span data-ttu-id="3a644-191">Wanneer de Web-API 1 wil een token op-andere gebruikers-of de gebruiker een aanvraag voor Web API 2, wordt het verzoek mislukken omdat de gebruiker niet is aangemeld met multi-factor authentication-server.</span><span class="sxs-lookup"><span data-stu-id="3a644-191">Once Web API 1 tries to request a token on-behalf-of the user for Web API 2, the request fails since the user has not signed in with multi-factor authentication.</span></span>

<span data-ttu-id="3a644-192">Azure AD retourneert een HTTP-antwoord met enkele interessante gegevens:</span><span class="sxs-lookup"><span data-stu-id="3a644-192">Azure AD returns an HTTP response with some interesting data:</span></span> 

> [!NOTE]
> <span data-ttu-id="3a644-193">In dit exemplaar is een foutbeschrijving multi-factor authentication-server, maar er is een breed scala aan `interaction_required` mogelijk die betrekking hebben op voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-193">In this instance it's a multi-factor authentication error description, but there's a wide range of `interaction_required` possible pertaining to conditional access.</span></span>  

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due to a configuration change made by your administrator, or because you moved to a new location, you must use multi-factor authentication to access '<Web API 2 App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="3a644-194">In onze Web API-1 wordt de fout catch `error=interaction_required`, en de `claims` voor de bureaublad-app.</span><span class="sxs-lookup"><span data-stu-id="3a644-194">In our Web API 1, we catch the error `error=interaction_required`, and send back the `claims` challenge to the desktop app.</span></span>  <span data-ttu-id="3a644-195">Op dat moment de bureaublad-app kunt maken een nieuwe `acquireToken()` aanroepen en toevoegen de `claims`uitdaging als een extra queryreeksparameter opgeven.</span><span class="sxs-lookup"><span data-stu-id="3a644-195">At that point, the desktop app can make a new `acquireToken()` call and append the `claims`challenge as an extra query string parameter.</span></span>  <span data-ttu-id="3a644-196">Deze nieuwe aanvraag moet de gebruiker multi-factor Authentication en stuurt deze nieuwe token terug naar de Web-API-1 en voltooien van de op namens-stroom.</span><span class="sxs-lookup"><span data-stu-id="3a644-196">This new request requires the user to do multi-factor authentication and then send this new token back to Web API 1 and complete the on-behalf-of flow.</span></span>

<span data-ttu-id="3a644-197">Als u wilt uitproberen dit scenario, Zie onze [.NET codevoorbeeld](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="3a644-197">To try out this scenario, see our [.NET code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="3a644-198">Dit laat zien hoe de uitdaging claims van Web-API 1 doorgeven aan de systeemeigen app en een nieuwe aanvraag in de client-app opstelt.</span><span class="sxs-lookup"><span data-stu-id="3a644-198">It demonstrates how to pass the claims challenge back from Web API 1 to the native app and construct a new request inside the client app.</span></span> 

### <a name="scenario-app-accessing-multiple-services"></a><span data-ttu-id="3a644-199">Scenario: App toegang tot meerdere services</span><span class="sxs-lookup"><span data-stu-id="3a644-199">Scenario: App accessing multiple services</span></span>

<span data-ttu-id="3a644-200">In dit scenario doorlopen we het geval waarbij een web-app heeft toegang tot twee services waarbij een van de toegewezen beleid voor voorwaardelijke toegang heeft.</span><span class="sxs-lookup"><span data-stu-id="3a644-200">In this scenario, we walk through the case in which a web app accesses two services one of which has a conditional access policy assigned.</span></span>  <span data-ttu-id="3a644-201">Afhankelijk van de logische app bestaat een pad waarin uw app geen toegang krijgen tot beide webservices vereist.</span><span class="sxs-lookup"><span data-stu-id="3a644-201">Depending on your app logic, there may exist a path in which your app does not require access to both web services.</span></span>  <span data-ttu-id="3a644-202">In dit scenario speelt een belangrijke rol in de gebruikerservaring is de volgorde waarin u een token aanvragen.</span><span class="sxs-lookup"><span data-stu-id="3a644-202">In this scenario, the order in which you request a token plays an important role in the end-user experience.</span></span>

<span data-ttu-id="3a644-203">Stel hebben we webservice A en B en webservice B heeft het beleid voor voorwaardelijke toegang toegepast.</span><span class="sxs-lookup"><span data-stu-id="3a644-203">Let's assume we have web service A and B and web service B has our conditional access policy applied.</span></span>  <span data-ttu-id="3a644-204">Tijdens de eerste interactieve auth-aanvraag toestemming voor beide services vereist, wordt het beleid voor voorwaardelijke toegang niet in alle gevallen vereist.</span><span class="sxs-lookup"><span data-stu-id="3a644-204">While the initial interactive auth request requires consent for both services, the conditional access policy is not required in all cases.</span></span>  <span data-ttu-id="3a644-205">Als de app een token voor webservice B vraagt, het beleid wordt aangeroepen en volgende aanvragen voor webservice A slaagt ook als volgt.</span><span class="sxs-lookup"><span data-stu-id="3a644-205">If the app requests a token for web service B, then the policy is invoked and subsequent requests for web service A also succeeds as follows.</span></span>

![App-toegang tot meerdere services stroomdiagram](media/active-directory-conditional-access-developer/app-accessing-multiple-services-scenario.png)

<span data-ttu-id="3a644-207">U kunt ook als de app een token in eerste instantie voor web service A vraagt, wordt de eindgebruiker geen gebruikgemaakt van het beleid voor voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-207">Alternatively, if the app initially requests a token for web service A, the end-user does not invoke the conditional access policy.</span></span>  <span data-ttu-id="3a644-208">Hierdoor kan de ontwikkelaar van de app voor het beheren van de gebruikerservaring en beleid voor voorwaardelijke toegang kan worden aangeroepen in alle gevallen niet afdwingen.</span><span class="sxs-lookup"><span data-stu-id="3a644-208">This allows the app developer to control the end-user experience and not force the conditional access policy to be invoked in all cases.</span></span> <span data-ttu-id="3a644-209">Het geval is lastig is als de app vervolgens een token voor webservice B. vraagt Op dit moment wordt de eindgebruiker moet voldoen aan het beleid voor voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-209">The tricky case is if the app subsequently requests a token for web service B. At this point, the end-user needs to comply with the conditional access policy.</span></span>  <span data-ttu-id="3a644-210">Wanneer de app probeert te `acquireToken`, kan dit de volgende fout (weergegeven in het volgende diagram) genereren:</span><span class="sxs-lookup"><span data-stu-id="3a644-210">When the app tries to `acquireToken`, it may generate the following error (illustrated in the following diagram):</span></span> 

```
HTTP 400; Bad Request
error=interaction_required
error_description=AADSTS50076: Due to a configuration change made by your administrator, or because you moved to a new location, you must use multi-factor authentication to access '<Web API App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
``` 

![App-toegang tot meerdere aanvragen van een nieuw token-services](media/active-directory-conditional-access-developer/app-accessing-multiple-services-new-token.png)

<span data-ttu-id="3a644-212">Als de app van de ADAL-bibliotheek gebruikmaakt, wordt het token verkrijgen van een mislukt altijd interactief geprobeerd.</span><span class="sxs-lookup"><span data-stu-id="3a644-212">If the app is using the ADAL library, a failure to acquire the token is always retried interactively.</span></span>  <span data-ttu-id="3a644-213">Wanneer deze interactieve aanvraag optreedt, heeft de eindgebruiker de mogelijkheid om te voldoen aan de voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-213">When this interactive request occurs, the end-user has the opportunity to comply with the conditional access.</span></span>  <span data-ttu-id="3a644-214">Dit is de waarde true tenzij de aanvraag is een `AcquireTokenSilentAsync` of `PromptBehavior.Never` in dat geval de app moet om uit te voeren een interactieve ```AcquireToken``` aanvraag voor het gebruik van het einde van de mogelijkheid om te voldoen aan het beleid bieden.</span><span class="sxs-lookup"><span data-stu-id="3a644-214">This is true unless the request is a `AcquireTokenSilentAsync` or `PromptBehavior.Never` in which case the app needs to perform an interactive ```AcquireToken``` request to give the end use the opportunity to comply with the policy.</span></span> 

### <a name="scenario-single-page-app-spa-using-adaljs"></a><span data-ttu-id="3a644-215">Scenario: Één pagina App (SPA) met behulp van ADAL.js</span><span class="sxs-lookup"><span data-stu-id="3a644-215">Scenario: Single Page App (SPA) using ADAL.js</span></span>

<span data-ttu-id="3a644-216">In dit scenario doorlopen we het geval wanneer we een app met één pagina (SPA hebben) ADAL.js met een voorwaardelijke toegang verlenen tot beveiligde web-API niet aanroepen.</span><span class="sxs-lookup"><span data-stu-id="3a644-216">In this scenario, we walk through the case when we have a single page app (SPA), using ADAL.js to call a conditional access protected web API.</span></span>  <span data-ttu-id="3a644-217">Dit is een eenvoudige architectuur, maar sommige nuances die worden gehouden moet bij het ontwikkelen van rond voorwaardelijke toegang heeft.</span><span class="sxs-lookup"><span data-stu-id="3a644-217">This is a simple architecture but has some nuances that need to be taken into account when developing around conditional access.</span></span>

<span data-ttu-id="3a644-218">In ADAL.js, zijn er enkele functies die tokens verkrijgen: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, en `acquireTokenRedirect(…)`.</span><span class="sxs-lookup"><span data-stu-id="3a644-218">In ADAL.js, there are a few functions that obtain tokens: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, and `acquireTokenRedirect(…)`.</span></span> 

* <span data-ttu-id="3a644-219">`login()`verkrijgt van een token ID via een aanvraag voor interactief aanmelden, maar biedt toegangstokens voor elke service (met inbegrip van een web-API van voorwaardelijke toegang verlenen tot beveiligde) niet ophalen.</span><span class="sxs-lookup"><span data-stu-id="3a644-219">`login()` obtains an ID token through an interactive sign-in request but does not obtain access tokens for any service (including a conditional access protected web API).</span></span>  
* <span data-ttu-id="3a644-220">`acquireToken(…)`vervolgens kan achtergrond verkrijgen van een toegangstoken dat wil zeggen dat UI wordt niet weergegeven in elk geval worden gebruikt.</span><span class="sxs-lookup"><span data-stu-id="3a644-220">`acquireToken(…)` can then be used to silently obtain an access token meaning it does not show UI in any circumstance.</span></span>  
* <span data-ttu-id="3a644-221">`acquireTokenPopup(…)`en `acquireTokenRedirect(…)` zijn beide gebruikt voor het interactief aanvragen van een token voor een resource wat betekent dat ze altijd aanmelden UI niet weergeven.</span><span class="sxs-lookup"><span data-stu-id="3a644-221">`acquireTokenPopup(…)` and `acquireTokenRedirect(…)` are both used to interactively request a token for a resource meaning they always show sign-in UI.</span></span>

<span data-ttu-id="3a644-222">Wanneer een app een toegangstoken een Web-API aan te roepen moet, wordt geprobeerd een `acquireToken(…)`.</span><span class="sxs-lookup"><span data-stu-id="3a644-222">When an app needs an access token to call a Web API, it attempts an `acquireToken(…)`.</span></span>  <span data-ttu-id="3a644-223">De token sessie is verlopen of als we nodig om te voldoen aan beleid voor voorwaardelijke toegang, wordt de *acquireToken* functie mislukt en de app gebruikt `acquireTokenPopup()` of `acquireTokenRedirect()`.</span><span class="sxs-lookup"><span data-stu-id="3a644-223">If the token session is expired or we need to comply with a conditional access policy, then the *acquireToken* function fails and the app uses `acquireTokenPopup()` or `acquireTokenRedirect()`.</span></span>

![Één pagina app met behulp van ADAL stroomdiagram](media/active-directory-conditional-access-developer/spa-using-adal-scenario.png)

<span data-ttu-id="3a644-225">We doorlopen een voorbeeld met ons scenario voorwaardelijke toegang.</span><span class="sxs-lookup"><span data-stu-id="3a644-225">Let's walk through an example with our conditional access scenario.</span></span>  <span data-ttu-id="3a644-226">De eindgebruiker gewoon bevindt zich op de site en beschikt niet over een sessie.</span><span class="sxs-lookup"><span data-stu-id="3a644-226">The end-user just landed on the site and doesn’t have a session.</span></span>  <span data-ttu-id="3a644-227">We voeren een `login()` aanroepen, een ID zonder multi-factor authentication-token ophalen.</span><span class="sxs-lookup"><span data-stu-id="3a644-227">We perform a `login()` call, get an ID token without multi-factor authentication.</span></span>  <span data-ttu-id="3a644-228">De gebruiker treffers vervolgens een knop die de app om gegevens van aanvragen van een web-API vereist.</span><span class="sxs-lookup"><span data-stu-id="3a644-228">Then the user hits a button that requires the app to request data from a web API.</span></span>  <span data-ttu-id="3a644-229">De app wordt geprobeerd een `acquireToken()` aanroep maar is mislukt omdat de gebruiker multi-factor authentication-server nog en behoeften te voldoen aan het beleid voor voorwaardelijke toegang niet uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="3a644-229">The app tries to do an `acquireToken()` call but fails since the user has not performed multi-factor authentication yet and needs to comply with the conditional access policy.</span></span>

<span data-ttu-id="3a644-230">Azure AD verzendt terug van de volgende HTTP-antwoord:</span><span class="sxs-lookup"><span data-stu-id="3a644-230">Azure AD sends back the following HTTP response:</span></span> 

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due to a configuration change made by your administrator, or because you moved to a new location, you must use multi-factor authentication to access '<Web API App/Client ID>'.
```

<span data-ttu-id="3a644-231">Onze app catch moet de `error=interaction_required`.</span><span class="sxs-lookup"><span data-stu-id="3a644-231">Our app needs to catch the `error=interaction_required`.</span></span>  <span data-ttu-id="3a644-232">De toepassing kan vervolgens worden gebruikt een `acquireTokenPopup()` of `acquireTokenRedirect()` op dezelfde resource.</span><span class="sxs-lookup"><span data-stu-id="3a644-232">The application can then use either `acquireTokenPopup()` or `acquireTokenRedirect()` on the same resource.</span></span>  <span data-ttu-id="3a644-233">De gebruiker moet een multi-factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="3a644-233">The user is forced to do a multi-factor authentication.</span></span> <span data-ttu-id="3a644-234">Nadat de gebruiker is voltooid voor de multi-factor authentication, kan de app een nieuw toegangstoken voor de aangevraagde bron is uitgegeven.</span><span class="sxs-lookup"><span data-stu-id="3a644-234">After the user completes the multi-factor authentication, the app is issued a fresh access token for the requested resource.</span></span>

<span data-ttu-id="3a644-235">Als u wilt uitproberen dit scenario, Zie onze [JS SPA op-andere gebruikers-of codevoorbeeld](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="3a644-235">To try out this scenario, see our [JS SPA On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="3a644-236">Deze voorbeeldcode maakt gebruik van het beleid voor voorwaardelijke toegang en de web-API die u eerder hebt geregistreerd bij een SPA JS ter illustratie van dit scenario.</span><span class="sxs-lookup"><span data-stu-id="3a644-236">This code sample uses the conditional access policy and web API you registered earlier with a JS SPA to demonstrate this scenario.</span></span> <span data-ttu-id="3a644-237">Er wordt weergegeven hoe goed de uitdaging claims verwerken en ophalen van een toegangstoken die kan worden gebruikt voor uw Web-API.</span><span class="sxs-lookup"><span data-stu-id="3a644-237">It shows how to properly handle the claims challenge and get an access token that can be used for your Web API.</span></span> <span data-ttu-id="3a644-238">U kunt ook de algemene afhandeling [Angular.js codevoorbeeld](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) voor hulp bij een Hoekvormige SPA</span><span class="sxs-lookup"><span data-stu-id="3a644-238">Alternatively, checkout the general [Angular.js code sample](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) for guidance on an Angular SPA</span></span>


## <a name="see-also"></a><span data-ttu-id="3a644-239">Zie ook</span><span class="sxs-lookup"><span data-stu-id="3a644-239">See also</span></span>

* <span data-ttu-id="3a644-240">Zie voor meer informatie over de mogelijkheden, [voorwaardelijke toegang in Azure AD](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="3a644-240">To learn more about the capabilities, see [Conditional Access in Azure AD](../active-directory-conditional-access.md).</span></span>
* <span data-ttu-id="3a644-241">Zie voor meer Azure AD-codevoorbeelden [Github-Repo-van-codevoorbeelden](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span><span class="sxs-lookup"><span data-stu-id="3a644-241">For more Azure AD code samples, see [Github Repo of Code Samples](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span></span> 
* <span data-ttu-id="3a644-242">Zie voor meer informatie over de ADAL SDK van en toegang naslagdocumentatie over de [bibliotheek handleiding](active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="3a644-242">For more info on the ADAL SDK's and access the reference documentation, see [library guide](active-directory-authentication-libraries.md).</span></span>
* <span data-ttu-id="3a644-243">Zie voor meer informatie over scenario's met meerdere tenants, [aanmelden van gebruikers met behulp van het patroon multitenant](active-directory-devhowto-multi-tenant-overview.md).</span><span class="sxs-lookup"><span data-stu-id="3a644-243">To learn more about multi-tenant scenarios, see [How to sign in users using the multi-tenant pattern](active-directory-devhowto-multi-tenant-overview.md).</span></span>
