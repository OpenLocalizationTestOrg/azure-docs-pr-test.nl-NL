---
title: Azure Active Directory v2.0 scopes, machtigingen en toestemming | Microsoft Docs
description: Een beschrijving van de autorisatie in de Azure AD v2.0-eindpunt, met inbegrip van bereiken, machtigingen en toestemming.
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 04869a7627ecb3e6a0d11733fae7da2ecb04ed51
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="scopes-permissions-and-consent-in-the-azure-active-directory-v20-endpoint"></a><span data-ttu-id="e6f00-103">Scopes, machtigingen en toestemming in de Azure Active Directory v2.0-eindpunt</span><span class="sxs-lookup"><span data-stu-id="e6f00-103">Scopes, permissions, and consent in the Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="e6f00-104">Apps die zijn geïntegreerd met Azure Active Directory (Azure AD) voert u een autorisatie-model waarmee gebruikers controle over hoe een app toegang krijgen hun gegevens tot.</span><span class="sxs-lookup"><span data-stu-id="e6f00-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="e6f00-105">Het v2.0-implementatie van het model van de autorisatie is bijgewerkt en verandert hoe een app moet communiceren met Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e6f00-105">The v2.0 implementation of the authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="e6f00-106">In dit artikel bevat informatie over de basisconcepten van deze autorisatie-model, inclusief scopes, machtigingen en toestemming.</span><span class="sxs-lookup"><span data-stu-id="e6f00-106">This article covers the basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="e6f00-107">Het v2.0-eindpunt biedt geen ondersteuning voor alle Azure Active Directory-scenario's en onderdelen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-107">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="e6f00-108">Meer informatie over om te bepalen of het v2.0-eindpunt moet worden gebruikt, [v2.0 beperkingen](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="e6f00-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="e6f00-109">Scopes en -machtigingen</span><span class="sxs-lookup"><span data-stu-id="e6f00-109">Scopes and permissions</span></span>
<span data-ttu-id="e6f00-110">Azure AD-implementeert de [OAuth 2.0](active-directory-v2-protocols.md) (authorization protocol).</span><span class="sxs-lookup"><span data-stu-id="e6f00-110">Azure AD implements the [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="e6f00-111">OAuth 2.0 is een methode waarmee een app van derden toegang web gehoste bronnen namens een gebruiker tot.</span><span class="sxs-lookup"><span data-stu-id="e6f00-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="e6f00-112">Een web gehost resource die kan worden geïntegreerd met Azure AD heeft een bron-id of *Application ID URI*.</span><span class="sxs-lookup"><span data-stu-id="e6f00-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="e6f00-113">Bijvoorbeeld: Microsoft website wordt gehost resources onder andere:</span><span class="sxs-lookup"><span data-stu-id="e6f00-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="e6f00-114">De Office 365 Unified API E-mail:`https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="e6f00-114">The Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="e6f00-115">De Azure AD Graph-API:`https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="e6f00-115">The Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="e6f00-116">Microsoft Graph:`https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="e6f00-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="e6f00-117">Hetzelfde geldt voor alle resources van derden die zijn geïntegreerd met Azure AD.</span><span class="sxs-lookup"><span data-stu-id="e6f00-117">The same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="e6f00-118">Een van deze resources kunt ook een reeks machtigingen die kunnen worden gebruikt voor de functionaliteit van die bron onderverdelen in kleinere reeksen definiëren.</span><span class="sxs-lookup"><span data-stu-id="e6f00-118">Any of these resources also can define a set of permissions that can be used to divide the functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="e6f00-119">Als u bijvoorbeeld [Microsoft Graph](https://graph.microsoft.io) is gedefinieerd machtigingen voor de volgende taken uitvoeren, onder andere:</span><span class="sxs-lookup"><span data-stu-id="e6f00-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions to do the following tasks, among others:</span></span>

* <span data-ttu-id="e6f00-120">Lezen van een gebruiker kalender</span><span class="sxs-lookup"><span data-stu-id="e6f00-120">Read a user's calendar</span></span>
* <span data-ttu-id="e6f00-121">Schrijven naar een gebruiker kalender</span><span class="sxs-lookup"><span data-stu-id="e6f00-121">Write to a user's calendar</span></span>
* <span data-ttu-id="e6f00-122">E-mail met een gebruiker als afzender verzenden</span><span class="sxs-lookup"><span data-stu-id="e6f00-122">Send mail as a user</span></span>

<span data-ttu-id="e6f00-123">De resource heeft met het definiëren van deze typen machtigingen, fijnmazig controle over de gegevens en hoe de gegevens wordt weergegeven.</span><span class="sxs-lookup"><span data-stu-id="e6f00-123">By defining these types of permissions, the resource has fine-grained control over its data and how the data is exposed.</span></span> <span data-ttu-id="e6f00-124">Een app van derden kunt u deze machtigingen aanvragen bij een app-gebruiker.</span><span class="sxs-lookup"><span data-stu-id="e6f00-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="e6f00-125">De app-gebruiker moet de machtigingen goedkeuren voordat de app kan namens de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="e6f00-125">The app user must approve the permissions before the app can act on the user's behalf.</span></span> <span data-ttu-id="e6f00-126">Door de verdeling in segmenten van de resource-functionaliteit in kleinere machtigingensets, kunnen apps van derden worden gebouwd om aan te vragen van alleen de specifieke machtigingen die ze nodig hebben om uit te voeren hun werking.</span><span class="sxs-lookup"><span data-stu-id="e6f00-126">By chunking the resource's functionality into smaller permission sets, third-party apps can be built to request only the specific permissions that they need to perform their function.</span></span> <span data-ttu-id="e6f00-127">App-gebruikers kunnen weet precies wijze waarop een app gebruikmaakt van hun gegevens en ze kunnen worden meer zeker weet dat de app werkt anders met kwade bedoelingen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-127">App users can know exactly how an app will use their data, and they can be more confident that the app is not behaving with malicious intent.</span></span>

<span data-ttu-id="e6f00-128">In Azure AD en OAuth, deze typen machtigingen worden genoemd *scopes*.</span><span class="sxs-lookup"><span data-stu-id="e6f00-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="e6f00-129">Ze soms ook worden aangeduid als *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="e6f00-129">They also sometimes are referred to as *oAuth2Permissions*.</span></span> <span data-ttu-id="e6f00-130">Een scope wordt weergegeven in Azure AD als een string-waarde.</span><span class="sxs-lookup"><span data-stu-id="e6f00-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="e6f00-131">U kunt doorgaan met het Microsoft Graph-voorbeeld, is de waarde scope voor elke machtiging:</span><span class="sxs-lookup"><span data-stu-id="e6f00-131">Continuing with the Microsoft Graph example, the scope value for each permission is:</span></span>

* <span data-ttu-id="e6f00-132">Lezen van een gebruiker kalender met`Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="e6f00-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="e6f00-133">Schrijven naar de kalender van een gebruiker met behulp van`Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="e6f00-133">Write to a user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="e6f00-134">E-mail verzenden namens een gebruiker met door`Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="e6f00-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="e6f00-135">Een app kunt u deze machtigingen aanvragen door op te geven van de bereiken in hun aanvragen aan het v2.0-eindpunt.</span><span class="sxs-lookup"><span data-stu-id="e6f00-135">An app can request these permissions by specifying the scopes in requests to the v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="e6f00-136">Scopes OpenID Connect</span><span class="sxs-lookup"><span data-stu-id="e6f00-136">OpenID Connect scopes</span></span>
<span data-ttu-id="e6f00-137">Het v2.0-implementatie van OpenID Connect, is enkele goed gedefinieerde bereiken die niet van toepassing op een specifieke bron: `openid`, `email`, `profile`, en `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="e6f00-137">The v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply to a specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="e6f00-138">openid</span><span class="sxs-lookup"><span data-stu-id="e6f00-138">openid</span></span>
<span data-ttu-id="e6f00-139">Als een app aanmelden met behulp van uitvoert [OpenID Connect](active-directory-v2-protocols.md), verzoekt zij de `openid` bereik.</span><span class="sxs-lookup"><span data-stu-id="e6f00-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request the `openid` scope.</span></span> <span data-ttu-id="e6f00-140">De `openid` bereik ziet op de pagina werken account toestemming als de machtiging 'Aanmelden' en op persoonlijke Microsoft-account toestemming pagina als de machtiging 'Uw profiel weergeven en verbinding maken met apps en services met behulp van uw Microsoft-account'.</span><span class="sxs-lookup"><span data-stu-id="e6f00-140">The `openid` scope shows on the work account consent page as the "Sign you in" permission, and on the personal Microsoft account consent page as the "View your profile and connect to apps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="e6f00-141">Met deze machtiging een app een unieke id voor de gebruiker kan ontvangen in de vorm van de `sub` claim.</span><span class="sxs-lookup"><span data-stu-id="e6f00-141">With this permission, an app can receive a unique identifier for the user in the form of the `sub` claim.</span></span> <span data-ttu-id="e6f00-142">Het biedt ook de apptoegang naar het eindpunt van gebruikersgegevens.</span><span class="sxs-lookup"><span data-stu-id="e6f00-142">It also gives the app access to the UserInfo endpoint.</span></span> <span data-ttu-id="e6f00-143">De `openid` bereik kan worden gebruikt bij het v2.0-eindpunt voor het token ID-tokens kunnen worden gebruikt voor het beveiligen van HTTP-aanroepen tussen de verschillende onderdelen van een app te verkrijgen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-143">The `openid` scope can be used at the v2.0 token endpoint to acquire ID tokens, which can be used to secure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="e6f00-144">E-mail</span><span class="sxs-lookup"><span data-stu-id="e6f00-144">email</span></span>
<span data-ttu-id="e6f00-145">De `email` bereik kan worden gebruikt met de `openid` bereik en alle andere.</span><span class="sxs-lookup"><span data-stu-id="e6f00-145">The `email` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="e6f00-146">Dit geeft de apptoegang tot de primaire e-mailadres van de gebruiker in de vorm van de `email` claim.</span><span class="sxs-lookup"><span data-stu-id="e6f00-146">It gives the app access to the user's primary email address in the form of the `email` claim.</span></span> <span data-ttu-id="e6f00-147">De `email` claim is opgenomen in een token alleen als een e-mailadres gekoppeld aan het gebruikersaccount is, is het niet altijd het geval is.</span><span class="sxs-lookup"><span data-stu-id="e6f00-147">The `email` claim is included in a token only if an email address is associated with the user account, which is not always the case.</span></span> <span data-ttu-id="e6f00-148">Als deze gebruikmaakt van de `email` bereik, uw app moet worden voorbereid voor het afhandelen van een aanvraag waarin de `email` claim bestaat niet in het token.</span><span class="sxs-lookup"><span data-stu-id="e6f00-148">If it uses the `email` scope, your app should be prepared to handle a case in which the `email` claim does not exist in the token.</span></span>

### <a name="profile"></a><span data-ttu-id="e6f00-149">Profiel</span><span class="sxs-lookup"><span data-stu-id="e6f00-149">profile</span></span>
<span data-ttu-id="e6f00-150">De `profile` bereik kan worden gebruikt met de `openid` bereik en alle andere.</span><span class="sxs-lookup"><span data-stu-id="e6f00-150">The `profile` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="e6f00-151">Dit geeft de apptoegang tot een aanzienlijke hoeveelheid informatie over de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="e6f00-151">It gives the app access to a substantial amount of information about the user.</span></span> <span data-ttu-id="e6f00-152">De toegang tot gegevens bevat, maar is niet beperkt tot de opgegeven naam van de gebruiker, achternaam, voorkeur gebruikersnaam en object-ID.</span><span class="sxs-lookup"><span data-stu-id="e6f00-152">The information it can access includes, but is not limited to, the user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="e6f00-153">Zie voor een volledige lijst van het profiel claims die beschikbaar zijn in de parameter id_tokens voor een specifieke gebruiker, de [v2.0 tokens verwijzing](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="e6f00-153">For a complete list of the profile claims available in the id_tokens parameter for a specific user, see the [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="e6f00-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="e6f00-154">offline_access</span></span>
<span data-ttu-id="e6f00-155">De [ `offline_access` bereik](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) geeft van uw apptoegang tot bronnen namens de gebruiker voor een langere periode.</span><span class="sxs-lookup"><span data-stu-id="e6f00-155">The [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access to resources on behalf of the user for an extended time.</span></span> <span data-ttu-id="e6f00-156">Op de pagina werken account toestemming weergegeven dit bereik als de machtiging 'Toegang tot uw gegevens op elk gewenst moment'.</span><span class="sxs-lookup"><span data-stu-id="e6f00-156">On the work account consent page, this scope appears as the "Access your data anytime" permission.</span></span> <span data-ttu-id="e6f00-157">Deze weergegeven op de persoonlijke Microsoft-account toestemming pagina als de machtiging 'Altijd toegang tot je gegevens'.</span><span class="sxs-lookup"><span data-stu-id="e6f00-157">On the personal Microsoft account consent page, it appears as the "Access your info anytime" permission.</span></span> <span data-ttu-id="e6f00-158">Wanneer een gebruiker keurt de `offline_access` bereik, uw app vernieuwen van tokens van het token v2.0-eindpunt kunt ontvangen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-158">When a user approves the `offline_access` scope, your app can receive refresh tokens from the v2.0 token endpoint.</span></span> <span data-ttu-id="e6f00-159">Vernieuwen van tokens zijn lange levensduur hebben.</span><span class="sxs-lookup"><span data-stu-id="e6f00-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="e6f00-160">Uw app kan nieuwe toegangstokens ophalen wanneer oudere zijn verlopen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="e6f00-161">Als uw app vraagt niet om de `offline_access` bereik, het ontvangt geen vernieuwen van tokens.</span><span class="sxs-lookup"><span data-stu-id="e6f00-161">If your app does not request the `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="e6f00-162">Dit betekent dat wanneer u een autorisatiecode in inwisselen de [OAuth 2.0-autorisatiecodestroom](active-directory-v2-protocols.md), ontvangt u een toegangstoken van de `/token` eindpunt.</span><span class="sxs-lookup"><span data-stu-id="e6f00-162">This means that when you redeem an authorization code in the [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from the `/token` endpoint.</span></span> <span data-ttu-id="e6f00-163">Het toegangstoken is geldig voor een korte periode.</span><span class="sxs-lookup"><span data-stu-id="e6f00-163">The access token is valid for a short time.</span></span> <span data-ttu-id="e6f00-164">Het toegangstoken verloopt meestal binnen een uur.</span><span class="sxs-lookup"><span data-stu-id="e6f00-164">The access token usually expires in one hour.</span></span> <span data-ttu-id="e6f00-165">Back-AT dat punt, uw app moet de gebruiker wordt omgeleid naar de `/authorize` eindpunt moet een nieuwe autorisatie-code.</span><span class="sxs-lookup"><span data-stu-id="e6f00-165">At that point, your app needs to redirect the user back to the `/authorize` endpoint to get a new authorization code.</span></span> <span data-ttu-id="e6f00-166">Tijdens deze omleiding, afhankelijk van het type app, de gebruiker mogelijk hun referenties opnieuw invoeren of opnieuw instemming met machtigingen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-166">During this redirect, depending on the type of app, the user might need to enter their credentials again or consent again to permissions.</span></span>

<span data-ttu-id="e6f00-167">Zie voor meer informatie over het vernieuwen van tokens gebruiken de [v2.0 protocolnaslaginformatie](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="e6f00-167">For more information about how to get and use refresh tokens, see the [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="e6f00-168">Afzonderlijke gebruikers toestemming wordt gevraagd</span><span class="sxs-lookup"><span data-stu-id="e6f00-168">Requesting individual user consent</span></span>
<span data-ttu-id="e6f00-169">In een [OpenID Connect of OAuth 2.0](active-directory-v2-protocols.md) autorisatie aanvraagt, een app kan aanvragen de machtigingen die nodig is met behulp van de `scope` queryparameter.</span><span class="sxs-lookup"><span data-stu-id="e6f00-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request the permissions it needs by using the `scope` query parameter.</span></span> <span data-ttu-id="e6f00-170">Bijvoorbeeld, wanneer een gebruiker zich aanmeldt bij een app, de app stuurt een aanvraag, zoals in het volgende voorbeeld (met regeleinden toegevoegd voor de leesbaarheid):</span><span class="sxs-lookup"><span data-stu-id="e6f00-170">For example, when a user signs in to an app, the app sends a request like the following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="e6f00-171">De `scope` parameter is een door spaties gescheiden lijst van bereiken die de app aanvraagt.</span><span class="sxs-lookup"><span data-stu-id="e6f00-171">The `scope` parameter is a space-separated list of scopes that the app is requesting.</span></span> <span data-ttu-id="e6f00-172">Elke scope wordt aangegeven door de bereikwaarde van de resource-id (de toepassing-ID-URI) toe te voegen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-172">Each scope is indicated by appending the scope value to the resource's identifier (the Application ID URI).</span></span> <span data-ttu-id="e6f00-173">De app moet in het voorbeeld aanvraag machtiging voor het lezen van de gebruiker agenda en mail verzenden als de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="e6f00-173">In the request example, the app needs permission to read the user's calendar and send mail as the user.</span></span>

<span data-ttu-id="e6f00-174">Nadat de gebruiker hun referenties invoert, het v2.0-eindpunt controleert of een overeenkomende record van *toestemming van de gebruiker*.</span><span class="sxs-lookup"><span data-stu-id="e6f00-174">After the user enters their credentials, the v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="e6f00-175">Als de gebruiker niet aan een van de aangevraagde machtigingen in het verleden heeft ingestemd, wordt de gebruiker om de vereiste machtigingen te verlenen gevraagd in het v2.0-eindpunt.</span><span class="sxs-lookup"><span data-stu-id="e6f00-175">If the user has not consented to any of the requested permissions in the past, the v2.0 endpoint asks the user to grant the requested permissions.</span></span>

![Account toestemming werken](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="e6f00-177">Wanneer de gebruiker de machtiging goedkeurt, wordt de toestemming vastgelegd zodat de gebruiker om toestemming opnieuw op de volgende accountaanmeldingen niet heeft.</span><span class="sxs-lookup"><span data-stu-id="e6f00-177">When the user approves the permission, the consent is recorded so that the user doesn't have to consent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="e6f00-178">Toestemming voor een volledige-tenant aanvragen</span><span class="sxs-lookup"><span data-stu-id="e6f00-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="e6f00-179">Vaak als een organisatie een licentie of abonnement voor een toepassing koopt, wil de organisatie volledig inrichten van de toepassing voor de werknemers.</span><span class="sxs-lookup"><span data-stu-id="e6f00-179">Often, when an organization purchases a license or subscription for an application, the organization wants to fully provision the application for its employees.</span></span> <span data-ttu-id="e6f00-180">Als onderdeel van dit proces kan een beheerder toestemming voor de toepassing te handelen namens een werknemer verlenen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-180">As part of this process, an administrator can grant consent for the application to act on behalf of any employee.</span></span> <span data-ttu-id="e6f00-181">Als de beheerder toestemming voor de hele tenant verleent, kan de werknemers van de organisatie een pagina toestemming voor de toepassing niet zien.</span><span class="sxs-lookup"><span data-stu-id="e6f00-181">If the admin grants consent for the entire tenant, the organization's employees won't see a consent page for the application.</span></span>

<span data-ttu-id="e6f00-182">Uw app kunt om aan te vragen van toestemming voor alle gebruikers in een tenant, het eindpunt beheerder toestemming.</span><span class="sxs-lookup"><span data-stu-id="e6f00-182">To request consent for all users in a tenant, your app can use the admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="e6f00-183">Scopes administrator beperkt</span><span class="sxs-lookup"><span data-stu-id="e6f00-183">Admin-restricted scopes</span></span>
<span data-ttu-id="e6f00-184">Sommige hoge privileges machtigingen in het Microsoft-ecosysteem kunnen worden ingesteld op *administrator beperkt*.</span><span class="sxs-lookup"><span data-stu-id="e6f00-184">Some high-privilege permissions in the Microsoft ecosystem can be set to *admin-restricted*.</span></span> <span data-ttu-id="e6f00-185">Voorbeelden van dergelijke bereiken zijn de volgende machtigingen:</span><span class="sxs-lookup"><span data-stu-id="e6f00-185">Examples of these kinds of scopes include the following permissions:</span></span>

* <span data-ttu-id="e6f00-186">Directory-gegevens voor een organisatie worden gelezen door`Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="e6f00-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="e6f00-187">Gegevens schrijven naar de map van een organisatie met behulp van`Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="e6f00-187">Write data to an organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="e6f00-188">Beveiligingsgroepen in de map van een organisatie worden gelezen door`Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="e6f00-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="e6f00-189">Hoewel een gebruiker consumenten mogelijk een App toegang tot dit soort gegevens verlenen, worden organisatie gebruikers beperkt in het verlenen van toegang tot dezelfde set van gevoelige bedrijfsgegevens.</span><span class="sxs-lookup"><span data-stu-id="e6f00-189">Although a consumer user might grant an application access to this kind of data, organizational users are restricted from granting access to the same set of sensitive company data.</span></span> <span data-ttu-id="e6f00-190">Als uw toepassing toegang naar een van deze machtigingen van een organisatie-gebruiker vraagt, ontvangt de gebruiker een foutbericht dat ze niet gemachtigd om toestemming aan uw app-machtigingen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-190">If your application requests access to one of these permissions from an organizational user, the user receives an error message that says they are not authorized to consent to your app's permissions.</span></span>

<span data-ttu-id="e6f00-191">Als uw app toegang tot bereiken voor organisaties administrator beperkt vereist, moet u aanvragen ze rechtstreeks vanuit de bedrijfsbeheerder van een, ook met behulp van het eindpunt beheerder toestemming, hieronder wordt beschreven.</span><span class="sxs-lookup"><span data-stu-id="e6f00-191">If your app requires access to admin-restricted scopes for organizations, you should request them directly from a company administrator, also by using the admin consent endpoint, described next.</span></span>

<span data-ttu-id="e6f00-192">Wanneer een beheerder deze machtigingen via het eindpunt beheerder toestemming verleent, wordt toestemming verleend voor alle gebruikers in de tenant.</span><span class="sxs-lookup"><span data-stu-id="e6f00-192">When an administrator grants these permissions via the admin consent endpoint, consent is granted for all users in the tenant.</span></span>

## <a name="using-the-admin-consent-endpoint"></a><span data-ttu-id="e6f00-193">Met behulp van het eindpunt beheerder toestemming</span><span class="sxs-lookup"><span data-stu-id="e6f00-193">Using the admin consent endpoint</span></span>
<span data-ttu-id="e6f00-194">Als u deze stappen hebt uitgevoerd, kan uw app-machtigingen voor alle gebruikers in een tenant, met inbegrip van de administrator beperkt scopes verzamelen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="e6f00-195">Zie voor een voorbeeld van code die de stappen implementeert de [administrator beperkt scopes voorbeeld](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="e6f00-195">To see a code sample that implements the steps, see the [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-the-permissions-in-the-app-registration-portal"></a><span data-ttu-id="e6f00-196">De machtigingen in de app-portal voor registratie van aanvragen</span><span class="sxs-lookup"><span data-stu-id="e6f00-196">Request the permissions in the app registration portal</span></span>
1. <span data-ttu-id="e6f00-197">Ga naar uw toepassing in de [toepassing Registratieportal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), of [maken van een app](active-directory-v2-app-registration.md) als u dat nog niet gedaan hebt.</span><span class="sxs-lookup"><span data-stu-id="e6f00-197">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="e6f00-198">Zoek de **Microsoft Graph machtigingen** sectie en voeg vervolgens de machtigingen die vereist dat uw app.</span><span class="sxs-lookup"><span data-stu-id="e6f00-198">Locate the **Microsoft Graph Permissions** section, and then add the permissions that your app requires.</span></span>
3. <span data-ttu-id="e6f00-199">Zorg ervoor dat u **opslaan** de registratie van de app.</span><span class="sxs-lookup"><span data-stu-id="e6f00-199">Make sure you **Save** the app registration.</span></span>

### <a name="recommended-sign-the-user-in-to-your-app"></a><span data-ttu-id="e6f00-200">Aanbevolen: De gebruiker zich aanmeldt bij uw app</span><span class="sxs-lookup"><span data-stu-id="e6f00-200">Recommended: Sign the user in to your app</span></span>
<span data-ttu-id="e6f00-201">Als u een toepassing die gebruikmaakt van het eindpunt beheerder toestemming bouwen, moet de app normaal gesproken een pagina of weergave waarin de beheerder van de app-machtigingen kan goedkeuren.</span><span class="sxs-lookup"><span data-stu-id="e6f00-201">Typically, when you build an application that uses the admin consent endpoint, the app needs a page or view in which the admin can approve the app's permissions.</span></span> <span data-ttu-id="e6f00-202">Deze pagina kan deel uitmaken van de app aanmelden stroom deel uit van de instellingen van de app of een specifieke stroom van "connect".</span><span class="sxs-lookup"><span data-stu-id="e6f00-202">This page can be part of the app's sign-up flow, part of the app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="e6f00-203">In veel gevallen is het zinvol voor de app weer te geven 'verbinding' weergave pas nadat een gebruiker is aangemeld met een werk- of school Microsoft-account.</span><span class="sxs-lookup"><span data-stu-id="e6f00-203">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="e6f00-204">Wanneer u de gebruiker zich aanmeldt bij uw app, kunt u de organisatie die de beheerder behoort voordat het verzoek om de benodigde machtigingen goedkeuren identificeren.</span><span class="sxs-lookup"><span data-stu-id="e6f00-204">When you sign the user in to your app, you can identify the organization to which the admin belongs before asking them to approve the necessary permissions.</span></span> <span data-ttu-id="e6f00-205">Hoewel niet strikt noodzakelijk is, kunt u u bij het maken van een intuïtieve ervaring voor gebruikers van uw organisatie.</span><span class="sxs-lookup"><span data-stu-id="e6f00-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="e6f00-206">De gebruiker in ondertekenen, volgt u onze [v2.0 protocol zelfstudies](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="e6f00-206">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-the-permissions-from-a-directory-admin"></a><span data-ttu-id="e6f00-207">De machtigingen aanvragen bij een directory-beheerder</span><span class="sxs-lookup"><span data-stu-id="e6f00-207">Request the permissions from a directory admin</span></span>
<span data-ttu-id="e6f00-208">Wanneer u klaar bent om machtigingen van de beheerder van uw organisatie, kunt u de gebruiker omgeleid naar het v2.0 *toestemming beheereindpunt*.</span><span class="sxs-lookup"><span data-stu-id="e6f00-208">When you're ready to request permissions from your organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting the below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="e6f00-209">Parameter</span><span class="sxs-lookup"><span data-stu-id="e6f00-209">Parameter</span></span> | <span data-ttu-id="e6f00-210">Voorwaarde</span><span class="sxs-lookup"><span data-stu-id="e6f00-210">Condition</span></span> | <span data-ttu-id="e6f00-211">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="e6f00-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e6f00-212">Tenant</span><span class="sxs-lookup"><span data-stu-id="e6f00-212">tenant</span></span> |<span data-ttu-id="e6f00-213">Vereist</span><span class="sxs-lookup"><span data-stu-id="e6f00-213">Required</span></span> |<span data-ttu-id="e6f00-214">De directory-tenant die u wilt machtiging van aanvragen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-214">The directory tenant that you want to request permission from.</span></span> <span data-ttu-id="e6f00-215">Kan worden opgegeven in de beschrijvende naam van de indeling of GUID.</span><span class="sxs-lookup"><span data-stu-id="e6f00-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="e6f00-216">client_id</span><span class="sxs-lookup"><span data-stu-id="e6f00-216">client_id</span></span> |<span data-ttu-id="e6f00-217">Vereist</span><span class="sxs-lookup"><span data-stu-id="e6f00-217">Required</span></span> |<span data-ttu-id="e6f00-218">De aanvraag-ID die de [Registratieportal toepassing](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) toegewezen aan uw app.</span><span class="sxs-lookup"><span data-stu-id="e6f00-218">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="e6f00-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="e6f00-219">redirect_uri</span></span> |<span data-ttu-id="e6f00-220">Vereist</span><span class="sxs-lookup"><span data-stu-id="e6f00-220">Required</span></span> |<span data-ttu-id="e6f00-221">De omleidings-URI waar u het antwoord moet worden verzonden voor uw app om af te handelen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-221">The redirect URI where you want the response to be sent for your app to handle.</span></span> <span data-ttu-id="e6f00-222">Deze moet exact overeenkomen met een van de omleidings-URI's die u hebt geregistreerd in de portal van de registratie van de app.</span><span class="sxs-lookup"><span data-stu-id="e6f00-222">It must exactly match one of the redirect URIs that you registered in the app registration portal.</span></span> |
| <span data-ttu-id="e6f00-223">state</span><span class="sxs-lookup"><span data-stu-id="e6f00-223">state</span></span> |<span data-ttu-id="e6f00-224">Aanbevolen</span><span class="sxs-lookup"><span data-stu-id="e6f00-224">Recommended</span></span> |<span data-ttu-id="e6f00-225">Een waarde die is opgenomen in de aanvraag die ook in het token antwoord worden geretourneerd.</span><span class="sxs-lookup"><span data-stu-id="e6f00-225">A value included in the request that will also be returned in the token response.</span></span> <span data-ttu-id="e6f00-226">Een tekenreeks van alle inhoud die u wilt dat kan zijn.</span><span class="sxs-lookup"><span data-stu-id="e6f00-226">It can be a string of any content you want.</span></span> <span data-ttu-id="e6f00-227">Gebruik de status voor het coderen van informatie over de status van de gebruiker in de app voordat het verificatieverzoek opgetreden, zoals de pagina of de weergave op.</span><span class="sxs-lookup"><span data-stu-id="e6f00-227">Use the state to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

<span data-ttu-id="e6f00-228">Azure AD vereist op dit moment een tenantbeheerder aan te melden bij de aanvraag niet voltooien.</span><span class="sxs-lookup"><span data-stu-id="e6f00-228">At this point, Azure AD requires a tenant administrator to sign in to complete the request.</span></span> <span data-ttu-id="e6f00-229">De beheerder wordt gevraagd om het goedkeuren van alle machtigingen die u hebt aangevraagd voor uw app in de app-portal voor wachtwoordregistratie.</span><span class="sxs-lookup"><span data-stu-id="e6f00-229">The administrator is asked to approve all the permissions that you have requested for your app in the app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="e6f00-230">Geslaagde reactie</span><span class="sxs-lookup"><span data-stu-id="e6f00-230">Successful response</span></span>
<span data-ttu-id="e6f00-231">Als de beheerder heeft de machtigingen voor uw app goedgekeurd, is geslaagd antwoord ziet er als volgt:</span><span class="sxs-lookup"><span data-stu-id="e6f00-231">If the admin approves the permissions for your app, the successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="e6f00-232">Parameter</span><span class="sxs-lookup"><span data-stu-id="e6f00-232">Parameter</span></span> | <span data-ttu-id="e6f00-233">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="e6f00-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e6f00-234">Tenant</span><span class="sxs-lookup"><span data-stu-id="e6f00-234">tenant</span></span> |<span data-ttu-id="e6f00-235">De directory-tenant die uw toepassing, de machtigingen aangevraagd, in GUID-indeling.</span><span class="sxs-lookup"><span data-stu-id="e6f00-235">The directory tenant that granted your application the permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="e6f00-236">state</span><span class="sxs-lookup"><span data-stu-id="e6f00-236">state</span></span> |<span data-ttu-id="e6f00-237">Een waarde die is opgenomen in de aanvraag die ook in het token antwoord worden geretourneerd.</span><span class="sxs-lookup"><span data-stu-id="e6f00-237">A value included in the request that also will be returned in the token response.</span></span> <span data-ttu-id="e6f00-238">Een tekenreeks van alle inhoud die u wilt dat kan zijn.</span><span class="sxs-lookup"><span data-stu-id="e6f00-238">It can be a string of any content you want.</span></span> <span data-ttu-id="e6f00-239">De status wordt gebruikt voor het coderen van informatie over de status van de gebruiker in de app voordat het verificatieverzoek opgetreden, zoals de pagina of de weergave op.</span><span class="sxs-lookup"><span data-stu-id="e6f00-239">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="e6f00-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="e6f00-240">admin_consent</span></span> |<span data-ttu-id="e6f00-241">Worden ingesteld op **true**.</span><span class="sxs-lookup"><span data-stu-id="e6f00-241">Will be set to **true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="e6f00-242">Foutbericht</span><span class="sxs-lookup"><span data-stu-id="e6f00-242">Error response</span></span>
<span data-ttu-id="e6f00-243">Als de beheerder worden de machtigingen voor uw app niet goedgekeurd, wordt de mislukte reactie als volgt weergegeven:</span><span class="sxs-lookup"><span data-stu-id="e6f00-243">If the admin does not approve the permissions for your app, the failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="e6f00-244">Parameter</span><span class="sxs-lookup"><span data-stu-id="e6f00-244">Parameter</span></span> | <span data-ttu-id="e6f00-245">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="e6f00-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e6f00-246">error</span><span class="sxs-lookup"><span data-stu-id="e6f00-246">error</span></span> |<span data-ttu-id="e6f00-247">Een tekenreeks van de fout code die kan worden gebruikt voor het classificeren van typen fouten die optreden en kan worden gebruikt om te reageren op fouten.</span><span class="sxs-lookup"><span data-stu-id="e6f00-247">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="e6f00-248">error_description</span><span class="sxs-lookup"><span data-stu-id="e6f00-248">error_description</span></span> |<span data-ttu-id="e6f00-249">Een specifiek foutbericht waarmee een ontwikkelaar kan identificeren de hoofdoorzaak van een fout.</span><span class="sxs-lookup"><span data-stu-id="e6f00-249">A specific error message that can help a developer identify the root cause of an error.</span></span> |

<span data-ttu-id="e6f00-250">Nadat u een geslaagde reactie van het eindpunt beheerder toestemming hebt ontvangen, hebben de machtigingen die zij gevraagd opgedaan met uw app.</span><span class="sxs-lookup"><span data-stu-id="e6f00-250">After you've received a successful response from the admin consent endpoint, your app has gained the permissions it requested.</span></span> <span data-ttu-id="e6f00-251">U kunt vervolgens een token voor de resource die u wilt aanvragen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-251">Next, you can request a token for the resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="e6f00-252">Met behulp van machtigingen</span><span class="sxs-lookup"><span data-stu-id="e6f00-252">Using permissions</span></span>
<span data-ttu-id="e6f00-253">Nadat de gebruiker akkoord aan machtigingen voor uw app gaat, kan uw app toegangstokens met daarin uw app-machtiging voor toegang tot een resource in sommige capaciteit verkrijgen.</span><span class="sxs-lookup"><span data-stu-id="e6f00-253">After the user consents to permissions for your app, your app can acquire access tokens that represent your app's permission to access a resource in some capacity.</span></span> <span data-ttu-id="e6f00-254">Een toegangstoken kan alleen worden gebruikt voor één resource, maar elke machtiging die uw app is verleend voor die bron gecodeerd binnen het toegangstoken is.</span><span class="sxs-lookup"><span data-stu-id="e6f00-254">An access token can be used only for a single resource, but encoded inside the access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="e6f00-255">Als u wilt een toegangstoken aanschaft, kunt uw app een aanvraag aanbrengen in v2.0 eindpunt van het token, als volgt:</span><span class="sxs-lookup"><span data-stu-id="e6f00-255">To acquire an access token, your app can make a request to the v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="e6f00-256">U kunt het resulterende toegangstoken in HTTP-aanvragen naar de resource.</span><span class="sxs-lookup"><span data-stu-id="e6f00-256">You can use the resulting access token in HTTP requests to the resource.</span></span> <span data-ttu-id="e6f00-257">Deze geeft betrouwbaar u aan de resource dat uw app in de juiste machtigingen voor het uitvoeren van een specifieke taak heeft.</span><span class="sxs-lookup"><span data-stu-id="e6f00-257">It reliably indicates to the resource that your app has the proper permission to perform a specific task.</span></span>  

<span data-ttu-id="e6f00-258">Zie voor meer informatie over het OAuth 2.0-protocol en het ophalen van de toegangstokens de [v2.0 protocol eindpuntreferentie](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="e6f00-258">For more information about the OAuth 2.0 protocol and how to get access tokens, see the [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>
