---
title: aaaHow tooconfigure een toepassingsproxy toepassing toouse Kerberos-beperkte overdracht | Microsoft Docs
description: Hoe tooconfigure Kerberos-beperkte overdracht voor een Azure AD-toepassingsproxy-toepassing.
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="c36cb-103">Hoe tooconfigure een toepassingsproxy toepassing toouse Kerberos-beperkte overdracht</span><span class="sxs-lookup"><span data-stu-id="c36cb-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="c36cb-104">Hallo methoden die beschikbaar zijn voor het bereiken van toepassingen enigszins van de toepassing tooapplication en een van de Hallo-opties afwijken kunnen die Azure-toepassingsproxy rechts out of box hello, biedt eenmalige aanmelding-toopublished is Kerberos-beperkt delegatie (KCD).</span><span class="sxs-lookup"><span data-stu-id="c36cb-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="c36cb-105">Dit is waarbij een host connector geconfigureerde tooperform beperkte kerberos-verificatie toobackend toepassingen, namens gebruikers.</span><span class="sxs-lookup"><span data-stu-id="c36cb-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="c36cb-106">Hallo werkelijke procedure voor het inschakelen van KCD is betrekkelijk eenvoudig en is doorgaans niet meer dan een algemeen begrip van Hallo verschillende onderdelen en authenticatiestroom voor eenmalige aanmelding.</span><span class="sxs-lookup"><span data-stu-id="c36cb-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="c36cb-107">Zoeken goede bronnen van informatie toohelp oplossen scenario's waarbij KCD SSO niet werkt zoals verwacht, kunnen worden verspreid.</span><span class="sxs-lookup"><span data-stu-id="c36cb-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="c36cb-108">In dit artikel probeert als zodanig tooprovide één punt van verwijzing die u helpen kan oplossen en zelf herstelt mogelijk enkele Hallo meest voorkomende problemen die we zien.</span><span class="sxs-lookup"><span data-stu-id="c36cb-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="c36cb-109">Op Hallo dezelfde tijd bieden aanvullende richtlijnen bij het vaststellen van Hallo complexer en moeilijkheden van implementatie.</span><span class="sxs-lookup"><span data-stu-id="c36cb-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="c36cb-110">Houd er rekening mee dat dit artikel wordt Hallo veronderstellingen te volgen:</span><span class="sxs-lookup"><span data-stu-id="c36cb-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="c36cb-111">Azure-toepassingsproxy is geïmplementeerd als per onze [documentatie](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) en algemene toegang toonon KCD toepassingen werkt zoals verwacht.</span><span class="sxs-lookup"><span data-stu-id="c36cb-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="c36cb-112">Hallo is gepubliceerde doeltoepassing gebaseerd op IIS en Microsoft implementatie van kerberos.</span><span class="sxs-lookup"><span data-stu-id="c36cb-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="c36cb-113">Hallo-hosts voor servers en toepassingen zich in één Active Directory-domein bevinden.</span><span class="sxs-lookup"><span data-stu-id="c36cb-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="c36cb-114">Gedetailleerde informatie over cross-domein en forest-scenario's vindt u in onze [KCD technisch document](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="c36cb-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="c36cb-115">Hallo onderwerp toepassing is gepubliceerd in een Azure-tenant met vooraf-verificatie ingeschakeld en gebruikers verwacht tooauthenticate tooAzure via formulieren gebaseerde verificatie.</span><span class="sxs-lookup"><span data-stu-id="c36cb-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="c36cb-116">Rich client verificatie scenario's worden niet behandeld in dit artikel wordt beschreven, maar op een bepaald moment in toekomstige Hallo worden toegevoegd.</span><span class="sxs-lookup"><span data-stu-id="c36cb-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="c36cb-117">Vereisten</span><span class="sxs-lookup"><span data-stu-id="c36cb-117">Prerequisites</span></span>

<span data-ttu-id="c36cb-118">Azure Application Proxy kan worden geïmplementeerd in vrijwel elk type infrastructuur of organisatie tooorganization omgeving en Hallo architecturen geen twijfel bestaat afwijken.</span><span class="sxs-lookup"><span data-stu-id="c36cb-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="c36cb-119">Een van de meest voorkomende oorzaken Hallo van KCD met betrekking tot problemen zijn niet Hallo omgevingen zelf, maar in plaats daarvan eenvoudige onjuiste configuraties of algemene toezicht.</span><span class="sxs-lookup"><span data-stu-id="c36cb-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="c36cb-120">Om deze reden onze advies is altijd toostart door ervoor te zorgen dat aan wordt voldaan aan vereisten van alle Hallo lay-out in onze main [KCD-SSO met Hallo toepassingsproxy artikel met behulp van](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) starten voor het oplossen van problemen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="c36cb-121">Met name Hallo sectie over het configureren van KCD op 2012R2, omdat dit een fundamenteel andere benadering tooconfiguring KCD in eerdere versies van Windows, maar houd ook rekening met verschillende andere overwegingen terwijl de veiligheidsmaatregelen:</span><span class="sxs-lookup"><span data-stu-id="c36cb-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="c36cb-122">Het is niet ongewoon is voor een domein lid server tooopen een beveiligd kanaal-dialoogvenster met een specifieke domeincontroller.</span><span class="sxs-lookup"><span data-stu-id="c36cb-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="c36cb-123">Verplaats tooanother dialoogvenster op elk gewenst connector hosts moeten dus over het algemeen niet beperkt toobeing kunnen toocommunicate met lokale site alleen specifieke DC's.</span><span class="sxs-lookup"><span data-stu-id="c36cb-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="c36cb-124">Vergelijkbare toohello boven punt tussen domeinen scenario's zijn afhankelijk van verwijzingen die rechtstreeks van een connector host tooDCs die zich buiten de lokale netwerkverbinding Hallo mogelijk bevinden.</span><span class="sxs-lookup"><span data-stu-id="c36cb-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="c36cb-125">In dit scenario is even belangrijk toomake zeker dat u toestaat dat verkeer en hoger ook tooDCs waarbij andere domeinen, anders overdracht mislukken.</span><span class="sxs-lookup"><span data-stu-id="c36cb-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="c36cb-126">Waar mogelijk, moet u niet alle actieve apparaten in de IP-Adressen/id's tussen connector hosts en de DC's, plaatsen wanneer deze soms via Tussenkomende worden en core RPC-verkeer verstoren</span><span class="sxs-lookup"><span data-stu-id="c36cb-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="c36cb-127">Zoveel willen we graag tooresolve problemen snel en efficiënt, enige tijd kan duren, dus waar mogelijk te probeer en delegering te testen in Hallo eenvoudigste scenario's.</span><span class="sxs-lookup"><span data-stu-id="c36cb-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="c36cb-128">Hallo meer variabelen die u introduceren, hello meer wellicht hebt u toocontend met.</span><span class="sxs-lookup"><span data-stu-id="c36cb-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="c36cb-129">Bijvoorbeeld: beperken van uw test tooa één connector bespaart kostbare tijd en aanvullende connectors kunnen worden toegevoegd nadat Hallo problemen zijn opgelost.</span><span class="sxs-lookup"><span data-stu-id="c36cb-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="c36cb-130">Sommige omgevingsfactoren kunnen ook een bijdrage leveren tooan probleem, dus opnieuw als mogelijk probeert en Hallo architectuur tooa bare minimum voor het testen minimaliseren.</span><span class="sxs-lookup"><span data-stu-id="c36cb-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="c36cb-131">Bijvoorbeeld, onjuist geconfigureerde interne firewall ACL's zijn niet ongewoon, dus indien mogelijk hebt u al het verkeer van een connector die rechtstreeks via toohello DC's en back-end-toepassing toegestaan.</span><span class="sxs-lookup"><span data-stu-id="c36cb-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="c36cb-132">Daadwerkelijk is Hallo absolute beste plaats tooposition connectors zo dicht tootheir doelen omdat kan zijn.</span><span class="sxs-lookup"><span data-stu-id="c36cb-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="c36cb-133">Met een firewall zat inline wordt aangeroepen terwijl er gewoon testen onnodige complexiteit toegevoegd en kan alleen verlengen van uw onderzoek.</span><span class="sxs-lookup"><span data-stu-id="c36cb-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="c36cb-134">Ja, wat wordt verstaan onder een probleem KCD toch?</span><span class="sxs-lookup"><span data-stu-id="c36cb-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="c36cb-135">Er verschillende klassieke aanduidingen van KCD SSO mislukken en Hallo eerste tekenen van een probleem wordt meestal manifest zelf in Hallo browser.</span><span class="sxs-lookup"><span data-stu-id="c36cb-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Onjuiste KCD configuratiefout](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Autorisatie is mislukt vanwege toomissing machtigingen](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="c36cb-138">alle die voorzien zijn dezelfde symptoom van tooperform SSO mislukt en als gevolg daarvan weigeren Hallo Hallo toohello toepassing van de gebruiker toegang.</span><span class="sxs-lookup"><span data-stu-id="c36cb-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="c36cb-139">Problemen oplossen</span><span class="sxs-lookup"><span data-stu-id="c36cb-139">Troubleshooting</span></span>

<span data-ttu-id="c36cb-140">Hoe u vervolgens oplossen, afhankelijk van Hallo probleem en symptomen waargenomen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="c36cb-141">Voordat u gaat verdere zou het is raadzaam Hallo koppelingen volgen als ze nuttige informatie die u niet nog afkomstig bevatten via zijn mogelijk:</span><span class="sxs-lookup"><span data-stu-id="c36cb-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="c36cb-142">Oplossen van problemen met toepassingsproxy en foutberichten</span><span class="sxs-lookup"><span data-stu-id="c36cb-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="c36cb-143">Kerberos-fouten en problemen</span><span class="sxs-lookup"><span data-stu-id="c36cb-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="c36cb-144">Werken met eenmalige aanmelding bij het on-premises en cloud identiteiten zijn niet identiek</span><span class="sxs-lookup"><span data-stu-id="c36cb-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="c36cb-145">Als u dit tot nu toe, en vervolgens hello belangrijkste hebt bestaat probleem definitief.</span><span class="sxs-lookup"><span data-stu-id="c36cb-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="c36cb-146">U moet toodig diepere, dus starten door te scheiden Hallo stroom in drie verschillende fasen die u kunt oplossen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="c36cb-147">**Clientverificatie vooraf van** -Hallo externe gebruiker verifiëren tooAzure via een browser.</span><span class="sxs-lookup"><span data-stu-id="c36cb-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="c36cb-148">Wordt kunnen toopre-verifiëren tooAzure is van cruciaal belang voor KCD SSO toofunction.</span><span class="sxs-lookup"><span data-stu-id="c36cb-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="c36cb-149">Dit moet worden getest en eerst opgelost als er problemen zijn.</span><span class="sxs-lookup"><span data-stu-id="c36cb-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="c36cb-150">Hallo verificatie vooraf fase heeft geen relatie tooKCD of Hallo gepubliceerde toepassing.</span><span class="sxs-lookup"><span data-stu-id="c36cb-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="c36cb-151">Deze moet relatief eenvoudig toocorrect afwijkingen door sanity controleren Hallo onderwerp account bestaat in Azure, en dat het niet is uitgeschakeld/geblokkeerd.</span><span class="sxs-lookup"><span data-stu-id="c36cb-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="c36cb-152">fout antwoord Hallo in browser Hallo is meestal beschrijvende toounderstand Hallo oorzaak.</span><span class="sxs-lookup"><span data-stu-id="c36cb-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="c36cb-153">Als u niet weet, kunt u ook onze andere problemen met docs tooverify controleren.</span><span class="sxs-lookup"><span data-stu-id="c36cb-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="c36cb-154">**Overdracht service** -connector voor toepassingsproxy van Azure ophalen van een kerberos-serviceticket uit een KDC (Kerberos Distribution Center) Hallo namens gebruikers.</span><span class="sxs-lookup"><span data-stu-id="c36cb-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="c36cb-155">externe communicatie tussen client hello en hello Azure-front-end Hallo moet geen gevolgen hebben voor KCD dan ook, andere dan ervoor zorgen dat deze werkt.</span><span class="sxs-lookup"><span data-stu-id="c36cb-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="c36cb-156">Dit is zodat hello Azure Proxy-service worden kan opgegeven met een geldige gebruikersnaam op die de gebruikte tooobtain een kerberos-ticket worden.</span><span class="sxs-lookup"><span data-stu-id="c36cb-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="c36cb-157">Zonder deze KCD niet mogelijk is en mislukken.</span><span class="sxs-lookup"><span data-stu-id="c36cb-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="c36cb-158">Zoals eerder vermeld, leveren Hallo browser foutberichten sommige goede aanwijzingen gewoonlijk op waarom de dingen zijn mislukt.</span><span class="sxs-lookup"><span data-stu-id="c36cb-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="c36cb-159">Zorg ervoor toonote Hallo activiteits-ID en de tijdstempel in antwoord Hallo als u dit kunt u toocorrelate Hallo gedrag tooactual gebeurtenissen in logboek hello Azure-Proxy.</span><span class="sxs-lookup"><span data-stu-id="c36cb-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Onjuiste KCD configuratiefout](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="c36cb-161">En Hallo overeenkomstige vermeldingen gebeurtenislogboek waargenomen Hallo zou worden gezien als gebeurtenissen 13019 of 12027.</span><span class="sxs-lookup"><span data-stu-id="c36cb-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="c36cb-162">U vindt Hallo connector gebeurtenislogboeken in **logboeken toepassingen en Services** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span><span class="sxs-lookup"><span data-stu-id="c36cb-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Gebeurtenis 13019 uit Application Proxy-gebeurtenislogboek](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![Gebeurtenis 12027 uit Application Proxy-gebeurtenislogboek](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="c36cb-165">Een A-record in uw interne DNS gebruiken voor het adres van de toepassing hello en niet een CName</span><span class="sxs-lookup"><span data-stu-id="c36cb-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="c36cb-166">Opnieuw controleren die Hallo-connector host Hallo rechten toodelegate toohello aangewezen doelaccount van SPN en dat is verleend **elk verificatieprotocol voor gebruiken** is geselecteerd.</span><span class="sxs-lookup"><span data-stu-id="c36cb-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="c36cb-167">Deze procedure wordt besproken in onze main [SSO configuratie artikel](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span><span class="sxs-lookup"><span data-stu-id="c36cb-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="c36cb-168">Controleer of er slechts één exemplaar van Hallo SPN-naam bestaat in AD door uitgifte van een **setspn - x** vanaf een opdrachtprompt op de host van een domein lid</span><span class="sxs-lookup"><span data-stu-id="c36cb-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="c36cb-169">Controleer toosee als een domeinbeleid wordt afgedwongen toolimit hello [de maximale grootte van kerberos-uitgegeven tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), zoals deze connector verhinderen Hallo van een token verkrijgen als toobe overmatige gevonden</span><span class="sxs-lookup"><span data-stu-id="c36cb-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="c36cb-170">Een nieuwe netwerktracering vastleggen Hallo kunnen worden uitgewisseld tussen Hallo-connector host en een domein KDC worden dan Hallo volgende aanbevolen stap bij het verkrijgen van meer laag niveau detail op Hallo problemen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="c36cb-171">U vindt dit in [diepgaand oplossen papier](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="c36cb-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="c36cb-172">Als tickets er goed uitziet, ziet u een gebeurtenis in het Hallo-logboeken met de mededeling dat de verificatie is mislukt vanwege een 401 retourneren toohello-toepassing.</span><span class="sxs-lookup"><span data-stu-id="c36cb-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="c36cb-173">Dit geeft doorgaans aan dat uw ticket weigeren Hallo-doeltoepassing, dus doorgaan met de Hallo na de volgende fase.</span><span class="sxs-lookup"><span data-stu-id="c36cb-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="c36cb-174">**Doeltoepassing** -Hallo consument van kerberos-ticket Hallo geleverd door het Hallo-connector</span><span class="sxs-lookup"><span data-stu-id="c36cb-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="c36cb-175">In deze fase Hallo connector verwachte toohave verzonden een kerberos-serviceticket toohello back-end, als een koptekst binnen de eerste toepassingsaanvraag Hallo.</span><span class="sxs-lookup"><span data-stu-id="c36cb-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="c36cb-176">Met behulp van de toepassing hello interne URL die is gedefinieerd in de portal Hallo valideren dat Hallo toepassing rechtstreeks vanuit de browser Hallo op Hallo-connector host toegankelijk is.</span><span class="sxs-lookup"><span data-stu-id="c36cb-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="c36cb-177">Vervolgens kunt u aanmelden met succes.</span><span class="sxs-lookup"><span data-stu-id="c36cb-177">Then you can login successfully.</span></span> <span data-ttu-id="c36cb-178">Meer informatie hierover vindt u op de pagina Hallo connector oplossen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="c36cb-179">Nog steeds op Hallo-connector host, bevestig dat Hallo-verificatie tussen de browser Hallo en toepassing hello gebruik van kerberos, op een van de volgende Hallo:</span><span class="sxs-lookup"><span data-stu-id="c36cb-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="c36cb-180">Dev-hulpprogramma's uitvoeren (**F12**) in Internet Explorer of gebruik [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) van Hallo-connector host.</span><span class="sxs-lookup"><span data-stu-id="c36cb-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="c36cb-181">Ga toohello toepassing met behulp van de interne URL Hallo, en inspecteren Hallo www-autorisatie-header geretourneerd in antwoord van de toepassing hello Hallo aangeboden, tooensure die ofwel onderhandelen of kerberos aanwezig is.</span><span class="sxs-lookup"><span data-stu-id="c36cb-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="c36cb-182">Een blob daaropvolgende kerberos geretourneerd in antwoord Hallo van Hallo browser toohello toepassing doorgaans begint met **YII**, zodat dit is een goede indicatie van kerberos in play.</span><span class="sxs-lookup"><span data-stu-id="c36cb-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="c36cb-183">NTLM op Hallo daarentegen altijd beginnen met **TlRMTVNTUAAB**, welke luidt NTLMSSP bij het decoderen van Base64.</span><span class="sxs-lookup"><span data-stu-id="c36cb-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="c36cb-184">Als u ziet **TlRMTVNTUAAB** aan het begin Hallo van Hallo blob, betekent dit dat Kerberos **niet** beschikbaar.</span><span class="sxs-lookup"><span data-stu-id="c36cb-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="c36cb-185">Als u dit niet ziet, is het Kerberos waarschijnlijk beschikbaar.</span><span class="sxs-lookup"><span data-stu-id="c36cb-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="c36cb-186">Houd er rekening mee als Fiddler, met deze methode vereist een uitgebreide beveiliging op de configuratie van de toepassing hello in IIS tijdelijk uit te schakelen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Venster van de controle van de browser](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="c36cb-188">*Afbeelding:* omdat deze niet met TIRMTVNTUAAB begint, dit is een voorbeeld is dat Kerberos beschikbaar is.</span><span class="sxs-lookup"><span data-stu-id="c36cb-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="c36cb-189">Dit is een voorbeeld van een Kerberos-Blob die niet met YII begint.</span><span class="sxs-lookup"><span data-stu-id="c36cb-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="c36cb-190">Tijdelijk NTLM uit de lijst met providers Hallo op IIS site en toegang tot app rechtstreeks van Internet Explorer op de host van de connector verwijderen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="c36cb-191">Met NTLM niet langer in de lijst met providers van hello moet u kunnen tooaccess Hallo toepassing alleen Kerberos gebruiken.</span><span class="sxs-lookup"><span data-stu-id="c36cb-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="c36cb-192">Als dit niet lukt, vervolgens die wijst erop dat er een probleem met de configuratie van de toepassing hello en Kerberos-verificatie niet werkt.</span><span class="sxs-lookup"><span data-stu-id="c36cb-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="c36cb-193">Als Kerberos niet beschikbaar is, is controle Hallo toepassing verificatie-instellingen in IIS toomake zeker te onderhandelen over bovenste met NTLM onder het vermeld.</span><span class="sxs-lookup"><span data-stu-id="c36cb-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="c36cb-194">(Geen Negotiate: kerberos of Negotiate: PKU2U).</span><span class="sxs-lookup"><span data-stu-id="c36cb-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="c36cb-195">Alleen doorgaan als Kerberos functioneel is.</span><span class="sxs-lookup"><span data-stu-id="c36cb-195">Only continue if Kerberos is functional.</span></span>

   ![Windows-verificatieproviders](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="c36cb-197">Met Kerberos en NTLM in plaats, kunt vooraf-verificatie voor de toepassing in de portal Hallo Hallo nu tijdelijk uitschakelen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="c36cb-198">Als u deze vanaf Hallo openen kunt Zie internet met behulp van de externe URL Hallo.</span><span class="sxs-lookup"><span data-stu-id="c36cb-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="c36cb-199">U moet na vragen aan gebruiker tooauthenticate en kunnen toodo moet dus Hello die dezelfde die wordt gebruikt in Hallo account vorige stap.</span><span class="sxs-lookup"><span data-stu-id="c36cb-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="c36cb-200">Als dat niet het geval is, wordt dit duidt op een probleem met de back-end-toepassing hello en niet KCD helemaal.</span><span class="sxs-lookup"><span data-stu-id="c36cb-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="c36cb-201">Nu opnieuw inschakelen van vooraf-verificatie in Hallo-portal en zich verifiëren via Azure door te proberen tooconnect toohello toepassing via de externe URL.</span><span class="sxs-lookup"><span data-stu-id="c36cb-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="c36cb-202">Als u eenmalige aanmelding is mislukt, ziet u een niet-toegestane foutbericht weergegeven in de browser hello, plus gebeurtenis 13022 in Hallo logboek:</span><span class="sxs-lookup"><span data-stu-id="c36cb-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="c36cb-203">*Microsoft AAD Application Proxy Connector kan geen Hallo gebruiker niet verifiëren omdat het back-endserver Hallo reageert tooKerberos verificatiepogingen met een 401 HTTP-fout.*</span><span class="sxs-lookup"><span data-stu-id="c36cb-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![HTTTP 401 fout is niet toegestaan](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="c36cb-205">Controleer Hallo IIS application tooensure Hallo geconfigureerd groep van toepassingen is geconfigureerd toouse Hallo hetzelfde account dat Hallo SPN is geconfigureerd op basis van AD, door te navigeren in IIS, zoals hieronder weergegeven</span><span class="sxs-lookup"><span data-stu-id="c36cb-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![Venster voor configuratie van IIS-toepassing](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="c36cb-207">Zodra u Hallo identiteit weet, uitgeven Hallo volgende vanaf een cmd vragen toomake of dat dit account definitief is geconfigureerd met Hallo SPN betrokken.</span><span class="sxs-lookup"><span data-stu-id="c36cb-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="c36cb-208">Bijvoorbeeld: **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="c36cb-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![SetSPN-opdrachtvenster](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="c36cb-210">Controleer dat SPN gedefinieerd aan de hand van de toepassing hello-instellingen in de portal Hallo is dezelfde SPN-naam die is geconfigureerd tegen Hallo doel AD-account wordt gebruikt door de groep van toepassingen van de toepassing hello Hallo Hallo</span><span class="sxs-lookup"><span data-stu-id="c36cb-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![SPN-configuratie in Azure Portal](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="c36cb-212">Ga naar de IIS- en selecteer Hallo **configuratie-Editor** optie voor de toepassing hello en te navigeren**system.webServer/security/authentication/windowsAuthentication** toomake ervoor dat **UseAppPoolCredentials** tootrue is ingesteld</span><span class="sxs-lookup"><span data-stu-id="c36cb-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![App-groepen van IIS-configuratie referentie-optie](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="c36cb-214">Terwijl nuttig zijn bij het verbeteren van de prestaties van Kerberos-bewerkingen hello, verlaten kernelmodus ingeschakeld veroorzaakt ook Hallo ticket voor Hallo service toobe ontsleuteld met behulp van computeraccount aangevraagd.</span><span class="sxs-lookup"><span data-stu-id="c36cb-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="c36cb-215">Dit is een afkorting Hallo lokaal systeem, dus met deze set tootrue onderbreking KCD wanneer de toepassing hello wordt gehost op meerdere servers in een farm.</span><span class="sxs-lookup"><span data-stu-id="c36cb-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="c36cb-216">Als een aanvullende controle wilt u wellicht ook toodisable hello **Extended** beveiliging te.</span><span class="sxs-lookup"><span data-stu-id="c36cb-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="c36cb-217">Er zijn aangetroffen scenario's waar dit is gebleken dat toobreak KCD wanneer ingeschakeld in zeer specifieke configuraties waarin een toepassing is gepubliceerd als een submap van Hallo standaardwebsite.</span><span class="sxs-lookup"><span data-stu-id="c36cb-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="c36cb-218">Deze zelf is geconfigureerd voor anonieme verificatie alleen gehele Hallo-dialoogvensters voorstellen onderliggende objecten wordt niet overgenomen actieve instellingen grijs verlaten.</span><span class="sxs-lookup"><span data-stu-id="c36cb-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="c36cb-219">Maar waar mogelijk zou altijd aan te raden dit ingeschakeld, dus in alle geval test, maar vergeet niet toorestore deze tooenabled.</span><span class="sxs-lookup"><span data-stu-id="c36cb-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="c36cb-220">Deze extra controles moeten hebben plaats in bijhouden toostart met behulp van de gepubliceerde toepassing.</span><span class="sxs-lookup"><span data-stu-id="c36cb-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="c36cb-221">Gaat u door en spin van aanvullende connectors die ook toodelegate geconfigureerd, maar als er dingen zijn niet verder vervolgens zou het is raadzaam het lezen van onze uitgebreidere technische scenario [Hallo volledige handleiding voor het oplossen van Azure AD-toepassing Proxy](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="c36cb-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="c36cb-222">Als u bent nog tooprogress uw probleem, ondersteuning zou niet langer zijn dan tevreden tooassist en gaan.</span><span class="sxs-lookup"><span data-stu-id="c36cb-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="c36cb-223">Maak een ondersteuningsticket rechtstreeks vanuit de portal Hallo en onze technici tooyou zal bereiken.</span><span class="sxs-lookup"><span data-stu-id="c36cb-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="c36cb-224">Andere scenario's</span><span class="sxs-lookup"><span data-stu-id="c36cb-224">Other scenarios</span></span>

-   <span data-ttu-id="c36cb-225">Een Kerberos-ticket aanvragen Azure toepassingsproxy voordat de aanvraag tooan toepassing worden verzonden.</span><span class="sxs-lookup"><span data-stu-id="c36cb-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="c36cb-226">Sommige 3e toepassingen van derden zoals Tableau Server niet tevreden bent met deze methode te verifiëren en in plaats daarvan verwacht Hallo meer conventionele onderhandelingen tootake plaatsen.</span><span class="sxs-lookup"><span data-stu-id="c36cb-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="c36cb-227">de eerste aanvraag Hallo is anonieme, zodat Hallo toepassing toorespond met Hallo verificatietypen dat het via een 401 ondersteunt.</span><span class="sxs-lookup"><span data-stu-id="c36cb-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="c36cb-228">Dubbele hop verificatie - meestal gebruikt in scenario's waarbij lagen van een toepassing, met een back-end als front-end, beide verificatie te vereisen, zoals SQL Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="c36cb-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c36cb-229">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="c36cb-229">Next steps</span></span>
[<span data-ttu-id="c36cb-230">Kerberos-beperkte delegatie (KCD) configureren op een beheerd domein</span><span class="sxs-lookup"><span data-stu-id="c36cb-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)
