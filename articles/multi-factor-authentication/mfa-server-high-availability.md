---
title: aaaConfigure Azure MFA-Server voor hoge beschikbaarheid | Microsoft Docs
description: Implementeer meerdere exemplaren van Azure multi-factor Authentication-Server in de configuraties die maximale beschikbaarheid.
services: multi-factor-authentication
keywords: Azure MFA
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/23/2017
ms.author: joflore
ms.reviewer: alexwe
ms.custom: it-pro
ms.openlocfilehash: 8c6b1921c734c7a7273e443b3591fbbb15cd5e6c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-for-high-availability"></a><span data-ttu-id="954c9-104">Azure multi-factor Authentication-Server configureren voor hoge beschikbaarheid</span><span class="sxs-lookup"><span data-stu-id="954c9-104">Configure Azure Multi-Factor Authentication Server for high availability</span></span>

<span data-ttu-id="954c9-105">tooachieve hoge beschikbaarheid met uw Azure-Server MFA-implementatie, moet u toodeploy meerdere MFA-servers.</span><span class="sxs-lookup"><span data-stu-id="954c9-105">tooachieve high-availability with your Azure Server MFA deployment, you need toodeploy multiple MFA servers.</span></span> <span data-ttu-id="954c9-106">Deze sectie bevat informatie over een tooachieve taakverdeling ontwerp uw doelen voor hoge beschikbaarheid in uw Azure MFS Server-implementatie.</span><span class="sxs-lookup"><span data-stu-id="954c9-106">This section provides information on a load-balanced design tooachieve your high availability targets in you Azure MFS Server deployment.</span></span>

## <a name="mfa-server-overview"></a><span data-ttu-id="954c9-107">Overzicht van de MFA-Server</span><span class="sxs-lookup"><span data-stu-id="954c9-107">MFA Server overview</span></span>

<span data-ttu-id="954c9-108">Hallo architectuur van de service Azure MFA-Server omvat diverse onderdelen, zoals wordt weergegeven in het volgende diagram Hallo:</span><span class="sxs-lookup"><span data-stu-id="954c9-108">hello Azure MFA Server service architecture comprises several components as shown in hello following diagram:</span></span>

 ![Architectuur van MFA-Server](./media/mfa-server-high-availability/mfa-ha-architecture.png)

<span data-ttu-id="954c9-110">Een MFA-Server is een Windows-Server die hello Azure multi-factor Authentication software is geïnstalleerd.</span><span class="sxs-lookup"><span data-stu-id="954c9-110">An MFA Server is a Windows Server that has hello Azure Multi-Factor Authentication software installed.</span></span> <span data-ttu-id="954c9-111">Hallo MFA-Server-exemplaar moet worden geactiveerd door Hallo MFA-Service in Azure toofunction.</span><span class="sxs-lookup"><span data-stu-id="954c9-111">hello MFA Server instance must be activated by hello MFA Service in Azure toofunction.</span></span> <span data-ttu-id="954c9-112">Meer dan één MFA-Server worden geïnstalleerd op lokale.</span><span class="sxs-lookup"><span data-stu-id="954c9-112">More than one MFA Server can be installed on-premises.</span></span>

<span data-ttu-id="954c9-113">Hallo eerste MFA-Server die is geïnstalleerd, is Hallo master MFA-Server bij de activering door hello Azure MFA-Service standaard.</span><span class="sxs-lookup"><span data-stu-id="954c9-113">hello first MFA Server that is installed is hello master MFA Server upon activation by hello Azure MFA Service by default.</span></span> <span data-ttu-id="954c9-114">Hallo master MFA-server heeft een beschrijfbare kopie van Hallo PhoneFactor.pfdata database.</span><span class="sxs-lookup"><span data-stu-id="954c9-114">hello master MFA server has a writeable copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="954c9-115">Volgende installaties van exemplaren van MFA-Server worden slaves genoemd.</span><span class="sxs-lookup"><span data-stu-id="954c9-115">Subsequent installations of instances of MFA Server are known as slaves.</span></span> <span data-ttu-id="954c9-116">Hallo MFA slaves hebben een gerepliceerde alleen-lezen kopie van Hallo PhoneFactor.pfdata database.</span><span class="sxs-lookup"><span data-stu-id="954c9-116">hello MFA slaves have a replicated read-only copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="954c9-117">MFA servers repliceren gegevens door middel van Remote Procedure Call (RPC).</span><span class="sxs-lookup"><span data-stu-id="954c9-117">MFA servers replicate information using Remote Procedure Call (RPC).</span></span> <span data-ttu-id="954c9-118">Alle servers van MFA moet gezamenlijk zijn verbonden met het domein of zelfstandige tooreplicate informatie.</span><span class="sxs-lookup"><span data-stu-id="954c9-118">All MFA Severs must collectively either be domain joined or standalone tooreplicate information.</span></span>

<span data-ttu-id="954c9-119">MFA master en slave MFA-Servers communiceren met Hallo MFA-Service wanneer tweeledige verificatie vereist is.</span><span class="sxs-lookup"><span data-stu-id="954c9-119">Both MFA master and slave MFA Servers communicate with hello MFA Service when two-factor authentication is required.</span></span> <span data-ttu-id="954c9-120">Bijvoorbeeld, wanneer een gebruiker toogain toegang tooan toepassing waarvoor tweeledige verificatie probeert, Hallo gebruiker eerst geverifieerd door een id-provider, zoals Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="954c9-120">For example, when a user attempts toogain access tooan application that requires two-factor authentication, hello user will first be authenticated by an identity provider, such as Active Directory (AD).</span></span>

<span data-ttu-id="954c9-121">Na een geslaagde authenticatie met AD Hallo MFA-Server communiceert met de Hallo MFA-Service.</span><span class="sxs-lookup"><span data-stu-id="954c9-121">After successful authentication with AD, hello MFA Server will communicate with hello MFA Service.</span></span> <span data-ttu-id="954c9-122">Hallo MFA-Server wacht op een melding van Hallo MFA-Service tooallow of weigeren van toegang Hallo-toohello gebruikerstoepassing.</span><span class="sxs-lookup"><span data-stu-id="954c9-122">hello MFA Server waits for notification from hello MFA Service tooallow or deny hello user access toohello application.</span></span>

<span data-ttu-id="954c9-123">Als master Hallo MFA-server offline gaat, verificaties nog steeds kunnen worden verwerkt, maar bewerkingen waarvoor wijzigingen toohello MFA database kunnen niet worden verwerkt.</span><span class="sxs-lookup"><span data-stu-id="954c9-123">If hello MFA master server goes offline, authentications can still be processed, but operations that require changes toohello MFA database cannot be processed.</span></span> <span data-ttu-id="954c9-124">(Voorbeelden zijn: het toevoegen van gebruikers, selfservice PINCODE wijzigen en het wijzigen van gebruikersgegevens Hallo)</span><span class="sxs-lookup"><span data-stu-id="954c9-124">(Examples include: hello addition of users, self-service PIN changes, and changing user information)</span></span>

## <a name="deployment"></a><span data-ttu-id="954c9-125">Implementatie</span><span class="sxs-lookup"><span data-stu-id="954c9-125">Deployment</span></span>

<span data-ttu-id="954c9-126">Houd rekening met Hallo belangrijke punten voor taakverdeling Azure MFA-Server en de bijbehorende onderdelen te volgen.</span><span class="sxs-lookup"><span data-stu-id="954c9-126">Consider hello following important points for load balancing Azure MFA Server and its related components.</span></span>

* <span data-ttu-id="954c9-127">**Met behulp van RADIUS-standaard tooachieve hoge beschikbaarheid**.</span><span class="sxs-lookup"><span data-stu-id="954c9-127">**Using RADIUS standard tooachieve high availability**.</span></span> <span data-ttu-id="954c9-128">Als u van Azure MFA-Servers als RADIUS-servers gebruikmaakt, kunt u mogelijk een MFA-Server configureren als een RADIUS-doel voor primaire verificatie en andere Azure MFA-Servers als secundaire verificatie doelen.</span><span class="sxs-lookup"><span data-stu-id="954c9-128">If you are using Azure MFA Servers as RADIUS servers, you can potentially configure one MFA Server as a primary RADIUS authentication target and other Azure MFA Servers as secondary authentication targets.</span></span> <span data-ttu-id="954c9-129">Deze methode tooachieve hoge beschikbaarheid kan echter niet zijn praktische omdat u wachten voor een periode toooccur time moet-verificatie is mislukt op de primaire verificatiedoel Hallo voordat u tegen Hallo secundaire verificatie kan worden geverifieerd het doel.</span><span class="sxs-lookup"><span data-stu-id="954c9-129">However, this method tooachieve high availability may not be practical because you must wait for a time-out period toooccur when authentication fails on hello primary authentication target before you can be authenticated against hello secondary authentication target.</span></span> <span data-ttu-id="954c9-130">Het is efficiënter tooload saldo Hallo RADIUS-verkeer tussen Hallo RADIUS-client en Hallo RADIUS-Servers (in dit geval hello Azure MFA-Servers die fungeren als RADIUS-servers) zodat u Hallo RADIUS-clients met één URL van een die ze configureren kunt naar kunnen verwijzen.</span><span class="sxs-lookup"><span data-stu-id="954c9-130">It is more efficient tooload balance hello RADIUS traffic between hello RADIUS client and hello RADIUS Servers (in this case, hello Azure MFA Servers acting as RADIUS servers) so that you can configure hello RADIUS clients with a single URL that they can point to.</span></span>
* <span data-ttu-id="954c9-131">**Moet promoveren toomanually MFA slaves**.</span><span class="sxs-lookup"><span data-stu-id="954c9-131">**Need toomanually promote MFA slaves**.</span></span> <span data-ttu-id="954c9-132">Hallo master Azure MFA-server offline gaat, blijven hello secundaire Servers van de Azure MFA tooprocess MFA aanvragen.</span><span class="sxs-lookup"><span data-stu-id="954c9-132">If hello master Azure MFA server goes offline, hello secondary Azure MFA Servers continue tooprocess MFA requests.</span></span> <span data-ttu-id="954c9-133">Echter totdat een master MFA-server beschikbaar is, beheerders kunnen geen gebruikers toevoegen of MFA-instellingen wijzigen en kunnen gebruikers niet met behulp van de gebruikersportal Hallo wijzigingen aanbrengen.</span><span class="sxs-lookup"><span data-stu-id="954c9-133">However, until a master MFA server is available, admins can not add users or modify MFA settings, and users can not make changes using hello user portal.</span></span> <span data-ttu-id="954c9-134">Promoveren van een MFA slave toohello master-functie is altijd een handmatig proces.</span><span class="sxs-lookup"><span data-stu-id="954c9-134">Promoting an MFA slave toohello master role is always a manual process.</span></span>
* <span data-ttu-id="954c9-135">**Afscheidbaarheid van onderdelen**.</span><span class="sxs-lookup"><span data-stu-id="954c9-135">**Separability of components**.</span></span> <span data-ttu-id="954c9-136">Azure MFA-Server bestaat uit verschillende onderdelen die kunnen worden geïnstalleerd op Hallo Hallo hetzelfde exemplaar van WindowsServer of op verschillende exemplaren.</span><span class="sxs-lookup"><span data-stu-id="954c9-136">hello Azure MFA Server comprises several components that can be installed on hello same Windows Server instance or on different instances.</span></span> <span data-ttu-id="954c9-137">Deze onderdelen zijn Hallo Gebruikersportal webservice voor mobiele App en Hallo AD FS-adapter (agent).</span><span class="sxs-lookup"><span data-stu-id="954c9-137">These components include hello User Portal, Mobile App Web Service, and hello ADFS adapter (agent).</span></span> <span data-ttu-id="954c9-138">Deze Afscheidbaarheid maakt het mogelijk toouse Hallo Web Application Proxy toopublish hello Gebruikersportal- en Mobile App Web Server uit het perimeternetwerk Hallo.</span><span class="sxs-lookup"><span data-stu-id="954c9-138">This separability makes it possible toouse hello Web Application Proxy toopublish hello User Portal and Mobile App Web Server from hello perimeter network.</span></span> <span data-ttu-id="954c9-139">Een dergelijke configuratie voegt toohello algehele beveiliging van uw ontwerp, zoals wordt weergegeven in het volgende diagram Hallo.</span><span class="sxs-lookup"><span data-stu-id="954c9-139">Such a configuration adds toohello overall security of your design, as shown in hello following diagram.</span></span> <span data-ttu-id="954c9-140">Hello MFA User Portal- en Mobile App Web Server kan ook worden geïmplementeerd in HA taakverdeling configuraties.</span><span class="sxs-lookup"><span data-stu-id="954c9-140">hello MFA User Portal and Mobile App Web Server may also be deployed in HA load-balanced configurations.</span></span>

   ![MFA-Server met een perimeternetwerk](./media/mfa-server-high-availability/mfasecurity.png)

* <span data-ttu-id="954c9-142">**Eenmalig wachtwoord (OTP) via SMS (aka eenzijdige SMS) vereist Hallo gebruik van een tijdelijke sessies als verkeer taakverdeling**.</span><span class="sxs-lookup"><span data-stu-id="954c9-142">**One-time password (OTP) over SMS (aka one-way SMS) requires hello use of sticky sessions if traffic is load-balanced**.</span></span> <span data-ttu-id="954c9-143">SMS in één richting is een verificatieoptie die ervoor zorgt dat Hallo MFA-Server toosend Hallo gebruikers een tekstbericht met een OTP.</span><span class="sxs-lookup"><span data-stu-id="954c9-143">One-way SMS is an authentication option that causes hello MFA Server toosend hello users a text message containing an OTP.</span></span> <span data-ttu-id="954c9-144">Hallo gebruiker voert Hallo OTP in een promptvenster toocomplete Hallo MFA uitdaging.</span><span class="sxs-lookup"><span data-stu-id="954c9-144">hello user enters hello OTP in a prompt window toocomplete hello MFA challenge.</span></span> <span data-ttu-id="954c9-145">Als u taakverdeling van Azure MFA-Servers, moet hello dezelfde server die de eerste authenticatie-aanvraag Hallo behandeld Hallo-server waarop OTP het Hallo-bericht van gebruiker Hallo ontvangen; Als een andere MFA-Server Hallo OTP antwoord ontvangt, wordt Hallo verificatievraag mislukt.</span><span class="sxs-lookup"><span data-stu-id="954c9-145">If you load balance Azure MFA Servers, hello same server that served hello initial authentication request must be hello server that receives hello OTP message from hello user; if another MFA Server receives hello OTP reply, hello authentication challenge fails.</span></span> <span data-ttu-id="954c9-146">Zie voor meer informatie [één keer wachtwoord via SMS toegevoegd tooAzure MFA-Server](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span><span class="sxs-lookup"><span data-stu-id="954c9-146">For more information, see [One Time Password over SMS Added tooAzure MFA Server](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span></span>
* <span data-ttu-id="954c9-147">**Taakverdeling implementaties van Hallo Gebruikersportal en de webservice voor mobiele App moet een tijdelijke sessies**.</span><span class="sxs-lookup"><span data-stu-id="954c9-147">**Load-Balanced deployments of hello User Portal and Mobile App Web Service require sticky sessions**.</span></span> <span data-ttu-id="954c9-148">Als u load balancing Hallo MFA User Portal en Hallo webservice voor mobiele App, elke sessie moet toostay op Hallo dezelfde server.</span><span class="sxs-lookup"><span data-stu-id="954c9-148">If you are load-balancing hello MFA User Portal and hello Mobile App Web Service, each session needs toostay on hello same server.</span></span>

## <a name="high-availability-deployment"></a><span data-ttu-id="954c9-149">Hoge beschikbaarheid-implementatie</span><span class="sxs-lookup"><span data-stu-id="954c9-149">High-availability deployment</span></span>

<span data-ttu-id="954c9-150">Hallo toont volgende diagram een volledige op HA taakverdeling implementatie van Azure MFA en de bijbehorende onderdelen, samen met ADFS ter referentie.</span><span class="sxs-lookup"><span data-stu-id="954c9-150">hello following diagram shows a complete HA load-balanced implementation of Azure MFA and its components, along with ADFS for reference.</span></span>

 ![Azure MFA-Server HA-implementatie](./media/mfa-server-high-availability/mfa-ha-deployment.png)

<span data-ttu-id="954c9-152">Houd er rekening mee Hallo volgende items voor Hallo navenant genummerd gebied Hallo voorgaande diagram.</span><span class="sxs-lookup"><span data-stu-id="954c9-152">Note hello following items for hello correspondingly numbered area of hello preceding diagram.</span></span>

1. <span data-ttu-id="954c9-153">Hallo twee Azure MFA-Servers (MFA1 en MFA2) zijn geladen taakverdeling (mfaapp.contoso.com) en zijn geconfigureerde toouse een statische poort (4443) tooreplicate hello PhoneFactor.pfdata database.</span><span class="sxs-lookup"><span data-stu-id="954c9-153">hello two Azure MFA Servers (MFA1 and MFA2) are load balanced (mfaapp.contoso.com) and are configured toouse a static port (4443) tooreplicate hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="954c9-154">Hallo Web Service SDK is geïnstalleerd op elk van de Hallo MFA-Server tooenable communicatie via TCP-poort 443 met Hallo ADFS-servers.</span><span class="sxs-lookup"><span data-stu-id="954c9-154">hello Web Service SDK is installed on each of hello MFA Server tooenable communication over TCP port 443 with hello ADFS servers.</span></span> <span data-ttu-id="954c9-155">Hallo MFA servers worden geïmplementeerd in een stateless configuratie van taakverdeling.</span><span class="sxs-lookup"><span data-stu-id="954c9-155">hello MFA servers are deployed in a stateless load-balanced configuration.</span></span> <span data-ttu-id="954c9-156">Echter, als u OTP toouse via SMS wilde, moet u stateful taakverdeling.</span><span class="sxs-lookup"><span data-stu-id="954c9-156">However, if you wanted toouse OTP over SMS, you must use stateful load balancing.</span></span>
   <span data-ttu-id="954c9-157">![Azure MFA-Server - appserver HA](./media/mfa-server-high-availability/mfaapp.png)</span><span class="sxs-lookup"><span data-stu-id="954c9-157">![Azure MFA Server - App server HA](./media/mfa-server-high-availability/mfaapp.png)</span></span>

   > [!NOTE]
   > <span data-ttu-id="954c9-158">Omdat de RPC dynamische poorten gebruikt, zijn het wordt niet aangeraden tooopen firewalls up toohello bereik van dynamische poorten die RPC kan gebruiken.</span><span class="sxs-lookup"><span data-stu-id="954c9-158">Because RPC uses dynamic ports, it is not recommended tooopen firewalls up toohello range of dynamic ports that RPC can potentially use.</span></span> <span data-ttu-id="954c9-159">Als u een firewall hebt **tussen** uw MFA-toepassingsservers, moet u configureren Hallo MFA-Server toocommunicate op een statische poort voor Hallo replicatieverkeer tussen servers slave en master en deze te openen die poort op uw firewall.</span><span class="sxs-lookup"><span data-stu-id="954c9-159">If you have a firewall **between** your MFA application servers, you should configure hello MFA Server toocommunicate on a static port for hello replication traffic between slave and master servers and open that port on your firewall.</span></span> <span data-ttu-id="954c9-160">U kunt statische poort Hallo afdwingen door het maken van een DWORD-registerwaarde op ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` aangeroepen ```Pfsvc_ncan_ip_tcp_port``` en instellingswaarde Hallo tooan beschikbare statische poort.</span><span class="sxs-lookup"><span data-stu-id="954c9-160">You can force hello static port by creating a DWORD registry value at ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` called ```Pfsvc_ncan_ip_tcp_port``` and setting hello value tooan available static port.</span></span> <span data-ttu-id="954c9-161">Verbindingen zijn altijd wordt geïnitieerd door Hallo slave MFA Servers toohello master, Hallo statische poort is alleen vereist op Hallo master, maar omdat op elk gewenst moment u een lager niveau bevindende toobe Hallo model promoveren kunt, moet u Hallo statische poort instellen op alle Servers met MFA.</span><span class="sxs-lookup"><span data-stu-id="954c9-161">Connections are always initiated by hello slave MFA Servers toohello master, hello static port is only required on hello master, but since you can promote a slave toobe hello master at any time, you should set hello static port on all MFA Servers.</span></span>

2. <span data-ttu-id="954c9-162">Hallo twee gebruiker Portal/MFA mobiele App servers (MFA-UP-MAS1 en MFA-UP-MAS2) worden verdeeld een **stateful** configuration (mfa.contoso.com).</span><span class="sxs-lookup"><span data-stu-id="954c9-162">hello two User Portal/MFA Mobile App servers (MFA-UP-MAS1 and MFA-UP-MAS2) are load balanced in a **stateful** configuration (mfa.contoso.com).</span></span> <span data-ttu-id="954c9-163">Intrekken dat een tijdelijke sessies zijn vereist voor de load balancer Hallo MFA User Portal en de mobiele App Service.</span><span class="sxs-lookup"><span data-stu-id="954c9-163">Recall that sticky sessions are a requirement for load balancing hello MFA User Portal and Mobile App Service.</span></span>
   <span data-ttu-id="954c9-164">![Azure MFA-Server - Gebruikersportal en de mobiele App Service HA](./media/mfa-server-high-availability/mfaportal.png)</span><span class="sxs-lookup"><span data-stu-id="954c9-164">![Azure MFA Server - User Portal and Mobile App Service HA](./media/mfa-server-high-availability/mfaportal.png)</span></span>
3. <span data-ttu-id="954c9-165">Hallo ADFS-Server-farm is load balanced en toohello Internet via AD FS-proxy's Netwerktaakverdeling in het perimeternetwerk Hallo gepubliceerd.</span><span class="sxs-lookup"><span data-stu-id="954c9-165">hello ADFS Server farm is load balanced and published toohello Internet through load-balanced ADFS proxies in hello perimeter network.</span></span> <span data-ttu-id="954c9-166">Elke AD FS-Server gebruikt Hallo ADFS agent toocommunicate Hello Azure MFA-Servers via één taakverdeling URL (mfaapp.contoso.com) via TCP-poort 443.</span><span class="sxs-lookup"><span data-stu-id="954c9-166">Each ADFS Server uses hello ADFS agent toocommunicate with hello Azure MFA Servers using a single load-balanced URL (mfaapp.contoso.com) over TCP port 443.</span></span>

## <a name="next-steps"></a><span data-ttu-id="954c9-167">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="954c9-167">Next steps</span></span>

* [<span data-ttu-id="954c9-168">Azure MFA-Server installeren en configureren</span><span class="sxs-lookup"><span data-stu-id="954c9-168">Install and configure Azure MFA Server</span></span>](multi-factor-authentication-get-started-server.md)
