---
title: 'ExpressRoute-routering optimaliseren: Azure | Microsoft Docs'
description: "Deze pagina bevat informatie over hoe toooptimize routering wanneer er meer dan één ExpressRoute-circuits die Microsoft verbinden met uw bedrijfsnetwerk."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="a869c-103">ExpressRoute-routering optimaliseren</span><span class="sxs-lookup"><span data-stu-id="a869c-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="a869c-104">Wanneer u meerdere ExpressRoute-circuits hebt, hebt u meer dan één pad tooconnect tooMicrosoft.</span><span class="sxs-lookup"><span data-stu-id="a869c-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="a869c-105">Als gevolg hiervan suboptimale routering kan plaatsvinden - dat wil zeggen, het verkeer kan duren voordat een langer pad tooreach Microsoft, en Microsoft tooyour netwerk.</span><span class="sxs-lookup"><span data-stu-id="a869c-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="a869c-106">Hallo langer Hallo netwerkpad, Hallo hogere Hallo latentie.</span><span class="sxs-lookup"><span data-stu-id="a869c-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="a869c-107">Latentie heeft een directe invloed op toepassingsprestaties en gebruikerservaring.</span><span class="sxs-lookup"><span data-stu-id="a869c-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="a869c-108">Dit artikel wordt dit probleem geïllustreerd en wordt uitgelegd hoe routering met toooptimize Hallo standaardrouteringstechnologieën.</span><span class="sxs-lookup"><span data-stu-id="a869c-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="a869c-109">Suboptimale routering van de klant tooMicrosoft</span><span class="sxs-lookup"><span data-stu-id="a869c-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="a869c-110">U gaat nu sluiten Hallo routeringsprobleem bekijken door een voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="a869c-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="a869c-111">Stel dat u hebt twee kantoren in Hallo VS, één in Los Angeles en één in New York.</span><span class="sxs-lookup"><span data-stu-id="a869c-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="a869c-112">Uw kantoren zijn aangesloten op een Wide Area Network (WAN). Dit kan uw eigen backbone-netwerk zijn of het IP VPN van uw serviceprovider.</span><span class="sxs-lookup"><span data-stu-id="a869c-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="a869c-113">U hebt twee ExpressRoute-circuits, één in VS-West en één in VS-Oost, die ook op Hallo WAN zijn verbonden.</span><span class="sxs-lookup"><span data-stu-id="a869c-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="a869c-114">U hebt uiteraard twee paden tooconnect toohello Microsoft-netwerk.</span><span class="sxs-lookup"><span data-stu-id="a869c-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="a869c-115">Stel nu dat u zowel in VS West als in VS Oost een Azure-implementatie hebt (bijvoorbeeld Azure App Service).</span><span class="sxs-lookup"><span data-stu-id="a869c-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="a869c-116">Uw bedoeling is tooconnect uw gebruikers in Los Angeles tooAzure VS-West en uw gebruikers in New York tooAzure VS-Oost omdat uw servicebeheerder adverteert dat gebruikers in elke office access Hallo in de buurt van Azure services voor optimale ervaringen.</span><span class="sxs-lookup"><span data-stu-id="a869c-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="a869c-117">Helaas werkt Hallo dit plan voor gebruikers van Hallo oostkust maar niet voor Hallo westkust gebruikers.</span><span class="sxs-lookup"><span data-stu-id="a869c-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="a869c-118">Hallo is Hallo probleem te wijten aan Hallo volgende.</span><span class="sxs-lookup"><span data-stu-id="a869c-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="a869c-119">Op elk ExpressRoute-circuit adverteren we tooyou zowel Hallo-voorvoegsel in Azure VS-Oost (23.100.0.0/16) en Hallo-voorvoegsel in Azure VS-West (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="a869c-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="a869c-120">Als u niet welk voorvoegsel bij welke regio hoort weet, bent u niet kunt tootreat deze anders.</span><span class="sxs-lookup"><span data-stu-id="a869c-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="a869c-121">Uw WAN-netwerk kan denkt dat beide voorvoegsels Hallo zijn dichter tooUS Oost dan VS-West en daarom omgeleid beide office gebruikers toohello ExpressRoute-circuit in VS-Oost.</span><span class="sxs-lookup"><span data-stu-id="a869c-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="a869c-122">Hallo-end hebt u veel ontevreden gebruikers in Hallo kantoor in Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="a869c-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![ExpressRoute geval 1 probleem - suboptimale routering van de klant tooMicrosoft](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="a869c-124">Oplossing: gebruik BGP-community's</span><span class="sxs-lookup"><span data-stu-id="a869c-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="a869c-125">toooptimize routering voor gebruikers van beide kantoren, moet u tooknow welk voorvoegsel van Azure VS-West en die van Azure VS-Oost is.</span><span class="sxs-lookup"><span data-stu-id="a869c-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="a869c-126">Deze informatie wordt versleuteld met [BGP-communitywaarden](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="a869c-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="a869c-127">We hebt een unieke BGP-Community waarde tooeach Azure-regio, bijvoorbeeld toegewezen '12076:51004' voor VS Oost en '12076:51006' voor VS West.</span><span class="sxs-lookup"><span data-stu-id="a869c-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="a869c-128">Nu u weet welk voorvoegsel bij welke Azure-regio hoort, kunt u configureren welk ExpressRoute-circuit de voorkeur heeft.</span><span class="sxs-lookup"><span data-stu-id="a869c-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="a869c-129">Omdat we BGP-tooexchange routeringsinformatie hello gebruiken, kunt u BGP van lokale-voorkeurswaarde tooinfluence routering.</span><span class="sxs-lookup"><span data-stu-id="a869c-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="a869c-130">In ons voorbeeld kunt u een hogere lokale-voorkeurswaarde waarde too13.100.0.0/16 in VS-West dan in VS-Oost, en in een hogere lokale-voorkeurswaarde waarde too23.100.0.0/16 in VS-Oost dan in VS-West toewijzen.</span><span class="sxs-lookup"><span data-stu-id="a869c-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="a869c-131">Deze configuratie zorgt ervoor dat, wanneer beide tooMicrosoft paden beschikbaar zijn, uw gebruikers in Los Angeles Hallo ExpressRoute-circuit in VS-West tooconnect tooAzure VS-West duurt dat uw gebruikers in New York Hallo ExpressRoute in VS-Oost tooAzure VS-Oost nemen .</span><span class="sxs-lookup"><span data-stu-id="a869c-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="a869c-132">Routering is nu aan beide zijden geoptimaliseerd.</span><span class="sxs-lookup"><span data-stu-id="a869c-132">Routing is optimized on both sides.</span></span> 

![Oplossing Expressroute casus 1: BGP-community's gebruiken](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="a869c-134">Hallo dezelfde techniek, met behulp van de lokale voorkeur, toegepaste toorouting van klant tooAzure virtueel netwerk kan worden.</span><span class="sxs-lookup"><span data-stu-id="a869c-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="a869c-135">We coderen BGP-Community waarde toohello voorvoegsels die worden geadverteerd vanuit Azure tooyour netwerk niet.</span><span class="sxs-lookup"><span data-stu-id="a869c-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="a869c-136">Echter, omdat u welke van uw implementatie van het virtuele netwerk sluiten toowhich van uw kantoor is weet, kunt u uw routers configureren dienovereenkomstig tooprefer één ExpressRoute-circuit tooanother.</span><span class="sxs-lookup"><span data-stu-id="a869c-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="a869c-137">Suboptimale routering van Microsoft toocustomer</span><span class="sxs-lookup"><span data-stu-id="a869c-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="a869c-138">Hier volgt een voorbeeld waarin verbindingen van Microsoft een langer pad tooreach uw netwerk nemen.</span><span class="sxs-lookup"><span data-stu-id="a869c-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="a869c-139">In dit geval maakt u gebruik van on-premises Exchange-servers en Exchange Online in een [hybride omgeving](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="a869c-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="a869c-140">Uw kantoren zijn verbonden tooa WAN.</span><span class="sxs-lookup"><span data-stu-id="a869c-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="a869c-141">U adverteert de voorvoegsels Hallo van uw on-premises servers in beide uw kantoren tooMicrosoft via Hallo twee ExpressRoute-circuits.</span><span class="sxs-lookup"><span data-stu-id="a869c-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="a869c-142">Start Exchange Online verbindingen toohello lokale servers in bijvoorbeeld postvakmigratie.</span><span class="sxs-lookup"><span data-stu-id="a869c-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="a869c-143">Hallo verbinding tooyour kantoor in Los Angeles is helaas gerouteerde toohello ExpressRoute-circuit in VS-Oost voordat Hallo gehele continent back toohello westkust passeert.</span><span class="sxs-lookup"><span data-stu-id="a869c-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="a869c-144">Hallo Hallo probleem wordt veroorzaakt vergelijkbare toohello eerst een.</span><span class="sxs-lookup"><span data-stu-id="a869c-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="a869c-145">Zonder aanwijzingen weet Hallo Microsoft-netwerk niet welk klantvoorvoegsel sluiten tooUS Oost is en welke tooUS West sluiten.</span><span class="sxs-lookup"><span data-stu-id="a869c-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="a869c-146">Dit gebeurt toopick Hallo Onjuiste padindeling tooyour kantoor in Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="a869c-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![ExpressRoute-voorbeeld 2 - suboptimale routering van Microsoft toocustomer](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="a869c-148">Oplossing: AS-padtoevoeging</span><span class="sxs-lookup"><span data-stu-id="a869c-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="a869c-149">Er zijn twee oplossingen toohello probleem.</span><span class="sxs-lookup"><span data-stu-id="a869c-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="a869c-150">Hallo eerst is een dat u gewoon uw on-premises voorvoegsel voor uw kantoor in Los Angeles, 177.2.0.0/31, op Hallo ExpressRoute-circuit in VS-West adverteert en uw on-premises voorvoegsel voor uw kantoor in New York, 177.2.0.2/31, op Hallo ExpressRoute-circuit in VS-Oost.</span><span class="sxs-lookup"><span data-stu-id="a869c-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="a869c-151">Als gevolg hiervan is er slechts één pad voor Microsoft tooconnect tooeach kantoren.</span><span class="sxs-lookup"><span data-stu-id="a869c-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="a869c-152">Er is geen dubbelzinnigheid en routering is geoptimaliseerd.</span><span class="sxs-lookup"><span data-stu-id="a869c-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="a869c-153">Bij dit ontwerp moet u toothink over uw failoverstrategie voor.</span><span class="sxs-lookup"><span data-stu-id="a869c-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="a869c-154">In Hallo gebeurtenis die Hallo pad tooMicrosoft via ExpressRoute wordt verbroken, moet u ervoor dat Exchange Online kunt nog steeds verbinding tooyour lokale servers toomake.</span><span class="sxs-lookup"><span data-stu-id="a869c-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="a869c-155">de tweede oplossing Hallo is dat u doorgaan met tooadvertise van Hallo voorvoegsels op beide ExpressRoute-circuits en Daarnaast geeft u een hint welk voorvoegsel sluiten toowhich kantoren is.</span><span class="sxs-lookup"><span data-stu-id="a869c-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="a869c-156">Omdat we BGP AS-padtoevoeging ondersteunen, kunt u Hallo AS-pad voor uw voorvoegsel tooinfluence routering configureren.</span><span class="sxs-lookup"><span data-stu-id="a869c-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="a869c-157">U kunt in dit voorbeeld Hallo AS-pad voor 172.2.0.0/31 in VS-Oost verlengen zodat we wordt de voorkeur aan Hallo ExpressRoute-circuit in VS-West voor verkeer dat is bestemd voor dit voorvoegsel (omdat ons netwerk Hallo pad toothis voorvoegsel is korter in Hallo westen dat).</span><span class="sxs-lookup"><span data-stu-id="a869c-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="a869c-158">U kunt ook Hallo AS-pad voor 172.2.0.2/31 in VS-West verlengen zodat we je liever Hallo ExpressRoute-circuit in VS-Oost.</span><span class="sxs-lookup"><span data-stu-id="a869c-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="a869c-159">Routering is geoptimaliseerd voor beide kantoren.</span><span class="sxs-lookup"><span data-stu-id="a869c-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="a869c-160">Als bij dit ontwerp één ExpressRoute-circuit wordt verbroken, kan Exchange Online u nog steeds bereiken via een ander ExpressRoute-circuit en uw WAN.</span><span class="sxs-lookup"><span data-stu-id="a869c-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="a869c-161">We verwijderen persoonlijke als getallen in Hallo AS-pad voor voorvoegsels Hallo op Microsoft-Peering ontvangen.</span><span class="sxs-lookup"><span data-stu-id="a869c-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="a869c-162">U moet tooappend openbare AS-nummers in het Hallo AS-pad tooinfluence routering voor Microsoft-Peering.</span><span class="sxs-lookup"><span data-stu-id="a869c-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Oplossing ExpressRoute casus 2: Toevoeging van AS PATH gebruiken](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="a869c-164">Hoewel Hallo voorbeelden hier opgegeven voor Microsoft- en openbare peerings, bieden we ondersteuning Hallo dezelfde mogelijkheden voor Hallo persoonlijke peering.</span><span class="sxs-lookup"><span data-stu-id="a869c-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="a869c-165">Hallo AS-padtoevoeging werkt ook binnen een enkel ExpressRoute-circuit, tooinfluence Hallo selectie van de primaire en secundaire paden Hallo.</span><span class="sxs-lookup"><span data-stu-id="a869c-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="a869c-166">Suboptimale routering tussen virtuele netwerken</span><span class="sxs-lookup"><span data-stu-id="a869c-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="a869c-167">Met ExpressRoute, kunt u het virtuele netwerk tooVirtual netwerk (ook wel bekend als 'VNet') inschakelen communicatie door deze te koppelen tooan ExpressRoute-circuit.</span><span class="sxs-lookup"><span data-stu-id="a869c-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="a869c-168">Wanneer u ze toomultiple ExpressRoute-circuits koppelen kan suboptimale routering gebeuren tussen Hallo VNets.</span><span class="sxs-lookup"><span data-stu-id="a869c-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="a869c-169">Een voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="a869c-169">Let's consider an example.</span></span> <span data-ttu-id="a869c-170">U hebt twee ExpressRoute-circuits, één in VS West en één in VS Oost.</span><span class="sxs-lookup"><span data-stu-id="a869c-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="a869c-171">In elke regio hebt u twee VNets.</span><span class="sxs-lookup"><span data-stu-id="a869c-171">In each region, you have two VNets.</span></span> <span data-ttu-id="a869c-172">Uw webservers zijn geïmplementeerd in een VNet en toepassingsservers in andere Hallo.</span><span class="sxs-lookup"><span data-stu-id="a869c-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="a869c-173">Voor de redundantie, u koppeling Hallo twee VNets in elke regio tooboth Hallo lokale ExpressRoute-circuit en Hallo externe ExpressRoute-circuit.</span><span class="sxs-lookup"><span data-stu-id="a869c-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="a869c-174">Zoals u hieronder kunt zien, uit elke VNet zijn er twee paden toohello andere VNet.</span><span class="sxs-lookup"><span data-stu-id="a869c-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="a869c-175">Hallo VNets weet niet welk ExpressRoute-circuit is lokaal en welke regel is extern.</span><span class="sxs-lookup"><span data-stu-id="a869c-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="a869c-176">Als gevolg daarvan als gelijk-kosten-Multi-Path (ECMP) routering tooload saldo inter VNet-verkeer, sommige verkeersstromen duurt langer pad Hallo en ophalen doorgestuurd op Hallo externe ExpressRoute-circuit.</span><span class="sxs-lookup"><span data-stu-id="a869c-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![Probleem ExpressRoute casus 3: Suboptimale routering tussen virtuele netwerken](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="a869c-178">Oplossing: een hoog gewicht toolocal verbinding toewijzen</span><span class="sxs-lookup"><span data-stu-id="a869c-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="a869c-179">Hallo-oplossing is eenvoudig.</span><span class="sxs-lookup"><span data-stu-id="a869c-179">hello solution is simple.</span></span> <span data-ttu-id="a869c-180">Omdat u waar de vnet's en Hallo circuits Hallo weet, u kunt laat ons weten welk pad voor elk VNet voorkeuren.</span><span class="sxs-lookup"><span data-stu-id="a869c-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="a869c-181">Speciaal voor dit voorbeeld u een hogere gewicht toohello lokale verbinding dan verbinding met extern toohello toewijzen (Zie Hallo configuratievoorbeeld [hier](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="a869c-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="a869c-182">Wanneer een VNet Hallo voorvoegsel Hallo ontvangt andere VNet op meerdere verbindingen deze wordt de voorkeur aan Hallo verbinding met de Hallo hoogste gewicht toosend verkeer dat is bestemd voor voorvoegsel.</span><span class="sxs-lookup"><span data-stu-id="a869c-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Oplossing voor ExpressRoute geval 3 - toewijzen hoog gewicht toolocal verbinding](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="a869c-184">U kunt ook de routering van VNet tooyour on-premises netwerk, als u meerdere ExpressRoute-circuits hebt met het gewicht van een verbinding in plaats van het toepassen van de AS-pad prepending, een techniek die wordt beschreven in het tweede scenario Hallo bovenstaande Hallo configureren beïnvloeden.</span><span class="sxs-lookup"><span data-stu-id="a869c-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="a869c-185">Voor elke voorvoegsel altijd kijken we Hallo verbinding gewicht voordat Hallo AS padlengte bij het bepalen hoe toosend verkeer.</span><span class="sxs-lookup"><span data-stu-id="a869c-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>
