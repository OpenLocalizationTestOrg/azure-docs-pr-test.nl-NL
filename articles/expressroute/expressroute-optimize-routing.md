---
title: 'ExpressRoute-routering optimaliseren: Azure | Microsoft Docs'
description: Deze pagina bevat gedetailleerde informatie over het optimaliseren van routering wanneer u meerdere ExpressRoute-circuits hebt die Microsoft verbinden met uw bedrijfsnetwerk.
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: c3a85b9445d69330c3f6c7d298169efddb6ecca0
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="48acb-103">ExpressRoute-routering optimaliseren</span><span class="sxs-lookup"><span data-stu-id="48acb-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="48acb-104">Als u meerdere ExpressRoute-circuits hebt, hebt u meer dan één pad om verbinding te maken met Microsoft.</span><span class="sxs-lookup"><span data-stu-id="48acb-104">When you have multiple ExpressRoute circuits, you have more than one path to connect to Microsoft.</span></span> <span data-ttu-id="48acb-105">Dat betekent dat suboptimale routering kan plaatsvinden, met andere woorden, dat verkeer soms een langer pad aflegt om Microsoft te bereiken en Microsoft om uw netwerk te bereiken.</span><span class="sxs-lookup"><span data-stu-id="48acb-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path to reach Microsoft, and Microsoft to your network.</span></span> <span data-ttu-id="48acb-106">Hoe langer het netwerkpad, hoe groter de latentie.</span><span class="sxs-lookup"><span data-stu-id="48acb-106">The longer the network path, the higher the latency.</span></span> <span data-ttu-id="48acb-107">Latentie heeft een directe invloed op toepassingsprestaties en gebruikerservaring.</span><span class="sxs-lookup"><span data-stu-id="48acb-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="48acb-108">In dit artikel wordt dit probleem geïllustreerd en wordt uitgelegd hoe u routering optimaliseert met behulp van de standaardrouteringstechnologieën.</span><span class="sxs-lookup"><span data-stu-id="48acb-108">This article will illustrate this problem and explain how to optimize routing using the standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-to-microsoft"></a><span data-ttu-id="48acb-109">Suboptimale routering van klant naar Microsoft</span><span class="sxs-lookup"><span data-stu-id="48acb-109">Suboptimal routing from customer to Microsoft</span></span>
<span data-ttu-id="48acb-110">We gaan het routeringsprobleem bekijken aan de hand van een voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="48acb-110">Let's take a close look at the routing problem by an example.</span></span> <span data-ttu-id="48acb-111">Stel, u hebt twee kantoren in de VS, één in Los Angeles en één in New York.</span><span class="sxs-lookup"><span data-stu-id="48acb-111">Imagine you have two offices in the US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="48acb-112">Uw kantoren zijn aangesloten op een Wide Area Network (WAN). Dit kan uw eigen backbone-netwerk zijn of het IP VPN van uw serviceprovider.</span><span class="sxs-lookup"><span data-stu-id="48acb-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="48acb-113">U hebt twee ExpressRoute-circuits, één in VS West en één in VS Oost. Deze zijn ook aangesloten op het WAN.</span><span class="sxs-lookup"><span data-stu-id="48acb-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on the WAN.</span></span> <span data-ttu-id="48acb-114">U hebt uiteraard twee paden om verbinding te maken met het Microsoft-netwerk.</span><span class="sxs-lookup"><span data-stu-id="48acb-114">Obviously, you have two paths to connect to the Microsoft network.</span></span> <span data-ttu-id="48acb-115">Stel nu dat u zowel in VS West als in VS Oost een Azure-implementatie hebt (bijvoorbeeld Azure App Service).</span><span class="sxs-lookup"><span data-stu-id="48acb-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="48acb-116">Het is uw bedoeling om uw gebruikers in Los Angeles te verbinden met Azure VS West en uw gebruikers in New York met Azure VS Oost, omdat uw servicebeheerder adverteert dat gebruikers in elk kantoor voor optimale ervaringen gebruik kunnen maken van de Azure-services die zich zo dichtbij mogelijk bevinden.</span><span class="sxs-lookup"><span data-stu-id="48acb-116">Your intention is to connect your users in Los Angeles to Azure US West and your users in New York to Azure US East because your service admin advertises that users in each office access the nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="48acb-117">Helaas werkt dit plan prima voor de gebruikers aan de oostkust maar niet voor de gebruikers aan de westkust.</span><span class="sxs-lookup"><span data-stu-id="48acb-117">Unfortunately, the plan works out well for the east coast users but not for the west coast users.</span></span> <span data-ttu-id="48acb-118">Dit heeft de volgende oorzaak.</span><span class="sxs-lookup"><span data-stu-id="48acb-118">The cause of the problem is the following.</span></span> <span data-ttu-id="48acb-119">In elk ExpressRoute-circuit adverteren we aan u zowel het voorvoegsel in Azure VS Oost (23.100.0.0/16) als het voorvoegsel in Azure VS West (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="48acb-119">On each ExpressRoute circuit, we advertise to you both the prefix in Azure US East (23.100.0.0/16) and the prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="48acb-120">Als u niet weet welk voorvoegsel bij welke regio hoort, kunt u ze niet op verschillende manieren behandelen.</span><span class="sxs-lookup"><span data-stu-id="48acb-120">If you don't know which prefix is from which region, you are not able to treat it differently.</span></span> <span data-ttu-id="48acb-121">Misschien 'denkt' uw WAN-netwerk dat beide voorvoegsels zich dichter bij VS Oost bevinden dan bij VS West, en worden de gebruikers van beide kantoren daarom omgeleid naar het ExpressRoute-circuit in VS Oost.</span><span class="sxs-lookup"><span data-stu-id="48acb-121">Your WAN network may think both of the prefixes are closer to US East than US West and therefore route both office users to the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="48acb-122">Dit leidt tot veel ontevreden gebruikers in het kantoor in Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="48acb-122">In the end, you will have many unhappy users in the Los Angeles office.</span></span>

![Probleem ExpressRoute casus 1: Suboptimale routering van klant naar Microsoft](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="48acb-124">Oplossing: gebruik BGP-community's</span><span class="sxs-lookup"><span data-stu-id="48acb-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="48acb-125">Om routering te optimaliseren voor de gebruikers op beide kantoren, moet u weten welk voorvoegsel van Azure VS West is en welk van Azure VS Oost.</span><span class="sxs-lookup"><span data-stu-id="48acb-125">To optimize routing for both office users, you need to know which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="48acb-126">Deze informatie wordt versleuteld met [BGP-communitywaarden](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="48acb-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="48acb-127">Aan elke Azure-regio is een unieke BGP-communitywaarde toegewezen, bijvoorbeeld '12076:51004' voor VS Oost en '12076:51006' voor VS West.</span><span class="sxs-lookup"><span data-stu-id="48acb-127">We've assigned a unique BGP Community value to each Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="48acb-128">Nu u weet welk voorvoegsel bij welke Azure-regio hoort, kunt u configureren welk ExpressRoute-circuit de voorkeur heeft.</span><span class="sxs-lookup"><span data-stu-id="48acb-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="48acb-129">Omdat we het BGP gebruiken om routeringsinformatie uit te wisselen, kunt u de routering beïnvloeden met de lokale voorkeur van het BGP.</span><span class="sxs-lookup"><span data-stu-id="48acb-129">Because we use the BGP to exchange routing info, you can use BGP's Local Preference to influence routing.</span></span> <span data-ttu-id="48acb-130">In ons voorbeeld kunt u in VS West aan 13.100.0.0/16 een hogere lokale-voorkeurswaarde toekennen dan in VS Oost, en in VS Oost kunt u aan 23.100.0.0/16 een hogere lokale-voorkeurswaarde toekennen dan in VS West.</span><span class="sxs-lookup"><span data-stu-id="48acb-130">In our example, you can assign a higher local preference value to 13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value to 23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="48acb-131">Als beide paden naar Microsoft beschikbaar zijn, zorgt deze configuratie ervoor dat uw gebruikers in Los Angeles het ExpressRoute-circuit in VS West gebruiken om verbinding te maken met Azure VS West, en uw gebruikers in New York de ExpressRoute in VS Oost nemen naar Azure VS Oost.</span><span class="sxs-lookup"><span data-stu-id="48acb-131">This configuration will make sure that, when both paths to Microsoft are available, your users in Los Angeles will take the ExpressRoute circuit in US West to connect to Azure US West whereas your users in New York take the ExpressRoute in US East to Azure US East.</span></span> <span data-ttu-id="48acb-132">Routering is nu aan beide zijden geoptimaliseerd.</span><span class="sxs-lookup"><span data-stu-id="48acb-132">Routing is optimized on both sides.</span></span> 

![Oplossing Expressroute casus 1: BGP-community's gebruiken](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="48acb-134">Dezelfde techniek, het gebruik van lokale voorkeur, kan ook worden toegepast op routering van klant naar Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="48acb-134">The same technique, using Local Preference, can be applied to routing from customer to Azure Virtual Network.</span></span> <span data-ttu-id="48acb-135">We voegen geen BGP Community-waarde toe aan de voorvoegsels die vanuit Azure zijn aangekondigd aan uw netwerk.</span><span class="sxs-lookup"><span data-stu-id="48acb-135">We don't tag BGP Community value to the prefixes advertised from Azure to your network.</span></span> <span data-ttu-id="48acb-136">Maar omdat u weet welke Virtual Network-implementatie zich dicht bij uw kantoor bevindt, kunt u uw routers zo configureren dat het ene ExpressRoute-circuit de voorkeur krijgt boven het andere.</span><span class="sxs-lookup"><span data-stu-id="48acb-136">However, since you know which of your Virtual Network deployment is close to which of your office, you can configure your routers accordingly to prefer one ExpressRoute circuit to another.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-to-customer"></a><span data-ttu-id="48acb-137">Suboptimale routering van Microsoft naar de klant</span><span class="sxs-lookup"><span data-stu-id="48acb-137">Suboptimal routing from Microsoft to customer</span></span>
<span data-ttu-id="48acb-138">Hier volgt nog een voorbeeld waarin verbindingen van Microsoft een langer pad afleggen om uw netwerk te bereiken.</span><span class="sxs-lookup"><span data-stu-id="48acb-138">Here is another example where connections from Microsoft take a longer path to reach your network.</span></span> <span data-ttu-id="48acb-139">In dit geval maakt u gebruik van on-premises Exchange-servers en Exchange Online in een [hybride omgeving](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="48acb-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="48acb-140">Uw kantoren zijn verbonden met een WAN.</span><span class="sxs-lookup"><span data-stu-id="48acb-140">Your offices are connected to a WAN.</span></span> <span data-ttu-id="48acb-141">U adverteert de voorvoegsels van uw on-premises servers in beide kantoren aan Microsoft door middel van de twee ExpressRoute-circuits.</span><span class="sxs-lookup"><span data-stu-id="48acb-141">You advertise the prefixes of your on-premises servers in both of your offices to Microsoft through the two ExpressRoute circuits.</span></span> <span data-ttu-id="48acb-142">Voor bijvoorbeeld postvakmigratie start Exchange Online verbindingen met de on-premises servers.</span><span class="sxs-lookup"><span data-stu-id="48acb-142">Exchange Online will initiate connections to the on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="48acb-143">Helaas wordt de verbinding met uw kantoor in Los Angeles omgeleid naar het ExpressRoute-circuit in VS - oost, waarna deze het gehele continent doorkruist om weer aan de westkust uit te komen.</span><span class="sxs-lookup"><span data-stu-id="48acb-143">Unfortunately, the connection to your Los Angeles office is routed to the ExpressRoute circuit in US East before traversing the entire continent back to the west coast.</span></span> <span data-ttu-id="48acb-144">De oorzaak van het probleem is vergelijkbaar met die in het eerste voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="48acb-144">The cause of the problem is similar to the first one.</span></span> <span data-ttu-id="48acb-145">Zonder aanwijzingen weet het Microsoft-netwerk niet welk klantvoorvoegsel zich dichter bij VS Oost bevindt en welk dichter bij VS West.</span><span class="sxs-lookup"><span data-stu-id="48acb-145">Without any hint, the Microsoft network can't tell which customer prefix is close to US East and which one is close to US West.</span></span> <span data-ttu-id="48acb-146">Dus soms wordt het verkeerde pad naar uw kantoor in Los Angeles gekozen.</span><span class="sxs-lookup"><span data-stu-id="48acb-146">It happens to pick the wrong path to your office in Los Angeles.</span></span>

![Probleem ExpressRoute casus 2: Suboptimale routering van Microsoft naar de klant](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="48acb-148">Oplossing: AS-padtoevoeging</span><span class="sxs-lookup"><span data-stu-id="48acb-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="48acb-149">Er zijn twee oplossingen voor het probleem.</span><span class="sxs-lookup"><span data-stu-id="48acb-149">There are two solutions to the problem.</span></span> <span data-ttu-id="48acb-150">Voor de eerste oplossing adverteert u gewoon het on-premises voorvoegsel voor uw kantoor in Los Angeles, 177.2.0.0/31, op het ExpressRoute-circuit in VS West en het on-premises voorvoegsel voor uw kantoor in New York, 177.2.0.2/31, op het ExpressRoute-circuit in VS Oost.</span><span class="sxs-lookup"><span data-stu-id="48acb-150">The first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on the ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="48acb-151">Als gevolg hiervan is er slechts één pad waarlangs Microsoft verbinding maakt met elk kantoor.</span><span class="sxs-lookup"><span data-stu-id="48acb-151">As a result, there is only one path for Microsoft to connect to each of your offices.</span></span> <span data-ttu-id="48acb-152">Er is geen dubbelzinnigheid en routering is geoptimaliseerd.</span><span class="sxs-lookup"><span data-stu-id="48acb-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="48acb-153">Bij dit ontwerp moet u echter nadenken over een failoverstrategie.</span><span class="sxs-lookup"><span data-stu-id="48acb-153">With this design, you need to think about your failover strategy.</span></span> <span data-ttu-id="48acb-154">Als het pad naar Microsoft via ExpressRoute wordt verbroken, moet u ervoor zorgen dat Exchange Online nog steeds verbinding kan maken met uw on-premises servers.</span><span class="sxs-lookup"><span data-stu-id="48acb-154">In the event that the path to Microsoft via ExpressRoute is broken, you need to make sure that Exchange Online can still connect to your on-premises servers.</span></span> 

<span data-ttu-id="48acb-155">Voor de tweede oplossing blijft u beide voorvoegsels op beide ExpressRoute-circuits adverteren en geeft u daarnaast aan welk voorvoegsel zich het dichtst bij welk kantoor bevindt.</span><span class="sxs-lookup"><span data-stu-id="48acb-155">The second solution is that you continue to advertise both of the prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close to which one of your offices.</span></span> <span data-ttu-id="48acb-156">Omdat we BGP AS-padtoevoeging ondersteunen, kunt u het AS-pad voor uw voorvoegsel configureren om routering te beïnvloeden.</span><span class="sxs-lookup"><span data-stu-id="48acb-156">Because we support BGP AS Path prepending, you can configure the AS Path for your prefix to influence routing.</span></span> <span data-ttu-id="48acb-157">In dit voorbeeld kunt u het AS-pad voor 172.2.0.0/31 in VS Oost verlengen zodat het ExpressRoute-circuit in VS West de voorkeur krijgt voor verkeer dat is bestemd voor dit voorvoegsel (omdat ons netwerk 'denkt' dat het pad naar dit voorvoegsel korter is in het westen).</span><span class="sxs-lookup"><span data-stu-id="48acb-157">In this example, you can lengthen the AS PATH for 172.2.0.0/31 in US East so that we will prefer the ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think the path to this prefix is shorter in the west).</span></span> <span data-ttu-id="48acb-158">En zo verlengt u ook het AS-pad voor 172.2.0.2/31 in VS - west, zodat het ExpressRoute-circuit in VS - oost de voorkeur krijgt.</span><span class="sxs-lookup"><span data-stu-id="48acb-158">Similarly you can lengthen the AS PATH for 172.2.0.2/31 in US West so that we'll prefer the ExpressRoute circuit in US East.</span></span> <span data-ttu-id="48acb-159">Routering is geoptimaliseerd voor beide kantoren.</span><span class="sxs-lookup"><span data-stu-id="48acb-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="48acb-160">Als bij dit ontwerp één ExpressRoute-circuit wordt verbroken, kan Exchange Online u nog steeds bereiken via een ander ExpressRoute-circuit en uw WAN.</span><span class="sxs-lookup"><span data-stu-id="48acb-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="48acb-161">We verwijderen persoonlijke AS-nummers in het AS-pad voor voorvoegsels die binnenkomen op Microsoft-peering.</span><span class="sxs-lookup"><span data-stu-id="48acb-161">We remove private AS numbers in the AS PATH for the prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="48acb-162">U moet openbare AS-nummers aan het AS-pad toevoegen om routering voor Microsoft-peering te beïnvloeden.</span><span class="sxs-lookup"><span data-stu-id="48acb-162">You need to append public AS numbers in the AS PATH to influence routing for Microsoft Peering.</span></span>
> 
> 

![Oplossing ExpressRoute casus 2: Toevoeging van AS PATH gebruiken](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="48acb-164">Hoewel de hier getoonde voorbeelden voor Microsoft- en openbare peerings zijn, ondersteunen we dezelfde mogelijkheden voor persoonlijke peering.</span><span class="sxs-lookup"><span data-stu-id="48acb-164">While the examples given here are for Microsoft and Public peerings, we do support the same capabilities for the Private peering.</span></span> <span data-ttu-id="48acb-165">De AS-padtoevoeging werkt ook binnen één ExpressRoute-circuit om de selectie van primaire en secundaire paden te beïnvloeden.</span><span class="sxs-lookup"><span data-stu-id="48acb-165">Also, the AS Path prepending works within one single ExpressRoute circuit, to influence the selection of the primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="48acb-166">Suboptimale routering tussen virtuele netwerken</span><span class="sxs-lookup"><span data-stu-id="48acb-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="48acb-167">Met ExpressRoute kunt u VNet-communicatie (communicatie van Virtual Network naar Virtual Network) inschakelen door de VNets te koppelen aan een ExpressRoute-circuit.</span><span class="sxs-lookup"><span data-stu-id="48acb-167">With ExpressRoute, you can enable Virtual Network to Virtual Network (which is also known as "VNet") communication by linking them to an ExpressRoute circuit.</span></span> <span data-ttu-id="48acb-168">Wanneer u ze koppelt aan meerdere ExpressRoute-circuits, kan er suboptimale routering tussen de VNets optreden.</span><span class="sxs-lookup"><span data-stu-id="48acb-168">When you link them to multiple ExpressRoute circuits, suboptimal routing can happen between the VNets.</span></span> <span data-ttu-id="48acb-169">Een voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="48acb-169">Let's consider an example.</span></span> <span data-ttu-id="48acb-170">U hebt twee ExpressRoute-circuits, één in VS West en één in VS Oost.</span><span class="sxs-lookup"><span data-stu-id="48acb-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="48acb-171">In elke regio hebt u twee VNets.</span><span class="sxs-lookup"><span data-stu-id="48acb-171">In each region, you have two VNets.</span></span> <span data-ttu-id="48acb-172">Uw webservers zijn geïmplementeerd in het ene VNet en de toepassingsservers in het andere.</span><span class="sxs-lookup"><span data-stu-id="48acb-172">Your web servers are deployed in one VNet and application servers in the other.</span></span> <span data-ttu-id="48acb-173">Ten behoeve van redundantie kunt u de twee VNets in elke regio koppelen aan zowel het lokale ExpressRoute-circuit als aan het externe ExpressRoute-circuit.</span><span class="sxs-lookup"><span data-stu-id="48acb-173">For redundancy, you link the two VNets in each region to both the local ExpressRoute circuit and the remote ExpressRoute circuit.</span></span> <span data-ttu-id="48acb-174">Zoals u hieronder kunt zien, lopen er vanuit elk VNet twee paden naar het andere VNet.</span><span class="sxs-lookup"><span data-stu-id="48acb-174">As can be seen below, from each VNet there are two paths to the other VNet.</span></span> <span data-ttu-id="48acb-175">De VNets weten niet welk ExpressRoute-circuit lokaal is en welk circuit extern.</span><span class="sxs-lookup"><span data-stu-id="48acb-175">The VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="48acb-176">Omdat er ECMP-routering (Equal-Cost-Multi-Path) plaatsvindt om het verkeer tussen VNets gelijk te verdelen, kan het daardoor gebeuren dat verkeer een langere weg aflegt en naar het externe ExpressRoute-circuit wordt omgeleid.</span><span class="sxs-lookup"><span data-stu-id="48acb-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing to load-balance inter-VNet traffic, some traffic flows will take the longer path and get routed at the remote ExpressRoute circuit.</span></span>

![Probleem ExpressRoute casus 3: Suboptimale routering tussen virtuele netwerken](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-to-local-connection"></a><span data-ttu-id="48acb-178">Oplossing: meer gewicht toewijzen aan lokale verbinding</span><span class="sxs-lookup"><span data-stu-id="48acb-178">Solution: assign a high weight to local connection</span></span>
<span data-ttu-id="48acb-179">De oplossing is eenvoudig.</span><span class="sxs-lookup"><span data-stu-id="48acb-179">The solution is simple.</span></span> <span data-ttu-id="48acb-180">Omdat u weet waar de VNets en circuits zich bevinden, kunt u ons vertellen aan welk pad elke VNet de voorkeur moet geven.</span><span class="sxs-lookup"><span data-stu-id="48acb-180">Since you know where the VNets and the circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="48acb-181">Voor dit voorbeeld wijst u aan de lokale verbinding een hoger gewicht toe dan aan de externe verbinding (klik [hier](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection) voor een configuratievoorbeeld).</span><span class="sxs-lookup"><span data-stu-id="48acb-181">Specifically for this example, you assign a higher weight to the local connection than to the remote connection (see the configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="48acb-182">Wanneer een VNet op meerdere verbindingen het voorvoegsel van het andere VNet ontvangt, krijgt de verbinding met het hoogste gewicht de voorkeur om verkeer te verzenden dat voor dat voorvoegsel is bestemd.</span><span class="sxs-lookup"><span data-stu-id="48acb-182">When a VNet receives the prefix of the other VNet on multiple connections it will prefer the connection with the highest weight to send traffic destined for that prefix.</span></span>

![Oplossing ExpressRoute casus 3: Meer gewicht toewijzen aan lokale verbinding](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="48acb-184">Als u meerdere ExpressRoute-circuits hebt, kunt u de routering vanuit VNet naar uw on-premises netwerk ook beïnvloeden door het gewicht van een verbinding te configureren in plaats van AS PATH aan het begin toe te voegen, een techniek die in het tweede scenario hierboven is beschreven.</span><span class="sxs-lookup"><span data-stu-id="48acb-184">You can also influence routing from VNet to your on-premises network, if you have multiple ExpressRoute circuits, by configuring the weight of a connection instead of applying AS PATH prepending, a technique described in the second scenario above.</span></span> <span data-ttu-id="48acb-185">Wanneer er wordt bepaald hoe het verkeer moet worden verzonden, wordt er voor elk voorvoegsel altijd eerst gekeken naar het gewicht van de verbinding en dan pas naar de AS PATH-lengte.</span><span class="sxs-lookup"><span data-stu-id="48acb-185">For each prefix, we will always look at the connection weight before the AS Path length when deciding how to send traffic.</span></span>
>
>
