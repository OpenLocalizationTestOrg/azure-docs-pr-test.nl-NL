---
title: Azure Media Services tot gefragmenteerde MP4 live opnemen specificatie | Microsoft Docs
description: Deze specificatie beschrijft het protocol en de indeling voor gefragmenteerde MP4 gebaseerde live streaming opname voor Azure Media Services. U kunt Azure Media Services gebruiken om te streamen live gebeurtenissen en inhoud in realtime uitzenden met behulp van Azure als het cloudplatform. Dit document wordt ook beschreven best practices voor het bouwen van maximaal redundante en robuuste live mechanismen opnemen.
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 6250b73504bec765b8299060a29e84e771791cc9
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/29/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="bb2cd-105">Azure Media Services tot gefragmenteerde MP4 live opnemen specificatie</span><span class="sxs-lookup"><span data-stu-id="bb2cd-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="bb2cd-106">Deze specificatie beschrijft het protocol en de indeling voor gefragmenteerde MP4 gebaseerde live streaming opname voor Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-106">This specification describes the protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="bb2cd-107">Media Services biedt een service voor live streamen waarmee klanten kunnen stream live gebeurtenissen en de inhoud in realtime uitzenden met behulp van Azure als het cloudplatform.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-107">Media Services provides a live streaming service that customers can use to stream live events and broadcast content in real time by using Azure as the cloud platform.</span></span> <span data-ttu-id="bb2cd-108">Dit document wordt ook beschreven best practices voor het bouwen van maximaal redundante en robuuste live mechanismen opnemen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="bb2cd-109">1. Conformiteit notatie</span><span class="sxs-lookup"><span data-stu-id="bb2cd-109">1. Conformance notation</span></span>
<span data-ttu-id="bb2cd-110">De sleutel 'Moet' 'Moet geen,' 'Is vereist,' "Geldt," "wordt niet," 'SHOULD', 'Mag niet' woorden 'Aanbevolen,' 'Kunnen' en 'Optioneel' in dit document moeten worden geïnterpreteerd als ze worden beschreven in RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-110">The key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are to be interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="bb2cd-111">2. Diagram van de service</span><span class="sxs-lookup"><span data-stu-id="bb2cd-111">2. Service diagram</span></span>
<span data-ttu-id="bb2cd-112">Het volgende diagram toont de architectuur op hoog niveau van de service voor live streamen in Media Services:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-112">The following diagram shows the high-level architecture of the live streaming service in Media Services:</span></span>

1. <span data-ttu-id="bb2cd-113">Een live coderingsprogramma duwt live-feeds kanalen die zijn gemaakt en zijn ingericht via Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-113">A live encoder pushes live feeds to channels that are created and provisioned via the Azure Media Services SDK.</span></span>
2. <span data-ttu-id="bb2cd-114">Kanalen, programma's en streaming-eindpunten in Media Services verwerkt alle functionaliteiten voor live streamen, waaronder opnemen, opmaken, DVR, beveiliging, schaalbaarheid en redundantie cloud.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-114">Channels, programs, and streaming endpoints in Media Services handle all the live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="bb2cd-115">Klanten kunnen eventueel kiezen voor het implementeren van een laag Azure Content Delivery Network tussen het streaming-eindpunt en de clienteindpunten.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-115">Optionally, customers can choose to deploy an Azure Content Delivery Network layer between the streaming endpoint and the client endpoints.</span></span>
4. <span data-ttu-id="bb2cd-116">Client-eindpunten stroom van het streaming-eindpunt met behulp van protocollen HTTP adaptief streamen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-116">Client endpoints stream from the streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="bb2cd-117">Voorbeelden zijn Microsoft Smooth Streaming, dynamische adaptief streamen via HTTP (DASH of MPEG-DASH) en Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![stroom opnemen][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="bb2cd-119">3. De indeling bitstream – ISO 14496 12 gefragmenteerd MP4</span><span class="sxs-lookup"><span data-stu-id="bb2cd-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="bb2cd-120">Draadindeling voor live streamen opnemen die worden beschreven dit document is gebaseerd op [ISO 14496 12].</span><span class="sxs-lookup"><span data-stu-id="bb2cd-120">The wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="bb2cd-121">Zie voor een gedetailleerde uitleg van gefragmenteerde MP4-indeling en extensies zowel voor video-on-demand bestanden en live streaming opname [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="bb2cd-122">Indeling definities voor Live opnemen</span><span class="sxs-lookup"><span data-stu-id="bb2cd-122">Live ingest format definitions</span></span>
<span data-ttu-id="bb2cd-123">De volgende lijst bevat speciale indeling definities die van toepassing op live in Azure Media Services opnemen:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-123">The following list describes special format definitions that apply to live ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="bb2cd-124">De **ftyp legt vast**, **vak Server Manifest Live**, en **moov** vakken bij elke aanvraag (HTTP POST) moeten worden verzonden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-124">The **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="bb2cd-125">Deze vakken aan het begin van de stroom moeten worden verzonden en elk gewenst moment de encoder moet opnieuw verbinding maken om te hervatten stroom opnemen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-125">These boxes MUST be sent at the beginning of the stream and any time the encoder must reconnect to resume stream ingest.</span></span> <span data-ttu-id="bb2cd-126">Zie de sectie 6 in [1] voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="bb2cd-127">Sectie 3.3.2 in [1] definieert een optioneel het zogenaamde **StreamManifestBox** voor live opnemen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="bb2cd-128">Vanwege de routering logica van de Azure load balancer is met behulp van dit vak afgeschaft.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-128">Due to the routing logic of the Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="bb2cd-129">Het selectievakje niet moet aanwezig zijn bij het opnemen van Media Services.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-129">The box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="bb2cd-130">Als dit selectievakje aanwezig is, Media Services achtergrond deze genegeerd.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="bb2cd-131">De **TrackFragmentExtendedHeaderBox** vak gedefinieerd in 3.2.3.2 in [1] moet aanwezig zijn voor elke fragment.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-131">The **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="bb2cd-132">Versie 2 van de **TrackFragmentExtendedHeaderBox** vak moet worden gebruikt voor het genereren van mediasegmenten die identiek URL's in meerdere datacenters hebben.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-132">Version 2 of the **TrackFragmentExtendedHeaderBox** box SHOULD be used to generate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="bb2cd-133">Het veld fragment index is REQUIRED voor cross-datacenter failover van een index gebaseerde streaming-indelingen zoals Apple HLS en MPEG-DASH op basis van een index.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-133">The fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="bb2cd-134">Om cross-datacenter failover, wordt de index fragment moet worden gesynchroniseerd tussen meerdere coderingsprogramma's en worden verhoogd met 1 voor elke fragment opeenvolgende media, zelfs in encoder opnieuw wordt opgestart of storingen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-134">To enable cross-datacenter failover, the fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="bb2cd-135">Sectie 3.3.6 in [1] definieert een invoervak **MovieFragmentRandomAccessBox** (**mfra**) die aan het einde van live opname worden verzonden om aan te geven einde van stroom (EOS) naar het kanaal.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at the end of live ingestion to indicate end-of-stream (EOS) to the channel.</span></span> <span data-ttu-id="bb2cd-136">Als gevolg van de logica opnemen van Media Services, met behulp van EOS is afgeschaft, en de **mfra** vak voor live opname niet moet worden verzonden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-136">Due to the ingest logic of Media Services, using EOS is deprecated, and the **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="bb2cd-137">Als verzonden, Media Services achtergrond deze genegeerd.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="bb2cd-138">Als u de status van het punt opnemen herstellen, wordt aangeraden dat u [kanaal opnieuw](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-138">To reset the state of the ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="bb2cd-139">Wordt ook aangeraden dat u [programma stoppen](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) naar einde van een presentatie en de stream.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) to end a presentation and stream.</span></span>
6. <span data-ttu-id="bb2cd-140">De duur van MP4-fragment moet constant, de grootte van de clientmanifesten verminderen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-140">The MP4 fragment duration SHOULD be constant, to reduce the size of the client manifests.</span></span> <span data-ttu-id="bb2cd-141">Een constante MP4 verbetert ook methodiek voor client downloaden met behulp van het fragment duur Herhaal labels.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-141">A constant MP4 fragment duration also improves client download heuristics through the use of repeat tags.</span></span> <span data-ttu-id="bb2cd-142">De duur kan om te compenseren voor niet-integere framesnelheid variëren.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-142">The duration MAY fluctuate to compensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="bb2cd-143">De duur van MP4-fragment moet liggen tussen ongeveer 2 en 6 seconden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-143">The MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="bb2cd-144">MP4 fragment tijdstempels en indexen (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` en `fragment_index`) moeten in oplopende volgorde binnenkomen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="bb2cd-145">Hoewel Media Services flexibel omgaan met dubbele fragmenten, heeft dit dan beperkt de mogelijkheid om opnieuw te rangschikken fragmenten volgens de planning van de media.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-145">Although Media Services is resilient to duplicate fragments, it has limited ability to reorder fragments according to the media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="bb2cd-146">4. Indeling protocol: HTTP</span><span class="sxs-lookup"><span data-stu-id="bb2cd-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="bb2cd-147">ISO gefragmenteerd MP4 gebaseerde live opnemen voor Media Services maakt gebruik van een standaard langlopende HTTP POST-aanvraag voor het verzenden van mediagegevens van het gecodeerde die wordt verpakt in gefragmenteerde MP4-indeling met de service.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request to transmit encoded media data that is packaged in fragmented MP4 format to the service.</span></span> <span data-ttu-id="bb2cd-148">Elke HTTP POST verstuurt een complete gefragmenteerd MP4 bitstream ('stream'), vanaf het begin met header vakken (**ftyp legt vast**, **vak Server Manifest Live**, en **moov** vakken), en wilt doorgaan met een reeks fragmenten (**moof** en **mdat** vakken).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from the beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="bb2cd-149">Zie de sectie 9.2 in [1] voor URL-syntaxis voor de HTTP POST-aanvraag.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-149">For URL syntax for the HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="bb2cd-150">Een voorbeeld van de POST-URL is:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-150">An example of the POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="bb2cd-151">Vereisten</span><span class="sxs-lookup"><span data-stu-id="bb2cd-151">Requirements</span></span>
<span data-ttu-id="bb2cd-152">Hier volgen de gedetailleerde vereisten:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-152">Here are the detailed requirements:</span></span>

1. <span data-ttu-id="bb2cd-153">Het coderingsprogramma moet eerst de uitzending verzenden van een HTTP POST-aanvraag met een leeg 'hoofdtekst' (nul inhoudslengte) met behulp van dezelfde URL voor de opname.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-153">The encoder SHOULD start the broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using the same ingestion URL.</span></span> <span data-ttu-id="bb2cd-154">Zo kunt u het coderingsprogramma snel detecteren of het eindpunt live opname geldig is en als er verificatie of andere voorwaarden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-154">This can help the encoder quickly detect whether the live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="bb2cd-155">Per HTTP-protocol, kan niet de server teruggestuurd een HTTP-antwoord totdat de gehele request, met inbegrip van de hoofdtekst van bericht is ontvangen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-155">Per HTTP protocol, the server can't send back an HTTP response until the entire request, including the POST body, is received.</span></span> <span data-ttu-id="bb2cd-156">Gezien de langlopende aard van een live gebeurtenis, zonder deze stap wordt het coderingsprogramma niet mogelijk voor het detecteren van alle fouten, totdat het klaar is met het verzenden van de gegevens.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-156">Given the long-running nature of a live event, without this step, the encoder might not be able to detect any error until it finishes sending all the data.</span></span>
2. <span data-ttu-id="bb2cd-157">Het coderingsprogramma moet eventuele fouten of verificatiecontroles verwerken vanwege (1).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-157">The encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="bb2cd-158">Als (1) is voltooid met een 200 antwoord worden voortgezet.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="bb2cd-159">Het coderingsprogramma moet een nieuwe HTTP POST-aanvraag beginnen met de gefragmenteerde MP4-stream.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-159">The encoder MUST start a new HTTP POST request with the fragmented MP4 stream.</span></span> <span data-ttu-id="bb2cd-160">De nettolading moet beginnen met de vakken koptekst, gevolgd door fragmenten.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-160">The payload MUST start with the header boxes, followed by fragments.</span></span> <span data-ttu-id="bb2cd-161">Houd er rekening mee dat de **ftyp legt vast**, **vak Server Manifest Live**, en **moov** vakken (in deze volgorde) moeten worden verzonden met elke aanvraag, zelfs als het coderingsprogramma opnieuw verbinding maken moet omdat het eerdere verzoek voorafgaand aan het einde van de stroom is beëindigd.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-161">Note that the **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if the encoder must reconnect because the previous request was terminated prior to the end of the stream.</span></span> 
4. <span data-ttu-id="bb2cd-162">Het coderingsprogramma moet gedeelde codering voor het uploaden, omdat het onmogelijk om te voorspellen van de hele lengte van de inhoud van de live gebeurtenis is voor overdracht gebruiken.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-162">The encoder MUST use chunked transfer encoding for uploading, because it’s impossible to predict the entire content length of the live event.</span></span>
5. <span data-ttu-id="bb2cd-163">Wanneer de gebeurtenis is afgelopen, na het verzenden van het laatste fragment moet het coderingsprogramma probleemloos gesegmenteerde overdrachtscodering berichtenstroom (de meeste HTTP-client stacks verwerkt; het automatisch) eindigen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-163">When the event is over, after sending the last fragment, the encoder MUST gracefully end the chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="bb2cd-164">Het coderingsprogramma moet wachten op de service te retourneren van de laatste antwoordcode en vervolgens de verbinding verbreken.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-164">The encoder MUST wait for the service to return the final response code, and then terminate the connection.</span></span> 
6. <span data-ttu-id="bb2cd-165">Het coderingsprogramma niet moet de `Events()` zelfstandig naamwoord zoals beschreven in 9.2 in [1] voor live opname in Media Services.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-165">The encoder MUST NOT use the `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="bb2cd-166">Als de HTTP POST-aanvraag wordt beëindigd of met een TCP-fout voorafgaand aan het einde van de stroom een optreedt time-out, moet het coderingsprogramma uitgeven van een nieuwe POST-aanvraag met behulp van een nieuwe verbinding en volg de bovenstaande vereisten.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-166">If the HTTP POST request terminates or times out with a TCP error prior to the end of the stream, the encoder MUST issue a new POST request by using a new connection, and follow the preceding requirements.</span></span> <span data-ttu-id="bb2cd-167">Het coderingsprogramma moet bovendien opnieuw verzenden van de vorige twee MP4 fragmenten voor elk nummer in de stroom en hervatten zonder een onderbreking in de tijdlijn van media.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-167">Additionally, the encoder MUST resend the previous two MP4 fragments for each track in the stream, and resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="bb2cd-168">Opnieuw verzenden van de laatste twee MP4-fragmenten voor elk nummer zorgt ervoor dat er geen gegevens verloren gaan.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-168">Resending the last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="bb2cd-169">Met andere woorden, als een stroom geen audio en video bijgehouden bevat en de huidige POST-aanvraag is mislukt, moet de encoder opnieuw verbinding maken en verzenden van de laatste twee fragmenten voor de audio bijhouden die eerder met succes zijn verzonden, en de laatste twee fragmenten voor de video bijhouden die eerder met succes zijn verzonden, om ervoor te zorgen dat er geen gegevensverlies is.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-169">In other words, if a stream contains both an audio and a video track, and the current POST request fails, the encoder must reconnect and resend the last two fragments for the audio track, which were previously successfully sent, and the last two fragments for the video track, which were previously successfully sent, to ensure that there is no data loss.</span></span> <span data-ttu-id="bb2cd-170">Het coderingsprogramma moet onderhouden een "forward" buffer van media fragmenten die het opnieuw verzendt wanneer verbinding wordt gemaakt.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-170">The encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="bb2cd-171">5. Tijdschaal</span><span class="sxs-lookup"><span data-stu-id="bb2cd-171">5. Timescale</span></span>
<span data-ttu-id="bb2cd-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) beschrijft het gebruik van tijdschaal voor **SmoothStreamingMedia** (sectie 2.2.2.1) **StreamElement** (sectie 2.2.2.3) **StreamFragmentElement** (sectie 2.2.2.6) en **LiveSMIL** (sectie 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes the usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="bb2cd-173">Als de waarde tijdschaal niet aanwezig is, is de standaardwaarde gebruikt 10,000,000 (10 MHz).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-173">If the timescale value is not present, the default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="bb2cd-174">Hoewel de indelingsspecificatie Smooth Streaming wordt geen informatie over het gebruik van andere waarden tijdschaal geblokkeerd, de meeste implementaties van het coderingsprogramma gebruikt deze standaard waarde (10 MHz) voor het genereren van Smooth Streaming opnemen van gegevens.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-174">Although the Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) to generate Smooth Streaming ingest data.</span></span> <span data-ttu-id="bb2cd-175">Vanwege de [Azure Media dynamische pakketten](media-services-dynamic-packaging-overview.md) functie, het is raadzaam een tijdschaal 90 KHz te gebruiken voor video stromen en 44,1 of 48.1 KHz voor audio stromen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-175">Due to the [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="bb2cd-176">Als andere tijdschaal waarden worden gebruikt voor verschillende stromen, kan de stroom-niveau tijdschaal moet worden verzonden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-176">If different timescale values are used for different streams, the stream-level timescale MUST be sent.</span></span> <span data-ttu-id="bb2cd-177">Zie voor meer informatie [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="bb2cd-178">6. Definitie van 'stream'</span><span class="sxs-lookup"><span data-stu-id="bb2cd-178">6. Definition of “stream”</span></span>
<span data-ttu-id="bb2cd-179">Stroom is de basiseenheid voor bewerking in live opname voor het opstellen van live presentaties verwerken streaming failover en redundantie scenario's.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-179">Stream is the basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="bb2cd-180">Stroom wordt gedefinieerd als een unieke, gefragmenteerde MP4-bitstream met één track of meerdere nummers.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="bb2cd-181">Een volledige live presentatie kan een of meer stromen, afhankelijk van de configuratie van de live coderingsprogramma's bevatten.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-181">A full live presentation might contain one or more streams, depending on the configuration of the live encoders.</span></span> <span data-ttu-id="bb2cd-182">De volgende voorbeelden ziet diverse opties van het gebruik van streams voor het opstellen van een volledige live presentatie.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-182">The following examples illustrate various options of using streams to compose a full live presentation.</span></span>

<span data-ttu-id="bb2cd-183">**Voorbeeld:**</span><span class="sxs-lookup"><span data-stu-id="bb2cd-183">**Example:**</span></span> 

<span data-ttu-id="bb2cd-184">Een klant wil een live streaming presentatie met de volgende audio/video-bitsnelheden maken:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-184">A customer wants to create a live streaming presentation that includes the following audio/video bitrates:</span></span>

<span data-ttu-id="bb2cd-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span><span class="sxs-lookup"><span data-stu-id="bb2cd-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="bb2cd-186">Audio-128 k</span><span class="sxs-lookup"><span data-stu-id="bb2cd-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="bb2cd-187">Optie 1: Alle nummers in één stroom</span><span class="sxs-lookup"><span data-stu-id="bb2cd-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="bb2cd-188">Bij deze optie geen enkele coderingsprogramma genereert alle audio/video-nummers en verzamelt ze in één gefragmenteerde MP4 bitstream.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="bb2cd-189">De gefragmenteerde MP4-bitstream wordt verzonden via één HTTP POST-verbinding.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-189">The fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="bb2cd-190">In dit voorbeeld is er slechts één stream voor deze live presentatie.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-190">In this example, there is only one stream for this live presentation.</span></span>

![Streams-een bijhouden][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="bb2cd-192">Optie 2: Elk nummer in een afzonderlijke stream</span><span class="sxs-lookup"><span data-stu-id="bb2cd-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="bb2cd-193">Bij deze optie het coderingsprogramma plaatst een nummer in elke bitstream fragment MP4 en plaatst alle stromen via afzonderlijke HTTP-verbindingen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-193">In this option, the encoder puts one track into each fragment MP4 bitstream, and then posts all of the streams over separate HTTP connections.</span></span> <span data-ttu-id="bb2cd-194">Dit kan worden gedaan met een coderingsprogramma of met meerdere coderingsprogramma's.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="bb2cd-195">De live opname ziet deze live presentatie als bestaat uit vier stromen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-195">The live ingestion sees this live presentation as composed of four streams.</span></span>

![Streams afzonderlijke houdt][image3]

### <a name="option-3-bundle-audio-track-with-the-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="bb2cd-197">Optie 3: Audio bijhouden met de laagste bitrate video spoor bundelen in één stream</span><span class="sxs-lookup"><span data-stu-id="bb2cd-197">Option 3: Bundle audio track with the lowest bitrate video track into one stream</span></span>
<span data-ttu-id="bb2cd-198">Bij deze optie kiest de klant de audio bijhouden met de laagste bitrate video bijhouden bundelen in één MP4-fragment bitstream, en laat de andere twee video sporen als afzonderlijke stromen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-198">In this option, the customer chooses to bundle the audio track with the lowest-bitrate video track in one fragment MP4 bitstream, and leave the other two video tracks as separate streams.</span></span> 

![Streams-audio en video-nummers][image4]

### <a name="summary"></a><span data-ttu-id="bb2cd-200">Samenvatting</span><span class="sxs-lookup"><span data-stu-id="bb2cd-200">Summary</span></span>
<span data-ttu-id="bb2cd-201">Dit is geen uitputtende lijst van alle mogelijke opname opties voor dit voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="bb2cd-202">Als een sterker nog, wordt een groepering van nummers in streams ondersteund door live opname.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="bb2cd-203">Klanten en leveranciers encoder kunt hun eigen implementaties op basis van de technische complexiteit, encoder-capaciteit en redundantie en overwegingen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="bb2cd-204">In de meeste gevallen is er echter slechts één-nummer voor de hele live presentatie.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-204">However, in most cases, there is only one audio track for the entire live presentation.</span></span> <span data-ttu-id="bb2cd-205">Het is dus belangrijk om te controleren of de gezondheid van de stroom opnemen met de-nummer. Dit aandachtspunt vaak resulteert in het nummer in een eigen stroom (zoals in de optie 2) of het bundeling deze met de laagste bitrate video bijhouden (zoals in de optie 3).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-205">So, it’s important to ensure the healthiness of the ingest stream that contains the audio track. This consideration often results in putting the audio track in its own stream (as in Option 2) or bundling it with the lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="bb2cd-206">Ook, voor betere redundantie en fouttolerantie, verzendt de dezelfde audio bijhouden in twee verschillende stromen (optie 2 met redundant audio houdt) of de audio bijhouden met ten minste twee van de laagste bitrate video-nummers (optie 3 met audio gebundeld in ten minste twee video stromen) bundeling wordt nadrukkelijk aanbevolen voor live opnemen in Media Services.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-206">Also, for better redundancy and fault tolerance, sending the same audio track in two different streams (Option 2 with redundant audio tracks) or bundling the audio track with at least two of the lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="bb2cd-207">7. Failover van de service</span><span class="sxs-lookup"><span data-stu-id="bb2cd-207">7. Service failover</span></span>
<span data-ttu-id="bb2cd-208">Gegeven de aard van live streamen, zijn goede failover-ondersteuning is essentieel voor de beschikbaarheid van de service.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-208">Given the nature of live streaming, good failover support is critical for ensuring the availability of the service.</span></span> <span data-ttu-id="bb2cd-209">Media Services is ontworpen voor het verwerken van verschillende typen fouten, waaronder netwerkfouten, server-fouten en opslagproblemen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-209">Media Services is designed to handle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="bb2cd-210">Wanneer gebruikt in combinatie met de juiste failoverlogica vanaf de live codering, kunnen klanten een uiterst betrouwbare service voor live streamen vanuit de cloud kunnen bereiken.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-210">When used in conjunction with proper failover logic from the live encoder side, customers can achieve a highly reliable live streaming service from the cloud.</span></span>

<span data-ttu-id="bb2cd-211">In deze sectie bespreken we service failover-scenario's.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="bb2cd-212">In dit geval wordt de fout gebeurt er ergens in de service en het doet zich voor als een netwerkfout opgetreden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-212">In this case, the failure happens somewhere within the service, and it manifests itself as a network error.</span></span> <span data-ttu-id="bb2cd-213">Hier volgen enkele aanbevelingen voor de uitvoering van de codering voor het verwerken van de service failover:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-213">Here are some recommendations for the encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="bb2cd-214">Gebruik een 10 seconden time-out voor de TCP-verbinding tot stand brengen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-214">Use a 10-second timeout for establishing the TCP connection.</span></span> <span data-ttu-id="bb2cd-215">Als een poging de verbinding tot stand brengen langer dan 10 seconden duurt, afbreken van de bewerking en probeer het opnieuw.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-215">If an attempt to establish the connection takes longer than 10 seconds, abort the operation and try again.</span></span> 
2. <span data-ttu-id="bb2cd-216">Gebruik een korte time-out voor het verzenden van bericht segmenten van de HTTP-aanvraag.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-216">Use a short timeout for sending the HTTP request message chunks.</span></span> <span data-ttu-id="bb2cd-217">Als de doel-MP4-fragment duur N seconden, gebruikt u de time-out voor een verzenden tussen N en 2 N seconden; Als de duur van MP4-fragment 6 seconden, gebruikt u bijvoorbeeld een time-out van 6 tot en met 12 seconden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-217">If the target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if the MP4 fragment duration is 6 seconds, use a timeout of 6 to 12 seconds.</span></span> <span data-ttu-id="bb2cd-218">Als er een time-out optreedt, opnieuw instellen van de verbinding en opent u een nieuwe verbinding hervatten stroom opnemen op de nieuwe verbinding.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-218">If a timeout occurs, reset the connection, open a new connection, and resume stream ingest on the new connection.</span></span> 
3. <span data-ttu-id="bb2cd-219">Houd een rolling buffer die is de laatste twee fragmenten voor elk nummer dat correct en volledig naar de service verzonden is.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-219">Maintain a rolling buffer that has the last two fragments for each track that were successfully and completely sent to the service.</span></span>  <span data-ttu-id="bb2cd-220">Als de HTTP POST-aanvraag voor een stroom wordt beëindigd of time-out voorafgaand aan het einde van de stroom, opent u een nieuwe verbinding en beginnen met een andere HTTP POST-aanvraag, opnieuw verzenden van de stroom-headers, opnieuw verzenden van de laatste twee fragmenten voor elk nummer en hervatten van de stroom zonder een onderbreking in de tijdlijn media.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-220">If the HTTP POST request for a stream is terminated or times out prior to the end of the stream, open a new connection and begin another HTTP POST request, resend the stream headers, resend the last two fragments for each track, and resume the stream without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="bb2cd-221">Dit vermindert de kans op verlies van gegevens.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-221">This reduces the chance of data loss.</span></span>
4. <span data-ttu-id="bb2cd-222">U wordt aangeraden dat het coderingsprogramma geen beperking is het aantal nieuwe pogingen om een verbinding tot stand brengen of hervatten streaming nadat een TCP-fout is opgetreden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-222">We recommend that the encoder does NOT limit the number of retries to establish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="bb2cd-223">Nadat een TCP-fout:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-223">After a TCP error:</span></span>
  
    <span data-ttu-id="bb2cd-224">a.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-224">a.</span></span> <span data-ttu-id="bb2cd-225">De huidige verbinding moet worden gesloten en een nieuwe verbinding moet worden gemaakt voor een nieuwe HTTP POST-aanvraag.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-225">The current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="bb2cd-226">b.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-226">b.</span></span> <span data-ttu-id="bb2cd-227">De nieuwe HTTP POST-URL moet hetzelfde zijn als de oorspronkelijke POST-URL.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-227">The new HTTP POST URL MUST be the same as the initial POST URL.</span></span>
  
    <span data-ttu-id="bb2cd-228">c.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-228">c.</span></span> <span data-ttu-id="bb2cd-229">De nieuwe HTTP POST moet bestaan uit kopteksten stream (**ftyp legt vast**, **vak Server Manifest Live**, en **moov** vakken) die identiek zijn aan de kopteksten stream in het eerste bericht.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-229">The new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical to the stream headers in the initial POST.</span></span>
  
    <span data-ttu-id="bb2cd-230">d.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-230">d.</span></span> <span data-ttu-id="bb2cd-231">De laatste twee fragmenten verzonden voor elk nummer moeten opnieuw worden verzonden en streaming moet hervat zonder een onderbreking in de tijdlijn van media.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-231">The last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="bb2cd-232">De tijdstempels MP4-fragment toenemen continu, zelfs in een HTTP POST-aanvragen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-232">The MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="bb2cd-233">Het coderingsprogramma moet de HTTP POST-aanvraag beëindigd als er gegevens worden niet verzonden met een frequentie in overeenstemming met de duur van MP4-fragment.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-233">The encoder SHOULD terminate the HTTP POST request if data is not being sent at a rate commensurate with the MP4 fragment duration.</span></span>  <span data-ttu-id="bb2cd-234">Een HTTP POST-aanvraag die geen gegevens verzendt kunt voorkomen dat Media Services de encoder snel verbreken in het geval van een service-update.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update.</span></span> <span data-ttu-id="bb2cd-235">Daarom moet het HTTP POST-protocol voor sparse (ad signaal) houdt moeten worden kortstondig wordt beëindigd zodra de sparse fragment wordt verzonden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-235">For this reason, the HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as the sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="bb2cd-236">8. codering-failover</span><span class="sxs-lookup"><span data-stu-id="bb2cd-236">8. Encoder failover</span></span>
<span data-ttu-id="bb2cd-237">Failover van de codering is het tweede type van failover-scenario dat moet worden opgelost voor de levering van end-to-end-live-streaming.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-237">Encoder failover is the second type of failover scenario that needs to be addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="bb2cd-238">In dit scenario wordt optreedt de fout aan de kant van de encoder.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-238">In this scenario, the error condition occurs on the encoder side.</span></span> 

![codering-failover][image5]

<span data-ttu-id="bb2cd-240">De volgende verwachtingen van het eindpunt live opname van toepassing wanneer encoder failover gebeurt:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-240">The following expectations apply from the live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="bb2cd-241">Een nieuw exemplaar van de codering moet worden gemaakt om door te gaan streaming, zoals geïllustreerd in het diagram (Stream voor 3000k video met stippellijn).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-241">A new encoder instance SHOULD be created to continue streaming, as illustrated in the diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="bb2cd-242">De nieuwe encoder moet dezelfde URL gebruiken voor HTTP POST-aanvragen als de instantie is mislukt.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-242">The new encoder MUST use the same URL for HTTP POST requests as the failed instance.</span></span>
3. <span data-ttu-id="bb2cd-243">De nieuwe encoder POST-aanvraag moet opnemen met de dezelfde gefragmenteerde MP4-header vakken als de instantie is mislukt.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-243">The new encoder’s POST request MUST include the same fragmented MP4 header boxes as the failed instance.</span></span>
4. <span data-ttu-id="bb2cd-244">De nieuwe encoder moet juist worden gesynchroniseerd met alle andere actieve coderingsprogramma's voor dezelfde live presentatie gesynchroniseerde audio/video-voorbeelden met uitgelijnde fragment grenzen genereren.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-244">The new encoder MUST be properly synced with all other running encoders for the same live presentation to generate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="bb2cd-245">De nieuwe stroom moet semantisch equivalent met de vorige stroom en uitwisselbaar op het niveau van-header en het fragment.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-245">The new stream MUST be semantically equivalent with the previous stream, and interchangeable at the header and fragment levels.</span></span>
6. <span data-ttu-id="bb2cd-246">De nieuwe encoder moet proberen om gegevensverlies te minimaliseren.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-246">The new encoder SHOULD try to minimize data loss.</span></span> <span data-ttu-id="bb2cd-247">De `fragment_absolute_time` en `fragment_index` Media fragmenten vanaf het punt waar de encoder laatste gestopt moeten verhogen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-247">The `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from the point where the encoder last stopped.</span></span> <span data-ttu-id="bb2cd-248">De `fragment_absolute_time` en `fragment_index` in een ononderbroken wijze moet verhogen, maar is het toegestaan om te introduceren een onderbreking, indien nodig.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-248">The `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible to introduce a discontinuity, if necessary.</span></span> <span data-ttu-id="bb2cd-249">Media Services negeert fragmenten dat al is ontvangen en verwerkt, dus is het beter err naast fragmenten dan introduceren aan onderbrekingen in de tijdlijn media opnieuw te verzenden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-249">Media Services ignores fragments that it has already received and processed, so it's better to err on the side of resending fragments than to introduce discontinuities in the media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="bb2cd-250">9. codering redundantie</span><span class="sxs-lookup"><span data-stu-id="bb2cd-250">9. Encoder redundancy</span></span>
<span data-ttu-id="bb2cd-251">Voor bepaalde kritieke live gebeurtenissen dat verzoek zelfs hogere beschikbaarheid en kwaliteit vereisen, we u actieve redundante coderingsprogramma's gebruiken raden voor een naadloze failover zonder verlies van gegevens.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders to achieve seamless failover with no data loss.</span></span>

![codering redundantie][image6]

<span data-ttu-id="bb2cd-253">Zoals wordt geïllustreerd in dit diagram, push twee groepen coderingsprogramma's twee exemplaren van elke stroom tegelijkertijd naar de service voor live.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into the live service.</span></span> <span data-ttu-id="bb2cd-254">Deze instelling wordt ondersteund, omdat Media Services dubbele fragmenten op basis van de stroom-ID en het fragment timestamp uitfilteren kunt.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="bb2cd-255">De resulterende livestream en -archief is één exemplaar van de stromen die de best mogelijke aggregatie van de twee bronnen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-255">The resulting live stream and archive is a single copy of all the streams that is the best possible aggregation from the two sources.</span></span> <span data-ttu-id="bb2cd-256">Bijvoorbeeld in een hypothetische extreme aanvraag, zolang er is een coderingsprogramma (deze heeft geen moet hetzelfde account) uitgevoerd op elk gewenst moment in de tijd van elke stroom, de resulterende live stream van de service is continue zonder gegevensverlies.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have to be the same one) running at any given point in time for each stream, the resulting live stream from the service is continuous without data loss.</span></span> 

<span data-ttu-id="bb2cd-257">De vereisten voor dit scenario zijn bijna gelijk zijn aan de vereisten in het geval 'Encoder failover' met de uitzondering die de tweede reeks coderingsprogramma's worden uitgevoerd op hetzelfde moment als de primaire coderingsprogramma's.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-257">The requirements for this scenario are almost the same as the requirements in the "Encoder failover" case, with the exception that the second set of encoders are running at the same time as the primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="bb2cd-258">10. redundantie van de service</span><span class="sxs-lookup"><span data-stu-id="bb2cd-258">10. Service redundancy</span></span>
<span data-ttu-id="bb2cd-259">Voor maximaal redundante globale distributie, moet u soms regio-overschrijdende back-up voor het afhandelen van regionale noodsituaties hebben.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-259">For highly redundant global distribution, sometimes you must have cross-region backup to handle regional disasters.</span></span> <span data-ttu-id="bb2cd-260">Uitbreiden van de topologie 'Encoder redundantie', kunnen klanten kiezen om een redundante service-implementatie in een andere regio die verbonden met de tweede reeks coderingsprogramma's.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-260">Expanding on the “Encoder redundancy” topology, customers can choose to have a redundant service deployment in a different region that's connected with the second set of encoders.</span></span> <span data-ttu-id="bb2cd-261">Klanten kunnen ook werken met een Content Delivery Network-provider voor het implementeren van een globale Traffic Manager voor de twee implementaties naadloos om clientverkeer te routeren.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-261">Customers also can work with a Content Delivery Network provider to deploy a Global Traffic Manager in front of the two service deployments to seamlessly route client traffic.</span></span> <span data-ttu-id="bb2cd-262">De vereisten voor het coderingsprogramma's zijn hetzelfde als de aanvraag 'Encoder redundantie'.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-262">The requirements for the encoders are the same as the “Encoder redundancy” case.</span></span> <span data-ttu-id="bb2cd-263">De enige uitzondering hierop is dat de tweede set worden waarnaar wordt verwezen naar een andere live coderingsprogramma's moet eindpunt opnemen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-263">The only exception is that the second set of encoders needs to be pointed to a different live ingest endpoint.</span></span> <span data-ttu-id="bb2cd-264">Het volgende diagram ziet u deze installatie:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-264">The following diagram shows this setup:</span></span>

![redundantie van de service][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="bb2cd-266">11. Speciale soorten opname-indelingen</span><span class="sxs-lookup"><span data-stu-id="bb2cd-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="bb2cd-267">Deze sectie wordt beschreven speciale soorten live opname-indelingen die zijn ontworpen voor het afhandelen van specifieke scenario's.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-267">This section discusses special types of live ingestion formats that are designed to handle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="bb2cd-268">Sparse bijhouden</span><span class="sxs-lookup"><span data-stu-id="bb2cd-268">Sparse track</span></span>
<span data-ttu-id="bb2cd-269">Wanneer u een live streaming presentatie met een interactieve ervaring, vaak het nodig is voor het verzenden van gebeurtenissen die tijd zijn gesynchroniseerd of signalen in-band met de belangrijkste mediagegevens.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-269">When delivering a live streaming presentation with a rich client experience, often it's necessary to transmit time-synced events or signals in-band with the main media data.</span></span> <span data-ttu-id="bb2cd-270">Een voorbeeld hiervan is dynamische live ad invoegen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="bb2cd-271">Dit type gebeurtenis-signalering wijkt af van reguliere audio/video-streaming vanwege de sparse aard.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="bb2cd-272">Met andere woorden, de signalering gegevens meestal gebeurt niet continu en het interval kan zijn moeilijk te voorspellen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-272">In other words, the signaling data usually does not happen continuously, and the interval can be hard to predict.</span></span> <span data-ttu-id="bb2cd-273">Het concept van sparse bijhouden is ontworpen voor opnemen en signalering van gegevens in-band-broadcast.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-273">The concept of sparse track was designed to ingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="bb2cd-274">De volgende stappen zijn een aanbevolen implementatie voor het opnemen van sparse bijhouden:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-274">The following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="bb2cd-275">Maak een afzonderlijke gefragmenteerde MP4 bitstream met sparse houdt, zonder audio/video houdt.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="bb2cd-276">In de **vak Server Manifest Live** zoals gedefinieerd in de sectie 6 in [1], gebruiken de *parentTrackName* parameter om de naam van de bovenliggende bijhouden. Zie voor meer informatie de sectie 4.2.1.2.1.2 in [1].</span><span class="sxs-lookup"><span data-stu-id="bb2cd-276">In the **Live Server Manifest Box** as defined in Section 6 in [1], use the *parentTrackName* parameter to specify the name of the parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="bb2cd-277">In de **vak Server Manifest Live**, **manifestOutput** moet worden ingesteld op **true**.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-277">In the **Live Server Manifest Box**, **manifestOutput** MUST be set to **true**.</span></span>
4. <span data-ttu-id="bb2cd-278">Gezien de sparse aard van de gebeurtenis signalering, raden we het volgende:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-278">Given the sparse nature of the signaling event, we recommended the following:</span></span>
   
    <span data-ttu-id="bb2cd-279">a.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-279">a.</span></span> <span data-ttu-id="bb2cd-280">Aan het begin van de live gebeurtenis verzendt het coderingsprogramma de selectievakjes voor de eerste header aan de service, waarmee de service de sparse bijhouden registratie in het manifest van de client.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-280">At the beginning of the live event, the encoder sends the initial header boxes to the service, which allows the service to register the sparse track in the client manifest.</span></span>
   
    <span data-ttu-id="bb2cd-281">b.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-281">b.</span></span> <span data-ttu-id="bb2cd-282">HTTP POST-aanvraag moet worden beëindigd door de encoder wanneer gegevens worden niet verzonden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-282">The encoder SHOULD terminate the HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="bb2cd-283">Een langlopende HTTP POST die geen gegevens verzendt kunt voorkomen dat Media Services de encoder snel verbreken in het geval van een service-update of de server opnieuw opstarten.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update or server reboot.</span></span> <span data-ttu-id="bb2cd-284">In dergelijke gevallen is de server tijdelijk zijn geblokkeerd in een ontvangstbewerking op de socket.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-284">In these cases, the media server is temporarily blocked in a receive operation on the socket.</span></span>
   
    <span data-ttu-id="bb2cd-285">c.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-285">c.</span></span> <span data-ttu-id="bb2cd-286">Tijdens de tijd wanneer signalering van gegevens is niet beschikbaar, de encoder SHOULD sluit het HTTP POST-protocol vragen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-286">During the time when signaling data is not available, the encoder SHOULD close the HTTP POST request.</span></span> <span data-ttu-id="bb2cd-287">Terwijl de POST-aanvraag actief is, moet het coderingsprogramma gegevens verzenden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-287">While the POST request is active, the encoder SHOULD send data.</span></span>

    <span data-ttu-id="bb2cd-288">d.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-288">d.</span></span> <span data-ttu-id="bb2cd-289">Bij het verzenden van sparse fragmenten instellen het coderingsprogramma een expliciete header content-length, als deze beschikbaar is.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-289">When sending sparse fragments, the encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="bb2cd-290">e.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-290">e.</span></span> <span data-ttu-id="bb2cd-291">Bij het verzenden van sparse fragmenten op basis van een nieuwe verbinding, moet het coderingsprogramma beginnen met het verzenden van de header vakken, gevolgd door de nieuwe fragmenten.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-291">When sending sparse fragments with a new connection, the encoder SHOULD start sending from the header boxes, followed by the new fragments.</span></span> <span data-ttu-id="bb2cd-292">Dit is voor gevallen waarin failover tussen gebeurt en de nieuwe sparse verbinding is met een nieuwe server die niet zichtbaar is voor de sparse bijhouden voordat wordt gemaakt.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-292">This is for cases in which failover happens in-between, and the new sparse connection is being established to a new server that has not seen the sparse track before.</span></span>

    <span data-ttu-id="bb2cd-293">f.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-293">f.</span></span> <span data-ttu-id="bb2cd-294">Het fragment sparse bijhouden beschikbaar voor de client wanneer de bijbehorende bovenliggende bijhouden fragment dat een tijdstempelwaarde groter of gelijk beschikbaar wordt gesteld aan de client.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-294">The sparse track fragment becomes available to the client when the corresponding parent track fragment that has an equal or larger timestamp value is made available to the client.</span></span> <span data-ttu-id="bb2cd-295">Bijvoorbeeld, als de sparse fragment een tijdstempel van t heeft = 1000, wordt verwacht dat nadat de client worden gezien 'video' (ervan uitgaande dat de naam van de bovenliggende bijhouden is 'video') fragment tijdstempel 1000 of voorbij, het kan downloaden, de sparse fragment t = 1000.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-295">For example, if the sparse fragment has a timestamp of t=1000, it is expected that after the client sees "video" (assuming the parent track name is "video") fragment timestamp 1000 or beyond, it can download the sparse fragment t=1000.</span></span> <span data-ttu-id="bb2cd-296">Houd er rekening mee dat het werkelijke signaal kan worden gebruikt voor een andere positie in de presentatie-tijdlijn voor het opgegeven doel.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-296">Note that the actual signal could be used for a different position in the presentation timeline for its designated purpose.</span></span> <span data-ttu-id="bb2cd-297">In dit voorbeeld is het mogelijk dat de sparse fragment van t = 1000 heeft een XML-nettolading is voor het invoegen van een ad dat een paar seconden later.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-297">In this example, it’s possible that the sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="bb2cd-298">g.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-298">g.</span></span> <span data-ttu-id="bb2cd-299">De nettolading van sparse bijhouden fragmenten kan zich in verschillende indelingen (zoals XML, tekst of binair), afhankelijk van het scenario.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-299">The payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on the scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="bb2cd-300">Redundante-nummer</span><span class="sxs-lookup"><span data-stu-id="bb2cd-300">Redundant audio track</span></span>
<span data-ttu-id="bb2cd-301">In een typische HTTP adaptieve streaming-scenario (bijvoorbeeld Smooth Streaming of streepje) vaak, is er slechts één-nummer in de hele presentatie.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in the entire presentation.</span></span> <span data-ttu-id="bb2cd-302">In tegenstelling tot de video nummers die meerdere kwaliteitsniveaus voor de client op fouten te hebben, mag de-nummer een potentieel risico als de opname van de stroom waarin het nummer verbroken is.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-302">Unlike video tracks, which have multiple quality levels for the client to choose from in error conditions, the audio track can be a single point of failure if the ingestion of the stream that contains the audio track is broken.</span></span> 

<span data-ttu-id="bb2cd-303">Media Services ondersteunt u lost dit probleem, live opname van redundante audio houdt.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-303">To solve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="bb2cd-304">Het idee is of de dezelfde-nummer kan worden verzonden naar meerdere keren in verschillende stromen.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-304">The idea is that the same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="bb2cd-305">Hoewel de service alleen-nummer eenmaal in het manifest van de client registreert, kan deze redundante audio houdt als back-ups gebruiken voor het ophalen van audio fragmenten als de primaire-nummer problemen heeft.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-305">Although the service only registers the audio track once in the client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if the primary audio track has issues.</span></span> <span data-ttu-id="bb2cd-306">Als u wilt opnemen redundante audio houdt, het coderingsprogramma moet:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-306">To ingest redundant audio tracks, the encoder needs to:</span></span>

1. <span data-ttu-id="bb2cd-307">Maak de dezelfde-nummer in meerdere fragment MP4 bitstreams.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-307">Create the same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="bb2cd-308">Redundante audio nummers moeten semantisch gelijk zijn, met de dezelfde fragment tijdstempels en uitwisselbaar op het niveau van-header en het fragment.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-308">The redundant audio tracks MUST be semantically equivalent, with the same fragment timestamps, and be interchangeable at the header and fragment levels.</span></span>
2. <span data-ttu-id="bb2cd-309">Zorg ervoor dat de 'audio' vermelding in de Live Server Manifest (sectie 6 in [1]) hetzelfde voor alle redundante audio nummers is.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-309">Ensure that the “audio” entry in the Live Server Manifest (Section 6 in [1]) is the same for all redundant audio tracks.</span></span>

<span data-ttu-id="bb2cd-310">De volgende implementatie wordt aanbevolen voor redundante audio houdt:</span><span class="sxs-lookup"><span data-stu-id="bb2cd-310">The following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="bb2cd-311">Elke unieke-nummer in een stream zelfstandig verzenden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="bb2cd-312">Ook verzenden van een redundant stroom voor elk van deze stromen-nummer, waarbij de tweede stroom van de eerste afwijkt alleen door de id in de HTTP POST-URL: {protocol} :// {server address} / {punt path}/Streams({identifier}) publiceren.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-312">Also, send a redundant stream for each of these audio track streams, where the second stream differs from the first only by the identifier in the HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="bb2cd-313">Gebruik afzonderlijke stromen voor het verzenden van de twee laagste video bitsnelheden.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-313">Use separate streams to send the two lowest video bitrates.</span></span> <span data-ttu-id="bb2cd-314">Elk van deze stromen moet ook een kopie van elke unieke nummer bevatten. Wanneer er meerdere talen worden ondersteund, moeten deze stromen audio houdt voor elke taal bevatten.</span><span class="sxs-lookup"><span data-stu-id="bb2cd-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="bb2cd-315">Instanties van de afzonderlijke server (coderingsprogramma) gebruiken om te coderen en verzenden van de redundante stromen vermeld in (1) en (2).</span><span class="sxs-lookup"><span data-stu-id="bb2cd-315">Use separate server (encoder) instances to encode and send the redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="bb2cd-316">Media Services-leertrajecten</span><span class="sxs-lookup"><span data-stu-id="bb2cd-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="bb2cd-317">Feedback geven</span><span class="sxs-lookup"><span data-stu-id="bb2cd-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png
