---
title: uw Azure IoT Suite verbonden aaaDeploy factory gateway | Microsoft Docs
description: Hoe een gateway op Windows of Linux tooenable connectiviteit toohello toodeploy factory verbonden vooraf geconfigureerde oplossing.
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: 72436dec60eda0de20143f362fe740b0c4412f36
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-hello-connected-factory-preconfigured-solution"></a><span data-ttu-id="c482a-103">Implementeer een gateway op Windows of Linux voor Hallo verbonden factory vooraf geconfigureerde oplossing</span><span class="sxs-lookup"><span data-stu-id="c482a-103">Deploy a gateway on Windows or Linux for hello connected factory preconfigured solution</span></span>

<span data-ttu-id="c482a-104">Hallo vereist software toodeploy een gateway voor Hallo verbonden factory vooraf geconfigureerde oplossing bestaat uit twee onderdelen:</span><span class="sxs-lookup"><span data-stu-id="c482a-104">hello software required toodeploy a gateway for hello connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="c482a-105">Hallo *OPC Proxy* stelt u een verbinding tooIoT Hub.</span><span class="sxs-lookup"><span data-stu-id="c482a-105">hello *OPC Proxy* establishes a connection tooIoT Hub.</span></span> <span data-ttu-id="c482a-106">Hallo *OPC Proxy* vervolgens wachten op voor de opdracht en controle berichten van Hallo OPC-Browser die wordt uitgevoerd in de portal van de oplossing Hallo verbonden factory geïntegreerd.</span><span class="sxs-lookup"><span data-stu-id="c482a-106">hello *OPC Proxy* then waits for command and control messages from hello integrated OPC Browser that runs in hello connected factory solution portal.</span></span>
* <span data-ttu-id="c482a-107">Hallo *OPC Publisher* verbindt tooexisting lokale OPC UA-servers en telemetrieberichten daarvan tooIoT Hub verzendt.</span><span class="sxs-lookup"><span data-stu-id="c482a-107">hello *OPC Publisher* connects tooexisting on-premises OPC UA servers and forwards telemetry messages from them tooIoT Hub.</span></span>

<span data-ttu-id="c482a-108">Beide onderdelen zijn open source en zijn beschikbaar als bron op GitHub, en als Docker-containers:</span><span class="sxs-lookup"><span data-stu-id="c482a-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="c482a-109">GitHub</span><span class="sxs-lookup"><span data-stu-id="c482a-109">GitHub</span></span> | <span data-ttu-id="c482a-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="c482a-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="c482a-111">[OPC-uitgever][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="c482a-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="c482a-112">[OPC-uitgever][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="c482a-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="c482a-113">[OPC-Proxy][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="c482a-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="c482a-114">[OPC-Proxy][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="c482a-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="c482a-115">Er is geen openbare IP-adres of gaten in Hallo gateway firewall zijn vereist voor beide componenten.</span><span class="sxs-lookup"><span data-stu-id="c482a-115">No public-facing IP address or holes in hello gateway firewall are required for either component.</span></span> <span data-ttu-id="c482a-116">Gebruik alleen uitgaande poorten 443 en 5671 8883 Hallo OPC-Proxy en OPC uitgever.</span><span class="sxs-lookup"><span data-stu-id="c482a-116">hello OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="c482a-117">Hallo stappen in dit artikel ziet u hoe toodeploy een gateway met behulp van Docker van een [Windows](#windows-deployment) of [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="c482a-117">hello steps in this article show you how toodeploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="c482a-118">Hallo-gateway kunnen connectiviteit toohello verbonden factory vooraf geconfigureerde oplossing.</span><span class="sxs-lookup"><span data-stu-id="c482a-118">hello gateway enables connectivity toohello connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="c482a-119">Hallo-gateway voor software die wordt uitgevoerd in de Docker-container Hallo [Azure IoT rand].</span><span class="sxs-lookup"><span data-stu-id="c482a-119">hello gateway software that runs in hello Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="c482a-120">Windows-implementatie</span><span class="sxs-lookup"><span data-stu-id="c482a-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="c482a-121">Als u een gateway-apparaat nog geen hebt, is het raadzaam om dat u een commerciële gateway koopt van een van onze partners.</span><span class="sxs-lookup"><span data-stu-id="c482a-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="c482a-122">Bezoek Hallo [Azure IoT-apparaat catalogus] voor een lijst met gatewayapparaten die compatibel is met de Hallo factory-oplossing die is verbonden.</span><span class="sxs-lookup"><span data-stu-id="c482a-122">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="c482a-123">Volg Hallo-instructies die worden geleverd met Hallo apparaat tooset up Hallo-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-123">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="c482a-124">Ook gebruiken Hallo instructies toomanually instellen op een van uw bestaande gateways te volgen.</span><span class="sxs-lookup"><span data-stu-id="c482a-124">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="c482a-125">Docker installeren</span><span class="sxs-lookup"><span data-stu-id="c482a-125">Install Docker</span></span>

<span data-ttu-id="c482a-126">Installeer [Docker voor Windows] op uw apparaat op basis van de Windows-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="c482a-127">Selecteer een station op uw host machine tooshare met Docker tijdens de installatie van Windows Docker.</span><span class="sxs-lookup"><span data-stu-id="c482a-127">During Windows Docker setup, select a drive on your host machine tooshare with Docker.</span></span> <span data-ttu-id="c482a-128">Hallo schermafbeelding ziet delen Hallo D-station op uw Windows-systeem te volgen:</span><span class="sxs-lookup"><span data-stu-id="c482a-128">hello following screenshot shows sharing hello D drive on your Windows system:</span></span>

![Docker installeren][img-install-docker]

<span data-ttu-id="c482a-130">Maak vervolgens een map met de naam **docker** in de hoofdmap Hallo Hallo gedeelde stations.</span><span class="sxs-lookup"><span data-stu-id="c482a-130">Then create a folder called **docker** in hello root of hello shared drive.</span></span>
<span data-ttu-id="c482a-131">U kunt deze stap ook uitvoeren na de installatie van docker van Hallo **instellingen** menu.</span><span class="sxs-lookup"><span data-stu-id="c482a-131">You can also perform this step after installing docker from hello **Settings** menu.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="c482a-132">Hallo-gateway configureren</span><span class="sxs-lookup"><span data-stu-id="c482a-132">Configure hello gateway</span></span>

1. <span data-ttu-id="c482a-133">U moet Hallo **iothubowner** verbindingsreeks van uw Azure IoT Suite verbonden factory implementatie toocomplete Hallo gateway-implementatie.</span><span class="sxs-lookup"><span data-stu-id="c482a-133">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="c482a-134">In Hallo [Azure-portal], navigeer tooyour IoT-Hub in de resourcegroep Hallo gemaakt tijdens de implementatie van Hallo verbonden factory-oplossing.</span><span class="sxs-lookup"><span data-stu-id="c482a-134">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="c482a-135">Klik op **gedeeld toegangsbeleid** tooaccess hello **iothubowner** verbindingsreeks:</span><span class="sxs-lookup"><span data-stu-id="c482a-135">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Hallo IoT Hub verbindingsreeks zoeken][img-hub-connection]

    <span data-ttu-id="c482a-137">Kopiëren Hallo **verbindingsreeks--primaire sleutel** waarde.</span><span class="sxs-lookup"><span data-stu-id="c482a-137">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="c482a-138">Hallo-gateway configureren voor uw IoT Hub met behulp van Hallo twee gateway modules **zodra** vanaf een opdrachtprompt met:</span><span class="sxs-lookup"><span data-stu-id="c482a-138">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="c482a-139">**&lt;ApplicationName&gt;**  hello toogive tooyour OPC UA Publisher Hallo-indeling is **publisher.&lt; de volledig gekwalificeerde domeinnaam&gt;**.</span><span class="sxs-lookup"><span data-stu-id="c482a-139">**&lt;ApplicationName&gt;** is hello name toogive tooyour OPC UA Publisher in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="c482a-140">Bijvoorbeeld, als uw netwerk factory heet **myfactorynetwork.com**, Hallo **ApplicationName** waarde is **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="c482a-140">For example, if your factory network is called **myfactorynetwork.com**, hello **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="c482a-141">**&lt;IoTHubOwnerConnectionString&gt;**  Hallo is **iothubowner** verbindingsreeks die u in de vorige stap Hallo hebt gekopieerd.</span><span class="sxs-lookup"><span data-stu-id="c482a-141">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="c482a-142">Deze verbindingsreeks wordt alleen gebruikt in deze stap, u hoeft deze niet in Hallo stappen te volgen:</span><span class="sxs-lookup"><span data-stu-id="c482a-142">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="c482a-143">U gebruikt Hallo toegewezen D:\\docker-map (Hallo `-v` argument) hoger toopersist Hallo twee X.509-certificaten die Hallo gateway-modules gebruiken.</span><span class="sxs-lookup"><span data-stu-id="c482a-143">You use hello mapped D:\\docker folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="c482a-144">Hallo-gateway uitvoeren</span><span class="sxs-lookup"><span data-stu-id="c482a-144">Run hello gateway</span></span>

1. <span data-ttu-id="c482a-145">Opnieuw opstarten met behulp van de volgende opdrachten Hallo Hallo-gateway:</span><span class="sxs-lookup"><span data-stu-id="c482a-145">Restart hello gateway using hello following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="c482a-146">Uit veiligheidsoverwegingen Hallo twee X.509-certificaten die zijn doorgevoerd in Hallo D:\\docker-map Hallo persoonlijke sleutel bevat.</span><span class="sxs-lookup"><span data-stu-id="c482a-146">For security reasons, hello two X.509 certificates persisted in hello D:\\docker folder contain hello private key.</span></span> <span data-ttu-id="c482a-147">Toegangsreferenties toothis map toohello beperken (meestal **beheerders**) u toorun hello Docker-container gebruiken.</span><span class="sxs-lookup"><span data-stu-id="c482a-147">Limit access toothis folder toohello credentials (typically **Administrators**) you use toorun hello Docker container.</span></span> <span data-ttu-id="c482a-148">Klik met de rechtermuisknop Hallo D:\\docker-map, kies **eigenschappen**, klikt u vervolgens **beveiliging**, en vervolgens **bewerken**.</span><span class="sxs-lookup"><span data-stu-id="c482a-148">Right-click hello D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="c482a-149">Geef **beheerders** volledige controle en verwijder alle andere gebruikers:</span><span class="sxs-lookup"><span data-stu-id="c482a-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Ken machtigingen tooDocker share][img-docker-share]

1. <span data-ttu-id="c482a-151">Controleer de netwerkverbinding.</span><span class="sxs-lookup"><span data-stu-id="c482a-151">Verify network connectivity.</span></span> <span data-ttu-id="c482a-152">Voer vanaf een opdrachtprompt Hallo opdracht `ping publisher.<your fully qualified domain name>` tooping uw gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-152">From a command prompt, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="c482a-153">Als Hallo bestemming niet bereikbaar is, toevoegen Hallo IP-adres en de naam van uw gateway toohello hosts-bestand op uw gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-153">If hello destination is unreachable, add hello IP address and name of your gateway toohello hosts file on your gateway.</span></span> <span data-ttu-id="c482a-154">Hallo hosts-bestand bevindt zich in Hallo **Windows\\System32\\stuurprogramma's\\enzovoort** map.</span><span class="sxs-lookup"><span data-stu-id="c482a-154">hello hosts file is located in hello **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="c482a-155">Probeer vervolgens tooconnect toohello publisher met behulp van een lokale OPC UA-client uitgevoerd op Hallo-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-155">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="c482a-156">Hallo OPC UA-eindpunt-URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="c482a-156">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="c482a-157">Als u een client OPC UA geen hebt, kunt u downloaden en gebruiken een [open source OPC UA client].</span><span class="sxs-lookup"><span data-stu-id="c482a-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="c482a-158">Wanneer u deze lokale tests hebt voltooid, bladeren toohello **verbinding maken met uw eigen OPC UA-Server** pagina in de portal van de oplossing Hallo verbonden factory.</span><span class="sxs-lookup"><span data-stu-id="c482a-158">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="c482a-159">Voer Hallo publisher eindpunt-URL (`tcp://publisher.<your fully qualified domain name>:62222`) en klik op **Connect**.</span><span class="sxs-lookup"><span data-stu-id="c482a-159">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="c482a-160">Ophalen van een certificaatwaarschuwing weergegeven en klik op **doorgaan.**</span><span class="sxs-lookup"><span data-stu-id="c482a-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="c482a-161">Vervolgens krijgt u een fout die Hallo publisher Hallo UA webclient niet vertrouwt.</span><span class="sxs-lookup"><span data-stu-id="c482a-161">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="c482a-162">tooresolve deze fout, kopie Hallo **UA webclient** certificaat van Hallo **D:\\docker\\afgewezen certificaten\\certificaten** map toohello **D:\\docker\\UA toepassingen\\certificaten** map op het Hallo-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-162">tooresolve this error, copy hello **UA Web Client** certificate from hello **D:\\docker\\Rejected Certificates\\certs** folder toohello **D:\\docker\\UA Applications\\certs** folder on hello gateway.</span></span> <span data-ttu-id="c482a-163">U hoeft niet toorestart van Hallo-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-163">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="c482a-164">Herhaal deze stap.</span><span class="sxs-lookup"><span data-stu-id="c482a-164">Repeat this step.</span></span> <span data-ttu-id="c482a-165">U kunt nu toohello gateway verbinding vanuit de cloud Hallo en u bent klaar tooadd OPC UA servers toohello oplossing.</span><span class="sxs-lookup"><span data-stu-id="c482a-165">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="c482a-166">Uw OPC UA-servers toevoegen</span><span class="sxs-lookup"><span data-stu-id="c482a-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="c482a-167">Blader toohello **verbinding maken met uw eigen OPC UA-Server** pagina in de portal van de oplossing Hallo verbonden factory.</span><span class="sxs-lookup"><span data-stu-id="c482a-167">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="c482a-168">Volg dezelfde stappen als in de voorgaande sectie tooestablish Hallo Hallo verbonden factory-portal en Hallo OPC UA-server vertrouwen tussen Hallo.</span><span class="sxs-lookup"><span data-stu-id="c482a-168">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="c482a-169">Deze stap wordt een wederzijdse vertrouwensrelatie van certificaten van Hallo Hallo verbonden factory-portal en Hallo OPC UA-server en maakt een verbinding tot stand gebracht.</span><span class="sxs-lookup"><span data-stu-id="c482a-169">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="c482a-170">Blader Hallo OPC UA knooppunten structuur van uw OPC UA-server, met de rechtermuisknop op Hallo OPC knooppunten en selecteer **publiceren**.</span><span class="sxs-lookup"><span data-stu-id="c482a-170">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="c482a-171">Voor publicatie toowork op deze manier Hallo OPC UA-server en Hallo publisher moet op Hallo hetzelfde netwerk.</span><span class="sxs-lookup"><span data-stu-id="c482a-171">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="c482a-172">Met andere woorden, als Hallo volledig gekwalificeerde domeinnaam van Hallo publisher is **publisher.mydomain.com** en vervolgens de volledig gekwalificeerde domeinnaam Hallo Hallo OPC UA-server, bijvoorbeeld zijn moet **myopcuaserver.mydomain.com**. Als de installatie anders is, kunt u handmatig knooppunten toohello publishesnodes.json bestand gevonden in Hallo toevoegen **D:\\docker** map.</span><span class="sxs-lookup"><span data-stu-id="c482a-172">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **D:\\docker** folder.</span></span> <span data-ttu-id="c482a-173">Hallo publishesnodes.json-bestand is automatisch gegenereerd op Hallo eerst geslaagde publiceren van een OPC-knooppunt.</span><span class="sxs-lookup"><span data-stu-id="c482a-173">hello publishesnodes.json file is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="c482a-174">Telemetrie loopt nu van Hallo gateway-apparaat.</span><span class="sxs-lookup"><span data-stu-id="c482a-174">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="c482a-175">U kunt Hallo telemetrie weergeven in Hallo **Factory locaties** weergave van Hallo verbonden factory portal onder **New Factory**.</span><span class="sxs-lookup"><span data-stu-id="c482a-175">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="c482a-176">Linux-implementatie</span><span class="sxs-lookup"><span data-stu-id="c482a-176">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="c482a-177">Als u een gateway-apparaat nog geen hebt, is het raadzaam om dat u een commerciële gateway koopt van een van onze partners.</span><span class="sxs-lookup"><span data-stu-id="c482a-177">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="c482a-178">Bezoek Hallo [Azure IoT-apparaat catalogus] voor een lijst met gatewayapparaten die compatibel is met de Hallo factory-oplossing die is verbonden.</span><span class="sxs-lookup"><span data-stu-id="c482a-178">Visit hello [Azure IoT device catalog] for a list of gateway devices compatible with hello connected factory solution.</span></span> <span data-ttu-id="c482a-179">Volg Hallo-instructies die worden geleverd met Hallo apparaat tooset up Hallo-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-179">Follow hello instructions that come with hello device tooset up hello gateway.</span></span> <span data-ttu-id="c482a-180">Ook gebruiken Hallo instructies toomanually instellen op een van uw bestaande gateways te volgen.</span><span class="sxs-lookup"><span data-stu-id="c482a-180">Alternatively, use hello following instructions toomanually set up one of your existing gateways.</span></span>

<span data-ttu-id="c482a-181">[Installeren van Docker] op uw Linux-gatewayapparaat.</span><span class="sxs-lookup"><span data-stu-id="c482a-181">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-hello-gateway"></a><span data-ttu-id="c482a-182">Hallo-gateway configureren</span><span class="sxs-lookup"><span data-stu-id="c482a-182">Configure hello gateway</span></span>

1. <span data-ttu-id="c482a-183">U moet Hallo **iothubowner** verbindingsreeks van uw Azure IoT Suite verbonden factory implementatie toocomplete Hallo gateway-implementatie.</span><span class="sxs-lookup"><span data-stu-id="c482a-183">You need hello **iothubowner** connection string of your Azure IoT Suite connected factory deployment toocomplete hello gateway deployment.</span></span> <span data-ttu-id="c482a-184">In Hallo [Azure-portal], navigeer tooyour IoT-Hub in de resourcegroep Hallo gemaakt tijdens de implementatie van Hallo verbonden factory-oplossing.</span><span class="sxs-lookup"><span data-stu-id="c482a-184">In hello [Azure portal], navigate tooyour IoT Hub in hello resource group created when you deployed hello connected factory solution.</span></span> <span data-ttu-id="c482a-185">Klik op **gedeeld toegangsbeleid** tooaccess hello **iothubowner** verbindingsreeks:</span><span class="sxs-lookup"><span data-stu-id="c482a-185">Click **Shared access policies** tooaccess hello **iothubowner** connection string:</span></span>

    ![Hallo IoT Hub verbindingsreeks zoeken][img-hub-connection]

    <span data-ttu-id="c482a-187">Kopiëren Hallo **verbindingsreeks--primaire sleutel** waarde.</span><span class="sxs-lookup"><span data-stu-id="c482a-187">Copy hello **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="c482a-188">Hallo-gateway configureren voor uw IoT Hub met behulp van Hallo twee gateway modules **zodra** van een shell met:</span><span class="sxs-lookup"><span data-stu-id="c482a-188">Configure hello gateway for your IoT Hub by running hello two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="c482a-189">**&lt;ApplicationName&gt;**  Hallo naam is van Hallo OPC UA Hallo toepassingsgateway in Hallo indeling maakt **publisher.&lt; de volledig gekwalificeerde domeinnaam&gt;**.</span><span class="sxs-lookup"><span data-stu-id="c482a-189">**&lt;ApplicationName&gt;** is hello name of hello OPC UA application hello gateway creates in hello format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="c482a-190">Bijvoorbeeld: **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="c482a-190">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="c482a-191">**&lt;IoTHubOwnerConnectionString&gt;**  Hallo is **iothubowner** verbindingsreeks die u in de vorige stap Hallo hebt gekopieerd.</span><span class="sxs-lookup"><span data-stu-id="c482a-191">**&lt;IoTHubOwnerConnectionString&gt;** is hello **iothubowner** connection string you copied in hello previous step.</span></span> <span data-ttu-id="c482a-192">Deze verbindingsreeks wordt alleen gebruikt in deze stap, u hoeft deze niet in Hallo stappen te volgen:</span><span class="sxs-lookup"><span data-stu-id="c482a-192">This connection string is only used in this step, you don’t need it in hello following steps:</span></span>

    <span data-ttu-id="c482a-193">Gebruik van Hallo **/ gedeelde** map (Hallo `-v` argument) hoger toopersist Hallo twee X.509-certificaten die Hallo gateway-modules gebruiken.</span><span class="sxs-lookup"><span data-stu-id="c482a-193">You use hello **/shared** folder (hello `-v` argument) later toopersist hello two X.509 certificates that hello gateway modules use.</span></span>

### <a name="run-hello-gateway"></a><span data-ttu-id="c482a-194">Hallo-gateway uitvoeren</span><span class="sxs-lookup"><span data-stu-id="c482a-194">Run hello gateway</span></span>

1. <span data-ttu-id="c482a-195">Opnieuw opstarten met behulp van de volgende opdrachten Hallo Hallo-gateway:</span><span class="sxs-lookup"><span data-stu-id="c482a-195">Restart hello gateway using hello following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="c482a-196">Uit veiligheidsoverwegingen Hallo twee X.509-certificaten die zijn doorgevoerd in Hallo **/ gedeelde** map Hallo persoonlijke sleutel bevat.</span><span class="sxs-lookup"><span data-stu-id="c482a-196">For security reasons, hello two X.509 certificates persisted in hello **/shared** folder contain hello private key.</span></span> <span data-ttu-id="c482a-197">Limiet toothis map toohello toegangsreferenties u toorun Hallo Docker-container.</span><span class="sxs-lookup"><span data-stu-id="c482a-197">Limit access toothis folder toohello credentials you use toorun hello Docker container.</span></span> <span data-ttu-id="c482a-198">tooset hello machtigingen voor **hoofdmap** alleen gebruiken Hallo `chmod` opdracht in de map Hallo-shell.</span><span class="sxs-lookup"><span data-stu-id="c482a-198">tooset hello permissions for **root** only, use hello `chmod` shell command on hello folder.</span></span>

1. <span data-ttu-id="c482a-199">Controleer de netwerkverbinding.</span><span class="sxs-lookup"><span data-stu-id="c482a-199">Verify network connectivity.</span></span> <span data-ttu-id="c482a-200">Voer vanuit een shell Hallo opdracht `ping publisher.<your fully qualified domain name>` tooping uw gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-200">From a shell, enter hello command `ping publisher.<your fully qualified domain name>` tooping your gateway.</span></span> <span data-ttu-id="c482a-201">Als Hallo bestemming niet bereikbaar is, toevoegen Hallo IP-adres en de naam van uw gateway tooyour hosts-bestand op uw gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-201">If hello destination is unreachable, add hello IP address and name of your gateway tooyour hosts file on your gateway.</span></span> <span data-ttu-id="c482a-202">Hallo hosts-bestand bevindt zich in Hallo **/enzovoort** map.</span><span class="sxs-lookup"><span data-stu-id="c482a-202">hello hosts file is located in hello **/etc** folder.</span></span>

1. <span data-ttu-id="c482a-203">Probeer vervolgens tooconnect toohello publisher met behulp van een lokale OPC UA-client uitgevoerd op Hallo-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-203">Next, try tooconnect toohello publisher using a local OPC UA client running on hello gateway.</span></span> <span data-ttu-id="c482a-204">Hallo OPC UA-eindpunt-URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="c482a-204">hello OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="c482a-205">Als u een client OPC UA geen hebt, kunt u downloaden en gebruiken een [open source OPC UA client].</span><span class="sxs-lookup"><span data-stu-id="c482a-205">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="c482a-206">Wanneer u deze lokale tests hebt voltooid, bladeren toohello **verbinding maken met uw eigen OPC UA-Server** pagina in de portal van de oplossing Hallo verbonden factory.</span><span class="sxs-lookup"><span data-stu-id="c482a-206">When you have successfully completed these local tests, browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="c482a-207">Voer Hallo publisher eindpunt-URL (`tcp://publisher.<your fully qualified domain name>:62222`) en klik op **Connect**.</span><span class="sxs-lookup"><span data-stu-id="c482a-207">Enter hello publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="c482a-208">Ophalen van een certificaatwaarschuwing weergegeven en klik op **doorgaan.**</span><span class="sxs-lookup"><span data-stu-id="c482a-208">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="c482a-209">Vervolgens krijgt u een fout die Hallo publisher Hallo UA webclient niet vertrouwt.</span><span class="sxs-lookup"><span data-stu-id="c482a-209">Next you get an error that hello publisher doesn’t trust hello UA Web Client.</span></span> <span data-ttu-id="c482a-210">tooresolve deze fout, kopie Hallo **UA webclient** certificaat van Hallo **/gedeeld/geweigerd certificaten/certificaten** map toohello **/shared/UA-toepassingen/certificaten** de map op Hallo-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-210">tooresolve this error, copy hello **UA Web Client** certificate from hello **/shared/Rejected Certificates/certs** folder toohello **/shared/UA Applications/certs** folder on hello gateway.</span></span> <span data-ttu-id="c482a-211">U hoeft niet toorestart van Hallo-gateway.</span><span class="sxs-lookup"><span data-stu-id="c482a-211">You do not need toorestart of hello gateway.</span></span> <span data-ttu-id="c482a-212">Herhaal deze stap.</span><span class="sxs-lookup"><span data-stu-id="c482a-212">Repeat this step.</span></span> <span data-ttu-id="c482a-213">U kunt nu toohello gateway verbinding vanuit de cloud Hallo en u bent klaar tooadd OPC UA servers toohello oplossing.</span><span class="sxs-lookup"><span data-stu-id="c482a-213">You can now connect toohello gateway from hello cloud, and you are ready tooadd OPC UA servers toohello solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="c482a-214">Uw OPC UA-servers toevoegen</span><span class="sxs-lookup"><span data-stu-id="c482a-214">Add your OPC UA servers</span></span>

1. <span data-ttu-id="c482a-215">Blader toohello **verbinding maken met uw eigen OPC UA-Server** pagina in de portal van de oplossing Hallo verbonden factory.</span><span class="sxs-lookup"><span data-stu-id="c482a-215">Browse toohello **Connect your own OPC UA Server** page in hello connected factory solution portal.</span></span> <span data-ttu-id="c482a-216">Volg dezelfde stappen als in de voorgaande sectie tooestablish Hallo Hallo verbonden factory-portal en Hallo OPC UA-server vertrouwen tussen Hallo.</span><span class="sxs-lookup"><span data-stu-id="c482a-216">Follow hello same steps as in hello preceding section tooestablish trust between hello connected factory portal and hello OPC UA server.</span></span> <span data-ttu-id="c482a-217">Deze stap wordt een wederzijdse vertrouwensrelatie van certificaten van Hallo Hallo verbonden factory-portal en Hallo OPC UA-server en maakt een verbinding tot stand gebracht.</span><span class="sxs-lookup"><span data-stu-id="c482a-217">This step establishes a mutual trust of hello certificates from hello connected factory portal and hello OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="c482a-218">Blader Hallo OPC UA knooppunten structuur van uw OPC UA-server, met de rechtermuisknop op Hallo OPC knooppunten en selecteer **publiceren**.</span><span class="sxs-lookup"><span data-stu-id="c482a-218">Browse hello OPC UA nodes tree of your OPC UA server, right-click hello OPC nodes, and select **publish**.</span></span> <span data-ttu-id="c482a-219">Voor publicatie toowork op deze manier Hallo OPC UA-server en Hallo publisher moet op Hallo hetzelfde netwerk.</span><span class="sxs-lookup"><span data-stu-id="c482a-219">For publishing toowork this way, hello OPC UA server and hello publisher must be on hello same network.</span></span> <span data-ttu-id="c482a-220">Met andere woorden, als Hallo volledig gekwalificeerde domeinnaam van Hallo publisher is **publisher.mydomain.com** en vervolgens de volledig gekwalificeerde domeinnaam Hallo Hallo OPC UA-server, bijvoorbeeld zijn moet **myopcuaserver.mydomain.com**. Als de installatie anders is, kunt u handmatig knooppunten toohello publishesnodes.json bestand gevonden in Hallo toevoegen **/ gedeelde** map.</span><span class="sxs-lookup"><span data-stu-id="c482a-220">In other words, if hello fully qualified domain name of hello publisher is **publisher.mydomain.com** then hello fully qualified domain name of hello OPC UA server must be, for example, **myopcuaserver.mydomain.com**. If your setup is different, you can manually add nodes toohello publishesnodes.json file found in hello **/shared** folder.</span></span> <span data-ttu-id="c482a-221">Hallo publishesnodes.json wordt automatisch gegenereerd op Hallo eerst geslaagde publiceren van een OPC-knooppunt.</span><span class="sxs-lookup"><span data-stu-id="c482a-221">hello publishesnodes.json is automatically generated on hello first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="c482a-222">Telemetrie loopt nu van Hallo gateway-apparaat.</span><span class="sxs-lookup"><span data-stu-id="c482a-222">Telemetry now flows from hello gateway device.</span></span> <span data-ttu-id="c482a-223">U kunt Hallo telemetrie weergeven in Hallo **Factory locaties** weergave van Hallo verbonden factory portal onder **New Factory**.</span><span class="sxs-lookup"><span data-stu-id="c482a-223">You can view hello telemetry in hello **Factory Locations** view of hello connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c482a-224">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="c482a-224">Next steps</span></span>

<span data-ttu-id="c482a-225">vooraf geconfigureerde oplossing voor toolearn meer informatie over het Hallo-architectuur van verbonden factory hello, Zie [verbonden factory oplossing walkthrough over vooraf geconfigureerde][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="c482a-225">toolearn more about hello architecture of hello connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

[Docker voor Windows]: https://www.docker.com/docker-windows
[Azure IoT-apparaat catalogus]: https://catalog.azureiotsuite.com/?q=opc
[Azure-portal]: http://portal.azure.com/
[open source OPC UA client]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4
[Installeren van Docker]: https://www.docker.com/community-edition#/download
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
[Azure IoT rand]: https://github.com/Azure/iot-edge

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy