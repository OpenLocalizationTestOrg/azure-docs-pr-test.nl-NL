---
title: Azure Active Directory-verificatie en Resource Manager | Microsoft Docs
description: Een Ontwikkelaarshandleiding voor verificatie met de API van Azure Resource Manager en Azure Active Directory voor het integreren van een app met andere Azure-abonnementen.
services: azure-resource-manager,active-directory
documentationcenter: na
author: dushyantgill
manager: timlt
editor: tysonn
ms.assetid: 17b2b40d-bf42-4c7d-9a88-9938409c5088
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 12/27/2016
ms.author: dugill;tomfitz
ms.openlocfilehash: 7830dc4774652f4d108e98660dce3bcea7b32d05
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="use-resource-manager-authentication-api-to-access-subscriptions"></a><span data-ttu-id="f6617-103">Gebruik Resource Manager authenticatie-API aan abonnementen, toegang</span><span class="sxs-lookup"><span data-stu-id="f6617-103">Use Resource Manager authentication API to access subscriptions</span></span>
## <a name="introduction"></a><span data-ttu-id="f6617-104">Inleiding</span><span class="sxs-lookup"><span data-stu-id="f6617-104">Introduction</span></span>
<span data-ttu-id="f6617-105">Als u een softwareontwikkelaar die moet maken van een app die van de klant Azure-resources wordt beheerd, dit onderwerp leest u hoe u verificatie met de Azure Resource Manager-API's en toegang krijgen tot bronnen in andere abonnementen.</span><span class="sxs-lookup"><span data-stu-id="f6617-105">If you are a software developer who needs to create an app that manages customer's Azure resources, this topic shows you how to authenticate with the Azure Resource Manager APIs and gain access to resources in other subscriptions.</span></span>

<span data-ttu-id="f6617-106">Uw app hebben toegang tot de Resource Manager-API's in verschillende manieren:</span><span class="sxs-lookup"><span data-stu-id="f6617-106">Your app can access the Resource Manager APIs in couple of ways:</span></span>

1. <span data-ttu-id="f6617-107">**Gebruikers- + toegang tot Apps**: voor apps die toegang krijgen bronnen namens een gebruiker aangemeld tot.</span><span class="sxs-lookup"><span data-stu-id="f6617-107">**User + app access**: for apps that access resources on behalf of a signed-in user.</span></span> <span data-ttu-id="f6617-108">Deze methode werkt voor apps, zoals web-apps en opdrachtregelprogramma's, die betrekking op alleen 'interactieve management' Azure-resources hebben.</span><span class="sxs-lookup"><span data-stu-id="f6617-108">This approach works for apps, such as web apps and command-line tools, that deal with only "interactive management" of Azure resources.</span></span>
2. <span data-ttu-id="f6617-109">**App-lezentoegang**: voor apps die daemon-services en geplande taken worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="f6617-109">**App-only access**: for apps that run daemon services and scheduled jobs.</span></span> <span data-ttu-id="f6617-110">Identiteit van de app wordt rechtstreeks toegang tot de bronnen worden verleend.</span><span class="sxs-lookup"><span data-stu-id="f6617-110">The app's identity is granted direct access to the resources.</span></span> <span data-ttu-id="f6617-111">Deze methode werkt voor apps die langlopende headless (zonder toezicht) toegang tot Azure nodig.</span><span class="sxs-lookup"><span data-stu-id="f6617-111">This approach works for apps that need long-term headless (unattended) access to Azure.</span></span>

<span data-ttu-id="f6617-112">Dit onderwerp bevat stapsgewijze instructies voor het maken van een app die gebruikmaakt van deze twee autorisatiemethoden.</span><span class="sxs-lookup"><span data-stu-id="f6617-112">This topic provides step-by-step instructions to create an app that employs both these authorization methods.</span></span> <span data-ttu-id="f6617-113">Er wordt weergegeven hoe om uit te voeren van elke stap met REST-API of C#.</span><span class="sxs-lookup"><span data-stu-id="f6617-113">It shows how to perform each step with REST API or C#.</span></span> <span data-ttu-id="f6617-114">De volledige ASP.NET MVC-toepassing is beschikbaar op [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span><span class="sxs-lookup"><span data-stu-id="f6617-114">The complete ASP.NET MVC application is available at [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span></span>

## <a name="what-the-web-app-does"></a><span data-ttu-id="f6617-115">Betekenis van de web-app</span><span class="sxs-lookup"><span data-stu-id="f6617-115">What the web app does</span></span>
<span data-ttu-id="f6617-116">De web-app:</span><span class="sxs-lookup"><span data-stu-id="f6617-116">The web app:</span></span>

1. <span data-ttu-id="f6617-117">Zich aanmeldt een Azure-gebruiker.</span><span class="sxs-lookup"><span data-stu-id="f6617-117">Signs-in an Azure user.</span></span>
2. <span data-ttu-id="f6617-118">Vraag de gebruiker de web-app om toegang te verlenen aan de Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f6617-118">Asks user to grant the web app access to Resource Manager.</span></span>
3. <span data-ttu-id="f6617-119">Gebruikers- + toegangstoken app opgehaald voor toegang tot de Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f6617-119">Gets user + app access token for accessing Resource Manager.</span></span>
4. <span data-ttu-id="f6617-120">Token (uit stap 3) gebruikt voor het aanroepen van Resource Manager en de app service-principal toewijzen aan een rol in het abonnement, die de app op lange termijn toegang tot het abonnement geeft.</span><span class="sxs-lookup"><span data-stu-id="f6617-120">Uses token (from step 3) to call Resource Manager and assign the app's service principal to a role in the subscription, which gives the app long-term access to the subscription.</span></span>
5. <span data-ttu-id="f6617-121">App-lezentoegang token opgehaald.</span><span class="sxs-lookup"><span data-stu-id="f6617-121">Gets app-only access token.</span></span>
6. <span data-ttu-id="f6617-122">Token (uit stap 5) wordt gebruikt voor het beheren van resources in het abonnement via Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f6617-122">Uses token (from step 5) to manage resources in the subscription through Resource Manager.</span></span>

<span data-ttu-id="f6617-123">Hier volgt de end-to-end-stroom van de webtoepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-123">Here's the end-to-end flow of the web application.</span></span>

![Resource Manager-authenticatiestroom](./media/resource-manager-api-authentication/Auth-Swim-Lane.png)

<span data-ttu-id="f6617-125">Als een gebruiker, kunt u de abonnements-id opgeven voor het abonnement dat u wilt gebruiken:</span><span class="sxs-lookup"><span data-stu-id="f6617-125">As a user, you provide the subscription id for the subscription you want to use:</span></span>

![abonnement-id opgeven](./media/resource-manager-api-authentication/sample-ux-1.png)

<span data-ttu-id="f6617-127">Selecteer het account moet worden gebruikt voor logboekregistratie in.</span><span class="sxs-lookup"><span data-stu-id="f6617-127">Select the account to use for logging in.</span></span>

![account selecteren](./media/resource-manager-api-authentication/sample-ux-2.png)

<span data-ttu-id="f6617-129">Geef uw referenties.</span><span class="sxs-lookup"><span data-stu-id="f6617-129">Provide your credentials.</span></span>

![referenties opgeven](./media/resource-manager-api-authentication/sample-ux-3.png)

<span data-ttu-id="f6617-131">De apptoegang verlenen tot uw Azure-abonnementen:</span><span class="sxs-lookup"><span data-stu-id="f6617-131">Grant the app access to your Azure subscriptions:</span></span>

![Toegang verlenen](./media/resource-manager-api-authentication/sample-ux-4.png)

<span data-ttu-id="f6617-133">Uw verbonden abonnementen beheren:</span><span class="sxs-lookup"><span data-stu-id="f6617-133">Manage your connected subscriptions:</span></span>

![Verbinding maken met abonnement](./media/resource-manager-api-authentication/sample-ux-7.png)

## <a name="register-application"></a><span data-ttu-id="f6617-135">Toepassing registreren</span><span class="sxs-lookup"><span data-stu-id="f6617-135">Register application</span></span>
<span data-ttu-id="f6617-136">Voordat u begint met het coderen, registreert u uw web-app met Azure Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="f6617-136">Before you start coding, register your web app with Azure Active Directory (AD).</span></span> <span data-ttu-id="f6617-137">De registratie van de app wordt gemaakt van de identiteit van een centrale voor uw app in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f6617-137">The app registration creates a central identity for your app in Azure AD.</span></span> <span data-ttu-id="f6617-138">Deze bevat algemene informatie over uw toepassing zoals OAuth-Clientidentiteit, antwoord-URL's en de referenties in die uw toepassing gebruikt om te verifiëren en toegang tot Azure Resource Manager-API's.</span><span class="sxs-lookup"><span data-stu-id="f6617-138">It holds basic information about your application like OAuth Client ID, Reply URLs, and credentials that your application uses to authenticate and access Azure Resource Manager APIs.</span></span> <span data-ttu-id="f6617-139">De registratie van de app registreert ook de verschillende gedelegeerde machtigingen die uw toepassing moet bij het openen van Microsoft APIs namens de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="f6617-139">The app registration also records the various delegated permissions that your application needs when accessing Microsoft APIs on behalf of the user.</span></span>

<span data-ttu-id="f6617-140">Omdat uw app toegang krijgt andere abonnement tot, moet u deze configureren als een multitenant-toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-140">Because your app accesses other subscription, you must configure it as a multi-tenant application.</span></span> <span data-ttu-id="f6617-141">Om te worden gevalideerd, bieden een die zijn gekoppeld aan uw Azure Active Directory-domein.</span><span class="sxs-lookup"><span data-stu-id="f6617-141">To pass validation, provide a domain associated with your Azure Active Directory.</span></span> <span data-ttu-id="f6617-142">Overzicht van de domeinen die zijn gekoppeld aan uw Azure Active Directory, meld u aan bij de [klassieke portal](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="f6617-142">To see the domains associated with your Azure Active Directory, log in to the [classic portal](https://manage.windowsazure.com).</span></span> <span data-ttu-id="f6617-143">Selecteer uw Azure Active Directory en selecteer vervolgens **domeinen**.</span><span class="sxs-lookup"><span data-stu-id="f6617-143">Select your Azure Active Directory and then select **Domains**.</span></span>

<span data-ttu-id="f6617-144">Het volgende voorbeeld laat zien hoe de app registreren met behulp van Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f6617-144">The following example shows how to register the app by using Azure PowerShell.</span></span> <span data-ttu-id="f6617-145">U moet de meest recente versie (augustus 2016) van Azure PowerShell voor deze opdracht werkt hebben.</span><span class="sxs-lookup"><span data-stu-id="f6617-145">You must have the latest version (August 2016) of Azure PowerShell for this command to work.</span></span>

    $app = New-AzureRmADApplication -DisplayName "{app name}" -HomePage "https://{your domain}/{app name}" -IdentifierUris "https://{your domain}/{app name}" -Password "{your password}" -AvailableToOtherTenants $true

<span data-ttu-id="f6617-146">Als u wilt zich aanmelden als de AD-toepassing, moet u de toepassings-id en het wachtwoord.</span><span class="sxs-lookup"><span data-stu-id="f6617-146">To log in as the AD application, you need the application id and password.</span></span> <span data-ttu-id="f6617-147">Overzicht van de toepassings-id die wordt geretourneerd uit de vorige opdracht gebruiken:</span><span class="sxs-lookup"><span data-stu-id="f6617-147">To see the application id that is returned from the previous command, use:</span></span>

    $app.ApplicationId

<span data-ttu-id="f6617-148">Het volgende voorbeeld laat zien hoe de app registreren met behulp van Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="f6617-148">The following example shows how to register the app by using Azure CLI.</span></span>

    azure ad app create --name {app name} --home-page https://{your domain}/{app name} --identifier-uris https://{your domain}/{app name} --password {your password} --available true

<span data-ttu-id="f6617-149">De resultaten bevatten de AppId, u moet bij het verifiëren van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-149">The results include the AppId, which you need when authenticating as the application.</span></span>

### <a name="optional-configuration---certificate-credential"></a><span data-ttu-id="f6617-150">Optionele configuratie - certificaat-referentie</span><span class="sxs-lookup"><span data-stu-id="f6617-150">Optional configuration - certificate credential</span></span>
<span data-ttu-id="f6617-151">Daarnaast ondersteunt Azure AD referenties van het computercertificaat voor toepassingen: maken van een zelfondertekend certificaat, blijven de persoonlijke sleutel en de openbare sleutel toevoegen aan de registratie van uw Azure AD-toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-151">Azure AD also supports certificate credentials for applications: you create a self-signed cert, keep the private key, and add the public key to your Azure AD application registration.</span></span> <span data-ttu-id="f6617-152">Uw toepassing een kleine nettolading verzendt naar Azure AD zijn ondertekend met de persoonlijke sleutel voor verificatie en Azure AD valideert de handtekening met de openbare sleutel die u hebt geregistreerd.</span><span class="sxs-lookup"><span data-stu-id="f6617-152">For authentication, your application sends a small payload to Azure AD signed using your private key, and Azure AD validates the signature using the public key that you registered.</span></span>

<span data-ttu-id="f6617-153">Zie voor meer informatie over het maken van een AD-app met een certificaat [gebruik Azure PowerShell voor het maken van een service-principal voor toegang tot bronnen](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) of [gebruik Azure CLI voor het maken van een service-principal voor toegang tot bronnen](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span><span class="sxs-lookup"><span data-stu-id="f6617-153">For information about creating an AD app with a certificate, see [Use Azure PowerShell to create a service principal to access resources](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) or [Use Azure CLI to create a service principal to access resources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span></span>

## <a name="get-tenant-id-from-subscription-id"></a><span data-ttu-id="f6617-154">Tenant-id ophalen van abonnement-id</span><span class="sxs-lookup"><span data-stu-id="f6617-154">Get tenant id from subscription id</span></span>
<span data-ttu-id="f6617-155">Uw toepassing moet de tenant-ID van de Azure AD-tenant die als host fungeert voor het Azure-abonnement hebt voor het aanvragen van een token dat kan worden gebruikt voor het aanroepen van Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f6617-155">To request a token that can be used to call Resource Manager, your application needs to know the tenant ID of the Azure AD tenant that hosts the Azure subscription.</span></span> <span data-ttu-id="f6617-156">Waarschijnlijk weet dat uw gebruikers hun abonnement-id's, maar ze mogelijk niet op de hoogte van de tenant id's voor Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="f6617-156">Most likely, your users know their subscription ids, but they might not know their tenant ids for Azure Active Directory.</span></span> <span data-ttu-id="f6617-157">Als u de tenant-id van de gebruiker, vraagt de gebruiker voor de abonnements-id.</span><span class="sxs-lookup"><span data-stu-id="f6617-157">To get the user's tenant id, ask the user for the subscription id.</span></span> <span data-ttu-id="f6617-158">Die id abonnement bieden bij het verzenden van een aanvraag over het abonnement:</span><span class="sxs-lookup"><span data-stu-id="f6617-158">Provide that subscription id when sending a request about the subscription:</span></span>

    https://management.azure.com/subscriptions/{subscription-id}?api-version=2015-01-01

<span data-ttu-id="f6617-159">De aanvraag is mislukt omdat de gebruiker heeft geen nog aangemeld, maar u de tenant-id uit het antwoord ophalen kunt.</span><span class="sxs-lookup"><span data-stu-id="f6617-159">The request fails because the user has not logged in yet, but you can retrieve the tenant id from the response.</span></span> <span data-ttu-id="f6617-160">In deze uitzondering ophalen van de tenant-id van de waarde van de antwoord-header voor **WWW-verificatie**.</span><span class="sxs-lookup"><span data-stu-id="f6617-160">In that exception, retrieve the tenant id from the response header value for **WWW-Authenticate**.</span></span> <span data-ttu-id="f6617-161">U ziet deze implementatie in de [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) methode.</span><span class="sxs-lookup"><span data-stu-id="f6617-161">You see this implementation in the [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) method.</span></span>

## <a name="get-user--app-access-token"></a><span data-ttu-id="f6617-162">Gebruikers- + app toegangstoken ophalen</span><span class="sxs-lookup"><span data-stu-id="f6617-162">Get user + app access token</span></span>
<span data-ttu-id="f6617-163">Uw toepassing wordt de gebruiker omgeleid naar Azure AD met een OAuth 2.0 autoriseren aanvraag - referenties van de gebruiker verifiëren en een autorisatiecode terughalen.</span><span class="sxs-lookup"><span data-stu-id="f6617-163">Your application redirects the user to Azure AD with an OAuth 2.0 Authorize Request - to authenticate the user's credentials and get back an authorization code.</span></span> <span data-ttu-id="f6617-164">Uw toepassing gebruikt de autorisatiecode om een toegangstoken ophalen voor Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f6617-164">Your application uses the authorization code to get an access token for Resource Manager.</span></span> <span data-ttu-id="f6617-165">De [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) methode maakt u de autorisatieaanvraag.</span><span class="sxs-lookup"><span data-stu-id="f6617-165">The [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) method creates the authorization request.</span></span>

<span data-ttu-id="f6617-166">Dit onderwerp bevat de REST-API-aanvragen voor het verifiëren van de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="f6617-166">This topic shows the REST API requests to authenticate the user.</span></span> <span data-ttu-id="f6617-167">U kunt ook helper bibliotheken validatie uit te voeren in uw code.</span><span class="sxs-lookup"><span data-stu-id="f6617-167">You can also use helper libraries to perform authentication in your code.</span></span> <span data-ttu-id="f6617-168">Zie voor meer informatie over deze bibliotheken [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="f6617-168">For more information about these libraries, see [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span></span> <span data-ttu-id="f6617-169">Zie voor instructies over het integreren van identiteitsbeheer in een toepassing [ontwikkelaarshandleiding Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="f6617-169">For guidance on integrating identity management in an application, see [Azure Active Directory developer's guide](../active-directory/active-directory-developers-guide.md).</span></span>

### <a name="auth-request-oauth-20"></a><span data-ttu-id="f6617-170">Aanvraag voor verificatie (OAuth 2.0)</span><span class="sxs-lookup"><span data-stu-id="f6617-170">Auth request (OAuth 2.0)</span></span>
<span data-ttu-id="f6617-171">Een Open ID Connect/OAuth2.0 autoriseren aanvraag verstrekken naar het Azure AD geautoriseerde eindpunt:</span><span class="sxs-lookup"><span data-stu-id="f6617-171">Issue an Open ID Connect/OAuth2.0 Authorize Request to the Azure AD Authorize endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize

<span data-ttu-id="f6617-172">De queryreeksparameters die beschikbaar voor deze aanvraag zijn worden beschreven in de [aanvragen van een autorisatiecode](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) onderwerp.</span><span class="sxs-lookup"><span data-stu-id="f6617-172">The query string parameters that are available for this request are described in the [request an authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) topic.</span></span>

<span data-ttu-id="f6617-173">Het volgende voorbeeld ziet u hoe OAuth2.0 autorisatie aanvragen:</span><span class="sxs-lookup"><span data-stu-id="f6617-173">The following example shows how to request OAuth2.0 authorization:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=query&response_type=code&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&domain_hint=live.com

<span data-ttu-id="f6617-174">Azure AD verifieert de gebruiker en, indien nodig, vraagt de gebruiker wilt machtigen om de app te.</span><span class="sxs-lookup"><span data-stu-id="f6617-174">Azure AD authenticates the user, and, if necessary, asks the user to grant permission to the app.</span></span> <span data-ttu-id="f6617-175">De autorisatiecode wordt naar de antwoord-URL van uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-175">It returns the authorization code to the Reply URL of your application.</span></span> <span data-ttu-id="f6617-176">Afhankelijk van de aangevraagde response_mode, Azure AD ofwel queryaanvraag in query-tekenreeks of als post-gegevens.</span><span class="sxs-lookup"><span data-stu-id="f6617-176">Depending on the requested response_mode, Azure AD either sends back the data in query string or as post data.</span></span>

    code=AAABAAAAiL****FDMZBUwZ8eCAA&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="auth-request-open-id-connect"></a><span data-ttu-id="f6617-177">Verificatieaanvragen (Open ID Connect)</span><span class="sxs-lookup"><span data-stu-id="f6617-177">Auth request (Open ID Connect)</span></span>
<span data-ttu-id="f6617-178">Als u niet alleen Azure Resource Manager namens de gebruiker toegang wilt, maar kan de gebruiker zich aanmeldt bij uw toepassing met behulp van hun Azure AD-account, geven u een Open ID Connect autoriseren Request.</span><span class="sxs-lookup"><span data-stu-id="f6617-178">If you not only wish to access Azure Resource Manager on behalf of the user, but also allow the user to sign in to your application using their Azure AD account, issue an Open ID Connect Authorize Request.</span></span> <span data-ttu-id="f6617-179">Met Open ID Connect ontvangt de toepassing ook een id_token van Azure AD die uw app gebruiken kunt voor het aanmelden van de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="f6617-179">With Open ID Connect, your application also receives an id_token from Azure AD that your app can use to sign in the user.</span></span>

<span data-ttu-id="f6617-180">De queryreeksparameters die beschikbaar voor deze aanvraag zijn worden beschreven in de [verzending van de aanvraag aanmelden](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) onderwerp.</span><span class="sxs-lookup"><span data-stu-id="f6617-180">The query string parameters that are available for this request are described in the [Send the sign-in request](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) topic.</span></span>

<span data-ttu-id="f6617-181">Er is een voorbeeld van een Open ID Connect aanvraag:</span><span class="sxs-lookup"><span data-stu-id="f6617-181">An example Open ID Connect request is:</span></span>

     https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=form_post&response_type=code+id_token&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&scope=openid+profile&nonce=63567Dc4MDAw&domain_hint=live.com&state=M_12tMyKaM8

<span data-ttu-id="f6617-182">Azure AD verifieert de gebruiker en, indien nodig, vraagt de gebruiker wilt machtigen om de app te.</span><span class="sxs-lookup"><span data-stu-id="f6617-182">Azure AD authenticates the user, and, if necessary, asks the user to grant permission to the app.</span></span> <span data-ttu-id="f6617-183">De autorisatiecode wordt naar de antwoord-URL van uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-183">It returns the authorization code to the Reply URL of your application.</span></span> <span data-ttu-id="f6617-184">Afhankelijk van de aangevraagde response_mode, Azure AD ofwel queryaanvraag in query-tekenreeks of als post-gegevens.</span><span class="sxs-lookup"><span data-stu-id="f6617-184">Depending on the requested response_mode, Azure AD either sends back the data in query string or as post data.</span></span>

<span data-ttu-id="f6617-185">Een voorbeeld Open ID Connect reactie is:</span><span class="sxs-lookup"><span data-stu-id="f6617-185">An example Open ID Connect response is:</span></span>

    code=AAABAAAAiL*****I4rDWd7zXsH6WUjlkIEQxIAA&id_token=eyJ0eXAiOiJKV1Q*****T3GrzzSFxg&state=M_12tMyKaM8&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="token-request-oauth20-code-grant-flow"></a><span data-ttu-id="f6617-186">Tokenaanvraag (OAuth2.0 Code Grant stromen)</span><span class="sxs-lookup"><span data-stu-id="f6617-186">Token request (OAuth2.0 Code Grant Flow)</span></span>
<span data-ttu-id="f6617-187">Nu uw toepassing heeft ontvangen van de autorisatiecode uit Azure AD, is het tijd om het toegangstoken ophalen voor Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f6617-187">Now that your application has received the authorization code from Azure AD, it is time to get the access token for Azure Resource Manager.</span></span>  <span data-ttu-id="f6617-188">Post een OAuth2.0 Code Grant Token aanvraag voor het eindpunt van het Azure AD Token:</span><span class="sxs-lookup"><span data-stu-id="f6617-188">Post an OAuth2.0 Code Grant Token Request to the Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="f6617-189">De queryreeksparameters die beschikbaar voor deze aanvraag zijn worden beschreven in de [gebruiken de autorisatiecode](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) onderwerp.</span><span class="sxs-lookup"><span data-stu-id="f6617-189">The query string parameters that are available for this request are described in the [use the authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) topic.</span></span>

<span data-ttu-id="f6617-190">Het volgende voorbeeld ziet u een aanvraag voor code grant token met referenties van het wachtwoord:</span><span class="sxs-lookup"><span data-stu-id="f6617-190">The following example shows a request for code grant token with password credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="f6617-191">Als u werkt met de referenties van het computercertificaat, maak een JSON Web Token (JWT) en meld u (RSA SHA256) met behulp van de persoonlijke sleutel van uw toepassing certificaat referentie.</span><span class="sxs-lookup"><span data-stu-id="f6617-191">When working with certificate credentials, create a JSON Web Token (JWT) and sign (RSA SHA256) using the private key of your application's certificate credential.</span></span> <span data-ttu-id="f6617-192">De claimtypen voor de token worden weergegeven in [JWT-token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span><span class="sxs-lookup"><span data-stu-id="f6617-192">The claim types for the token are shown in [JWT token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span></span> <span data-ttu-id="f6617-193">Zie voor een verwijzing naar de [code Active Directory Authentication Library (.NET)](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) voor ondertekenen van Client Assertion JWT-tokens.</span><span class="sxs-lookup"><span data-stu-id="f6617-193">For reference, see the [Active Directory Auth Library (.NET) code](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) to sign Client Assertion JWT tokens.</span></span>

<span data-ttu-id="f6617-194">Zie de [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) voor meer informatie over clientverificatie.</span><span class="sxs-lookup"><span data-stu-id="f6617-194">See the [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) for details on client authentication.</span></span>

<span data-ttu-id="f6617-195">Het volgende voorbeeld ziet u een aanvraag voor code grant token met referenties van het certificaat:</span><span class="sxs-lookup"><span data-stu-id="f6617-195">The following example shows a request for code grant token with certificate credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&client_assertion=eyJhbG*****Y9cYo8nEjMyA

<span data-ttu-id="f6617-196">Een voorbeeld van een antwoord voor code verlenen token:</span><span class="sxs-lookup"><span data-stu-id="f6617-196">An example response for code grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039858","not_before":"1432035958","resource":"https://management.core.windows.net/","access_token":"eyJ0eXAiOiJKV1Q****M7Cw6JWtfY2lGc5A","refresh_token":"AAABAAAAiL9Kn2Z****55j-sjnyYgAA","scope":"user_impersonation","id_token":"eyJ0eXAiOiJKV*****-drP1J3P-HnHi9Rr46kGZnukEBH4dsg"}

#### <a name="handle-code-grant-token-response"></a><span data-ttu-id="f6617-197">Code grant token antwoord verwerkt</span><span class="sxs-lookup"><span data-stu-id="f6617-197">Handle code grant token response</span></span>
<span data-ttu-id="f6617-198">Een geslaagde reactie token bevat (gebruiker + app) toegangstoken voor Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f6617-198">A successful token response contains the (user + app) access token for Azure Resource Manager.</span></span> <span data-ttu-id="f6617-199">Uw toepassing gebruikt deze toegangstoken voor toegang tot Resource Manager namens de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="f6617-199">Your application uses this access token to access Resource Manager on behalf of the user.</span></span> <span data-ttu-id="f6617-200">De levensduur van de toegangstokens die zijn uitgegeven door Azure AD is een uur.</span><span class="sxs-lookup"><span data-stu-id="f6617-200">The lifetime of access tokens issued by Azure AD is one hour.</span></span> <span data-ttu-id="f6617-201">Het lijkt onwaarschijnlijk dat de webtoepassing vernieuwen moet (gebruiker + app) toegangstoken.</span><span class="sxs-lookup"><span data-stu-id="f6617-201">It is unlikely that your web application needs to renew the (user + app) access token.</span></span> <span data-ttu-id="f6617-202">Als deze het toegangstoken vernieuwen moet, gebruikt u het vernieuwingstoken dat uw toepassing in het token antwoord ontvangt.</span><span class="sxs-lookup"><span data-stu-id="f6617-202">If it needs to renew the access token, use the refresh token that your application receives in the token response.</span></span> <span data-ttu-id="f6617-203">Post een OAuth2.0 Token aanvraag voor het eindpunt van het Azure AD Token:</span><span class="sxs-lookup"><span data-stu-id="f6617-203">Post an OAuth2.0 Token Request to the Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="f6617-204">De parameters voor gebruik met de aanvraag voor vernieuwen worden beschreven in [vernieuwen van het toegangstoken](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span><span class="sxs-lookup"><span data-stu-id="f6617-204">The parameters to use with the refresh request are described in [refreshing the access token](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span></span>

<span data-ttu-id="f6617-205">Het volgende voorbeeld ziet het gebruik van de vernieuwing token:</span><span class="sxs-lookup"><span data-stu-id="f6617-205">The following example shows how to use the refresh token:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=refresh_token&refresh_token=AAABAAAAiL9Kn2Z****55j-sjnyYgAA&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="f6617-206">Hoewel het vernieuwen van tokens kunnen worden gebruikt voor nieuwe toegangstokens ophalen voor Azure Resource Manager, zijn ze niet geschikt voor offline toegang door uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-206">Although refresh tokens can be used to get new access tokens for Azure Resource Manager, they are not suitable for offline access by your application.</span></span> <span data-ttu-id="f6617-207">De levensduur van het vernieuwen van tokens is beperkt en vernieuwen van tokens zijn gebonden aan de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="f6617-207">The refresh tokens lifetime is limited, and refresh tokens are bound to the user.</span></span> <span data-ttu-id="f6617-208">Als de gebruiker de organisatie verlaat, verliest de toepassing met het vernieuwingstoken toegang.</span><span class="sxs-lookup"><span data-stu-id="f6617-208">If the user leaves the organization, the application using the refresh token loses access.</span></span> <span data-ttu-id="f6617-209">Deze aanpak is niet geschikt voor toepassingen die worden gebruikt door teams om hun Azure-resources te beheren.</span><span class="sxs-lookup"><span data-stu-id="f6617-209">This approach isn't suitable for applications that are used by teams to manage their Azure resources.</span></span>

## <a name="check-if-user-can-assign-access-to-subscription"></a><span data-ttu-id="f6617-210">Als gebruikers toegang aan abonnement toewijzen kunt controleren</span><span class="sxs-lookup"><span data-stu-id="f6617-210">Check if user can assign access to subscription</span></span>
<span data-ttu-id="f6617-211">Nu uw toepassing heeft een token voor toegang tot Azure Resource Manager namens de gebruiker.</span><span class="sxs-lookup"><span data-stu-id="f6617-211">Your application now has a token to access Azure Resource Manager on behalf of the user.</span></span> <span data-ttu-id="f6617-212">De volgende stap is het uw app verbinden met het abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-212">The next step is to connect your app to the subscription.</span></span> <span data-ttu-id="f6617-213">Nadat u verbinding maakt, uw app deze abonnementen kunt beheren zelfs wanneer de gebruiker niet aanwezig is (op lange termijn offline toegang).</span><span class="sxs-lookup"><span data-stu-id="f6617-213">After connecting, your app can manage those subscriptions even when the user isn't present (long-term offline access).</span></span>

<span data-ttu-id="f6617-214">Voor elk abonnement om verbinding te bellen naar de [lijstmachtigingen Resource Manager](https://docs.microsoft.com/rest/api/authorization/permissions) API om te bepalen of de gebruiker management toegangsrechten voor het abonnement heeft.</span><span class="sxs-lookup"><span data-stu-id="f6617-214">For each subscription to connect, call the [Resource Manager list permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API to determine whether the user has access management rights for the subscription.</span></span>

<span data-ttu-id="f6617-215">De [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) methode van de ASP.NET MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="f6617-215">The [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) method of the ASP.NET MVC sample app implements this call.</span></span>

<span data-ttu-id="f6617-216">Het volgende voorbeeld laat zien hoe aanvragen van een gebruiker machtigingen voor een abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-216">The following example shows how to request a user's permissions on a subscription.</span></span> <span data-ttu-id="f6617-217">83cfe939-2402-4581-b761-4f59b0a041e4 is de id van het abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-217">83cfe939-2402-4581-b761-4f59b0a041e4 is the id of the subscription.</span></span>

    GET https://management.azure.com/subscriptions/83cfe939-2402-4581-b761-4f59b0a041e4/providers/microsoft.authorization/permissions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiLC***lwO1mM7Cw6JWtfY2lGc5A

<span data-ttu-id="f6617-218">Er is een voorbeeld van het antwoord van de gebruiker machtigingen voor abonnement ophalen:</span><span class="sxs-lookup"><span data-stu-id="f6617-218">An example of the response to get user's permissions on subscription is:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"actions":["*"],"notActions":["Microsoft.Authorization/*/Write","Microsoft.Authorization/*/Delete"]},{"actions":["*/read"],"notActions":[]}]}

<span data-ttu-id="f6617-219">De machtigingen API retourneert meerdere machtigingen.</span><span class="sxs-lookup"><span data-stu-id="f6617-219">The permissions API returns multiple permissions.</span></span> <span data-ttu-id="f6617-220">Elke machtiging bestaat uit de toegestane acties (acties) en niet-toegestane acties (notactions).</span><span class="sxs-lookup"><span data-stu-id="f6617-220">Each permission consists of allowed actions (actions) and disallowed actions (notactions).</span></span> <span data-ttu-id="f6617-221">Als een actie in de lijst met toegestane acties van een andere machtiging en niet aanwezig in de lijst notactions met deze machtiging is, wordt de gebruiker mag deze actie uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="f6617-221">If an action is present in the allowed actions list of any permission and not present in the notactions list of that permission, the user is allowed to perform that action.</span></span> <span data-ttu-id="f6617-222">**Microsoft.Authorization/RoleAssignments/Write** is de actie dat die toegang rights management verleent.</span><span class="sxs-lookup"><span data-stu-id="f6617-222">**microsoft.authorization/roleassignments/write** is the action that that grants access management rights.</span></span> <span data-ttu-id="f6617-223">Uw toepassing, moet het resultaat van de machtigingen om te zoeken naar een overeenkomst regex op deze tekenreeks actie in de acties en notactions van elke machtiging parseren.</span><span class="sxs-lookup"><span data-stu-id="f6617-223">Your application must parse the permissions result to look for a regex match on this action string in the actions and notactions of each permission.</span></span>

## <a name="get-app-only-access-token"></a><span data-ttu-id="f6617-224">App-lezentoegang-token ophalen</span><span class="sxs-lookup"><span data-stu-id="f6617-224">Get app-only access token</span></span>
<span data-ttu-id="f6617-225">Nu weet u als de gebruiker toegang aan het Azure-abonnement toewijzen kunt.</span><span class="sxs-lookup"><span data-stu-id="f6617-225">Now, you know if the user can assign access to the Azure subscription.</span></span> <span data-ttu-id="f6617-226">De volgende stappen zijn:</span><span class="sxs-lookup"><span data-stu-id="f6617-226">The next steps are:</span></span>

1. <span data-ttu-id="f6617-227">De juiste RBAC-rol toewijzen aan de identiteit van uw toepassing op het abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-227">Assign the appropriate RBAC role to your application's identity on the subscription.</span></span>
2. <span data-ttu-id="f6617-228">De toewijzing toegang controleren door een query uitvoert voor toegang tot het abonnement van de toepassing of door het openen van Resource Manager met alleen-app-token.</span><span class="sxs-lookup"><span data-stu-id="f6617-228">Validate the access assignment by querying for the Application's permission on the subscription or by accessing Resource Manager using app-only token.</span></span>
3. <span data-ttu-id="f6617-229">De verbinding registreren in de structuur van uw toepassingen 'verbonden abonnementen"data - behouden blijven van de id van het abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-229">Record the connection in your applications "connected subscriptions" data structure - persisting the id of the subscription.</span></span>

<span data-ttu-id="f6617-230">We bekijken dichter bij de eerste stap.</span><span class="sxs-lookup"><span data-stu-id="f6617-230">Let's look closer at the first step.</span></span> <span data-ttu-id="f6617-231">Als u wilt de juiste RBAC-rol toewijzen aan de identiteit van de toepassing, moet u het volgende bepalen:</span><span class="sxs-lookup"><span data-stu-id="f6617-231">To assign the appropriate RBAC role to the application's identity, you must determine:</span></span>

* <span data-ttu-id="f6617-232">De object-id van de identiteit van uw toepassing in van de gebruiker Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="f6617-232">The object id of your application's identity in the user's Azure Active Directory</span></span>
* <span data-ttu-id="f6617-233">De id van de RBAC-rol die uw toepassing voor het abonnement vereist</span><span class="sxs-lookup"><span data-stu-id="f6617-233">The identifier of the RBAC role that your application requires on the subscription</span></span>

<span data-ttu-id="f6617-234">Wanneer uw aanvraag wordt geverifieerd door een gebruiker uit een Azure AD, maakt deze een service-principal-object voor uw toepassing in die Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f6617-234">When your application authenticates a user from an Azure AD, it creates a service principal object for your application in that Azure AD.</span></span> <span data-ttu-id="f6617-235">Azure kunt RBAC-rollen worden toegewezen aan de service-principals direct toegang verlenen tot bijbehorende toepassingen op Azure-resources.</span><span class="sxs-lookup"><span data-stu-id="f6617-235">Azure allows RBAC roles to be assigned to service principals to grant direct access to corresponding applications on Azure resources.</span></span> <span data-ttu-id="f6617-236">Deze actie is precies wat we willen doen.</span><span class="sxs-lookup"><span data-stu-id="f6617-236">This action is exactly what we wish to do.</span></span> <span data-ttu-id="f6617-237">Query de Azure AD Graph API om te bepalen van de id van de service-principal van uw toepassing in de aangemelde gebruiker's Azure AD.</span><span class="sxs-lookup"><span data-stu-id="f6617-237">Query the Azure AD Graph API to determine the identifier of the service principal of your application in the signed-in user's Azure AD.</span></span>

<span data-ttu-id="f6617-238">U hoeft alleen een toegangstoken voor Azure Resource Manager - moet u een nieuw toegangstoken de Azure AD Graph API aan te roepen.</span><span class="sxs-lookup"><span data-stu-id="f6617-238">You only have an access token for Azure Resource Manager - you need a new access token to call the Azure AD Graph API.</span></span> <span data-ttu-id="f6617-239">Elke toepassing in Azure AD is gemachtigd om op te vragen een eigen service principal-object, zodat een app alleen-lezen toegangstoken voldoende is.</span><span class="sxs-lookup"><span data-stu-id="f6617-239">Every application in Azure AD has permission to query its own service principal object, so an app-only access token is sufficient.</span></span>

<a id="app-azure-ad-graph" />

### <a name="get-app-only-access-token-for-azure-ad-graph-api"></a><span data-ttu-id="f6617-240">App-lezentoegang voor Azure AD Graph API token ophalen</span><span class="sxs-lookup"><span data-stu-id="f6617-240">Get app-only access token for Azure AD Graph API</span></span>
<span data-ttu-id="f6617-241">Om uw app verifiëren en krijgt u een token voor Azure AD Graph API, door een tokenaanvraag door Client referentie Grant OAuth2.0 stroom te verlenen aan Azure AD-tokeneindpunt (**https://login.microsoftonline.com/ {directory_domain_name} / OAuth2/Token**).</span><span class="sxs-lookup"><span data-stu-id="f6617-241">To authenticate your app and get a token to Azure AD Graph API, issue a Client Credential Grant OAuth2.0 flow token request to Azure AD token endpoint (**https://login.microsoftonline.com/{directory_domain_name}/OAuth2/Token**).</span></span>

<span data-ttu-id="f6617-242">De [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) methode van de ASP.net MVC-voorbeeldtoepassing krijgt een app alleen-lezen toegang token voor Graph API met behulp van de Active Directory Authentication Library voor .NET.</span><span class="sxs-lookup"><span data-stu-id="f6617-242">The [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) method of the ASP.net MVC sample application gets an app-only access token for Graph API using the Active Directory Authentication Library for .NET.</span></span>

<span data-ttu-id="f6617-243">De queryreeksparameters die beschikbaar voor deze aanvraag zijn worden beschreven in de [een Token toegang aanvragen](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) onderwerp.</span><span class="sxs-lookup"><span data-stu-id="f6617-243">The query string parameters that are available for this request are described in the [Request an Access Token](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) topic.</span></span>

<span data-ttu-id="f6617-244">Een voorbeeld van de aanvraag voor de clientreferenties verlenen token:</span><span class="sxs-lookup"><span data-stu-id="f6617-244">An example request for client credential grant token:</span></span>

    POST https://login.microsoftonline.com/62e173e9-301e-423e-bcd4-29121ec1aa24/oauth2/token HTTP/1.1
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 187</pre>
    <pre>grant_type=client_credentials&client_id=a0448380-c346-4f9f-b897-c18733de9394&resource=https%3A%2F%2Fgraph.windows.net%2F &client_secret=olna8C*****Og%3D

<span data-ttu-id="f6617-245">Een voorbeeld van een antwoord voor de clientreferenties verlenen token:</span><span class="sxs-lookup"><span data-stu-id="f6617-245">An example response for client credential grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039862","not_before":"1432035962","resource":"https://graph.windows.net/","access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRv****G5gUTV-kKorR-pg"}

### <a name="get-objectid-of-application-service-principal-in-user-azure-ad"></a><span data-ttu-id="f6617-246">Object-id van de service-principal toepassing in Azure AD-gebruiker ophalen</span><span class="sxs-lookup"><span data-stu-id="f6617-246">Get ObjectId of application service principal in user Azure AD</span></span>
<span data-ttu-id="f6617-247">Nu de app alleen-lezen toegangstoken uit aan de query te gebruiken de [Azure AD Graph Service-Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API om te bepalen van de Object-Id van de service-principal in de map van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-247">Now, use the app-only access token to query the [Azure AD Graph Service Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API to determine the Object Id of the application's service principal in the directory.</span></span>

<span data-ttu-id="f6617-248">De [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) methode van de ASP.net MVC-voorbeeldtoepassing implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="f6617-248">The [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) method of the ASP.net MVC sample application implements this call.</span></span>

<span data-ttu-id="f6617-249">Het volgende voorbeeld laat zien hoe de service-principal van een toepassing aanvragen.</span><span class="sxs-lookup"><span data-stu-id="f6617-249">The following example shows how to request an application's service principal.</span></span> <span data-ttu-id="f6617-250">a0448380-c346-4f9f-b897-c18733de9394 is de client-id van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-250">a0448380-c346-4f9f-b897-c18733de9394 is the client id of the application.</span></span>

    GET https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/servicePrincipals?api-version=1.5&$filter=appId%20eq%20'a0448380-c346-4f9f-b897-c18733de9394' HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJK*****-kKorR-pg

<span data-ttu-id="f6617-251">Het volgende voorbeeld laat een reactie op de aanvraag voor een toepassing service principal</span><span class="sxs-lookup"><span data-stu-id="f6617-251">The following example shows a response to the request for an application's service principal</span></span>

    HTTP/1.1 200 OK

    {"odata.metadata":"https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/$metadata#directoryObjects/Microsoft.DirectoryServices.ServicePrincipal","value":[{"odata.type":"Microsoft.DirectoryServices.ServicePrincipal","objectType":"ServicePrincipal","objectId":"9b5018d4-6951-42ed-8a92-f11ec283ccec","deletionTimestamp":null,"accountEnabled":true,"appDisplayName":"CloudSense","appId":"a0448380-c346-4f9f-b897-c18733de9394","appOwnerTenantId":"62e173e9-301e-423e-bcd4-29121ec1aa24","appRoleAssignmentRequired":false,"appRoles":[],"displayName":"CloudSense","errorUrl":null,"homepage":"http://www.vipswapper.com/cloudsense","keyCredentials":[],"logoutUrl":null,"oauth2Permissions":[{"adminConsentDescription":"Allow the application to access CloudSense on behalf of the signed-in user.","adminConsentDisplayName":"Access CloudSense","id":"b7b7338e-683a-4796-b95e-60c10380de1c","isEnabled":true,"type":"User","userConsentDescription":"Allow the application to access CloudSense on your behalf.","userConsentDisplayName":"Access CloudSense","value":"user_impersonation"}],"passwordCredentials":[],"preferredTokenSigningKeyThumbprint":null,"publisherName":"vipswapper"quot;,"replyUrls":["http://www.vipswapper.com/cloudsense","http://www.vipswapper.com","http://vipswapper.com","http://vipswapper.azurewebsites.net","http://localhost:62080"],"samlMetadataUrl":null,"servicePrincipalNames":["http://www.vipswapper.com/cloudsense","a0448380-c346-4f9f-b897-c18733de9394"],"tags":["WindowsAzureActiveDirectoryIntegratedApp"]}]}

### <a name="get-azure-rbac-role-identifier"></a><span data-ttu-id="f6617-252">Azure RBAC-rol-id ophalen</span><span class="sxs-lookup"><span data-stu-id="f6617-252">Get Azure RBAC role identifier</span></span>
<span data-ttu-id="f6617-253">Als u wilt de juiste RBAC-rol toewijzen aan uw service-principal, moet u de id van de Azure RBAC-rol bepalen.</span><span class="sxs-lookup"><span data-stu-id="f6617-253">To assign the appropriate RBAC role to your service principal, you must determine the identifier of the Azure RBAC role.</span></span>

<span data-ttu-id="f6617-254">De juiste RBAC-rol voor uw toepassing:</span><span class="sxs-lookup"><span data-stu-id="f6617-254">The right RBAC role for your application:</span></span>

* <span data-ttu-id="f6617-255">Als uw toepassing alleen het abonnement, controleert zonder dat u wijzigingen aanbrengt, moet leesmachtigingen voor het abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-255">If your application only monitors the subscription, without making any changes, it requires only reader permissions on the subscription.</span></span> <span data-ttu-id="f6617-256">Wijs de **lezer** rol.</span><span class="sxs-lookup"><span data-stu-id="f6617-256">Assign the **Reader** role.</span></span>
* <span data-ttu-id="f6617-257">Als uw toepassing Azure het abonnement, entiteiten maken/wijzigen/verwijderen beheert, moet een van de Inzender-rechten.</span><span class="sxs-lookup"><span data-stu-id="f6617-257">If your application manages Azure the subscription, creating/modifying/deleting entities, it requires one of the contributor permissions.</span></span>
  * <span data-ttu-id="f6617-258">Voor het beheren van een bepaald type resource rollen toe te wijzen de resource-specifieke Inzender (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Inzender, enz.)</span><span class="sxs-lookup"><span data-stu-id="f6617-258">To manage a particular type of resource, assign the resource-specific contributor roles (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Contributor, etc.)</span></span>
  * <span data-ttu-id="f6617-259">Voor het beheren van elk brontype wijzen de **Inzender** rol.</span><span class="sxs-lookup"><span data-stu-id="f6617-259">To manage any resource type, assign the **Contributor** role.</span></span>

<span data-ttu-id="f6617-260">De roltoewijzing voor uw toepassing is zichtbaar voor gebruikers, dus selecteer bevoegdheid minst vereist.</span><span class="sxs-lookup"><span data-stu-id="f6617-260">The role assignment for your application is visible to users, so select the least-required privilege.</span></span>

<span data-ttu-id="f6617-261">Roep de [Resource Manager roldefinitie API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) lijst van alle Azure RBAC-rollen en zoeken en vervolgens het resultaat dat de gewenste roldefinitie zoeken op naam doorlopen.</span><span class="sxs-lookup"><span data-stu-id="f6617-261">Call the [Resource Manager role definition API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) to list all Azure RBAC roles and search then iterate over the result to find the desired role definition by name.</span></span>

<span data-ttu-id="f6617-262">De [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) methode van de ASP.net MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="f6617-262">The [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) method of the ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="f6617-263">De volgende aanvraag voorbeeld laat zien hoe Azure RBAC-rol-id ophalen.</span><span class="sxs-lookup"><span data-stu-id="f6617-263">The following request example shows how to get Azure RBAC role identifier.</span></span> <span data-ttu-id="f6617-264">09cbd307-aa71-4aca-b346-5f253e6e3ebb is de id van het abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-264">09cbd307-aa71-4aca-b346-5f253e6e3ebb is the id of the subscription.</span></span>

    GET https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV*****fY2lGc5

<span data-ttu-id="f6617-265">De reactie is in de volgende indeling:</span><span class="sxs-lookup"><span data-stu-id="f6617-265">The response is in the following format:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"properties":{"roleName":"API Management Service Contributor","type":"BuiltInRole","description":"Lets you manage API Management services, but not access to them.","scope":"/","permissions":[{"actions":["Microsoft.ApiManagement/Services/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/312a565d-c81f-4fd8-895a-4e21e48d571c","type":"Microsoft.Authorization/roleDefinitions","name":"312a565d-c81f-4fd8-895a-4e21e48d571c"},{"properties":{"roleName":"Application Insights Component Contributor","type":"BuiltInRole","description":"Lets you manage Application Insights components, but not access to them.","scope":"/","permissions":[{"actions":["Microsoft.Insights/components/*","Microsoft.Insights/webtests/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/ae349356-3a1b-4a5e-921d-050484c6347e","type":"Microsoft.Authorization/roleDefinitions","name":"ae349356-3a1b-4a5e-921d-050484c6347e"}]}

<span data-ttu-id="f6617-266">U hoeft niet voortdurend deze API niet aanroepen.</span><span class="sxs-lookup"><span data-stu-id="f6617-266">You do not need to call this API on an ongoing basis.</span></span> <span data-ttu-id="f6617-267">Nadat u de bekende GUID van de roldefinitie hebt vastgesteld, kunt u de roldefinitie-id als kunt maken:</span><span class="sxs-lookup"><span data-stu-id="f6617-267">Once you've determined the well-known GUID of the role definition, you can construct the role definition id as:</span></span>

    /subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{well-known-role-guid}

<span data-ttu-id="f6617-268">Hier volgen de bekende GUID's van veelgebruikte ingebouwde rollen:</span><span class="sxs-lookup"><span data-stu-id="f6617-268">Here are the well-known guids of commonly used built-in roles:</span></span>

| <span data-ttu-id="f6617-269">Rol</span><span class="sxs-lookup"><span data-stu-id="f6617-269">Role</span></span> | <span data-ttu-id="f6617-270">GUID</span><span class="sxs-lookup"><span data-stu-id="f6617-270">Guid</span></span> |
| --- | --- |
| <span data-ttu-id="f6617-271">Lezer</span><span class="sxs-lookup"><span data-stu-id="f6617-271">Reader</span></span> |<span data-ttu-id="f6617-272">acdd72a7-3385-48ef-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="f6617-272">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |
| <span data-ttu-id="f6617-273">Inzender</span><span class="sxs-lookup"><span data-stu-id="f6617-273">Contributor</span></span> |<span data-ttu-id="f6617-274">b24988ac-6180-42a0-ab88-20f7382dd24c</span><span class="sxs-lookup"><span data-stu-id="f6617-274">b24988ac-6180-42a0-ab88-20f7382dd24c</span></span> |
| <span data-ttu-id="f6617-275">Virtual Machine Contributor</span><span class="sxs-lookup"><span data-stu-id="f6617-275">Virtual Machine Contributor</span></span> |<span data-ttu-id="f6617-276">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span><span class="sxs-lookup"><span data-stu-id="f6617-276">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span></span> |
| <span data-ttu-id="f6617-277">Virtueel netwerk Inzender</span><span class="sxs-lookup"><span data-stu-id="f6617-277">Virtual Network Contributor</span></span> |<span data-ttu-id="f6617-278">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span><span class="sxs-lookup"><span data-stu-id="f6617-278">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span></span> |
| <span data-ttu-id="f6617-279">Storage-Account Inzender</span><span class="sxs-lookup"><span data-stu-id="f6617-279">Storage Account Contributor</span></span> |<span data-ttu-id="f6617-280">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span><span class="sxs-lookup"><span data-stu-id="f6617-280">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span></span> |
| <span data-ttu-id="f6617-281">Website Inzender</span><span class="sxs-lookup"><span data-stu-id="f6617-281">Website Contributor</span></span> |<span data-ttu-id="f6617-282">de139f84-1756-47ae-9be6-808fbbe84772</span><span class="sxs-lookup"><span data-stu-id="f6617-282">de139f84-1756-47ae-9be6-808fbbe84772</span></span> |
| <span data-ttu-id="f6617-283">Web Plan Inzender</span><span class="sxs-lookup"><span data-stu-id="f6617-283">Web Plan Contributor</span></span> |<span data-ttu-id="f6617-284">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span><span class="sxs-lookup"><span data-stu-id="f6617-284">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span></span> |
| <span data-ttu-id="f6617-285">SQL Server Inzender</span><span class="sxs-lookup"><span data-stu-id="f6617-285">SQL Server Contributor</span></span> |<span data-ttu-id="f6617-286">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span><span class="sxs-lookup"><span data-stu-id="f6617-286">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span></span> |
| <span data-ttu-id="f6617-287">SQL DB Contributor</span><span class="sxs-lookup"><span data-stu-id="f6617-287">SQL DB Contributor</span></span> |<span data-ttu-id="f6617-288">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span><span class="sxs-lookup"><span data-stu-id="f6617-288">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span></span> |

### <a name="assign-rbac-role-to-application"></a><span data-ttu-id="f6617-289">RBAC-rol toewijzen aan de toepassing</span><span class="sxs-lookup"><span data-stu-id="f6617-289">Assign RBAC role to application</span></span>
<span data-ttu-id="f6617-290">Hebt u alles wat u moet de juiste RBAC-rol toewijzen aan uw service-principal met behulp van de [Resource Manager roltoewijzing maken](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span><span class="sxs-lookup"><span data-stu-id="f6617-290">You have everything you need to assign the appropriate RBAC role to your service principal by using the [Resource Manager create role assignment](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span></span>

<span data-ttu-id="f6617-291">De [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) methode van de ASP.net MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="f6617-291">The [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) method of the ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="f6617-292">Een voorbeeld van aanvraag RBAC-rol toewijzen aan toepassing:</span><span class="sxs-lookup"><span data-stu-id="f6617-292">An example request to assign RBAC role to application:</span></span>

    PUT https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/microsoft.authorization/roleassignments/4f87261d-2816-465d-8311-70a27558df4c?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiL*****FlwO1mM7Cw6JWtfY2lGc5
    Content-Type: application/json
    Content-Length: 230

    {"properties": {"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2"}}

<span data-ttu-id="f6617-293">In de aanvraag, worden de volgende waarden gebruikt:</span><span class="sxs-lookup"><span data-stu-id="f6617-293">In the request, the following values are used:</span></span>

| <span data-ttu-id="f6617-294">GUID</span><span class="sxs-lookup"><span data-stu-id="f6617-294">Guid</span></span> | <span data-ttu-id="f6617-295">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="f6617-295">Description</span></span> |
| --- | --- |
| <span data-ttu-id="f6617-296">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span><span class="sxs-lookup"><span data-stu-id="f6617-296">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span></span> |<span data-ttu-id="f6617-297">de id van het abonnement</span><span class="sxs-lookup"><span data-stu-id="f6617-297">the id of the subscription</span></span> |
| <span data-ttu-id="f6617-298">c3097b31-7309-4c59-b4e3-770f8406bad2</span><span class="sxs-lookup"><span data-stu-id="f6617-298">c3097b31-7309-4c59-b4e3-770f8406bad2</span></span> |<span data-ttu-id="f6617-299">de object-id van de service-principal van de toepassing</span><span class="sxs-lookup"><span data-stu-id="f6617-299">the object id of the service principal of the application</span></span> |
| <span data-ttu-id="f6617-300">acdd72a7-3385-48ef-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="f6617-300">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |<span data-ttu-id="f6617-301">de id van de lezersrol</span><span class="sxs-lookup"><span data-stu-id="f6617-301">the id of the reader role</span></span> |
| <span data-ttu-id="f6617-302">4f87261d-2816-465d-8311-70a27558df4c</span><span class="sxs-lookup"><span data-stu-id="f6617-302">4f87261d-2816-465d-8311-70a27558df4c</span></span> |<span data-ttu-id="f6617-303">een nieuwe guid gemaakt voor de nieuwe roltoewijzing</span><span class="sxs-lookup"><span data-stu-id="f6617-303">a new guid created for the new role assignment</span></span> |

<span data-ttu-id="f6617-304">De reactie is in de volgende indeling:</span><span class="sxs-lookup"><span data-stu-id="f6617-304">The response is in the following format:</span></span>

    HTTP/1.1 201 Created

    {"properties":{"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2","scope":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb"},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleAssignments/4f87261d-2816-465d-8311-70a27558df4c","type":"Microsoft.Authorization/roleAssignments","name":"4f87261d-2816-465d-8311-70a27558df4c"}

### <a name="get-app-only-access-token-for-azure-resource-manager"></a><span data-ttu-id="f6617-305">App-lezentoegang-token ophalen voor Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="f6617-305">Get app-only access token for Azure Resource Manager</span></span>
<span data-ttu-id="f6617-306">Als u wilt valideren die app heeft de gewenste toegang krijgen tot op het abonnement, voert u een test-taak voor het abonnement met een alleen-app-token.</span><span class="sxs-lookup"><span data-stu-id="f6617-306">To validate that app has the desired access on the subscription, perform a test task on the subscription using an app-only token.</span></span>

<span data-ttu-id="f6617-307">Als u een app alleen-lezen toegangstoken, volgt u de instructies in sectie [alleen app-token ophalen voor Azure AD Graph API](#app-azure-ad-graph), met een andere waarde voor de resourceparameter:</span><span class="sxs-lookup"><span data-stu-id="f6617-307">To get an app-only access token, follow instructions from section [Get app-only access token for Azure AD Graph API](#app-azure-ad-graph), with a different value for the resource parameter:</span></span>

    https://management.core.windows.net/

<span data-ttu-id="f6617-308">De [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) methode van de ASP.NET MVC-voorbeeldtoepassing krijgt een app alleen-lezen toegang token voor Azure Resource Manager met de Active Directory Authentication Library voor .net.</span><span class="sxs-lookup"><span data-stu-id="f6617-308">The [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of the ASP.NET MVC sample application gets an app-only access token for Azure Resource Manager using the Active Directory Authentication Library for .net.</span></span>

#### <a name="get-applications-permissions-on-subscription"></a><span data-ttu-id="f6617-309">Machtigingen van de van toepassing op abonnement ophalen</span><span class="sxs-lookup"><span data-stu-id="f6617-309">Get Application's Permissions on Subscription</span></span>
<span data-ttu-id="f6617-310">Als u wilt controleren of uw toepassing de gewenste toegang op een Azure-abonnement heeft, u ook kan aanroepen de [Resource Manager machtigingen](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span><span class="sxs-lookup"><span data-stu-id="f6617-310">To check that your application has the desired access on an Azure subscription, you may also call the [Resource Manager Permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span></span> <span data-ttu-id="f6617-311">Deze methode is vergelijkbaar met hoe u bepaald of de gebruiker Access Management-rechten voor het abonnement heeft.</span><span class="sxs-lookup"><span data-stu-id="f6617-311">This approach is similar to how you determined whether the user has Access Management rights for the subscription.</span></span> <span data-ttu-id="f6617-312">Deze tijd aanroepen echter de machtigingen API met de app alleen-lezen toegangstoken dat u in de vorige stap hebt ontvangen.</span><span class="sxs-lookup"><span data-stu-id="f6617-312">However, this time, call the permissions API with the app-only access token that you received in the previous step.</span></span>

<span data-ttu-id="f6617-313">De [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) methode van de ASP.NET MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="f6617-313">The [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of the ASP.NET MVC sample app implements this call.</span></span>

## <a name="manage-connected-subscriptions"></a><span data-ttu-id="f6617-314">Verbonden abonnementen beheren</span><span class="sxs-lookup"><span data-stu-id="f6617-314">Manage connected subscriptions</span></span>
<span data-ttu-id="f6617-315">Wanneer de juiste RBAC-rol is toegewezen aan uw toepassing service-principal voor het abonnement, kunt uw toepassing houden bewaking/beheren met behulp van alleen-app toegangstokens voor Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="f6617-315">When the appropriate RBAC role is assigned to your application's service principal on the subscription, your application can keep monitoring/managing it using app-only access tokens for Azure Resource Manager.</span></span>

<span data-ttu-id="f6617-316">Als eigenaar van een abonnement van uw toepassing roltoewijzing via de klassieke portal of de opdrachtregelprogramma's verwijdert, is uw toepassing niet langer toegang kunnen krijgen tot dat abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-316">If a subscription owner removes your application's role assignment using the classic portal or command-line tools, your application is no longer able to access that subscription.</span></span> <span data-ttu-id="f6617-317">In dat geval moet u de gebruiker die de verbinding met het abonnement van buiten de toepassing werd verbroken waarschuwen en geeft u een optie voor het "repareren" de verbinding.</span><span class="sxs-lookup"><span data-stu-id="f6617-317">In that case, you should notify the user that the connection with the subscription was severed from outside the application and give them an option to "repair" the connection.</span></span> <span data-ttu-id="f6617-318">'Herstellen' zou gewoon opnieuw maken voor de roltoewijzing die offline is verwijderd.</span><span class="sxs-lookup"><span data-stu-id="f6617-318">"Repair" would simply re-create the role assignment that was deleted offline.</span></span>

<span data-ttu-id="f6617-319">Net als u de gebruiker verbinding abonnementen maken voor uw toepassing hebt ingeschakeld, moet u de gebruiker verbinding te verbreken abonnementen toestaan.</span><span class="sxs-lookup"><span data-stu-id="f6617-319">Just as you enabled the user to connect subscriptions to your application, you must allow the user to disconnect subscriptions too.</span></span> <span data-ttu-id="f6617-320">Verbinding verbreken betekent dat het verwijderen van de toewijzing van rol met de service-principal van de toepassing op het abonnement van een access-beheer.</span><span class="sxs-lookup"><span data-stu-id="f6617-320">From an access management point of view, disconnect means removing the role assignment that the application's service principal has on the subscription.</span></span> <span data-ttu-id="f6617-321">Desgewenst kan geen status in de toepassing voor het abonnement te worden verwijderd.</span><span class="sxs-lookup"><span data-stu-id="f6617-321">Optionally, any state in the application for the subscription might be removed too.</span></span>
<span data-ttu-id="f6617-322">Alleen gebruikers met beheer van toegangsmachtigingen voor het abonnement kunnen Verbreek de verbinding met het abonnement.</span><span class="sxs-lookup"><span data-stu-id="f6617-322">Only users with access management permission on the subscription are able to disconnect the subscription.</span></span>

<span data-ttu-id="f6617-323">De [RevokeRoleFromServicePrincipalOnSubscription methode](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) van de ASP.net MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="f6617-323">The [RevokeRoleFromServicePrincipalOnSubscription method](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) of the ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="f6617-324">Dat is alles - gebruikers kunnen nu eenvoudig verbinding maken en beheren hun Azure-abonnementen met uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="f6617-324">That's it - users can now easily connect and manage their Azure subscriptions with your application.</span></span>
