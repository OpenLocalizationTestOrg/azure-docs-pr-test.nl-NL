---
title: aaaAzure Active Directory-verificatie en Resource Manager | Microsoft Docs
description: Een ontwikkelaar handleiding tooauthentication met hello Azure Resource Manager-API en Azure Active Directory voor het integreren van een app met andere Azure-abonnementen.
services: azure-resource-manager,active-directory
documentationcenter: na
author: dushyantgill
manager: timlt
editor: tysonn
ms.assetid: 17b2b40d-bf42-4c7d-9a88-9938409c5088
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 12/27/2016
ms.author: dugill;tomfitz
ms.openlocfilehash: 757e45fdb28488b45de70647746461888bf35a56
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="use-resource-manager-authentication-api-tooaccess-subscriptions"></a><span data-ttu-id="86d3d-103">Gebruik resourcemanager authenticatie-API tooaccess abonnementen</span><span class="sxs-lookup"><span data-stu-id="86d3d-103">Use Resource Manager authentication API tooaccess subscriptions</span></span>
## <a name="introduction"></a><span data-ttu-id="86d3d-104">Inleiding</span><span class="sxs-lookup"><span data-stu-id="86d3d-104">Introduction</span></span>
<span data-ttu-id="86d3d-105">Als u een softwareontwikkelaar die moet toocreate een app die van de klant Azure-resources wordt beheerd, dit onderwerp leest u hoe tooauthenticate met hello Azure Resource Manager-API's en tooresources in andere abonnementen toegang te krijgen.</span><span class="sxs-lookup"><span data-stu-id="86d3d-105">If you are a software developer who needs toocreate an app that manages customer's Azure resources, this topic shows you how tooauthenticate with hello Azure Resource Manager APIs and gain access tooresources in other subscriptions.</span></span>

<span data-ttu-id="86d3d-106">Uw app hebben toegang tot Hallo Resource Manager-API's in verschillende manieren:</span><span class="sxs-lookup"><span data-stu-id="86d3d-106">Your app can access hello Resource Manager APIs in couple of ways:</span></span>

1. <span data-ttu-id="86d3d-107">**Gebruikers- + toegang tot Apps**: voor apps die toegang krijgen bronnen namens een gebruiker aangemeld tot.</span><span class="sxs-lookup"><span data-stu-id="86d3d-107">**User + app access**: for apps that access resources on behalf of a signed-in user.</span></span> <span data-ttu-id="86d3d-108">Deze methode werkt voor apps, zoals web-apps en opdrachtregelprogramma's, die betrekking op alleen 'interactieve management' Azure-resources hebben.</span><span class="sxs-lookup"><span data-stu-id="86d3d-108">This approach works for apps, such as web apps and command-line tools, that deal with only "interactive management" of Azure resources.</span></span>
2. <span data-ttu-id="86d3d-109">**App-lezentoegang**: voor apps die daemon-services en geplande taken worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="86d3d-109">**App-only access**: for apps that run daemon services and scheduled jobs.</span></span> <span data-ttu-id="86d3d-110">Hallo-app identiteit krijgt directe toegang tot toohello bronnen.</span><span class="sxs-lookup"><span data-stu-id="86d3d-110">hello app's identity is granted direct access toohello resources.</span></span> <span data-ttu-id="86d3d-111">Deze methode werkt voor apps die langlopende headless (zonder toezicht) toegang tooAzure nodig.</span><span class="sxs-lookup"><span data-stu-id="86d3d-111">This approach works for apps that need long-term headless (unattended) access tooAzure.</span></span>

<span data-ttu-id="86d3d-112">Dit onderwerp vindt u stapsgewijze instructies toocreate een app die gebruikmaakt van deze twee autorisatiemethoden.</span><span class="sxs-lookup"><span data-stu-id="86d3d-112">This topic provides step-by-step instructions toocreate an app that employs both these authorization methods.</span></span> <span data-ttu-id="86d3d-113">Er wordt weergegeven hoe tooperform elke stap met REST-API of C#.</span><span class="sxs-lookup"><span data-stu-id="86d3d-113">It shows how tooperform each step with REST API or C#.</span></span> <span data-ttu-id="86d3d-114">de volledige ASP.NET MVC-toepassing Hello is beschikbaar op [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span><span class="sxs-lookup"><span data-stu-id="86d3d-114">hello complete ASP.NET MVC application is available at [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span></span>

## <a name="what-hello-web-app-does"></a><span data-ttu-id="86d3d-115">Welke Hallo web-app biedt</span><span class="sxs-lookup"><span data-stu-id="86d3d-115">What hello web app does</span></span>
<span data-ttu-id="86d3d-116">Hallo-web-app:</span><span class="sxs-lookup"><span data-stu-id="86d3d-116">hello web app:</span></span>

1. <span data-ttu-id="86d3d-117">Zich aanmeldt een Azure-gebruiker.</span><span class="sxs-lookup"><span data-stu-id="86d3d-117">Signs-in an Azure user.</span></span>
2. <span data-ttu-id="86d3d-118">Gebruiker toogrant Hallo web app toegang tooResource Manager vraagt.</span><span class="sxs-lookup"><span data-stu-id="86d3d-118">Asks user toogrant hello web app access tooResource Manager.</span></span>
3. <span data-ttu-id="86d3d-119">Gebruikers- + toegangstoken app opgehaald voor toegang tot de Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="86d3d-119">Gets user + app access token for accessing Resource Manager.</span></span>
4. <span data-ttu-id="86d3d-120">Gebruikt (uit stap 3) token toocall Resource Manager en de functie toewijzen Hallo app service-principal tooa in Hallo-abonnement waarmee Hallo app op lange termijn toegang toohello abonnement.</span><span class="sxs-lookup"><span data-stu-id="86d3d-120">Uses token (from step 3) toocall Resource Manager and assign hello app's service principal tooa role in hello subscription, which gives hello app long-term access toohello subscription.</span></span>
5. <span data-ttu-id="86d3d-121">App-lezentoegang token opgehaald.</span><span class="sxs-lookup"><span data-stu-id="86d3d-121">Gets app-only access token.</span></span>
6. <span data-ttu-id="86d3d-122">Token (uit stap 5) toomanage bronnen worden gebruikt in het Hallo-abonnement via Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="86d3d-122">Uses token (from step 5) toomanage resources in hello subscription through Resource Manager.</span></span>

<span data-ttu-id="86d3d-123">Hier volgt Hallo end-to-end-stroom van Hallo-webtoepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-123">Here's hello end-to-end flow of hello web application.</span></span>

![Resource Manager-authenticatiestroom](./media/resource-manager-api-authentication/Auth-Swim-Lane.png)

<span data-ttu-id="86d3d-125">Als een gebruiker u Hallo abonnements-id opgeven voor Hallo abonnement u wilt dat toouse:</span><span class="sxs-lookup"><span data-stu-id="86d3d-125">As a user, you provide hello subscription id for hello subscription you want toouse:</span></span>

![abonnement-id opgeven](./media/resource-manager-api-authentication/sample-ux-1.png)

<span data-ttu-id="86d3d-127">Selecteer Hallo account toouse voor logboekregistratie in.</span><span class="sxs-lookup"><span data-stu-id="86d3d-127">Select hello account toouse for logging in.</span></span>

![account selecteren](./media/resource-manager-api-authentication/sample-ux-2.png)

<span data-ttu-id="86d3d-129">Geef uw referenties.</span><span class="sxs-lookup"><span data-stu-id="86d3d-129">Provide your credentials.</span></span>

![referenties opgeven](./media/resource-manager-api-authentication/sample-ux-3.png)

<span data-ttu-id="86d3d-131">Hallo app toegang tooyour Azure-abonnementen verlenen:</span><span class="sxs-lookup"><span data-stu-id="86d3d-131">Grant hello app access tooyour Azure subscriptions:</span></span>

![Toegang verlenen](./media/resource-manager-api-authentication/sample-ux-4.png)

<span data-ttu-id="86d3d-133">Uw verbonden abonnementen beheren:</span><span class="sxs-lookup"><span data-stu-id="86d3d-133">Manage your connected subscriptions:</span></span>

![Verbinding maken met abonnement](./media/resource-manager-api-authentication/sample-ux-7.png)

## <a name="register-application"></a><span data-ttu-id="86d3d-135">Toepassing registreren</span><span class="sxs-lookup"><span data-stu-id="86d3d-135">Register application</span></span>
<span data-ttu-id="86d3d-136">Voordat u begint met het coderen, registreert u uw web-app met Azure Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="86d3d-136">Before you start coding, register your web app with Azure Active Directory (AD).</span></span> <span data-ttu-id="86d3d-137">Hallo app registratie maakt een centrale identiteit voor uw app in Azure AD.</span><span class="sxs-lookup"><span data-stu-id="86d3d-137">hello app registration creates a central identity for your app in Azure AD.</span></span> <span data-ttu-id="86d3d-138">Deze bevat algemene informatie over uw toepassing zoals OAuth-Clientidentiteit, antwoord-URL's en de referenties die uw toepassing tooauthenticate en toegang tot Azure Resource Manager-API's gebruikt.</span><span class="sxs-lookup"><span data-stu-id="86d3d-138">It holds basic information about your application like OAuth Client ID, Reply URLs, and credentials that your application uses tooauthenticate and access Azure Resource Manager APIs.</span></span> <span data-ttu-id="86d3d-139">app-registratie Hallo registreert ook verschillende machtigingen die uw toepassing moet overgedragen bij het openen van Microsoft APIs namens de gebruiker Hallo Hallo.</span><span class="sxs-lookup"><span data-stu-id="86d3d-139">hello app registration also records hello various delegated permissions that your application needs when accessing Microsoft APIs on behalf of hello user.</span></span>

<span data-ttu-id="86d3d-140">Omdat uw app toegang krijgt andere abonnement tot, moet u deze configureren als een multitenant-toepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-140">Because your app accesses other subscription, you must configure it as a multi-tenant application.</span></span> <span data-ttu-id="86d3d-141">validatie van toopass bieden een die zijn gekoppeld aan uw Azure Active Directory-domein.</span><span class="sxs-lookup"><span data-stu-id="86d3d-141">toopass validation, provide a domain associated with your Azure Active Directory.</span></span> <span data-ttu-id="86d3d-142">toosee hello domeinen die zijn gekoppeld aan uw Azure Active Directory, aanmelden toohello [klassieke portal](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="86d3d-142">toosee hello domains associated with your Azure Active Directory, log in toohello [classic portal](https://manage.windowsazure.com).</span></span> <span data-ttu-id="86d3d-143">Selecteer uw Azure Active Directory en selecteer vervolgens **domeinen**.</span><span class="sxs-lookup"><span data-stu-id="86d3d-143">Select your Azure Active Directory and then select **Domains**.</span></span>

<span data-ttu-id="86d3d-144">Hallo volgende voorbeeld ziet u hoe tooregister app Hallo met behulp van Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="86d3d-144">hello following example shows how tooregister hello app by using Azure PowerShell.</span></span> <span data-ttu-id="86d3d-145">U moet Hallo meest recente versie (augustus 2016) van Azure PowerShell voor deze opdracht toowork hebben.</span><span class="sxs-lookup"><span data-stu-id="86d3d-145">You must have hello latest version (August 2016) of Azure PowerShell for this command toowork.</span></span>

    $app = New-AzureRmADApplication -DisplayName "{app name}" -HomePage "https://{your domain}/{app name}" -IdentifierUris "https://{your domain}/{app name}" -Password "{your password}" -AvailableToOtherTenants $true

<span data-ttu-id="86d3d-146">toolog in als Hallo AD-toepassing, moet u Hallo toepassings-id en wachtwoord.</span><span class="sxs-lookup"><span data-stu-id="86d3d-146">toolog in as hello AD application, you need hello application id and password.</span></span> <span data-ttu-id="86d3d-147">toosee hello toepassings-id die wordt geretourneerd vanaf Hallo vorige opdracht gebruiken:</span><span class="sxs-lookup"><span data-stu-id="86d3d-147">toosee hello application id that is returned from hello previous command, use:</span></span>

    $app.ApplicationId

<span data-ttu-id="86d3d-148">Hallo volgende voorbeeld ziet u hoe tooregister app Hallo met Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="86d3d-148">hello following example shows how tooregister hello app by using Azure CLI.</span></span>

    azure ad app create --name {app name} --home-page https://{your domain}/{app name} --identifier-uris https://{your domain}/{app name} --password {your password} --available true

<span data-ttu-id="86d3d-149">Hallo resultaten bevatten Hallo AppId die u bij het verifiëren van de toepassing hello moet.</span><span class="sxs-lookup"><span data-stu-id="86d3d-149">hello results include hello AppId, which you need when authenticating as hello application.</span></span>

### <a name="optional-configuration---certificate-credential"></a><span data-ttu-id="86d3d-150">Optionele configuratie - certificaat-referentie</span><span class="sxs-lookup"><span data-stu-id="86d3d-150">Optional configuration - certificate credential</span></span>
<span data-ttu-id="86d3d-151">Daarnaast ondersteunt Azure AD referenties van het computercertificaat voor toepassingen: maken van een zelfondertekend certificaat, blijven de persoonlijke sleutel Hallo en Hallo openbare sleutel tooyour Azure AD-toepassing registreren toevoegen.</span><span class="sxs-lookup"><span data-stu-id="86d3d-151">Azure AD also supports certificate credentials for applications: you create a self-signed cert, keep hello private key, and add hello public key tooyour Azure AD application registration.</span></span> <span data-ttu-id="86d3d-152">Voor verificatie verzendt uw toepassing een kleine nettolading tooAzure AD ondertekend met de persoonlijke sleutel en Azure AD valideert Hallo-handtekening met de Hallo openbare sleutel die u hebt geregistreerd.</span><span class="sxs-lookup"><span data-stu-id="86d3d-152">For authentication, your application sends a small payload tooAzure AD signed using your private key, and Azure AD validates hello signature using hello public key that you registered.</span></span>

<span data-ttu-id="86d3d-153">Zie voor meer informatie over het maken van een AD-app met een certificaat [gebruik Azure PowerShell toocreate een service-principal tooaccess resources](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) of [gebruik Azure CLI toocreate een service-principal tooaccess resources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span><span class="sxs-lookup"><span data-stu-id="86d3d-153">For information about creating an AD app with a certificate, see [Use Azure PowerShell toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) or [Use Azure CLI toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span></span>

## <a name="get-tenant-id-from-subscription-id"></a><span data-ttu-id="86d3d-154">Tenant-id ophalen van abonnement-id</span><span class="sxs-lookup"><span data-stu-id="86d3d-154">Get tenant id from subscription id</span></span>
<span data-ttu-id="86d3d-155">een token dat gebruikt toocall Resource Manager worden kan toorequest, uw toepassing moet tooknow hello tenant-ID van hello Azure AD-tenant die als host fungeert voor hello Azure-abonnement.</span><span class="sxs-lookup"><span data-stu-id="86d3d-155">toorequest a token that can be used toocall Resource Manager, your application needs tooknow hello tenant ID of hello Azure AD tenant that hosts hello Azure subscription.</span></span> <span data-ttu-id="86d3d-156">Waarschijnlijk weet dat uw gebruikers hun abonnement-id's, maar ze mogelijk niet op de hoogte van de tenant id's voor Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="86d3d-156">Most likely, your users know their subscription ids, but they might not know their tenant ids for Azure Active Directory.</span></span> <span data-ttu-id="86d3d-157">tooget hello gebruiker Hallo van de tenant-id van gebruiker vragen voor Hallo abonnements-id. Bieden die abonnements-id bij het verzenden van een aanvraag over Hallo abonnement:</span><span class="sxs-lookup"><span data-stu-id="86d3d-157">tooget hello user's tenant id, ask hello user for hello subscription id. Provide that subscription id when sending a request about hello subscription:</span></span>

    https://management.azure.com/subscriptions/{subscription-id}?api-version=2015-01-01

<span data-ttu-id="86d3d-158">Hallo-aanvraag mislukt, omdat Hallo gebruiker heeft geen nog aangemeld, maar u Hallo tenant-id uit het antwoord Hallo ophalen kunt.</span><span class="sxs-lookup"><span data-stu-id="86d3d-158">hello request fails because hello user has not logged in yet, but you can retrieve hello tenant id from hello response.</span></span> <span data-ttu-id="86d3d-159">In deze uitzondering ophalen Hallo tenant-id Hallo antwoord header-waarde voor **WWW-verificatie**.</span><span class="sxs-lookup"><span data-stu-id="86d3d-159">In that exception, retrieve hello tenant id from hello response header value for **WWW-Authenticate**.</span></span> <span data-ttu-id="86d3d-160">U ziet deze implementatie in Hallo [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) methode.</span><span class="sxs-lookup"><span data-stu-id="86d3d-160">You see this implementation in hello [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) method.</span></span>

## <a name="get-user--app-access-token"></a><span data-ttu-id="86d3d-161">Gebruikers- + app toegangstoken ophalen</span><span class="sxs-lookup"><span data-stu-id="86d3d-161">Get user + app access token</span></span>
<span data-ttu-id="86d3d-162">Uw toepassing hello gebruiker tooAzure AD met een OAuth 2.0 autoriseren - tooauthenticate Hallo van de gebruiker referenties aanvragen worden omgeleid en ophalen van een autorisatiecode.</span><span class="sxs-lookup"><span data-stu-id="86d3d-162">Your application redirects hello user tooAzure AD with an OAuth 2.0 Authorize Request - tooauthenticate hello user's credentials and get back an authorization code.</span></span> <span data-ttu-id="86d3d-163">Uw toepassing gebruikt Hallo autorisatie code tooget een toegangstoken voor Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="86d3d-163">Your application uses hello authorization code tooget an access token for Resource Manager.</span></span> <span data-ttu-id="86d3d-164">Hallo [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) methode Hallo autorisatieaanvraag maakt.</span><span class="sxs-lookup"><span data-stu-id="86d3d-164">hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) method creates hello authorization request.</span></span>

<span data-ttu-id="86d3d-165">Dit onderwerp leest Hallo REST-API-aanvragen tooauthenticate Hallo gebruiker.</span><span class="sxs-lookup"><span data-stu-id="86d3d-165">This topic shows hello REST API requests tooauthenticate hello user.</span></span> <span data-ttu-id="86d3d-166">U kunt ook helper bibliotheken tooperform verificatie gebruiken in uw code.</span><span class="sxs-lookup"><span data-stu-id="86d3d-166">You can also use helper libraries tooperform authentication in your code.</span></span> <span data-ttu-id="86d3d-167">Zie voor meer informatie over deze bibliotheken [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="86d3d-167">For more information about these libraries, see [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span></span> <span data-ttu-id="86d3d-168">Zie voor instructies over het integreren van identiteitsbeheer in een toepassing [ontwikkelaarshandleiding Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="86d3d-168">For guidance on integrating identity management in an application, see [Azure Active Directory developer's guide](../active-directory/active-directory-developers-guide.md).</span></span>

### <a name="auth-request-oauth-20"></a><span data-ttu-id="86d3d-169">Aanvraag voor verificatie (OAuth 2.0)</span><span class="sxs-lookup"><span data-stu-id="86d3d-169">Auth request (OAuth 2.0)</span></span>
<span data-ttu-id="86d3d-170">Een Open ID Connect/OAuth2.0 autoriseren aanvragen toohello Azure AD geautoriseerde eindpunt uitgeven:</span><span class="sxs-lookup"><span data-stu-id="86d3d-170">Issue an Open ID Connect/OAuth2.0 Authorize Request toohello Azure AD Authorize endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize

<span data-ttu-id="86d3d-171">Hallo queryreeksparameters die beschikbaar voor deze aanvraag zijn worden beschreven in Hallo [aanvragen van een autorisatiecode](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) onderwerp.</span><span class="sxs-lookup"><span data-stu-id="86d3d-171">hello query string parameters that are available for this request are described in hello [request an authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) topic.</span></span>

<span data-ttu-id="86d3d-172">Hallo volgende voorbeeld wordt getoond hoe toorequest OAuth2.0 autorisatie:</span><span class="sxs-lookup"><span data-stu-id="86d3d-172">hello following example shows how toorequest OAuth2.0 authorization:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=query&response_type=code&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&domain_hint=live.com

<span data-ttu-id="86d3d-173">Azure AD verifieert de gebruiker Hallo en, indien nodig, vraagt Hallo gebruiker toogrant machtiging toohello app.</span><span class="sxs-lookup"><span data-stu-id="86d3d-173">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="86d3d-174">Het resultaat Hallo autorisatie code toohello antwoord-URL van uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-174">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="86d3d-175">Afhankelijk van Hallo aangevraagd response_mode, Azure AD beide verzendt terug Hallo gegevens in de queryreeks of als post-gegevens.</span><span class="sxs-lookup"><span data-stu-id="86d3d-175">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

    code=AAABAAAAiL****FDMZBUwZ8eCAA&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="auth-request-open-id-connect"></a><span data-ttu-id="86d3d-176">Verificatieaanvragen (Open ID Connect)</span><span class="sxs-lookup"><span data-stu-id="86d3d-176">Auth request (Open ID Connect)</span></span>
<span data-ttu-id="86d3d-177">Als u niet alleen tooaccess Azure Resource Manager namens de gebruiker hello wilt, maar ook toestaan dat Hallo gebruiker toosign tooyour toepassing hun Azure AD-account, geven u een Open ID Connect autoriseren Request.</span><span class="sxs-lookup"><span data-stu-id="86d3d-177">If you not only wish tooaccess Azure Resource Manager on behalf of hello user, but also allow hello user toosign in tooyour application using their Azure AD account, issue an Open ID Connect Authorize Request.</span></span> <span data-ttu-id="86d3d-178">Met Open ID Connect ontvangt de toepassing ook een id_token van Azure AD die uw app in Hallo gebruiker toosign kunt gebruiken.</span><span class="sxs-lookup"><span data-stu-id="86d3d-178">With Open ID Connect, your application also receives an id_token from Azure AD that your app can use toosign in hello user.</span></span>

<span data-ttu-id="86d3d-179">Hallo queryreeksparameters die beschikbaar voor deze aanvraag zijn worden beschreven in Hallo [Hallo aanmelden Verzendaanvraag](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) onderwerp.</span><span class="sxs-lookup"><span data-stu-id="86d3d-179">hello query string parameters that are available for this request are described in hello [Send hello sign-in request](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) topic.</span></span>

<span data-ttu-id="86d3d-180">Er is een voorbeeld van een Open ID Connect aanvraag:</span><span class="sxs-lookup"><span data-stu-id="86d3d-180">An example Open ID Connect request is:</span></span>

     https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=form_post&response_type=code+id_token&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&scope=openid+profile&nonce=63567Dc4MDAw&domain_hint=live.com&state=M_12tMyKaM8

<span data-ttu-id="86d3d-181">Azure AD verifieert de gebruiker Hallo en, indien nodig, vraagt Hallo gebruiker toogrant machtiging toohello app.</span><span class="sxs-lookup"><span data-stu-id="86d3d-181">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="86d3d-182">Het resultaat Hallo autorisatie code toohello antwoord-URL van uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-182">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="86d3d-183">Afhankelijk van Hallo aangevraagd response_mode, Azure AD beide verzendt terug Hallo gegevens in de queryreeks of als post-gegevens.</span><span class="sxs-lookup"><span data-stu-id="86d3d-183">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

<span data-ttu-id="86d3d-184">Een voorbeeld Open ID Connect reactie is:</span><span class="sxs-lookup"><span data-stu-id="86d3d-184">An example Open ID Connect response is:</span></span>

    code=AAABAAAAiL*****I4rDWd7zXsH6WUjlkIEQxIAA&id_token=eyJ0eXAiOiJKV1Q*****T3GrzzSFxg&state=M_12tMyKaM8&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="token-request-oauth20-code-grant-flow"></a><span data-ttu-id="86d3d-185">Tokenaanvraag (OAuth2.0 Code Grant stromen)</span><span class="sxs-lookup"><span data-stu-id="86d3d-185">Token request (OAuth2.0 Code Grant Flow)</span></span>
<span data-ttu-id="86d3d-186">Nu uw toepassing heeft de autorisatiecode Hallo ontvangen van Azure AD, is het tijd tooget Hallo toegangstoken voor Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="86d3d-186">Now that your application has received hello authorization code from Azure AD, it is time tooget hello access token for Azure Resource Manager.</span></span>  <span data-ttu-id="86d3d-187">Een OAuth2.0 Code Grant Token aanvragen toohello Azure AD-tokeneindpunt boeken:</span><span class="sxs-lookup"><span data-stu-id="86d3d-187">Post an OAuth2.0 Code Grant Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="86d3d-188">Hallo queryreeksparameters die beschikbaar voor deze aanvraag zijn worden beschreven in Hallo [autorisatiecode hello gebruiken](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) onderwerp.</span><span class="sxs-lookup"><span data-stu-id="86d3d-188">hello query string parameters that are available for this request are described in hello [use hello authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) topic.</span></span>

<span data-ttu-id="86d3d-189">Hallo volgende voorbeeld ziet u een aanvraag voor code grant token met referenties van het wachtwoord:</span><span class="sxs-lookup"><span data-stu-id="86d3d-189">hello following example shows a request for code grant token with password credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="86d3d-190">Als u werkt met de referenties van het computercertificaat, maak een JSON Web Token (JWT) en meld u (RSA SHA256) met behulp van de persoonlijke sleutel van uw toepassing certificaat referentie Hallo.</span><span class="sxs-lookup"><span data-stu-id="86d3d-190">When working with certificate credentials, create a JSON Web Token (JWT) and sign (RSA SHA256) using hello private key of your application's certificate credential.</span></span> <span data-ttu-id="86d3d-191">Hallo claimtypen voor Hallo token staan in [JWT-token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span><span class="sxs-lookup"><span data-stu-id="86d3d-191">hello claim types for hello token are shown in [JWT token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span></span> <span data-ttu-id="86d3d-192">Zie voor een verwijzing naar Hallo [code Active Directory Authentication Library (.NET)](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign Client Assertion JWT-tokens.</span><span class="sxs-lookup"><span data-stu-id="86d3d-192">For reference, see hello [Active Directory Auth Library (.NET) code](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign Client Assertion JWT tokens.</span></span>

<span data-ttu-id="86d3d-193">Zie Hallo [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) voor meer informatie over clientverificatie.</span><span class="sxs-lookup"><span data-stu-id="86d3d-193">See hello [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) for details on client authentication.</span></span>

<span data-ttu-id="86d3d-194">Hallo volgende voorbeeld ziet u een aanvraag voor code grant token met referenties van het certificaat:</span><span class="sxs-lookup"><span data-stu-id="86d3d-194">hello following example shows a request for code grant token with certificate credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&client_assertion=eyJhbG*****Y9cYo8nEjMyA

<span data-ttu-id="86d3d-195">Een voorbeeld van een antwoord voor code verlenen token:</span><span class="sxs-lookup"><span data-stu-id="86d3d-195">An example response for code grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039858","not_before":"1432035958","resource":"https://management.core.windows.net/","access_token":"eyJ0eXAiOiJKV1Q****M7Cw6JWtfY2lGc5A","refresh_token":"AAABAAAAiL9Kn2Z****55j-sjnyYgAA","scope":"user_impersonation","id_token":"eyJ0eXAiOiJKV*****-drP1J3P-HnHi9Rr46kGZnukEBH4dsg"}

#### <a name="handle-code-grant-token-response"></a><span data-ttu-id="86d3d-196">Code grant token antwoord verwerkt</span><span class="sxs-lookup"><span data-stu-id="86d3d-196">Handle code grant token response</span></span>
<span data-ttu-id="86d3d-197">Een geslaagde reactie token bevat toegangstoken hello (gebruiker + app) voor Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="86d3d-197">A successful token response contains hello (user + app) access token for Azure Resource Manager.</span></span> <span data-ttu-id="86d3d-198">Deze toegang token tooaccess Resource Manager namens de gebruiker Hallo maakt gebruik van uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-198">Your application uses this access token tooaccess Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="86d3d-199">Hallo-levensduur van de toegangstokens die zijn uitgegeven door Azure AD is een uur.</span><span class="sxs-lookup"><span data-stu-id="86d3d-199">hello lifetime of access tokens issued by Azure AD is one hour.</span></span> <span data-ttu-id="86d3d-200">Het lijkt onwaarschijnlijk dat de webtoepassing toegangstoken van toorenew hello (gebruiker + app moet).</span><span class="sxs-lookup"><span data-stu-id="86d3d-200">It is unlikely that your web application needs toorenew hello (user + app) access token.</span></span> <span data-ttu-id="86d3d-201">Als het toegangstoken voor toorenew Hallo moet, gebruikt u Hallo-vernieuwingstoken dat uw toepassing in het token antwoord Hallo ontvangt.</span><span class="sxs-lookup"><span data-stu-id="86d3d-201">If it needs toorenew hello access token, use hello refresh token that your application receives in hello token response.</span></span> <span data-ttu-id="86d3d-202">Een OAuth2.0 Token aanvragen toohello Azure AD-tokeneindpunt boeken:</span><span class="sxs-lookup"><span data-stu-id="86d3d-202">Post an OAuth2.0 Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="86d3d-203">Hallo toouse parameters met de aanvraag voor het vernieuwen van Hallo worden beschreven in [vernieuwen Hallo toegangstoken](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span><span class="sxs-lookup"><span data-stu-id="86d3d-203">hello parameters toouse with hello refresh request are described in [refreshing hello access token](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span></span>

<span data-ttu-id="86d3d-204">Hallo volgende voorbeeld laat zien hoe toouse Hallo token vernieuwen:</span><span class="sxs-lookup"><span data-stu-id="86d3d-204">hello following example shows how toouse hello refresh token:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=refresh_token&refresh_token=AAABAAAAiL9Kn2Z****55j-sjnyYgAA&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="86d3d-205">Hoewel vernieuwen van tokens gebruikte tooget nieuwe toegangstokens voor Azure Resource Manager, zijn ze niet geschikt voor offline toegang door uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-205">Although refresh tokens can be used tooget new access tokens for Azure Resource Manager, they are not suitable for offline access by your application.</span></span> <span data-ttu-id="86d3d-206">Hallo vernieuwen van tokens levensduur is beperkt en vernieuwen van tokens zijn gebonden toohello gebruiker.</span><span class="sxs-lookup"><span data-stu-id="86d3d-206">hello refresh tokens lifetime is limited, and refresh tokens are bound toohello user.</span></span> <span data-ttu-id="86d3d-207">Als gebruiker Hallo Hallo organisatie verlaat, verliest Hallo toepassing hello vernieuwingstoken toegang.</span><span class="sxs-lookup"><span data-stu-id="86d3d-207">If hello user leaves hello organization, hello application using hello refresh token loses access.</span></span> <span data-ttu-id="86d3d-208">Deze aanpak is niet geschikt voor toepassingen die worden gebruikt door teams toomanage Azure-resources.</span><span class="sxs-lookup"><span data-stu-id="86d3d-208">This approach isn't suitable for applications that are used by teams toomanage their Azure resources.</span></span>

## <a name="check-if-user-can-assign-access-toosubscription"></a><span data-ttu-id="86d3d-209">Controleer als gebruiker toegang toosubscription kunt toewijzen</span><span class="sxs-lookup"><span data-stu-id="86d3d-209">Check if user can assign access toosubscription</span></span>
<span data-ttu-id="86d3d-210">Nu uw toepassing heeft een token tooaccess Azure Resource Manager namens Hallo-gebruiker.</span><span class="sxs-lookup"><span data-stu-id="86d3d-210">Your application now has a token tooaccess Azure Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="86d3d-211">de volgende stap Hallo tooconnect wordt uw app toohello-abonnement.</span><span class="sxs-lookup"><span data-stu-id="86d3d-211">hello next step is tooconnect your app toohello subscription.</span></span> <span data-ttu-id="86d3d-212">Nadat u verbinding maakt, uw app deze abonnementen kunt beheren zelfs wanneer de gebruiker Hallo niet aanwezig is (op lange termijn offline toegang).</span><span class="sxs-lookup"><span data-stu-id="86d3d-212">After connecting, your app can manage those subscriptions even when hello user isn't present (long-term offline access).</span></span>

<span data-ttu-id="86d3d-213">Bel voor elke tooconnect abonnement Hallo [Resource Manager lijstmachtigingen](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine of Hallo gebruiker management toegangsrechten voor het Hallo-abonnement heeft.</span><span class="sxs-lookup"><span data-stu-id="86d3d-213">For each subscription tooconnect, call hello [Resource Manager list permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine whether hello user has access management rights for hello subscription.</span></span>

<span data-ttu-id="86d3d-214">Hallo [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) methode Hallo ASP.NET MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="86d3d-214">hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) method of hello ASP.NET MVC sample app implements this call.</span></span>

<span data-ttu-id="86d3d-215">Hallo volgende voorbeeld wordt getoond hoe toorequest van een gebruiker machtigingen voor een abonnement.</span><span class="sxs-lookup"><span data-stu-id="86d3d-215">hello following example shows how toorequest a user's permissions on a subscription.</span></span> <span data-ttu-id="86d3d-216">83cfe939-2402-4581-b761-4f59b0a041e4 is Hallo-id van het Hallo-abonnement.</span><span class="sxs-lookup"><span data-stu-id="86d3d-216">83cfe939-2402-4581-b761-4f59b0a041e4 is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/83cfe939-2402-4581-b761-4f59b0a041e4/providers/microsoft.authorization/permissions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiLC***lwO1mM7Cw6JWtfY2lGc5A

<span data-ttu-id="86d3d-217">Een voorbeeld van Hallo antwoord tooget gebruikersmachtigingen op abonnement is:</span><span class="sxs-lookup"><span data-stu-id="86d3d-217">An example of hello response tooget user's permissions on subscription is:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"actions":["*"],"notActions":["Microsoft.Authorization/*/Write","Microsoft.Authorization/*/Delete"]},{"actions":["*/read"],"notActions":[]}]}

<span data-ttu-id="86d3d-218">Hallo machtigingen API retourneert meerdere machtigingen.</span><span class="sxs-lookup"><span data-stu-id="86d3d-218">hello permissions API returns multiple permissions.</span></span> <span data-ttu-id="86d3d-219">Elke machtiging bestaat uit de toegestane acties (acties) en niet-toegestane acties (notactions).</span><span class="sxs-lookup"><span data-stu-id="86d3d-219">Each permission consists of allowed actions (actions) and disallowed actions (notactions).</span></span> <span data-ttu-id="86d3d-220">Als een actie aanwezig in de lijst van acties van een andere machtiging toegestaan Hallo is en niet aanwezig is in de lijst met de Hallo notactions van deze machtiging, Hallo gebruiker is toegestaan tooperform die actie.</span><span class="sxs-lookup"><span data-stu-id="86d3d-220">If an action is present in hello allowed actions list of any permission and not present in hello notactions list of that permission, hello user is allowed tooperform that action.</span></span> <span data-ttu-id="86d3d-221">**Microsoft.Authorization/RoleAssignments/Write** is Hallo actie dat die toegang rights management verleent.</span><span class="sxs-lookup"><span data-stu-id="86d3d-221">**microsoft.authorization/roleassignments/write** is hello action that that grants access management rights.</span></span> <span data-ttu-id="86d3d-222">Uw toepassing moet Hallo machtigingen resultaat toolook regex dezelfde waarde voor deze actie tekenreeks in Hallo acties en notactions van elke machtiging parseren.</span><span class="sxs-lookup"><span data-stu-id="86d3d-222">Your application must parse hello permissions result toolook for a regex match on this action string in hello actions and notactions of each permission.</span></span>

## <a name="get-app-only-access-token"></a><span data-ttu-id="86d3d-223">App-lezentoegang-token ophalen</span><span class="sxs-lookup"><span data-stu-id="86d3d-223">Get app-only access token</span></span>
<span data-ttu-id="86d3d-224">Nu weet u als gebruiker Hallo toegang toohello Azure-abonnement kunt toewijzen.</span><span class="sxs-lookup"><span data-stu-id="86d3d-224">Now, you know if hello user can assign access toohello Azure subscription.</span></span> <span data-ttu-id="86d3d-225">de volgende stappen Hallo zijn:</span><span class="sxs-lookup"><span data-stu-id="86d3d-225">hello next steps are:</span></span>

1. <span data-ttu-id="86d3d-226">De identiteit van de Hallo juiste RBAC-rol tooyour van toepassing op Hallo abonnement toewijzen.</span><span class="sxs-lookup"><span data-stu-id="86d3d-226">Assign hello appropriate RBAC role tooyour application's identity on hello subscription.</span></span>
2. <span data-ttu-id="86d3d-227">Hallo toegang toewijzing controleren door een query uitvoert voor machtiging van de toepassing hello op Hallo abonnement of door het openen van Resource Manager met alleen-app-token.</span><span class="sxs-lookup"><span data-stu-id="86d3d-227">Validate hello access assignment by querying for hello Application's permission on hello subscription or by accessing Resource Manager using app-only token.</span></span>
3. <span data-ttu-id="86d3d-228">Record Hallo verbinding in de gegevensstructuur van toepassingen 'verbonden abonnementen' - Hallo-id van het Hallo-abonnement behouden blijven.</span><span class="sxs-lookup"><span data-stu-id="86d3d-228">Record hello connection in your applications "connected subscriptions" data structure - persisting hello id of hello subscription.</span></span>

<span data-ttu-id="86d3d-229">We bekijken dichter bij de eerste stap Hallo.</span><span class="sxs-lookup"><span data-stu-id="86d3d-229">Let's look closer at hello first step.</span></span> <span data-ttu-id="86d3d-230">identiteit tooassign Hallo juiste RBAC-rol toohello van de toepassing, moet u bepalen:</span><span class="sxs-lookup"><span data-stu-id="86d3d-230">tooassign hello appropriate RBAC role toohello application's identity, you must determine:</span></span>

* <span data-ttu-id="86d3d-231">Hallo-object-id van de identiteit van uw toepassing in van de gebruiker hello Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="86d3d-231">hello object id of your application's identity in hello user's Azure Active Directory</span></span>
* <span data-ttu-id="86d3d-232">Hallo-id van Hallo RBAC-rol die uw toepassing is op Hallo abonnement vereist</span><span class="sxs-lookup"><span data-stu-id="86d3d-232">hello identifier of hello RBAC role that your application requires on hello subscription</span></span>

<span data-ttu-id="86d3d-233">Wanneer uw aanvraag wordt geverifieerd door een gebruiker uit een Azure AD, maakt deze een service-principal-object voor uw toepassing in die Azure AD.</span><span class="sxs-lookup"><span data-stu-id="86d3d-233">When your application authenticates a user from an Azure AD, it creates a service principal object for your application in that Azure AD.</span></span> <span data-ttu-id="86d3d-234">Azure kan de RBAC-rollen toobe toegewezen principals tooservice toogrant directe toegang toocorresponding toepassingen op Azure-resources.</span><span class="sxs-lookup"><span data-stu-id="86d3d-234">Azure allows RBAC roles toobe assigned tooservice principals toogrant direct access toocorresponding applications on Azure resources.</span></span> <span data-ttu-id="86d3d-235">Deze actie is precies wat we willen toodo.</span><span class="sxs-lookup"><span data-stu-id="86d3d-235">This action is exactly what we wish toodo.</span></span> <span data-ttu-id="86d3d-236">Query hello Azure AD Graph API toodetermine Hallo id van de service-principal Hallo van uw toepassing hello aangemelde gebruiker's Azure AD.</span><span class="sxs-lookup"><span data-stu-id="86d3d-236">Query hello Azure AD Graph API toodetermine hello identifier of hello service principal of your application in hello signed-in user's Azure AD.</span></span>

<span data-ttu-id="86d3d-237">U hoeft alleen een toegangstoken voor Azure Resource Manager - moet u een nieuwe access token toocall hello Azure AD Graph API.</span><span class="sxs-lookup"><span data-stu-id="86d3d-237">You only have an access token for Azure Resource Manager - you need a new access token toocall hello Azure AD Graph API.</span></span> <span data-ttu-id="86d3d-238">Machtiging tooquery van elke toepassing in Azure AD heeft een eigen service principal-object, dus een app alleen-lezen toegangstoken voldoende is.</span><span class="sxs-lookup"><span data-stu-id="86d3d-238">Every application in Azure AD has permission tooquery its own service principal object, so an app-only access token is sufficient.</span></span>

<a id="app-azure-ad-graph" />

### <a name="get-app-only-access-token-for-azure-ad-graph-api"></a><span data-ttu-id="86d3d-239">App-lezentoegang voor Azure AD Graph API token ophalen</span><span class="sxs-lookup"><span data-stu-id="86d3d-239">Get app-only access token for Azure AD Graph API</span></span>
<span data-ttu-id="86d3d-240">tooauthenticate uw app en een token tooAzure AD Graph API, get uitgeven van een Client referentie Grant OAuth2.0 stroom tokenaanvraag tooAzure AD token-eindpunt (**https://login.microsoftonline.com/ {directory_domain_name} / OAuth2/Token**).</span><span class="sxs-lookup"><span data-stu-id="86d3d-240">tooauthenticate your app and get a token tooAzure AD Graph API, issue a Client Credential Grant OAuth2.0 flow token request tooAzure AD token endpoint (**https://login.microsoftonline.com/{directory_domain_name}/OAuth2/Token**).</span></span>

<span data-ttu-id="86d3d-241">Hallo [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) methode Hallo ASP.net MVC-voorbeeldtoepassing een app alleen-lezen toegang token voor het gebruik van Graph API krijgt Hallo Active Directory Authentication Library voor .NET.</span><span class="sxs-lookup"><span data-stu-id="86d3d-241">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) method of hello ASP.net MVC sample application gets an app-only access token for Graph API using hello Active Directory Authentication Library for .NET.</span></span>

<span data-ttu-id="86d3d-242">Hallo queryreeksparameters die beschikbaar voor deze aanvraag zijn worden beschreven in Hallo [een Token toegang aanvragen](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) onderwerp.</span><span class="sxs-lookup"><span data-stu-id="86d3d-242">hello query string parameters that are available for this request are described in hello [Request an Access Token](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) topic.</span></span>

<span data-ttu-id="86d3d-243">Een voorbeeld van de aanvraag voor de clientreferenties verlenen token:</span><span class="sxs-lookup"><span data-stu-id="86d3d-243">An example request for client credential grant token:</span></span>

    POST https://login.microsoftonline.com/62e173e9-301e-423e-bcd4-29121ec1aa24/oauth2/token HTTP/1.1
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 187</pre>
    <pre>grant_type=client_credentials&client_id=a0448380-c346-4f9f-b897-c18733de9394&resource=https%3A%2F%2Fgraph.windows.net%2F &client_secret=olna8C*****Og%3D

<span data-ttu-id="86d3d-244">Een voorbeeld van een antwoord voor de clientreferenties verlenen token:</span><span class="sxs-lookup"><span data-stu-id="86d3d-244">An example response for client credential grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039862","not_before":"1432035962","resource":"https://graph.windows.net/","access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRv****G5gUTV-kKorR-pg"}

### <a name="get-objectid-of-application-service-principal-in-user-azure-ad"></a><span data-ttu-id="86d3d-245">Object-id van de service-principal toepassing in Azure AD-gebruiker ophalen</span><span class="sxs-lookup"><span data-stu-id="86d3d-245">Get ObjectId of application service principal in user Azure AD</span></span>
<span data-ttu-id="86d3d-246">Nu gebruiken Hallo app alleen-lezen toegang token tooquery hello [Azure AD Graph Service-Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine Hallo Object-Id van de service-principal in de map Hallo Hallo-toepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-246">Now, use hello app-only access token tooquery hello [Azure AD Graph Service Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine hello Object Id of hello application's service principal in hello directory.</span></span>

<span data-ttu-id="86d3d-247">Hallo [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) methode Hallo ASP.net MVC-voorbeeldtoepassing implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="86d3d-247">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) method of hello ASP.net MVC sample application implements this call.</span></span>

<span data-ttu-id="86d3d-248">Hallo volgende voorbeeld wordt getoond hoe toorequest service-principal van een toepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-248">hello following example shows how toorequest an application's service principal.</span></span> <span data-ttu-id="86d3d-249">a0448380-c346-4f9f-b897-c18733de9394 is hello client-id van de toepassing hello.</span><span class="sxs-lookup"><span data-stu-id="86d3d-249">a0448380-c346-4f9f-b897-c18733de9394 is hello client id of hello application.</span></span>

    GET https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/servicePrincipals?api-version=1.5&$filter=appId%20eq%20'a0448380-c346-4f9f-b897-c18733de9394' HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJK*****-kKorR-pg

<span data-ttu-id="86d3d-250">Hallo volgende voorbeeld ziet u een antwoord toohello-aanvraag voor een toepassing service principal</span><span class="sxs-lookup"><span data-stu-id="86d3d-250">hello following example shows a response toohello request for an application's service principal</span></span>

    HTTP/1.1 200 OK

    {"odata.metadata":"https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/$metadata#directoryObjects/Microsoft.DirectoryServices.ServicePrincipal","value":[{"odata.type":"Microsoft.DirectoryServices.ServicePrincipal","objectType":"ServicePrincipal","objectId":"9b5018d4-6951-42ed-8a92-f11ec283ccec","deletionTimestamp":null,"accountEnabled":true,"appDisplayName":"CloudSense","appId":"a0448380-c346-4f9f-b897-c18733de9394","appOwnerTenantId":"62e173e9-301e-423e-bcd4-29121ec1aa24","appRoleAssignmentRequired":false,"appRoles":[],"displayName":"CloudSense","errorUrl":null,"homepage":"http://www.vipswapper.com/cloudsense","keyCredentials":[],"logoutUrl":null,"oauth2Permissions":[{"adminConsentDescription":"Allow hello application tooaccess CloudSense on behalf of hello signed-in user.","adminConsentDisplayName":"Access CloudSense","id":"b7b7338e-683a-4796-b95e-60c10380de1c","isEnabled":true,"type":"User","userConsentDescription":"Allow hello application tooaccess CloudSense on your behalf.","userConsentDisplayName":"Access CloudSense","value":"user_impersonation"}],"passwordCredentials":[],"preferredTokenSigningKeyThumbprint":null,"publisherName":"vipswapper"quot;,"replyUrls":["http://www.vipswapper.com/cloudsense","http://www.vipswapper.com","http://vipswapper.com","http://vipswapper.azurewebsites.net","http://localhost:62080"],"samlMetadataUrl":null,"servicePrincipalNames":["http://www.vipswapper.com/cloudsense","a0448380-c346-4f9f-b897-c18733de9394"],"tags":["WindowsAzureActiveDirectoryIntegratedApp"]}]}

### <a name="get-azure-rbac-role-identifier"></a><span data-ttu-id="86d3d-251">Azure RBAC-rol-id ophalen</span><span class="sxs-lookup"><span data-stu-id="86d3d-251">Get Azure RBAC role identifier</span></span>
<span data-ttu-id="86d3d-252">tooassign hello juiste RBAC tooyour functieservice principal, moet u bepalen Hallo-id van hello Azure RBAC-rol.</span><span class="sxs-lookup"><span data-stu-id="86d3d-252">tooassign hello appropriate RBAC role tooyour service principal, you must determine hello identifier of hello Azure RBAC role.</span></span>

<span data-ttu-id="86d3d-253">Hallo juiste RBAC-rol voor uw toepassing:</span><span class="sxs-lookup"><span data-stu-id="86d3d-253">hello right RBAC role for your application:</span></span>

* <span data-ttu-id="86d3d-254">Als uw toepassing alleen Hallo-abonnement, controleert zonder dat u wijzigingen aanbrengt, moet leesmachtigingen op Hallo-abonnement.</span><span class="sxs-lookup"><span data-stu-id="86d3d-254">If your application only monitors hello subscription, without making any changes, it requires only reader permissions on hello subscription.</span></span> <span data-ttu-id="86d3d-255">Hallo toewijzen **lezer** rol.</span><span class="sxs-lookup"><span data-stu-id="86d3d-255">Assign hello **Reader** role.</span></span>
* <span data-ttu-id="86d3d-256">Als uw toepassing hello Azure-abonnement, entiteiten maken/wijzigen/verwijderen beheert, vereist een Hallo Inzender-rechten.</span><span class="sxs-lookup"><span data-stu-id="86d3d-256">If your application manages Azure hello subscription, creating/modifying/deleting entities, it requires one of hello contributor permissions.</span></span>
  * <span data-ttu-id="86d3d-257">toomanage een bepaald type resource toewijzen Hallo Inzender resourcespecifieke rollen (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Inzender, enz.)</span><span class="sxs-lookup"><span data-stu-id="86d3d-257">toomanage a particular type of resource, assign hello resource-specific contributor roles (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Contributor, etc.)</span></span>
  * <span data-ttu-id="86d3d-258">toomanage elk resourcetype, toewijzen Hallo **Inzender** rol.</span><span class="sxs-lookup"><span data-stu-id="86d3d-258">toomanage any resource type, assign hello **Contributor** role.</span></span>

<span data-ttu-id="86d3d-259">Hallo roltoewijzing voor uw toepassing is zichtbaar toousers, dus selecteer Hallo bevoegdheid minst vereist.</span><span class="sxs-lookup"><span data-stu-id="86d3d-259">hello role assignment for your application is visible toousers, so select hello least-required privilege.</span></span>

<span data-ttu-id="86d3d-260">Hallo aanroepen [Resource Manager roldefinitie API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist alle Azure RBAC-rollen en zoek vervolgens Hallo resultaat toofind Hallo doorlopen gewenst roldefinitie met de naam.</span><span class="sxs-lookup"><span data-stu-id="86d3d-260">Call hello [Resource Manager role definition API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist all Azure RBAC roles and search then iterate over hello result toofind hello desired role definition by name.</span></span>

<span data-ttu-id="86d3d-261">Hallo [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) methode Hallo ASP.net MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="86d3d-261">hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="86d3d-262">Hallo volgende voorbeeld wordt getoond hoe aanvragen tooget Azure RBAC-rol-id.</span><span class="sxs-lookup"><span data-stu-id="86d3d-262">hello following request example shows how tooget Azure RBAC role identifier.</span></span> <span data-ttu-id="86d3d-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb is Hallo-id van het Hallo-abonnement.</span><span class="sxs-lookup"><span data-stu-id="86d3d-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV*****fY2lGc5

<span data-ttu-id="86d3d-264">Hallo reactie is in de volgende indeling Hallo:</span><span class="sxs-lookup"><span data-stu-id="86d3d-264">hello response is in hello following format:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"properties":{"roleName":"API Management Service Contributor","type":"BuiltInRole","description":"Lets you manage API Management services, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.ApiManagement/Services/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/312a565d-c81f-4fd8-895a-4e21e48d571c","type":"Microsoft.Authorization/roleDefinitions","name":"312a565d-c81f-4fd8-895a-4e21e48d571c"},{"properties":{"roleName":"Application Insights Component Contributor","type":"BuiltInRole","description":"Lets you manage Application Insights components, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.Insights/components/*","Microsoft.Insights/webtests/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/ae349356-3a1b-4a5e-921d-050484c6347e","type":"Microsoft.Authorization/roleDefinitions","name":"ae349356-3a1b-4a5e-921d-050484c6347e"}]}

<span data-ttu-id="86d3d-265">U hoeft deze API voortdurend niet toocall.</span><span class="sxs-lookup"><span data-stu-id="86d3d-265">You do not need toocall this API on an ongoing basis.</span></span> <span data-ttu-id="86d3d-266">Nadat u hebt vastgesteld bekende GUID van de roldefinitie Hallo Hallo, u kunt samenstellen Hallo roldefinitie-id als:</span><span class="sxs-lookup"><span data-stu-id="86d3d-266">Once you've determined hello well-known GUID of hello role definition, you can construct hello role definition id as:</span></span>

    /subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{well-known-role-guid}

<span data-ttu-id="86d3d-267">Hier volgen bekende GUID's Hallo van veelgebruikte ingebouwde rollen:</span><span class="sxs-lookup"><span data-stu-id="86d3d-267">Here are hello well-known guids of commonly used built-in roles:</span></span>

| <span data-ttu-id="86d3d-268">Rol</span><span class="sxs-lookup"><span data-stu-id="86d3d-268">Role</span></span> | <span data-ttu-id="86d3d-269">GUID</span><span class="sxs-lookup"><span data-stu-id="86d3d-269">Guid</span></span> |
| --- | --- |
| <span data-ttu-id="86d3d-270">Lezer</span><span class="sxs-lookup"><span data-stu-id="86d3d-270">Reader</span></span> |<span data-ttu-id="86d3d-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="86d3d-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |
| <span data-ttu-id="86d3d-272">Inzender</span><span class="sxs-lookup"><span data-stu-id="86d3d-272">Contributor</span></span> |<span data-ttu-id="86d3d-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span><span class="sxs-lookup"><span data-stu-id="86d3d-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span></span> |
| <span data-ttu-id="86d3d-274">Virtual Machine Contributor</span><span class="sxs-lookup"><span data-stu-id="86d3d-274">Virtual Machine Contributor</span></span> |<span data-ttu-id="86d3d-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span><span class="sxs-lookup"><span data-stu-id="86d3d-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span></span> |
| <span data-ttu-id="86d3d-276">Virtueel netwerk Inzender</span><span class="sxs-lookup"><span data-stu-id="86d3d-276">Virtual Network Contributor</span></span> |<span data-ttu-id="86d3d-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span><span class="sxs-lookup"><span data-stu-id="86d3d-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span></span> |
| <span data-ttu-id="86d3d-278">Storage-Account Inzender</span><span class="sxs-lookup"><span data-stu-id="86d3d-278">Storage Account Contributor</span></span> |<span data-ttu-id="86d3d-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span><span class="sxs-lookup"><span data-stu-id="86d3d-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span></span> |
| <span data-ttu-id="86d3d-280">Website Inzender</span><span class="sxs-lookup"><span data-stu-id="86d3d-280">Website Contributor</span></span> |<span data-ttu-id="86d3d-281">de139f84-1756-47ae-9be6-808fbbe84772</span><span class="sxs-lookup"><span data-stu-id="86d3d-281">de139f84-1756-47ae-9be6-808fbbe84772</span></span> |
| <span data-ttu-id="86d3d-282">Web Plan Inzender</span><span class="sxs-lookup"><span data-stu-id="86d3d-282">Web Plan Contributor</span></span> |<span data-ttu-id="86d3d-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span><span class="sxs-lookup"><span data-stu-id="86d3d-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span></span> |
| <span data-ttu-id="86d3d-284">SQL Server Inzender</span><span class="sxs-lookup"><span data-stu-id="86d3d-284">SQL Server Contributor</span></span> |<span data-ttu-id="86d3d-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span><span class="sxs-lookup"><span data-stu-id="86d3d-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span></span> |
| <span data-ttu-id="86d3d-286">SQL DB Contributor</span><span class="sxs-lookup"><span data-stu-id="86d3d-286">SQL DB Contributor</span></span> |<span data-ttu-id="86d3d-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span><span class="sxs-lookup"><span data-stu-id="86d3d-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span></span> |

### <a name="assign-rbac-role-tooapplication"></a><span data-ttu-id="86d3d-288">RBAC-rol tooapplication toewijzen</span><span class="sxs-lookup"><span data-stu-id="86d3d-288">Assign RBAC role tooapplication</span></span>
<span data-ttu-id="86d3d-289">U hebt u alles tooassign Hallo juiste RBAC-rol tooyour service-principal met behulp van Hallo [Resource Manager roltoewijzing maken](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span><span class="sxs-lookup"><span data-stu-id="86d3d-289">You have everything you need tooassign hello appropriate RBAC role tooyour service principal by using hello [Resource Manager create role assignment](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span></span>

<span data-ttu-id="86d3d-290">Hallo [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) methode Hallo ASP.net MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="86d3d-290">hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="86d3d-291">Een voorbeeld van de aanvraag tooassign RBAC-rol tooapplication:</span><span class="sxs-lookup"><span data-stu-id="86d3d-291">An example request tooassign RBAC role tooapplication:</span></span>

    PUT https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/microsoft.authorization/roleassignments/4f87261d-2816-465d-8311-70a27558df4c?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiL*****FlwO1mM7Cw6JWtfY2lGc5
    Content-Type: application/json
    Content-Length: 230

    {"properties": {"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2"}}

<span data-ttu-id="86d3d-292">Hallo-aanvraag worden Hallo volgende waarden gebruikt:</span><span class="sxs-lookup"><span data-stu-id="86d3d-292">In hello request, hello following values are used:</span></span>

| <span data-ttu-id="86d3d-293">GUID</span><span class="sxs-lookup"><span data-stu-id="86d3d-293">Guid</span></span> | <span data-ttu-id="86d3d-294">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="86d3d-294">Description</span></span> |
| --- | --- |
| <span data-ttu-id="86d3d-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span><span class="sxs-lookup"><span data-stu-id="86d3d-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span></span> |<span data-ttu-id="86d3d-296">Hallo-id van het Hallo-abonnement</span><span class="sxs-lookup"><span data-stu-id="86d3d-296">hello id of hello subscription</span></span> |
| <span data-ttu-id="86d3d-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span><span class="sxs-lookup"><span data-stu-id="86d3d-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span></span> |<span data-ttu-id="86d3d-298">object-id van de service-principal van de toepassing hello Hallo Hallo</span><span class="sxs-lookup"><span data-stu-id="86d3d-298">hello object id of hello service principal of hello application</span></span> |
| <span data-ttu-id="86d3d-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="86d3d-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |<span data-ttu-id="86d3d-300">Hallo-id van de rol Lezer Hallo</span><span class="sxs-lookup"><span data-stu-id="86d3d-300">hello id of hello reader role</span></span> |
| <span data-ttu-id="86d3d-301">4f87261d-2816-465d-8311-70a27558df4c</span><span class="sxs-lookup"><span data-stu-id="86d3d-301">4f87261d-2816-465d-8311-70a27558df4c</span></span> |<span data-ttu-id="86d3d-302">een nieuwe guid voor de nieuwe roltoewijzing Hallo gemaakt</span><span class="sxs-lookup"><span data-stu-id="86d3d-302">a new guid created for hello new role assignment</span></span> |

<span data-ttu-id="86d3d-303">Hallo reactie is in de volgende indeling Hallo:</span><span class="sxs-lookup"><span data-stu-id="86d3d-303">hello response is in hello following format:</span></span>

    HTTP/1.1 201 Created

    {"properties":{"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2","scope":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb"},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleAssignments/4f87261d-2816-465d-8311-70a27558df4c","type":"Microsoft.Authorization/roleAssignments","name":"4f87261d-2816-465d-8311-70a27558df4c"}

### <a name="get-app-only-access-token-for-azure-resource-manager"></a><span data-ttu-id="86d3d-304">App-lezentoegang-token ophalen voor Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="86d3d-304">Get app-only access token for Azure Resource Manager</span></span>
<span data-ttu-id="86d3d-305">toovalidate die app Hallo gewenst toegang op Hallo abonnement heeft, voert u een test-taak op Hallo-abonnement met een alleen-app-token.</span><span class="sxs-lookup"><span data-stu-id="86d3d-305">toovalidate that app has hello desired access on hello subscription, perform a test task on hello subscription using an app-only token.</span></span>

<span data-ttu-id="86d3d-306">een app alleen-lezen toegangstoken tooget Volg de instructies van sectie [alleen app-token ophalen voor Azure AD Graph API](#app-azure-ad-graph), met een andere waarde voor Hallo resourceparameter:</span><span class="sxs-lookup"><span data-stu-id="86d3d-306">tooget an app-only access token, follow instructions from section [Get app-only access token for Azure AD Graph API](#app-azure-ad-graph), with a different value for hello resource parameter:</span></span>

    https://management.core.windows.net/

<span data-ttu-id="86d3d-307">Hallo [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) methode Hallo ASP.NET MVC-voorbeeldtoepassing een app alleen-lezen toegang token voor het gebruik van Azure Resource Manager krijgt Hallo Active Directory Authentication Library voor .net.</span><span class="sxs-lookup"><span data-stu-id="86d3d-307">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample application gets an app-only access token for Azure Resource Manager using hello Active Directory Authentication Library for .net.</span></span>

#### <a name="get-applications-permissions-on-subscription"></a><span data-ttu-id="86d3d-308">Machtigingen van de van toepassing op abonnement ophalen</span><span class="sxs-lookup"><span data-stu-id="86d3d-308">Get Application's Permissions on Subscription</span></span>
<span data-ttu-id="86d3d-309">toocheck die uw toepassing heeft Hallo gewenst toegang op een Azure-abonnement, wordt u mogelijk ook aanroepen Hallo [Resource Manager machtigingen](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span><span class="sxs-lookup"><span data-stu-id="86d3d-309">toocheck that your application has hello desired access on an Azure subscription, you may also call hello [Resource Manager Permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span></span> <span data-ttu-id="86d3d-310">Deze aanpak is vergelijkbaar toohow u vastgesteld of Hallo gebruiker Access Management-rechten voor het Hallo-abonnement heeft.</span><span class="sxs-lookup"><span data-stu-id="86d3d-310">This approach is similar toohow you determined whether hello user has Access Management rights for hello subscription.</span></span> <span data-ttu-id="86d3d-311">Deze tijd aanroepen echter Hallo machtigingen API met Hallo app alleen-lezen toegangstoken dat u in de vorige stap Hallo ontvangen.</span><span class="sxs-lookup"><span data-stu-id="86d3d-311">However, this time, call hello permissions API with hello app-only access token that you received in hello previous step.</span></span>

<span data-ttu-id="86d3d-312">Hallo [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) methode Hallo ASP.NET MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="86d3d-312">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample app implements this call.</span></span>

## <a name="manage-connected-subscriptions"></a><span data-ttu-id="86d3d-313">Verbonden abonnementen beheren</span><span class="sxs-lookup"><span data-stu-id="86d3d-313">Manage connected subscriptions</span></span>
<span data-ttu-id="86d3d-314">Wanneer Hallo juiste RBAC-rol wordt toegewezen van de toepassing tooyour service-principal op Hallo abonnement, kunt uw toepassing houden bewaking/beheren met behulp van alleen-app toegangstokens voor Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="86d3d-314">When hello appropriate RBAC role is assigned tooyour application's service principal on hello subscription, your application can keep monitoring/managing it using app-only access tokens for Azure Resource Manager.</span></span>

<span data-ttu-id="86d3d-315">Is niet meer kunnen tooaccess dat abonnement als eigenaar van een abonnement van uw toepassing roltoewijzing met behulp van de klassieke portal Hallo of opdrachtregelprogramma's, uw toepassing worden verwijderd.</span><span class="sxs-lookup"><span data-stu-id="86d3d-315">If a subscription owner removes your application's role assignment using hello classic portal or command-line tools, your application is no longer able tooaccess that subscription.</span></span> <span data-ttu-id="86d3d-316">U moet in dat geval Hallo gebruiker waarschuwen dat Hallo verbinding met de Hallo abonnement vanuit externe Hallo toepassing werd verbroken en geef ze een optie te "repareren" hello verbinding.</span><span class="sxs-lookup"><span data-stu-id="86d3d-316">In that case, you should notify hello user that hello connection with hello subscription was severed from outside hello application and give them an option too"repair" hello connection.</span></span> <span data-ttu-id="86d3d-317">'Herstellen' maakt hello roltoewijzing is die offline is verwijderd gewoon opnieuw.</span><span class="sxs-lookup"><span data-stu-id="86d3d-317">"Repair" would simply re-create hello role assignment that was deleted offline.</span></span>

<span data-ttu-id="86d3d-318">Net zoals u Hallo tooconnect abonnementen tooyour Gebruikerstoepassing ingeschakeld, moet u Hallo gebruiker toodisconnect abonnementen te geven.</span><span class="sxs-lookup"><span data-stu-id="86d3d-318">Just as you enabled hello user tooconnect subscriptions tooyour application, you must allow hello user toodisconnect subscriptions too.</span></span> <span data-ttu-id="86d3d-319">Verbinding verbreken betekent Hallo roltoewijzing met service-principal van de toepassing hello op Hallo abonnement verwijderen uit een access management-oogpunt.</span><span class="sxs-lookup"><span data-stu-id="86d3d-319">From an access management point of view, disconnect means removing hello role assignment that hello application's service principal has on hello subscription.</span></span> <span data-ttu-id="86d3d-320">Desgewenst kan geen status in de toepassing hello voor Hallo abonnement te worden verwijderd.</span><span class="sxs-lookup"><span data-stu-id="86d3d-320">Optionally, any state in hello application for hello subscription might be removed too.</span></span>
<span data-ttu-id="86d3d-321">Alleen gebruikers met toegangsmachtigingen voor beheer op Hallo abonnement zijn kunnen toodisconnect Hallo abonnement.</span><span class="sxs-lookup"><span data-stu-id="86d3d-321">Only users with access management permission on hello subscription are able toodisconnect hello subscription.</span></span>

<span data-ttu-id="86d3d-322">Hallo [RevokeRoleFromServicePrincipalOnSubscription methode](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) Hallo ASP.net MVC-voorbeeld-app implementeert deze aanroep.</span><span class="sxs-lookup"><span data-stu-id="86d3d-322">hello [RevokeRoleFromServicePrincipalOnSubscription method](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="86d3d-323">Dat is alles - gebruikers kunnen nu eenvoudig verbinding maken en beheren hun Azure-abonnementen met uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="86d3d-323">That's it - users can now easily connect and manage their Azure subscriptions with your application.</span></span>
