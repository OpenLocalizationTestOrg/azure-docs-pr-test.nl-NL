---
title: Clientbibliotheek voor elastische database gebruiken met Dapper | Microsoft Docs
description: Gebruik de clientbibliotheek voor elastische database met Dapper.
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: f0efd37a39c1a60eee7b47304483c27727ca8833
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="47ac4-103">Clientbibliotheek voor elastische database gebruiken met Dapper</span><span class="sxs-lookup"><span data-stu-id="47ac4-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="47ac4-104">Dit document is bedoeld voor ontwikkelaars die afhankelijk zijn van Dapper om toepassingen te bouwen, maar ook wilt gaan [elastische database tooling](sql-database-elastic-scale-introduction.md) om toepassingen te maken die sharding implementeren voor scale-out hun gegevenslaag.</span><span class="sxs-lookup"><span data-stu-id="47ac4-104">This document is for developers that rely on Dapper to build applications, but also want to embrace [elastic database tooling](sql-database-elastic-scale-introduction.md) to create applications that implement sharding to scale-out their data tier.</span></span>  <span data-ttu-id="47ac4-105">Dit document ziet u de wijzigingen in Dapper gebaseerde toepassingen die nodig zijn om te integreren met hulpprogramma's voor elastische database.</span><span class="sxs-lookup"><span data-stu-id="47ac4-105">This document illustrates the changes in Dapper-based applications that are necessary to integrate with elastic database tools.</span></span> <span data-ttu-id="47ac4-106">Onze focus is op het samenstellen van de elastische database shard beheer- en afhankelijk van de gegevens routering met Dapper.</span><span class="sxs-lookup"><span data-stu-id="47ac4-106">Our focus is on composing the elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="47ac4-107">**Voorbeeldcode**: [hulpmiddelen voor elastische databases voor Azure SQL Database - Dapper integratie](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="47ac4-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="47ac4-108">Integratie van **Dapper** en **DapperExtensions** met de elastische database-clientbibliotheek voor Azure SQL Database is eenvoudig.</span><span class="sxs-lookup"><span data-stu-id="47ac4-108">Integrating **Dapper** and **DapperExtensions** with the elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="47ac4-109">Uw toepassingen kunnen gebruikmaken van afhankelijke routering door het wijzigen van het maken en openen van nieuwe gegevens [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objecten te gebruiken de [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) aanroepen vanuit de [clientbibliotheek](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="47ac4-109">Your applications can use data dependent routing by changing the creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects to use the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from the [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="47ac4-110">Dit beperkt de wijzigingen in uw toepassing alleen wanneer nieuwe verbindingen zijn gemaakt en geopend.</span><span class="sxs-lookup"><span data-stu-id="47ac4-110">This limits changes in your application to only where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="47ac4-111">Overzicht van dapper</span><span class="sxs-lookup"><span data-stu-id="47ac4-111">Dapper overview</span></span>
<span data-ttu-id="47ac4-112">**Dapper** is een object-relationele toewijzen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="47ac4-113">Het .NET-objecten van uw toepassing naar een relationele database (en omgekeerd) worden toegewezen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-113">It maps .NET objects from your application to a relational database (and vice versa).</span></span> <span data-ttu-id="47ac4-114">Het eerste deel van de voorbeeldcode ziet u hoe u de clientbibliotheek voor elastische database kunt integreren met Dapper gebaseerde toepassingen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-114">The first part of the sample code illustrates how you can integrate the elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="47ac4-115">Het tweede gedeelte van de voorbeeldcode laat zien hoe bij gebruik van zowel Dapper en DapperExtensions integreren.</span><span class="sxs-lookup"><span data-stu-id="47ac4-115">The second part of the sample code illustrates how to integrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="47ac4-116">De functionaliteit toewijzen in Dapper biedt uitbreidingsmethoden op databaseverbindingen die verzenden T-SQL-instructies voor het uitvoeren en het opvragen van de database te vereenvoudigen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-116">The mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying the database.</span></span> <span data-ttu-id="47ac4-117">Bijvoorbeeld: Dapper kunt u gemakkelijk om een koppeling tussen uw .NET-objecten en de parameters van de SQL-instructies voor **Execute** -aanroepen, of de resultaten van uw SQL-query's gebruiken in .NET-objecten met behulp van **Query** aanroepen van Dapper.</span><span class="sxs-lookup"><span data-stu-id="47ac4-117">For instance, Dapper makes it easy to map between your .NET objects and the parameters of SQL statements for **Execute** calls, or to consume the results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="47ac4-118">Wanneer u DapperExtensions gebruikt, moet u niet langer bieden de SQL-instructies.</span><span class="sxs-lookup"><span data-stu-id="47ac4-118">When using DapperExtensions, you no longer need to provide the SQL statements.</span></span> <span data-ttu-id="47ac4-119">Extensies methoden zoals **GetList** of **invoegen** via verbinding met de database maken van de SQL-instructies achter de schermen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-119">Extensions methods such as **GetList** or **Insert** over the database connection create the SQL statements behind the scenes.</span></span>

<span data-ttu-id="47ac4-120">Een ander voordeel van Dapper en ook DapperExtensions is dat de toepassing het maken van verbinding met de database bepaalt.</span><span class="sxs-lookup"><span data-stu-id="47ac4-120">Another benefit of Dapper and also DapperExtensions is that the application controls the creation of the database connection.</span></span> <span data-ttu-id="47ac4-121">Dit helpt communiceren met de clientbibliotheek voor elastische database die beleggingsmakelaars-databaseverbindingen op basis van de toewijzing van shardlets naar databases.</span><span class="sxs-lookup"><span data-stu-id="47ac4-121">This helps interact with the elastic database client library which brokers database connections based on the mapping of shardlets to databases.</span></span>

<span data-ttu-id="47ac4-122">Als u de Dapper assembly's, Zie [Dapper punt net](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="47ac4-122">To get the Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="47ac4-123">Zie voor de Dapper extensies [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="47ac4-123">For the Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-the-elastic-database-client-library"></a><span data-ttu-id="47ac4-124">Een kort overzicht van de clientbibliotheek voor elastische database</span><span class="sxs-lookup"><span data-stu-id="47ac4-124">A quick Look at the elastic database client library</span></span>
<span data-ttu-id="47ac4-125">Met de clientbibliotheek elastische database die u definieert partities van de toepassingsgegevens aangeroepen *shardlets* , toe te wijzen aan de databases en deze door herkennen *sharding sleutels*.</span><span class="sxs-lookup"><span data-stu-id="47ac4-125">With the elastic database client library, you define partitions of your application data called *shardlets* , map them to databases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="47ac4-126">U kunt zoveel databases als u uw shardlets verdelen over deze databases nodig hebben.</span><span class="sxs-lookup"><span data-stu-id="47ac4-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="47ac4-127">De toewijzing van sharding waarden van de databases is door een shard-toewijzing geleverd door de API's van de bibliotheek opgeslagen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-127">The mapping of sharding key values to the databases is stored by a shard map provided by the library’s APIs.</span></span> <span data-ttu-id="47ac4-128">Deze mogelijkheid wordt aangeroepen **shard kaart management**.</span><span class="sxs-lookup"><span data-stu-id="47ac4-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="47ac4-129">De shard-kaart fungeert ook als de broker databaseverbindingen voor aanvragen die een sharding-sleutel bevatten.</span><span class="sxs-lookup"><span data-stu-id="47ac4-129">The shard map also serves as the broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="47ac4-130">Deze mogelijkheid wordt aangeduid als **gegevensafhankelijke routering**.</span><span class="sxs-lookup"><span data-stu-id="47ac4-130">This capability is referred to as **data dependent routing**.</span></span>

![Shard-kaarten en gegevensafhankelijke routering][1]

<span data-ttu-id="47ac4-132">De shard-toewijzing manager beveiligt gebruikers tegen inconsistente weergaven in shardlet gegevens die optreden kunnen wanneer de gelijktijdige shardlet bewerkingen plaatsvinden op de databases.</span><span class="sxs-lookup"><span data-stu-id="47ac4-132">The shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on the databases.</span></span> <span data-ttu-id="47ac4-133">Om dit te doen broker de shard-maps de databaseverbindingen voor een toepassing met de bibliotheek gemaakt.</span><span class="sxs-lookup"><span data-stu-id="47ac4-133">To do so, the shard maps broker the database connections for an application built with the library.</span></span> <span data-ttu-id="47ac4-134">Als de shard-beheerbewerkingen kunnen invloed hebben op de shardlet, kan de functionaliteit van de kaart shard automatisch afsluiten van een databaseverbinding.</span><span class="sxs-lookup"><span data-stu-id="47ac4-134">When shard management operations could impact the shardlet, this allows the shard map functionality to automatically kill a database connection.</span></span> 

<span data-ttu-id="47ac4-135">In plaats van de traditionele manier om verbindingen voor Dapper te maken, moeten we gebruiken de [OpenConnectionForKey methode](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="47ac4-135">Instead of using the traditional way to create connections for Dapper, we need to use the [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="47ac4-136">Dit zorgt ervoor dat de validatie plaats vindt en verbindingen correct worden beheerd als er gegevens worden verplaatst tussen shards.</span><span class="sxs-lookup"><span data-stu-id="47ac4-136">This ensures that all the validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="47ac4-137">Vereisten voor Dapper-integratie</span><span class="sxs-lookup"><span data-stu-id="47ac4-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="47ac4-138">Als u werkt met de clientbibliotheek voor elastische database en de Dapper API's, die we willen behouden van de volgende eigenschappen:</span><span class="sxs-lookup"><span data-stu-id="47ac4-138">When working with both the elastic database client library and the Dapper APIs, we want to retain the following properties:</span></span>

* <span data-ttu-id="47ac4-139">**Scaleout**: We wilt toevoegen of verwijderen van de databases uit de gegevenslaag van de shard-toepassing die nodig zijn voor de vereisten van de capaciteit van de toepassing.</span><span class="sxs-lookup"><span data-stu-id="47ac4-139">**Scaleout**: We want to add or remove databases from the data tier of the sharded application as necessary for the capacity demands of the application.</span></span> 
* <span data-ttu-id="47ac4-140">**Consistentie**: omdat de toepassing is uitgebreid met behulp van sharding, moeten we gegevensafhankelijke routering uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="47ac4-140">**Consistency**: Since our application is scaled out using sharding, we need to perform data dependent routing.</span></span> <span data-ttu-id="47ac4-141">We willen dat de gegevens routering mogelijkheden afhankelijk van de bibliotheek gebruiken om dit te doen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-141">We want to use the Data dependent routing capabilities of the library to do so.</span></span> <span data-ttu-id="47ac4-142">In het bijzonder we willen behouden de validatie en consistentie wordt geleverd door verbindingen die worden geleverd door de shard-toewijzing manager om te voorkomen dat beschadiging of onjuiste queryresultaten.</span><span class="sxs-lookup"><span data-stu-id="47ac4-142">In particular, we want to retain the validation and consistency guarantees provided by connections that are brokered through the shard map manager in order to avoid corruption or wrong query results.</span></span> <span data-ttu-id="47ac4-143">Dit zorgt ervoor dat de verbindingen met een bepaalde shardlet afgewezen of gestopt als (bijvoorbeeld) de shardlet momenteel wordt verplaatst naar een andere shard met gesplitste/Merge-API's.</span><span class="sxs-lookup"><span data-stu-id="47ac4-143">This ensures that connections to a given shardlet are rejected or stopped if (for instance) the shardlet is currently moved to a different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="47ac4-144">**Objecttoewijzing**: We willen het gemak van de toewijzingen geleverd door Dapper voor de omzetting tussen klassen in de toepassing en de onderliggende structuur van de database behouden.</span><span class="sxs-lookup"><span data-stu-id="47ac4-144">**Object Mapping**: We want to retain the convenience of the mappings provided by Dapper to translate between classes in the application and the underlying database structures.</span></span> 

<span data-ttu-id="47ac4-145">De volgende sectie bevat hulp voor deze vereisten voor toepassingen op basis van **Dapper** en **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="47ac4-145">The following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="47ac4-146">Technische richtlijnen</span><span class="sxs-lookup"><span data-stu-id="47ac4-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="47ac4-147">Afhankelijke routering met Dapper gegevens</span><span class="sxs-lookup"><span data-stu-id="47ac4-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="47ac4-148">De toepassing is met Dapper, gewoonlijk verantwoordelijk is voor het maken en openen van de verbindingen met de onderliggende database.</span><span class="sxs-lookup"><span data-stu-id="47ac4-148">With Dapper, the application is typically responsible for creating and opening the connections to the underlying database.</span></span> <span data-ttu-id="47ac4-149">Een type T gezien door de toepassing, retourneert Dapper queryresultaten zoals .NET verzamelingen van het type T. Dapper voert de toewijzing van de T-SQL-Resultatenrijen aan de objecten van het type T. Op deze manier maps Dapper .NET-objecten in SQL-waarden of de parameters voor instructies voor data manipulatie language (DML).</span><span class="sxs-lookup"><span data-stu-id="47ac4-149">Given a type T by the application, Dapper returns query results as .NET collections of type T. Dapper performs the mapping from the T-SQL result rows to the objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="47ac4-150">Dapper biedt deze functionaliteit via uitbreidingsmethoden op de normale [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object uit de ADO .NET SQL-clientbibliotheken.</span><span class="sxs-lookup"><span data-stu-id="47ac4-150">Dapper offers this functionality via extension methods on the regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from the ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="47ac4-151">De SQL-verbinding die wordt geretourneerd door de Elastic Scale API's voor DDR zijn ook reguliere [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objecten.</span><span class="sxs-lookup"><span data-stu-id="47ac4-151">The SQL connection returned by the Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="47ac4-152">Deze manier kunnen wij rechtstreeks Dapper om uitbreidingen te gebruiken via het type dat wordt geretourneerd door de clientbibliotheek DDR-API, omdat het ook een eenvoudige SQL-clientverbinding.</span><span class="sxs-lookup"><span data-stu-id="47ac4-152">This allows us to directly use Dapper extensions over the type returned by the client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="47ac4-153">Deze opmerkingen kunnen u eenvoudig door de clientbibliotheek voor elastische databases voor Dapper brokered verbindingen te gebruiken.</span><span class="sxs-lookup"><span data-stu-id="47ac4-153">These observations make it straightforward to use connections brokered by the elastic database client library for Dapper.</span></span>

<span data-ttu-id="47ac4-154">Dit codevoorbeeld (van de bijbehorende voorbeeld) ziet u de methode waarbij de sharding-sleutel wordt geleverd door de toepassing aan de bibliotheek op de verbinding met de juiste shard broker.</span><span class="sxs-lookup"><span data-stu-id="47ac4-154">This code example (from the accompanying sample) illustrates the approach where the sharding key is provided by the application to the library to broker the connection to the right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="47ac4-155">De aanroep van de [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API vervangt het standaard maken en openen van een SQL-clientverbinding.</span><span class="sxs-lookup"><span data-stu-id="47ac4-155">The call to the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces the default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="47ac4-156">De [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) aanroep worden de argumenten die vereist voor het gegevensafhankelijke routering zijn:</span><span class="sxs-lookup"><span data-stu-id="47ac4-156">The [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes the arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="47ac4-157">De shard-toewijzing voor toegang tot de gegevens van afhankelijke routeringsinterfaces</span><span class="sxs-lookup"><span data-stu-id="47ac4-157">The shard map to access the data dependent routing interfaces</span></span>
* <span data-ttu-id="47ac4-158">De sharding-sleutel voor het identificeren van de shardlet</span><span class="sxs-lookup"><span data-stu-id="47ac4-158">The sharding key to identify the shardlet</span></span>
* <span data-ttu-id="47ac4-159">De referenties (gebruikersnaam en wachtwoord) verbinding maken met de shard</span><span class="sxs-lookup"><span data-stu-id="47ac4-159">The credentials (user name and password) to connect to the shard</span></span>

<span data-ttu-id="47ac4-160">Het object shard-toewijzing maakt een verbinding met de shard die de shardlet voor de opgegeven sharding-sleutel bevat.</span><span class="sxs-lookup"><span data-stu-id="47ac4-160">The shard map object creates a connection to the shard that holds the shardlet for the given sharding key.</span></span> <span data-ttu-id="47ac4-161">De client-API's van elastische database ook de verbinding met het implementeren van de consistentie wordt gegarandeerd labelen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-161">The elastic database client APIs also tag the connection to implement its consistency guarantees.</span></span> <span data-ttu-id="47ac4-162">Sinds de aanroep [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) retourneert reguliere SQL object clientverbinding, de volgende aanroep naar de **Execute** uitbreidingsmethode van Dapper volgt de standaard Dapper praktijk.</span><span class="sxs-lookup"><span data-stu-id="47ac4-162">Since the call to [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, the subsequent call to the **Execute** extension method from Dapper follows the standard Dapper practice.</span></span>

<span data-ttu-id="47ac4-163">Query's werken bijna hetzelfde - u opent eerst de verbinding met [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) van de client-API.</span><span class="sxs-lookup"><span data-stu-id="47ac4-163">Queries work very much the same way - you first open the connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from the client API.</span></span> <span data-ttu-id="47ac4-164">U de gewone Dapper uitbreidingsmethoden de resultaten van uw SQL-query toewijzen aan .NET-objecten gebruiken:</span><span class="sxs-lookup"><span data-stu-id="47ac4-164">Then you use the regular Dapper extension methods to map the results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="47ac4-165">Houd er rekening mee dat de **met** blokkeren met de DDR verbinding scopes alle databasebewerkingen in het blok op de ene shard waar tenantId1 wordt gehouden.</span><span class="sxs-lookup"><span data-stu-id="47ac4-165">Note that the **using** block with the DDR connection scopes all database operations within the block to the one shard where tenantId1 is kept.</span></span> <span data-ttu-id="47ac4-166">De query retourneert alleen opgeslagen op de huidige shard-blogs, maar niet de bestanden die zijn opgeslagen op een andere shards.</span><span class="sxs-lookup"><span data-stu-id="47ac4-166">The query only returns blogs stored on the current shard, but not the ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="47ac4-167">Afhankelijke routering met Dapper en DapperExtensions gegevens</span><span class="sxs-lookup"><span data-stu-id="47ac4-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="47ac4-168">Dapper wordt geleverd met een ecosysteem van de aanvullende extensies die verdere gemak en abstractie uit de database bieden kunnen bij het ontwikkelen van databasetoepassingen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from the database when developing database applications.</span></span> <span data-ttu-id="47ac4-169">DapperExtensions is een voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="47ac4-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="47ac4-170">DapperExtensions gebruiken in uw toepassing wordt niet gewijzigd hoe databaseverbindingen gemaakt en beheerd.</span><span class="sxs-lookup"><span data-stu-id="47ac4-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="47ac4-171">Nog steeds de verantwoordelijkheid van de toepassing te openen van verbindingen en reguliere SQL Client connection-objecten door de uitbreidingsmethoden worden verwacht.</span><span class="sxs-lookup"><span data-stu-id="47ac4-171">It is still the application’s responsibility to open connections, and regular SQL Client connection objects are expected by the extension methods.</span></span> <span data-ttu-id="47ac4-172">We kunnen vertrouwen op de [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) hierboven.</span><span class="sxs-lookup"><span data-stu-id="47ac4-172">We can rely on the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="47ac4-173">Als u de volgende codevoorbeelden weergeven, wordt de enige wijziging is dat er niet langer moet de T-SQL-instructies schrijven:</span><span class="sxs-lookup"><span data-stu-id="47ac4-173">As the following code samples show, the only change is that we do no longer have to write the T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="47ac4-174">En dit is de voorbeeldcode voor de query:</span><span class="sxs-lookup"><span data-stu-id="47ac4-174">And here is the code sample for the query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="47ac4-175">Afhandeling van tijdelijke fouten</span><span class="sxs-lookup"><span data-stu-id="47ac4-175">Handling transient faults</span></span>
<span data-ttu-id="47ac4-176">Het team van Microsoft Patterns & procedures gepubliceerd de [tijdelijke fout afhandeling van Application Block](http://msdn.microsoft.com/library/hh680934.aspx) voor ontwikkelaars van toepassingen beperken algemene tijdelijke storingen opgetreden tijdens het uitvoeren in de cloud.</span><span class="sxs-lookup"><span data-stu-id="47ac4-176">The Microsoft Patterns & Practices team published the [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) to help application developers mitigate common transient fault conditions encountered when running in the cloud.</span></span> <span data-ttu-id="47ac4-177">Zie voor meer informatie [Perseverance, geheim van alle successen: met behulp van de tijdelijke fout afhandeling van Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="47ac4-177">For more information, see [Perseverance, Secret of All Triumphs: Using the Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="47ac4-178">In het voorbeeld is afhankelijk van de bibliotheek tijdelijke fout bij de bescherming tegen tijdelijke fouten.</span><span class="sxs-lookup"><span data-stu-id="47ac4-178">The code sample relies on the transient fault library to protect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="47ac4-179">**SqlDatabaseUtils.SqlRetryPolicy** in de bovenstaande code wordt gedefinieerd als een **SqlDatabaseTransientErrorDetectionStrategy** met een aantal nieuwe pogingen van 10 en 5 seconden wachttijd tussen nieuwe pogingen.</span><span class="sxs-lookup"><span data-stu-id="47ac4-179">**SqlDatabaseUtils.SqlRetryPolicy** in the code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="47ac4-180">Als u van transacties gebruikmaakt, ervoor zorgen dat uw bereik opnieuw teruggaan naar het begin van de transactie in het geval van een tijdelijke fout.</span><span class="sxs-lookup"><span data-stu-id="47ac4-180">If you are using transactions, make sure that your retry scope goes back to the beginning of the transaction in the case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="47ac4-181">Beperkingen</span><span class="sxs-lookup"><span data-stu-id="47ac4-181">Limitations</span></span>
<span data-ttu-id="47ac4-182">De methoden die worden beschreven in dit document leidt tot een aantal beperkingen:</span><span class="sxs-lookup"><span data-stu-id="47ac4-182">The approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="47ac4-183">De voorbeeldcode voor dit document biedt niet laten zien hoe schema beheren via shards.</span><span class="sxs-lookup"><span data-stu-id="47ac4-183">The sample code for this document does not demonstrate how to manage schema across shards.</span></span>
* <span data-ttu-id="47ac4-184">Een aanvraag opgegeven, gaan we ervan uit dat alle bijbehorende verwerken van de database zich in een enkel shard aangeduid met de sleutel sharding van de aanvraag.</span><span class="sxs-lookup"><span data-stu-id="47ac4-184">Given a request, we assume that all its database processing is contained within a single shard as identified by the sharding key provided by the request.</span></span> <span data-ttu-id="47ac4-185">Echter, deze aanname niet altijd bijhoudt, bijvoorbeeld wanneer het is niet mogelijk om een sharding-sleutel beschikbaar te maken.</span><span class="sxs-lookup"><span data-stu-id="47ac4-185">However, this assumption does not always hold, for example, when it is not possible to make a sharding key available.</span></span> <span data-ttu-id="47ac4-186">Daarom de clientbibliotheek voor elastische database bevat de [MultiShardQuery klasse](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="47ac4-186">To address this, the elastic database client library includes the [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="47ac4-187">De klasse implementeert een abstractie van de verbinding voor het uitvoeren van query's via meerdere shards.</span><span class="sxs-lookup"><span data-stu-id="47ac4-187">The class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="47ac4-188">MultiShardQuery gebruiken in combinatie met Dapper valt buiten het bereik van dit document.</span><span class="sxs-lookup"><span data-stu-id="47ac4-188">Using MultiShardQuery in combination with Dapper is beyond the scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="47ac4-189">Conclusie</span><span class="sxs-lookup"><span data-stu-id="47ac4-189">Conclusion</span></span>
<span data-ttu-id="47ac4-190">Toepassingen met Dapper en DapperExtensions kunnen eenvoudig profiteren van de hulpmiddelen voor elastische databases voor Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="47ac4-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="47ac4-191">Door de stappen die worden beschreven in dit document, die toepassingen kunnen gebruikmaken van de mogelijkheid van het hulpprogramma voor afhankelijke routering door het wijzigen van het maken en openen van nieuwe gegevens [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objecten te gebruiken de [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) aanroep van de clientbibliotheek voor elastische database.</span><span class="sxs-lookup"><span data-stu-id="47ac4-191">Through the steps outlined in this document, those applications can use the tool's capability for data dependent routing by changing the creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects to use the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of the elastic database client library.</span></span> <span data-ttu-id="47ac4-192">Dit beperkt de wijzigingen in de toepassing vereist voor deze locaties waar de nieuwe verbindingen zijn gemaakt en geopend.</span><span class="sxs-lookup"><span data-stu-id="47ac4-192">This limits the application changes required to those places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png
