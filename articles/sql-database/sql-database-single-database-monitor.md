---
title: Databaseprestaties bewaken in Azure SQL Database | Microsoft Docs
description: Lees meer over de opties voor het bewaken van uw database met Azure-hulpprogramma's en dynamische beheerweergave.
keywords: database bewaken, prestaties van clouddatabase
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: e11ed3275413b428523eef78a5a89b537f6a4afc
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="e869e-104">Databaseprestaties bewaken in Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="e869e-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="e869e-105">Het bewaken van de prestaties van een SQL-database in Azure begint met het bewaken van het resourcegebruik ten opzichte van het gekozen niveau van databaseprestaties.</span><span class="sxs-lookup"><span data-stu-id="e869e-105">Monitoring the performance of a SQL database in Azure starts with monitoring the resource utilization relative to the level of database performance you choose.</span></span> <span data-ttu-id="e869e-106">Bewaking helpt u om te bepalen of de database te veel capaciteit heeft of juist problemen heeft omdat resources volledig worden benut. Vervolgens kunt u beslissen of u het prestatieniveau en de [servicelaag](sql-database-service-tiers.md) van uw database moet aanpassen.</span><span class="sxs-lookup"><span data-stu-id="e869e-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time to adjust the performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="e869e-107">U kunt een database bewaken met grafische hulpprogramma's in de [Azure-portal](https://portal.azure.com) of met [dynamische beheerweergaven](https://msdn.microsoft.com/library/ms188754.aspx) van SQL.</span><span class="sxs-lookup"><span data-stu-id="e869e-107">You can monitor your database using graphical tools in the [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-the-azure-portal"></a><span data-ttu-id="e869e-108">Databases bewaken via de Azure-portal</span><span class="sxs-lookup"><span data-stu-id="e869e-108">Monitor databases using the Azure portal</span></span>
<span data-ttu-id="e869e-109">In de [Azure-portal](https://portal.azure.com/) kunt u het verbruik van een individuele database bewaken door de database te selecteren en op de grafiek **Bewaking** te klikken.</span><span class="sxs-lookup"><span data-stu-id="e869e-109">In the [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking the **Monitoring** chart.</span></span> <span data-ttu-id="e869e-110">Nu wordt een venster **Metrische gegevens** geopend, dat u kunt wijzigen door op de knop **Grafiek bewerken** te klikken.</span><span class="sxs-lookup"><span data-stu-id="e869e-110">This brings up a **Metric** window that you can change by clicking the **Edit chart** button.</span></span> <span data-ttu-id="e869e-111">Voeg de volgende metrische gegevens toe:</span><span class="sxs-lookup"><span data-stu-id="e869e-111">Add the following metrics:</span></span>

* <span data-ttu-id="e869e-112">CPU-percentage</span><span class="sxs-lookup"><span data-stu-id="e869e-112">CPU percentage</span></span>
* <span data-ttu-id="e869e-113">DTU-percentage</span><span class="sxs-lookup"><span data-stu-id="e869e-113">DTU percentage</span></span>
* <span data-ttu-id="e869e-114">Gegevens-I/O-percentage</span><span class="sxs-lookup"><span data-stu-id="e869e-114">Data IO percentage</span></span>
* <span data-ttu-id="e869e-115">Databaseomvangpercentage</span><span class="sxs-lookup"><span data-stu-id="e869e-115">Database size percentage</span></span>

<span data-ttu-id="e869e-116">Wanneer u deze metrische gegevens hebt toegevoegd, kunt u ze in de grafiek **Bewaking** gedetailleerder bekijken in het venster **Metrische gegevens**.</span><span class="sxs-lookup"><span data-stu-id="e869e-116">Once you’ve added these metrics, you can continue to view them in the **Monitoring** chart with more details on the **Metric** window.</span></span> <span data-ttu-id="e869e-117">De vier metrische gegevens tonen het gemiddelde gebruikspercentage ten opzichte van de **DTU** van uw database.</span><span class="sxs-lookup"><span data-stu-id="e869e-117">All four metrics show the average utilization percentage relative to the **DTU** of your database.</span></span> <span data-ttu-id="e869e-118">Raadpleeg het artikel over [servicelagen](sql-database-service-tiers.md) voor meer informatie over DTU's.</span><span class="sxs-lookup"><span data-stu-id="e869e-118">See the [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Servicelaagbewaking van databaseprestaties.](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="e869e-120">U kunt ook meldingen configureren voor prestatiewaarden.</span><span class="sxs-lookup"><span data-stu-id="e869e-120">You can also configure alerts on the performance metrics.</span></span> <span data-ttu-id="e869e-121">Klik op de knop **Melding toevoegen** in het venster **Metrische gegevens**.</span><span class="sxs-lookup"><span data-stu-id="e869e-121">Click the **Add alert** button in the **Metric** window.</span></span> <span data-ttu-id="e869e-122">Volg de wizard om de melding te configureren.</span><span class="sxs-lookup"><span data-stu-id="e869e-122">Follow the wizard to configure your alert.</span></span> <span data-ttu-id="e869e-123">U hebt de keuze om een melding weer te geven als de metrische gegevens een bepaalde drempelwaarde overschrijden of als het meetpunt onder een bepaalde drempelwaarde komt.</span><span class="sxs-lookup"><span data-stu-id="e869e-123">You have the option to alert if the metrics exceed a certain threshold or if the metric falls below a certain threshold.</span></span>

<span data-ttu-id="e869e-124">Als u bijvoorbeeld verwacht dat de workload van de database zal toenemen, kunt u configureren dat er een e-mailmelding wordt verstuurd wanneer de database 80% van een van de prestatiewaarden heeft bereikt.</span><span class="sxs-lookup"><span data-stu-id="e869e-124">For example, if you expect the workload on your database to grow, you can choose to configure an email alert whenever your database reaches 80% on any of the performance metrics.</span></span> <span data-ttu-id="e869e-125">U kunt dit gebruiken als een aankondiging dat u misschien moet overschakelen naar een hoger prestatieniveau.</span><span class="sxs-lookup"><span data-stu-id="e869e-125">You can use this as an early warning to figure out when you might have to switch to the next higher performance level.</span></span>

<span data-ttu-id="e869e-126">Aan de hand van de prestatiewaarden kunt u ook bepalen of u misschien moet downgraden naar een lager prestatieniveau.</span><span class="sxs-lookup"><span data-stu-id="e869e-126">The performance metrics can also help you determine if you are able to downgrade to a lower performance level.</span></span> <span data-ttu-id="e869e-127">Stel dat u een Standard S2-database gebruikt en alle prestatiewaarden aangeven dat de database gemiddeld nooit meer dan 10% gebruikt.</span><span class="sxs-lookup"><span data-stu-id="e869e-127">Assume you are using a Standard S2 database and all performance metrics show that the database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="e869e-128">Het is dan waarschijnlijk dat de database in Standard S1 goed werkt.</span><span class="sxs-lookup"><span data-stu-id="e869e-128">It is likely that the database will work well in Standard S1.</span></span> <span data-ttu-id="e869e-129">Houd echter wel rekening met workloads die pieken of fluctueren, voordat u besluit om over te stappen op een lager prestatieniveau.</span><span class="sxs-lookup"><span data-stu-id="e869e-129">However, be aware of workloads that spike or fluctuate before making the decision to move to a lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="e869e-130">Databases bewaken via DMV's</span><span class="sxs-lookup"><span data-stu-id="e869e-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="e869e-131">Dezelfde metrische gegevens die in de portal worden weergegeven, zijn ook beschikbaar via systeemweergaven: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in de logische **hoofd**database van de server en [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in de gebruikersdatabase.</span><span class="sxs-lookup"><span data-stu-id="e869e-131">The same metrics that are exposed in the portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in the logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in the user database.</span></span> <span data-ttu-id="e869e-132">Gebruik **sys.resource_stats** als u voor een langere periode minder gedetailleerde gegevens wilt bewaken.</span><span class="sxs-lookup"><span data-stu-id="e869e-132">Use **sys.resource_stats** if you need to monitor less granular data across a longer period of time.</span></span> <span data-ttu-id="e869e-133">Gebruik **sys.dm_db_resource_stats** als u gedurende kortere tijd meer gedetailleerde gegevens wilt bewaken.</span><span class="sxs-lookup"><span data-stu-id="e869e-133">Use **sys.dm_db_resource_stats** if you need to monitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="e869e-134">Zie [Richtlijnen voor Azure SQL Database-prestaties](sql-database-single-database-monitor.md#monitor-resource-use) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="e869e-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="e869e-135">**sys.dm_db_resource_stats** retourneert een lege resultatenset als deze wordt gebruikt voor de buiten gebruik gestelde Web en Business Edition-databases.</span><span class="sxs-lookup"><span data-stu-id="e869e-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="e869e-136">Brongebruik controleren</span><span class="sxs-lookup"><span data-stu-id="e869e-136">Monitor resource use</span></span>

<span data-ttu-id="e869e-137">U kunt controleren met resource-gebruik [SQL Database Query Performance Insight](sql-database-query-performance.md) en [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="e869e-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="e869e-138">U kunt ook gebruik van deze twee weergaven met bewaken:</span><span class="sxs-lookup"><span data-stu-id="e869e-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="e869e-139">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="e869e-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="e869e-140">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="e869e-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="e869e-141">sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="e869e-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="e869e-142">U kunt de [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) weergave in elke SQL-database.</span><span class="sxs-lookup"><span data-stu-id="e869e-142">You can use the [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="e869e-143">De **sys.dm_db_resource_stats** weergave toont recente gegevens ten opzichte van de servicetier resource gebruiken.</span><span class="sxs-lookup"><span data-stu-id="e869e-143">The **sys.dm_db_resource_stats** view shows recent resource use data relative to the service tier.</span></span> <span data-ttu-id="e869e-144">Gemiddelde percentages voor CPU, i/o-gegevens, logboekschrijfbewerkingen en geheugen elke 15 seconden worden vastgelegd en worden bewaard 1 uur.</span><span class="sxs-lookup"><span data-stu-id="e869e-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="e869e-145">Omdat deze weergave een meer gedetailleerd blik op gebruik van bronnen biedt, gebruikt u **sys.dm_db_resource_stats** eerste voor een analyse van de huidige status of het oplossen van problemen.</span><span class="sxs-lookup"><span data-stu-id="e869e-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="e869e-146">Deze query geeft bijvoorbeeld het gebruik van gemiddelde en maximale resource voor de huidige database via het afgelopen uur:</span><span class="sxs-lookup"><span data-stu-id="e869e-146">For example, this query shows the average and maximum resource use for the current database over the past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="e869e-147">Zie voor andere query's in de voorbeelden in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="e869e-147">For other queries, see the examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="e869e-148">sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="e869e-148">sys.resource_stats</span></span>
<span data-ttu-id="e869e-149">De [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) weergeven in de **master** database bevat extra informatie kunt u de prestaties van uw SQL-database op de specifieke prijscategorie en prestatieniveau serviceniveau controleren.</span><span class="sxs-lookup"><span data-stu-id="e869e-149">The [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in the **master** database has additional information that can help you monitor the performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="e869e-150">De gegevens worden verzameld om de 5 minuten en ongeveer 35 dagen wordt bijgehouden.</span><span class="sxs-lookup"><span data-stu-id="e869e-150">The data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="e869e-151">Deze weergave is handig voor een langere historische analyse van hoe uw SQL-database maakt gebruik van bronnen.</span><span class="sxs-lookup"><span data-stu-id="e869e-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="e869e-152">De volgende grafiek ziet de CPU gebruik van bronnen voor een Premium-database met het prestatieniveau P2 voor elk uur in een week.</span><span class="sxs-lookup"><span data-stu-id="e869e-152">The following graph shows the CPU resource use for a Premium database with the P2 performance level for each hour in a week.</span></span> <span data-ttu-id="e869e-153">Deze grafiek begint op een maandag, ziet u 5 werkdagen en geeft vervolgens een weekend, als er veel minder wordt uitgevoerd op de toepassing.</span><span class="sxs-lookup"><span data-stu-id="e869e-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on the application.</span></span>

![Gebruik van SQL database-bronnen](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="e869e-155">Van de gegevens, heeft deze database momenteel een piek CPU-belasting van iets meer dan 50 procent CPU-gebruik ten opzichte van het prestatieniveau P2 (middaguur op dinsdag).</span><span class="sxs-lookup"><span data-stu-id="e869e-155">From the data, this database currently has a peak CPU load of just over 50 percent CPU use relative to the P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="e869e-156">Als CPU de verwerkingsflexibiliteit factor in resource-profiel van de toepassing is, kunt u vervolgens besluiten dat P2 het juiste prestatieniveau is te garanderen dat de werkbelasting altijd past.</span><span class="sxs-lookup"><span data-stu-id="e869e-156">If CPU is the dominant factor in the application’s resource profile, then you might decide that P2 is the right performance level to guarantee that the workload always fits.</span></span> <span data-ttu-id="e869e-157">Als u verwacht een toepassing dat op den duur uitgebreid, is het een goed idee om een extra bron buffer hebben, zodat de toepassing niet ooit de prestatieniveau limiet bereikt.</span><span class="sxs-lookup"><span data-stu-id="e869e-157">If you expect an application to grow over time, it's a good idea to have an extra resource buffer so that the application doesn't ever reach the performance-level limit.</span></span> <span data-ttu-id="e869e-158">Als u het prestatieniveau verhoogt, kunt u helpen te voorkomen dat zichtbaar is voor een klant fouten die optreden mogelijk wanneer een database beschikt niet over voldoende stroom voor het verwerken van aanvragen effectief, met name in omgevingen latentie gevoelig.</span><span class="sxs-lookup"><span data-stu-id="e869e-158">If you increase the performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power to process requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="e869e-159">Een voorbeeld is een database die een toepassing die worden getekend door webpagina's op basis van de resultaten van de database-aanroepen ondersteunt.</span><span class="sxs-lookup"><span data-stu-id="e869e-159">An example is a database that supports an application that paints webpages based on the results of database calls.</span></span>

<span data-ttu-id="e869e-160">Andere soorten toepassingen mogelijk dezelfde grafiek anders interpreteren.</span><span class="sxs-lookup"><span data-stu-id="e869e-160">Other application types might interpret the same graph differently.</span></span> <span data-ttu-id="e869e-161">Bijvoorbeeld, als een toepassing probeert te verwerken van gegevens van elke dag en dezelfde grafiek heeft, kunt dit soort 'batchverwerking' model doen goed op prestatieniveau P1.</span><span class="sxs-lookup"><span data-stu-id="e869e-161">For example, if an application tries to process payroll data each day and has the same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="e869e-162">Het prestatieniveau P1 heeft 100 dtu's ten opzichte van 200 dtu's op het niveau van de prestaties P2.</span><span class="sxs-lookup"><span data-stu-id="e869e-162">The P1 performance level has 100 DTUs compared to 200 DTUs at the P2 performance level.</span></span> <span data-ttu-id="e869e-163">Het prestatieniveau P1 biedt de helft van de prestaties van het prestatieniveau P2.</span><span class="sxs-lookup"><span data-stu-id="e869e-163">The P1 performance level provides half the performance of the P2 performance level.</span></span> <span data-ttu-id="e869e-164">Dus 50 procent van de CPU-gebruik in P2 is gelijk aan 100 procent CPU-gebruik in P1.</span><span class="sxs-lookup"><span data-stu-id="e869e-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="e869e-165">Als de toepassing geen time-outs, maakt het niet uit als een taak duurt 2 uur of 2,5 uren in beslag, als het vandaag wordt voltooid.</span><span class="sxs-lookup"><span data-stu-id="e869e-165">If the application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours to finish, if it gets done today.</span></span> <span data-ttu-id="e869e-166">Een toepassing in deze categorie kunt waarschijnlijk prestatieniveau P1 gebruiken.</span><span class="sxs-lookup"><span data-stu-id="e869e-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="e869e-167">U kunt profiteren van het feit dat er perioden gedurende de dag wanneer bronnengebruik ligt, zodat eventuele 'big piek' kan worden gelekt via in een van de holten later op de dag.</span><span class="sxs-lookup"><span data-stu-id="e869e-167">You can take advantage of the fact that there are periods of time during the day when resource use is lower, so that any "big peak" might spill over into one of the troughs later in the day.</span></span> <span data-ttu-id="e869e-168">Het prestatieniveau P1 mogelijk geschikt voor dit soort van toepassing (en geld besparen), zolang de taken op tijd per dag kunnen worden voltooid.</span><span class="sxs-lookup"><span data-stu-id="e869e-168">The P1 performance level might be good for that kind of application (and save money), as long as the jobs can finish on time each day.</span></span>

<span data-ttu-id="e869e-169">Azure SQL Database worden verbruikt resourcegegevens voor elke actieve database in de **sys.resource_stats** weergeven van de **master** database op elke server.</span><span class="sxs-lookup"><span data-stu-id="e869e-169">Azure SQL Database exposes consumed resource information for each active database in the **sys.resource_stats** view of the **master** database in each server.</span></span> <span data-ttu-id="e869e-170">De gegevens in de tabel worden samengevoegd voor 5 minuten durende intervallen.</span><span class="sxs-lookup"><span data-stu-id="e869e-170">The data in the table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="e869e-171">De gegevens kan worden weergegeven in de tabel betekent dat deze gegevens nuttiger voor historische analyse in plaats van in de buurt van de realtime-analyses meer dan 5 minuten duren voordat met de Servicelagen Basic, Standard en Premium.</span><span class="sxs-lookup"><span data-stu-id="e869e-171">With the Basic, Standard, and Premium service tiers, the data can take more than 5 minutes to appear in the table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="e869e-172">Query de **sys.resource_stats** de recente geschiedenis van een database weergeven en valideren of de reservering u hebt ervoor gekozen de prestaties die u wilt dat wanneer deze nodig is geleverd.</span><span class="sxs-lookup"><span data-stu-id="e869e-172">Query the **sys.resource_stats** view to see the recent history of a database and to validate whether the reservation you chose delivered the performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="e869e-173">U moet verbonden zijn met de **master** database van de logische SQL database-server aan query **sys.resource_stats** in de volgende voorbeelden.</span><span class="sxs-lookup"><span data-stu-id="e869e-173">You must be connected to the **master** database of your logical SQL database server to query **sys.resource_stats** in the following examples.</span></span>
> 
> 

<span data-ttu-id="e869e-174">Dit voorbeeld ziet u hoe de gegevens in deze weergave wordt weergegeven:</span><span class="sxs-lookup"><span data-stu-id="e869e-174">This example shows you how the data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![De catalogusweergave sys.resource_stats](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="e869e-176">Het volgende voorbeeld ziet u de verschillende manieren waarop u kunt de **sys.resource_stats** catalogusweergave voor informatie over hoe resources in uw SQL-database worden gebruikt:</span><span class="sxs-lookup"><span data-stu-id="e869e-176">The next example shows you different ways that you can use the **sys.resource_stats** catalog view to get information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="e869e-177">Om te kijken naar de afgelopen week resource voor de database userdb1 gebruiken, kunt u deze query uitvoeren:</span><span class="sxs-lookup"><span data-stu-id="e869e-177">To look at the past week’s resource use for the database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="e869e-178">Als u wilt evalueren hoe goed uw werkbelasting geschikt is voor het prestatieniveau, die u wilt inzoomen op elk aspect van de resource metrische gegevens: CPU, lezen, schrijven, aantal werknemers en aantal sessies.</span><span class="sxs-lookup"><span data-stu-id="e869e-178">To evaluate how well your workload fits the performance level, you need to drill down into each aspect of the resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="e869e-179">Hier volgt een herziene query met **sys.resource_stats** voor het rapporteren van de gemiddelde en maximale waarden van deze resource metrische gegevens:</span><span class="sxs-lookup"><span data-stu-id="e869e-179">Here's a revised query using **sys.resource_stats** to report the average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="e869e-180">U kunt met deze informatie over de gemiddelde en maximale waarden van elke resource metrische gegevens kunt beoordelen hoe goed uw werkbelasting in het prestatieniveau dat u hebt gekozen past.</span><span class="sxs-lookup"><span data-stu-id="e869e-180">With this information about the average and maximum values of each resource metric, you can assess how well your workload fits into the performance level you chose.</span></span> <span data-ttu-id="e869e-181">Normaal gesproken gemiddelde waarden van **sys.resource_stats** bieden u een goede basis te gebruiken op basis van de doelgrootte.</span><span class="sxs-lookup"><span data-stu-id="e869e-181">Usually, average values from **sys.resource_stats** give you a good baseline to use against the target size.</span></span> <span data-ttu-id="e869e-182">Moet uw primaire meting stick.</span><span class="sxs-lookup"><span data-stu-id="e869e-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="e869e-183">Voor een voorbeeld kan de laag Standard-service worden gebruikt met S2 prestatieniveau.</span><span class="sxs-lookup"><span data-stu-id="e869e-183">For an example, you might be using the Standard service tier with S2 performance level.</span></span> <span data-ttu-id="e869e-184">Het gemiddelde gebruik percentages voor CPU- en i/o-leesbewerkingen en schrijfbewerkingen zijn dan 40 procent, het gemiddelde aantal werknemers lager is dan 50 en het gemiddelde aantal sessies lager is dan 200.</span><span class="sxs-lookup"><span data-stu-id="e869e-184">The average use percentages for CPU and I/O reads and writes are below 40 percent, the average number of workers is below 50, and the average number of sessions is below 200.</span></span> <span data-ttu-id="e869e-185">Uw werkbelasting mogelijk in het prestatieniveau S1 past.</span><span class="sxs-lookup"><span data-stu-id="e869e-185">Your workload might fit into the S1 performance level.</span></span> <span data-ttu-id="e869e-186">Het is gemakkelijk om te zien of de database in de limieten van de werknemer en sessie past.</span><span class="sxs-lookup"><span data-stu-id="e869e-186">It's easy to see whether your database fits in the worker and session limits.</span></span> <span data-ttu-id="e869e-187">Om te zien of een database in een lager prestatieniveau met betrekking tot de CPU past, leest en schrijft, verdeelt het DTU-nummer van de lager prestatieniveau door het DTU-nummer van uw huidige prestatieniveau en vervolgens het resultaat vermenigvuldigd met 100:</span><span class="sxs-lookup"><span data-stu-id="e869e-187">To see whether a database fits into a lower performance level with regards to CPU, reads, and writes, divide the DTU number of the lower performance level by the DTU number of your current performance level, and then multiply the result by 100:</span></span>
   
    <span data-ttu-id="e869e-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="e869e-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="e869e-189">Het resultaat is het relatieve prestatieverschil tussen de twee prestatieniveaus in een percentage.</span><span class="sxs-lookup"><span data-stu-id="e869e-189">The result is the relative performance difference between the two performance levels in percentage.</span></span> <span data-ttu-id="e869e-190">Als uw gebruik van de resource niet groter zijn dan deze hoeveelheid, kan uw werkbelasting past in lager prestatieniveau.</span><span class="sxs-lookup"><span data-stu-id="e869e-190">If your resource use doesn't exceed this amount, your workload might fit into the lower performance level.</span></span> <span data-ttu-id="e869e-191">Echter, moet u alle bereiken van waarden voor het gebruik van resources, en bepalen, op percentage, hoe vaak de werkbelasting van uw database valt in de lager prestatieniveau.</span><span class="sxs-lookup"><span data-stu-id="e869e-191">However, you need to look at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into the lower performance level.</span></span> <span data-ttu-id="e869e-192">De volgende query levert het percentage aanpassen per resourcedimensie, op basis van de drempelwaarde van 40 procent die in dit voorbeeld is berekend:</span><span class="sxs-lookup"><span data-stu-id="e869e-192">The following query outputs the fit percentage per resource dimension, based on the threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="e869e-193">Op basis van uw database serviceniveaudoelstelling (SLO), kunt u beslissen of uw werkbelasting in lager prestatieniveau past.</span><span class="sxs-lookup"><span data-stu-id="e869e-193">Based on your database service level objective (SLO), you can decide whether your workload fits into the lower performance level.</span></span> <span data-ttu-id="e869e-194">Als de werkbelasting van uw database SLO 99,9 procent is en de voorgaande query waarden groter dan 99,9% voor alle drie resourcedimensies retourneert, wordt uw workload waarschijnlijk in de lager prestatieniveau past.</span><span class="sxs-lookup"><span data-stu-id="e869e-194">If your database workload SLO is 99.9 percent and the preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into the lower performance level.</span></span>
   
    <span data-ttu-id="e869e-195">Kijken naar de geschikte percentage biedt ook inzicht in of u naar de hoger prestatieniveau overstappen moet om te voldoen aan uw SLO.</span><span class="sxs-lookup"><span data-stu-id="e869e-195">Looking at the fit percentage also gives you insight into whether you should move to the next higher performance level to meet your SLO.</span></span> <span data-ttu-id="e869e-196">Userdb1 ziet u bijvoorbeeld het volgende CPU-gebruik voor de afgelopen week:</span><span class="sxs-lookup"><span data-stu-id="e869e-196">For example, userdb1 shows the following CPU use for the past week:</span></span>
   
   | <span data-ttu-id="e869e-197">Gemiddelde CPU-percentage</span><span class="sxs-lookup"><span data-stu-id="e869e-197">Average CPU percent</span></span> | <span data-ttu-id="e869e-198">Maximale CPU-percentage</span><span class="sxs-lookup"><span data-stu-id="e869e-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="e869e-199">24.5</span><span class="sxs-lookup"><span data-stu-id="e869e-199">24.5</span></span> |<span data-ttu-id="e869e-200">100.00</span><span class="sxs-lookup"><span data-stu-id="e869e-200">100.00</span></span> |
   
    <span data-ttu-id="e869e-201">De gemiddelde CPU is over een kwartaal van de limiet van het prestatieniveau dat zijn voor het prestatieniveau van de database geschikt zou.</span><span class="sxs-lookup"><span data-stu-id="e869e-201">The average CPU is about a quarter of the limit of the performance level, which would fit well into the performance level of the database.</span></span> <span data-ttu-id="e869e-202">Maar de maximale waarde ziet u dat de database heeft de limiet van het prestatieniveau bereikt.</span><span class="sxs-lookup"><span data-stu-id="e869e-202">But, the maximum value shows that the database reaches the limit of the performance level.</span></span> <span data-ttu-id="e869e-203">Moet u naar de hoger prestatieniveau verplaatsen?</span><span class="sxs-lookup"><span data-stu-id="e869e-203">Do you need to move to the next higher performance level?</span></span> <span data-ttu-id="e869e-204">Kijken hoe vaak uw werkbelasting bereikt 100 procent en vergelijk deze met de werkbelasting van uw database SLO.</span><span class="sxs-lookup"><span data-stu-id="e869e-204">Look at how many times your workload reaches 100 percent, and then compare it to your database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="e869e-205">Als deze query retourneert een waarde minder dan 99,9 procent voor een van de resourcedimensies drie Overweeg beide verplaatsen naar de hoger prestatieniveau of technieken afstemming van toepassingen om de belasting van de SQL-database te verminderen.</span><span class="sxs-lookup"><span data-stu-id="e869e-205">If this query returns a value less than 99.9 percent for any of the three resource dimensions, consider either moving to the next higher performance level or use application-tuning techniques to reduce the load on the SQL database.</span></span>
4. <span data-ttu-id="e869e-206">In deze oefening tevens rekening gehouden met de verwachte werkbelasting toename in de toekomst.</span><span class="sxs-lookup"><span data-stu-id="e869e-206">This exercise also considers your projected workload increase in the future.</span></span>

<span data-ttu-id="e869e-207">Voor elastische pools kunt u afzonderlijke databases in de pool bewaken met de technieken die in deze sectie zijn beschreven.</span><span class="sxs-lookup"><span data-stu-id="e869e-207">For elastic pools, you can monitor individual databases in the pool with the techniques described in this section.</span></span> <span data-ttu-id="e869e-208">U kunt echter ook de groep als geheel bewaken.</span><span class="sxs-lookup"><span data-stu-id="e869e-208">But you can also monitor the pool as a whole.</span></span> <span data-ttu-id="e869e-209">Zie [Een elastische pool bewaken en beheren](sql-database-elastic-pool-manage-portal.md) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="e869e-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="e869e-210">Maximum aantal gelijktijdige aanvragen</span><span class="sxs-lookup"><span data-stu-id="e869e-210">Maximum concurrent requests</span></span>
<span data-ttu-id="e869e-211">Overzicht van het aantal gelijktijdige aanvragen uitvoeren deze Transact-SQL-query op de SQL database:</span><span class="sxs-lookup"><span data-stu-id="e869e-211">To see the number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="e869e-212">Wijzig deze query om te filteren op specifieke database die u wilt analyseren voor het analyseren van de werkbelasting van een on-premises SQL Server database.</span><span class="sxs-lookup"><span data-stu-id="e869e-212">To analyze the workload of an on-premises SQL Server database, modify this query to filter on the specific database you want to analyze.</span></span> <span data-ttu-id="e869e-213">Bijvoorbeeld, als er een lokale database met de naam MijnDatabase, retourneert deze Transact-SQL-query het aantal gelijktijdige aanvragen in de database:</span><span class="sxs-lookup"><span data-stu-id="e869e-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns the count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="e869e-214">Dit is slechts een momentopname op één punt in tijd.</span><span class="sxs-lookup"><span data-stu-id="e869e-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="e869e-215">Als u een beter begrip van uw werkbelasting en de vereisten voor gelijktijdige aanvragen, moet u veel voorbeelden verzamelen gedurende een bepaalde periode.</span><span class="sxs-lookup"><span data-stu-id="e869e-215">To get a better understanding of your workload and concurrent request requirements, you'll need to collect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="e869e-216">Maximum aantal gelijktijdige aanmeldingen</span><span class="sxs-lookup"><span data-stu-id="e869e-216">Maximum concurrent logins</span></span>
<span data-ttu-id="e869e-217">U kunt uw gebruikers- en patronen voor een beter beeld van de frequentie van aanmeldingen analyseren.</span><span class="sxs-lookup"><span data-stu-id="e869e-217">You can analyze your user and application patterns to get an idea of the frequency of logins.</span></span> <span data-ttu-id="e869e-218">U kunt ook de werkelijke hoeveelheden in een testomgeving om ervoor te zorgen dat u bent niet kunt u door deze of andere limieten in dit artikel besproken uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="e869e-218">You also can run real-world loads in a test environment to make sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="e869e-219">Er is een enkele query of de dynamische beheerweergave (DMV) die u kunt u zien gelijktijdige aanmelding telt of de geschiedenis niet.</span><span class="sxs-lookup"><span data-stu-id="e869e-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="e869e-220">Als meerdere clients de verbindingsreeks gebruiken, verifieert de service voor elke aanmelding.</span><span class="sxs-lookup"><span data-stu-id="e869e-220">If multiple clients use the same connection string, the service authenticates each login.</span></span> <span data-ttu-id="e869e-221">Als er verbinding tegelijkertijd 10 gebruikers met een database met behulp van dezelfde gebruikersnaam en wachtwoord, zou er 10 gelijktijdige aanmeldingen.</span><span class="sxs-lookup"><span data-stu-id="e869e-221">If 10 users simultaneously connect to a database by using the same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="e869e-222">Deze beperking geldt alleen voor de duur van de aanmelding en verificatie.</span><span class="sxs-lookup"><span data-stu-id="e869e-222">This limit applies only to the duration of the login and authentication.</span></span> <span data-ttu-id="e869e-223">Als dezelfde 10 gebruikers verbinding sequentieel worden verwerkt met de database, zou het aantal gelijktijdige aanmeldingen niet groter dan 1.</span><span class="sxs-lookup"><span data-stu-id="e869e-223">If the same 10 users connect to the database sequentially, the number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="e869e-224">Op dit moment is deze limiet niet van toepassing op databases in een elastische pools.</span><span class="sxs-lookup"><span data-stu-id="e869e-224">Currently, this limit does not apply to databases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="e869e-225">Maximum aantal sessies</span><span class="sxs-lookup"><span data-stu-id="e869e-225">Maximum sessions</span></span>
<span data-ttu-id="e869e-226">Het aantal huidige actieve sessies vindt deze Transact-SQL-query op de SQL-database worden uitgevoerd:</span><span class="sxs-lookup"><span data-stu-id="e869e-226">To see the number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="e869e-227">Als u van een lokale SQL Server-werkbelasting analyseren bent, wijzigt u de query om zich te richten op een specifieke database.</span><span class="sxs-lookup"><span data-stu-id="e869e-227">If you're analyzing an on-premises SQL Server workload, modify the query to focus on a specific database.</span></span> <span data-ttu-id="e869e-228">Deze query kunt u bepalen mogelijke sessie voor de database als u overweegt naar Azure SQL Database te verplaatsen.</span><span class="sxs-lookup"><span data-stu-id="e869e-228">This query helps you determine possible session needs for the database if you are considering moving it to Azure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="e869e-229">Deze query's retourneren opnieuw een punt in tijd telling.</span><span class="sxs-lookup"><span data-stu-id="e869e-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="e869e-230">Als u meerdere steekproeven gedurende een bepaalde periode verzamelt, hebt u het beste inzicht in uw sessie gebruiken.</span><span class="sxs-lookup"><span data-stu-id="e869e-230">If you collect multiple samples over time, you’ll have the best understanding of your session use.</span></span>

<span data-ttu-id="e869e-231">Voor analyse van de SQL-Database, kunt u historische statistieken opvragen op sessies door het uitvoeren van query's de [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) weergeven en beoordelen van de **active_session_count** kolom.</span><span class="sxs-lookup"><span data-stu-id="e869e-231">For SQL Database analysis, you can get historical statistics on sessions by querying the [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing the **active_session_count** column.</span></span> 
