---
title: SQL Database-noodherstel | Microsoft Docs
description: Informatie over het herstellen van een database van een onderbreking van de regionale datacenter of mislukt met de Azure SQL Database actieve geo-replicatie en mogelijkheden van geo-herstel.
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: e33f69bf04b32a31aae3c311c41aa44e4da5016a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="restore-an-azure-sql-database-or-failover-to-a-secondary"></a><span data-ttu-id="e5add-103">Een Azure SQL Database of een failover naar een secundaire herstellen</span><span class="sxs-lookup"><span data-stu-id="e5add-103">Restore an Azure SQL Database or failover to a secondary</span></span>
<span data-ttu-id="e5add-104">Azure SQL Database biedt de volgende mogelijkheden voor het herstellen van een storing:</span><span class="sxs-lookup"><span data-stu-id="e5add-104">Azure SQL Database offers the following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="e5add-105">Actieve Geo-replicatie</span><span class="sxs-lookup"><span data-stu-id="e5add-105">Active geo-replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="e5add-106">Geo-herstel</span><span class="sxs-lookup"><span data-stu-id="e5add-106">Geo-restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="e5add-107">Zie voor meer informatie over zakelijke continuïteit-scenario's en de onderdelen van deze scenario's ondersteunen, [bedrijfscontinuïteit](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="e5add-107">To learn about business continuity scenarios and the features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-the-event-of-an-outage"></a><span data-ttu-id="e5add-108">Voorbereiden voor het geval er een storing</span><span class="sxs-lookup"><span data-stu-id="e5add-108">Prepare for the event of an outage</span></span>
<span data-ttu-id="e5add-109">Voor een correcte werking met herstel naar een ander gegevensgebied met behulp van actieve geo-replicatie of geografisch redundante back-ups moet u een server voorbereiden in een ander datacenter onderbreking om te worden van de nieuwe primaire server indien nodig ook goed gedefinieerde stappen gedocumenteerde en geteste om ervoor te zorgen een smooth hebben veroorzaakt.</span><span class="sxs-lookup"><span data-stu-id="e5add-109">For success with recovery to another data region using either active geo-replication or geo-redundant backups, you need to prepare a server in another data center outage to become the new primary server should the need arise as well as have well-defined steps documented and tested to ensure a smooth recovery.</span></span> <span data-ttu-id="e5add-110">Deze voorbereidende stappen omvatten:</span><span class="sxs-lookup"><span data-stu-id="e5add-110">These preparation steps include:</span></span>

* <span data-ttu-id="e5add-111">Identificeer de logische server in een andere regio worden de nieuwe primaire server.</span><span class="sxs-lookup"><span data-stu-id="e5add-111">Identify the logical server in another region to become the new primary server.</span></span> <span data-ttu-id="e5add-112">Met actieve geo-replicatie, wordt dit ten minste één en mogelijk een van de secundaire servers zijn.</span><span class="sxs-lookup"><span data-stu-id="e5add-112">With active geo-replication, this will be at least one and perhaps each of the secondary servers.</span></span> <span data-ttu-id="e5add-113">Geo-Herstel dit in het algemeen is een server in de [gekoppelde regio](../best-practices-availability-paired-regions.md) voor de regio waar uw database zich bevindt.</span><span class="sxs-lookup"><span data-stu-id="e5add-113">For geo-restore, this will generally be a server in the [paired region](../best-practices-availability-paired-regions.md) for the region in which your database is located.</span></span>
* <span data-ttu-id="e5add-114">Identificeren en eventueel definieert, de firewallregels voor een niveau van de server nodig is voor gebruikers toegang krijgen tot de nieuwe primaire database op.</span><span class="sxs-lookup"><span data-stu-id="e5add-114">Identify, and optionally define, the server-level firewall rules needed on for users to access the new primary database.</span></span>
* <span data-ttu-id="e5add-115">Bepalen hoe u gaat om gebruikers te leiden naar de nieuwe primaire server, zoals door verbindingsreeksen wijzigen of door het wijzigen van DNS-vermeldingen.</span><span class="sxs-lookup"><span data-stu-id="e5add-115">Determine how you are going to redirect users to the new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="e5add-116">Identificeren en u kunt maken met de aanmeldingen die moeten worden gebruikt in de hoofddatabase op de nieuwe primaire server en zorg ervoor dat deze aanmeldingen geschikte machtigingen hebben in de database master, indien van toepassing.</span><span class="sxs-lookup"><span data-stu-id="e5add-116">Identify, and optionally create, the logins that must be present in the master database on the new primary server, and ensure these logins have appropriate permissions in the master database, if any.</span></span> <span data-ttu-id="e5add-117">Zie voor meer informatie [beveiliging van SQL Database na het herstel na noodgevallen](sql-database-geo-replication-security-config.md)</span><span class="sxs-lookup"><span data-stu-id="e5add-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="e5add-118">Regels voor waarschuwingen die moeten worden bijgewerkt om te worden toegewezen aan de nieuwe primaire database identificeren.</span><span class="sxs-lookup"><span data-stu-id="e5add-118">Identify alert rules that will need to be updated to map to the new primary database.</span></span>
* <span data-ttu-id="e5add-119">Documenteer de controle-configuratie op de huidige primaire database</span><span class="sxs-lookup"><span data-stu-id="e5add-119">Document the auditing configuration on the current primary database</span></span>
* <span data-ttu-id="e5add-120">Voer een [disaster recovery inzoomen](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="e5add-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="e5add-121">U kunt om te simuleren een storing voor geo-herstel, verwijderen of wijzig de naam van de brondatabase als u de toepassing verbindingsfout optreedt.</span><span class="sxs-lookup"><span data-stu-id="e5add-121">To simulate an outage for geo-restore, you can delete or rename the source database to cause application connectivity failure.</span></span> <span data-ttu-id="e5add-122">Om te simuleren een storing voor actieve geo-replicatie, kunt u de webtoepassing of de virtuele machine verbonden met de database of failover van de database om te leiden tot problemen met de toepassingen kunt uitschakelen.</span><span class="sxs-lookup"><span data-stu-id="e5add-122">To simulate an outage for active geo-replication, you can disable the web application or virtual machine connected to the database or failover the database to cause application connectivity failures.</span></span>

## <a name="when-to-initiate-recovery"></a><span data-ttu-id="e5add-123">Wanneer u herstel Start</span><span class="sxs-lookup"><span data-stu-id="e5add-123">When to initiate recovery</span></span>
<span data-ttu-id="e5add-124">De herstelbewerking heeft gevolgen voor de toepassing.</span><span class="sxs-lookup"><span data-stu-id="e5add-124">The recovery operation impacts the application.</span></span> <span data-ttu-id="e5add-125">Het wijzigen van de SQL-verbindingsreeks of met behulp van DNS-omleiding is vereist en kan leiden tot permanent verlies van gegevens.</span><span class="sxs-lookup"><span data-stu-id="e5add-125">It requires changing the SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="e5add-126">Daarom mag deze alleen worden uitgevoerd wanneer de onderbreking is waarschijnlijk langer dan de beoogde hersteltijd van uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="e5add-126">Therefore, it should be done only when the outage is likely to last longer than your application's recovery time objective.</span></span> <span data-ttu-id="e5add-127">Wanneer de toepassing wordt geïmplementeerd naar productie moet u reguliere bewaking van de toepassingsstatus uitvoeren en dat het herstel is gerechtvaardigd assert met de volgende gegevenspunten:</span><span class="sxs-lookup"><span data-stu-id="e5add-127">When the application is deployed to production you should perform regular monitoring of the application health and use the following data points to assert that the recovery is warranted:</span></span>

1. <span data-ttu-id="e5add-128">Permanente verbinding is mislukt van de tier toepassing naar de database.</span><span class="sxs-lookup"><span data-stu-id="e5add-128">Permanent connectivity failure from the application tier to the database.</span></span>
2. <span data-ttu-id="e5add-129">De Azure-portal geeft een waarschuwing over een incident in de regio met brede gevolgen.</span><span class="sxs-lookup"><span data-stu-id="e5add-129">The Azure portal shows an alert about an incident in the region with broad impact.</span></span>
3. <span data-ttu-id="e5add-130">De Azure SQL Database-server wordt gemarkeerd als beschadigd.</span><span class="sxs-lookup"><span data-stu-id="e5add-130">The Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="e5add-131">U kunt de volgende herstelopties overwegen, afhankelijk van uw toepassing tolerantie uitvaltijd en mogelijke business aansprakelijkheid.</span><span class="sxs-lookup"><span data-stu-id="e5add-131">Depending on your application tolerance to downtime and possible business liability you can consider the following recovery options.</span></span>

<span data-ttu-id="e5add-132">Gebruik de [herstelbare Database ophalen](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) om op te halen van de meest recente herstelpunt voor Geo-replicatie.</span><span class="sxs-lookup"><span data-stu-id="e5add-132">Use the [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) to get the latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="e5add-133">Wachttijd voor het herstel</span><span class="sxs-lookup"><span data-stu-id="e5add-133">Wait for service recovery</span></span>
<span data-ttu-id="e5add-134">Het werk Azure teams naar eer en geweten om terug te zetten van de beschikbaarheid van services zoals snel, afhankelijk van de hoofdmap, maar mogelijk tot gevolg hebben dat kan uren of dagen duren.</span><span class="sxs-lookup"><span data-stu-id="e5add-134">The Azure teams work diligently to restore service availability as quickly as possible but depending on the root cause it can take hours or days.</span></span>  <span data-ttu-id="e5add-135">Als uw toepassing aanzienlijke downtime tolereren kan kunt u gewoon wacht u totdat het herstel te voltooien.</span><span class="sxs-lookup"><span data-stu-id="e5add-135">If your application can tolerate significant downtime you can simply wait for the recovery to complete.</span></span> <span data-ttu-id="e5add-136">In dit geval is geen actie ondernemen vereist.</span><span class="sxs-lookup"><span data-stu-id="e5add-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="e5add-137">U ziet de status van de huidige op onze [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="e5add-137">You can see the current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="e5add-138">Na het herstel van de regio wordt van uw toepassing beschikbaarheid hersteld.</span><span class="sxs-lookup"><span data-stu-id="e5add-138">After the recovery of the region your application’s availability will be restored.</span></span>

## <a name="fail-over-to-geo-replicated-secondary-database"></a><span data-ttu-id="e5add-139">Failover naar de database op secundaire geo-replicatie</span><span class="sxs-lookup"><span data-stu-id="e5add-139">Fail over to geo-replicated secondary database</span></span>
<span data-ttu-id="e5add-140">Als uitvaltijd van uw toepassing tot zakelijke aansprakelijkheid leiden kan moet u databases geo-replicatie in uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="e5add-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="e5add-141">De toepassing voor snel herstel beschikbaarheid in een andere regio bij een stroomstoring wordt het ingeschakeld.</span><span class="sxs-lookup"><span data-stu-id="e5add-141">It will enable the application to quickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="e5add-142">Meer informatie over hoe [geo-replicatie configureren](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="e5add-142">Learn how to [configure geo-replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="e5add-143">U moet Start de failover naar de secundaire geo-replicatie met een van de ondersteunde methoden voor het herstellen van de beschikbaarheid van de databases.</span><span class="sxs-lookup"><span data-stu-id="e5add-143">To restore availability of the database(s) you need to initiate the failover to the geo-replicated secondary using one of the supported methods.</span></span>

<span data-ttu-id="e5add-144">Gebruik een van de volgende handleidingen failover naar een geo-replicatie secundaire database:</span><span class="sxs-lookup"><span data-stu-id="e5add-144">Use one of the following guides to fail over to a geo-replicated secondary database:</span></span>

* [<span data-ttu-id="e5add-145">Failover naar een secundaire geo-replicatie met Azure Portal</span><span class="sxs-lookup"><span data-stu-id="e5add-145">Fail over to a geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="e5add-146">Failover naar een secundaire geo-replicatie met PowerShell</span><span class="sxs-lookup"><span data-stu-id="e5add-146">Fail over to a geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="e5add-147">Failover naar een secundaire geo-replicatie met T-SQL</span><span class="sxs-lookup"><span data-stu-id="e5add-147">Fail over to a geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="e5add-148">Herstellen met behulp van geo-herstel</span><span class="sxs-lookup"><span data-stu-id="e5add-148">Recover using geo-restore</span></span>
<span data-ttu-id="e5add-149">Als uw toepassing uitvaltijd niet in business aansprakelijkheid resulteert kunt u [geo-restore](sql-database-recovery-using-backups.md) als een methode voor het herstellen van de databases van uw toepassing.</span><span class="sxs-lookup"><span data-stu-id="e5add-149">If your application’s downtime does not result in business liability you can use [geo-restore](sql-database-recovery-using-backups.md) as a method to recover your application database(s).</span></span> <span data-ttu-id="e5add-150">Een kopie van de database wordt gemaakt van de meest recente geografisch redundante back-up.</span><span class="sxs-lookup"><span data-stu-id="e5add-150">It creates a copy of the database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="e5add-151">Uw database na herstel configureren</span><span class="sxs-lookup"><span data-stu-id="e5add-151">Configure your database after recovery</span></span>
<span data-ttu-id="e5add-152">Als u gebruikmaakt van geo-replicatie, failover of geo-herstel van een storing wilt herstellen, moet u ervoor zorgen dat de verbinding met de nieuwe databases correct is geconfigureerd, zodat de normale toepassing-functie kan worden hervat.</span><span class="sxs-lookup"><span data-stu-id="e5add-152">If you are using either geo-replication failover or geo-restore to recover from an outage, you must make sure that the connectivity to the new databases is properly configured so that the normal application function can be resumed.</span></span> <span data-ttu-id="e5add-153">Dit is een controlelijst van taken bij het klaarstomen van uw productieomgeving herstelde database.</span><span class="sxs-lookup"><span data-stu-id="e5add-153">This is a checklist of tasks to get your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="e5add-154">Verbindingstekenreeksen bijwerken</span><span class="sxs-lookup"><span data-stu-id="e5add-154">Update connection strings</span></span>
<span data-ttu-id="e5add-155">Omdat de herstelde database bevindt zich in een andere server, moet u de verbindingsreeks van uw toepassing om te verwijzen naar die server bijwerken.</span><span class="sxs-lookup"><span data-stu-id="e5add-155">Because your recovered database will reside in a different server, you need to update your application’s connection string to point to that server.</span></span>

<span data-ttu-id="e5add-156">Zie voor meer informatie over het wijzigen van tekenreeksen voor de ontwikkeling van de juiste taal voor uw [verbindingsbibliotheek](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="e5add-156">For more information about changing connection strings, see the appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="e5add-157">Firewallregels configureren</span><span class="sxs-lookup"><span data-stu-id="e5add-157">Configure Firewall Rules</span></span>
<span data-ttu-id="e5add-158">U moet ervoor zorgen dat de firewallregels voor server en de database geconfigureerd overeenkomen met die die zijn geconfigureerd op de primaire server en de primaire database.</span><span class="sxs-lookup"><span data-stu-id="e5add-158">You need to make sure that the firewall rules configured on server and on the database match those that were configured on the primary server and primary database.</span></span> <span data-ttu-id="e5add-159">Zie voor meer informatie [procedure: Firewall-instellingen configureren (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="e5add-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="e5add-160">Aanmeldingen en databasegebruikers configureren</span><span class="sxs-lookup"><span data-stu-id="e5add-160">Configure logins and database users</span></span>
<span data-ttu-id="e5add-161">U moet ervoor zorgen dat alle aanmeldingen gebruikt door de toepassing bestaat op de server die als host de herstelde database fungeert.</span><span class="sxs-lookup"><span data-stu-id="e5add-161">You need to make sure that all the logins used by your application exist on the server which is hosting your recovered database.</span></span> <span data-ttu-id="e5add-162">Zie voor meer informatie [beveiligingsconfiguratie voor de geo-replicatie](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="e5add-162">For more information, see [Security Configuration for geo-replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="e5add-163">U moet configureren en testen van de firewallregels voor server en aanmeldingen (en hun machtigingen) tijdens een herstel na noodgevallen detailanalyse.</span><span class="sxs-lookup"><span data-stu-id="e5add-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="e5add-164">Deze objecten van het niveau van de server en de bijbehorende configuratie mogelijk niet beschikbaar tijdens de onderbreking.</span><span class="sxs-lookup"><span data-stu-id="e5add-164">These server-level objects and their configuration may not be available during the outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="e5add-165">Telemetrie-waarschuwingen instellen</span><span class="sxs-lookup"><span data-stu-id="e5add-165">Setup telemetry alerts</span></span>
<span data-ttu-id="e5add-166">Zo moet u ervoor dat de bestaande instellingen voor de waarschuwingsregel worden bijgewerkt als u wilt toewijzen aan de herstelde database en de andere server.</span><span class="sxs-lookup"><span data-stu-id="e5add-166">You need to make sure your existing alert rule settings are updated to map to the recovered database and the different server.</span></span>

<span data-ttu-id="e5add-167">Zie voor meer informatie over database waarschuwingsregels [waarschuwing meldingen ontvangen](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) en [bijhouden servicestatus](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="e5add-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="e5add-168">Controle inschakelen</span><span class="sxs-lookup"><span data-stu-id="e5add-168">Enable auditing</span></span>
<span data-ttu-id="e5add-169">Als controle is vereist voor toegang tot uw database, moet u controleren na het databaseherstel van de inschakelen.</span><span class="sxs-lookup"><span data-stu-id="e5add-169">If auditing is required to access your database, you need to enable Auditing after the database recovery.</span></span> <span data-ttu-id="e5add-170">Zie voor meer informatie [Databasecontrole](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="e5add-170">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e5add-171">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="e5add-171">Next steps</span></span>
* <span data-ttu-id="e5add-172">Voor meer informatie over Azure SQL Database geautomatiseerde back-ups, Zie [geautomatiseerde back-ups van SQL-Database](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="e5add-172">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="e5add-173">Zie voor meer informatie over zakelijke continuïteit ontwerp- en herstelinstellingen scenario's [continuïteit scenario's](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="e5add-173">To learn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="e5add-174">Zie voor meer informatie over het gebruik van automatische back-ups voor herstel, [een database herstellen vanuit back-ups service is gestart](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="e5add-174">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>

