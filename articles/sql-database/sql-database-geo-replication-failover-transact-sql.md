---
title: TSQL:initiate failover voor Azure SQL Database | Microsoft Docs
description: Start een geplande of niet-geplande failover voor Azure SQL Database met behulp van Transact-SQL
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="88ac3-103">Een geplande of niet-geplande failover initiÃ«ren voor Azure SQL Database met Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="88ac3-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="88ac3-104">Dit artikel ziet u hoe tooinitiate failover tooa secundaire SQL-Database met behulp van Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="88ac3-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="88ac3-105">tooconfigure geo-replicatie, Zie [geo-replicatie configureren voor Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="88ac3-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="88ac3-106">tooinitiate failover, moet u de volgende Hallo:</span><span class="sxs-lookup"><span data-stu-id="88ac3-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="88ac3-107">Een aanmelding die DBManager op Hallo primaire</span><span class="sxs-lookup"><span data-stu-id="88ac3-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="88ac3-108">Hebt u db_ownership van Hallo lokale database dat u geo-replicatie gaat</span><span class="sxs-lookup"><span data-stu-id="88ac3-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="88ac3-109">DBManager worden op Hallo partner (s) toowhich configureert u geo-replicatie</span><span class="sxs-lookup"><span data-stu-id="88ac3-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="88ac3-110">Meest recente versie van SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="88ac3-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="88ac3-111">Het verdient aanbeveling dat u altijd hello gebruiken meest recente versie van Management Studio tooremain gesynchroniseerd met updates tooMicrosoft Azure en SQL-Database.</span><span class="sxs-lookup"><span data-stu-id="88ac3-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="88ac3-112">[SQL Server Management Studio bijwerken](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="88ac3-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="88ac3-113">Start een geplande failover promoveren van een secundaire database toobecome Hallo nieuwe primaire</span><span class="sxs-lookup"><span data-stu-id="88ac3-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="88ac3-114">U kunt Hallo **ALTER DATABASE** instructie toopromote een secundaire database toobecome Hallo nieuwe primaire database op een geplande wijze, degraderen van de bestaande primaire toobecome Hallo een secundaire database.</span><span class="sxs-lookup"><span data-stu-id="88ac3-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="88ac3-115">Deze instructie is uitgevoerd voor de hoofddatabase Hallo op Hallo Azure SQL Database logische server in welke Hallo geo-replicatie secundaire database die wordt gepromoveerd zich bevindt.</span><span class="sxs-lookup"><span data-stu-id="88ac3-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="88ac3-116">Deze functionaliteit is ontworpen voor geplande failover, zoals tijdens Hallo DR-zoomt en vereist dat de primaire database Hallo beschikbaar zijn.</span><span class="sxs-lookup"><span data-stu-id="88ac3-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="88ac3-117">Hallo-opdracht verricht Hallo workflow volgen:</span><span class="sxs-lookup"><span data-stu-id="88ac3-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="88ac3-118">Tijdelijk leeggemaakte switches toosynchronous replicatiemodus, waardoor alle openstaande transacties toobe toohello secundaire en de blokkering van alle nieuwe transacties;</span><span class="sxs-lookup"><span data-stu-id="88ac3-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="88ac3-119">Switches Hallo rollen van de twee databases Hallo Hallo geo-replicatie samen.</span><span class="sxs-lookup"><span data-stu-id="88ac3-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="88ac3-120">Deze reeks wordt gegarandeerd dat Hallo twee databases zijn gesynchroniseerd voordat Hallo rollen switch en daarom geen verlies van gegevens wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="88ac3-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="88ac3-121">Er is een korte periode gedurende welke beide databases niet beschikbaar (in volgorde van de Hallo van 0 too25 seconden zijn) tijdens het Hallo-rollen worden omgeschakeld.</span><span class="sxs-lookup"><span data-stu-id="88ac3-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="88ac3-122">Als de primaire database Hallo meerdere secundaire databases, Hallo-opdracht heeft wordt automatisch opnieuw Hallo andere secundaire replica's tooconnect toohello nieuwe primaire.</span><span class="sxs-lookup"><span data-stu-id="88ac3-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="88ac3-123">Hallo hele bewerking duurt minder dan een minuut toocomplete onder normale omstandigheden.</span><span class="sxs-lookup"><span data-stu-id="88ac3-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="88ac3-124">Zie voor meer informatie [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) en [Servicelagen](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="88ac3-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="88ac3-125">Gebruik Hallo stappen tooinitiate een geplande failover te volgen.</span><span class="sxs-lookup"><span data-stu-id="88ac3-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="88ac3-126">In Management Studio verbinding met toohello Azure SQL Database logische server waarin een geo-replicatie secundaire database zich bevindt.</span><span class="sxs-lookup"><span data-stu-id="88ac3-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="88ac3-127">Open de map Hallo-Databases, vouw Hallo **systeemdatabases** map, klik met de rechtermuisknop op **master**, en klik vervolgens op **nieuwe Query**.</span><span class="sxs-lookup"><span data-stu-id="88ac3-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="88ac3-128">Gebruik de volgende Hallo **ALTER DATABASE** instructie tooswitch Hallo secundaire database toohello primaire rol.</span><span class="sxs-lookup"><span data-stu-id="88ac3-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="88ac3-129">Klik op **Execute** toorun Hallo query.</span><span class="sxs-lookup"><span data-stu-id="88ac3-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="88ac3-130">In zeldzame gevallen is het mogelijk dat Hallo-bewerking kan niet worden voltooid en vastgelopen lijkt.</span><span class="sxs-lookup"><span data-stu-id="88ac3-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="88ac3-131">Hallo-gebruiker kan in dit geval Hallo force failover-opdracht uitvoeren en verlies van gegevens te accepteren.</span><span class="sxs-lookup"><span data-stu-id="88ac3-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="88ac3-132">Start een niet-geplande failover uit Hallo primaire database toohello secundaire database</span><span class="sxs-lookup"><span data-stu-id="88ac3-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="88ac3-133">U kunt Hallo **ALTER DATABASE** instructie toopromote een secundaire database toobecome Hallo nieuwe primaire database op een niet-geplande wijze, waardoor Hallo degradatie van de bestaande primaire toobecome Hallo een secundaire database op een tijdstip wanneer Hallo primaire database is niet meer beschikbaar.</span><span class="sxs-lookup"><span data-stu-id="88ac3-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="88ac3-134">Deze instructie is uitgevoerd voor de hoofddatabase Hallo op Hallo Azure SQL Database logische server in welke Hallo geo-replicatie secundaire database die wordt gepromoveerd zich bevindt.</span><span class="sxs-lookup"><span data-stu-id="88ac3-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="88ac3-135">Deze functionaliteit is ontworpen voor herstel na noodgevallen wanneer herstellen beschikbaarheid voor Hallo-database is van essentieel belang en er gegevens verloren gaan acceptabel is.</span><span class="sxs-lookup"><span data-stu-id="88ac3-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="88ac3-136">Wanneer geforceerde failover wordt gestart, opgegeven Hallo secundaire database onmiddellijk wordt het Hallo primaire database en begint schrijftransacties accepteren.</span><span class="sxs-lookup"><span data-stu-id="88ac3-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="88ac3-137">Als de oorspronkelijke primaire database Hallo kunnen tooreconnect met deze nieuwe primaire database is, een incrementele back-up wordt gemaakt op de oorspronkelijke primaire database Hallo en Hallo oude primaire database wordt gemaakt in een secundaire database voor de nieuwe primaire database Hallo; het is alleen een synchroniseren replica van de nieuwe primaire Hallo.</span><span class="sxs-lookup"><span data-stu-id="88ac3-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="88ac3-138">Echter, omdat punt In tijd herstellen niet wordt ondersteund op Hallo secundaire databases als Hallo gebruiker toorecover gegevens die zijn toegewezen wenst toohello oude primaire database die niet is gerepliceerd toohello nieuwe primaire database voordat Hallo geforceerde failover is opgetreden, Hallo gebruiker moet tooengage ondersteuning toorecover dit gegevens verloren gegaan.</span><span class="sxs-lookup"><span data-stu-id="88ac3-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="88ac3-139">Als de primaire database Hallo meerdere secundaire databases, Hallo-opdracht heeft wordt automatisch opnieuw Hallo andere secundaire replica's tooconnect toohello nieuwe primaire.</span><span class="sxs-lookup"><span data-stu-id="88ac3-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="88ac3-140">Gebruik Hallo stappen tooinitiate een niet-geplande failover te volgen.</span><span class="sxs-lookup"><span data-stu-id="88ac3-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="88ac3-141">In Management Studio verbinding met toohello Azure SQL Database logische server waarin een geo-replicatie secundaire database zich bevindt.</span><span class="sxs-lookup"><span data-stu-id="88ac3-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="88ac3-142">Open de map Hallo-Databases, vouw Hallo **systeemdatabases** map, klik met de rechtermuisknop op **master**, en klik vervolgens op **nieuwe Query**.</span><span class="sxs-lookup"><span data-stu-id="88ac3-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="88ac3-143">Gebruik de volgende Hallo **ALTER DATABASE** instructie tooswitch Hallo secundaire database toohello primaire rol.</span><span class="sxs-lookup"><span data-stu-id="88ac3-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="88ac3-144">Klik op **Execute** toorun Hallo query.</span><span class="sxs-lookup"><span data-stu-id="88ac3-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="88ac3-145">Als het Hallo-opdracht wordt verstrekt wanneer zowel primaire als secundaire online oude primaire hello, worden nieuwe secundaire onmiddellijk zonder gegevenssynchronisatie Hallo.</span><span class="sxs-lookup"><span data-stu-id="88ac3-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="88ac3-146">Als primaire Hallo optreden doorvoeren van transacties wanneer Hallo-opdracht wordt gegeven kunnen gegevens verloren gaan.</span><span class="sxs-lookup"><span data-stu-id="88ac3-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="88ac3-147">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="88ac3-147">Next steps</span></span>
* <span data-ttu-id="88ac3-148">Controleert de verificatievereisten Hallo voor uw server en database zijn geconfigureerd op de nieuwe primaire Hallo na een failover.</span><span class="sxs-lookup"><span data-stu-id="88ac3-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="88ac3-149">Zie voor meer informatie [beveiliging van SQL Database na het herstel na noodgevallen](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="88ac3-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="88ac3-150">Zie toolearn herstellen na een noodgeval van actieve geo-replicatie, inclusief stappen voor herstel vÃ³Ã³r en na het herstel en het uitvoeren van een detailanalyse van het herstel na noodgevallen [herstel na noodgevallen](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="88ac3-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="88ac3-151">Zie voor een blogbericht Sasha Nosov over actieve geo-replicatie, [Spotlight op nieuwe mogelijkheden van geo-replicatie](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="88ac3-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="88ac3-152">Zie voor meer informatie over het ontwerpen van cloud-toepassingen toouse actieve geo-replicatie [cloud-toepassingen ontwerpen voor bedrijfscontinuÃ¯teit van geo-replicatie](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="88ac3-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="88ac3-153">Zie voor meer informatie over het gebruik van actieve geo-replicatie met elastische pools [elastische Pool disaster recovery strategieÃ«n](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="88ac3-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="88ac3-154">Zie voor een overzicht van zakelijke continuÃ¯teit [Business Continuity Overview](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="88ac3-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>

