---
title: aaaRun ad-hocquery analytics's over meerdere Azure SQL-databases | Microsoft Docs
description: Ad-hoc analytics query's via meerdere SQL-databases in Hallo Wingtip SaaS multitenant app uitvoeren.
keywords: zelfstudie sql-database
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: 140cd51fdd03b5a548147282b51ceb0ad80c944d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="04916-104">Ad-hoc analytics query's uitvoeren op alle Wingtip SaaS-tenants</span><span class="sxs-lookup"><span data-stu-id="04916-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="04916-105">In deze zelfstudie maakt uitvoeren u gedistribueerde query's op Hallo volledige set van databases van de tenant tooenable ad-hoc analytics.</span><span class="sxs-lookup"><span data-stu-id="04916-105">In this tutorial, you run distributed queries across hello entire set of tenant databases tooenable ad-hoc analytics.</span></span> <span data-ttu-id="04916-106">Elastische Query gebruikte tooenable gedistribueerde query's, is hiervoor een extra analytics-database wordt geïmplementeerd (toohello catalogusserver).</span><span class="sxs-lookup"><span data-stu-id="04916-106">Elastic Query is used tooenable distributed queries, which requires an additional analytics database is deployed (toohello catalog server).</span></span> <span data-ttu-id="04916-107">Deze query's kunnen overspoeld in Hallo dagelijkse operationele gegevens van Hallo Wingtip SaaS app insights extraheren.</span><span class="sxs-lookup"><span data-stu-id="04916-107">These queries can extract insights buried in hello day-to-day operational data of hello Wingtip SaaS app.</span></span>


<span data-ttu-id="04916-108">In deze zelfstudie komen deze onderwerpen aan bod:</span><span class="sxs-lookup"><span data-stu-id="04916-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="04916-109">Hallo globale weergaven in elke database waardoor efficiënter uitvoeren van query's over tenants</span><span class="sxs-lookup"><span data-stu-id="04916-109">About hello global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="04916-110">Hoe toodeploy een ad-hoc analytics-database</span><span class="sxs-lookup"><span data-stu-id="04916-110">How toodeploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="04916-111">Hoe toorun query's verdeeld over alle databases voor tenant</span><span class="sxs-lookup"><span data-stu-id="04916-111">How toorun distributed queries across all tenant databases</span></span>



<span data-ttu-id="04916-112">toocomplete in deze zelfstudie, zorg ervoor dat Hallo volgende vereisten zijn voltooid:</span><span class="sxs-lookup"><span data-stu-id="04916-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="04916-113">Hallo Wingtip SaaS-app wordt geïmplementeerd.</span><span class="sxs-lookup"><span data-stu-id="04916-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="04916-114">Zie toodeploy in minder dan vijf minuten [implementeren en verkennen Hallo Wingtip SaaS-toepassing](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="04916-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="04916-115">Azure PowerShell is geïnstalleerd.</span><span class="sxs-lookup"><span data-stu-id="04916-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="04916-116">Zie [Aan de slag met Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="04916-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="04916-117">SQL Server Management Studio (SSMS) is geïnstalleerd.</span><span class="sxs-lookup"><span data-stu-id="04916-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="04916-118">toodownload en installeer SSMS, Zie [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="04916-118">toodownload and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="04916-119">Ad-hoc analytics patroon</span><span class="sxs-lookup"><span data-stu-id="04916-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="04916-120">Een van de grote kansen Hallo met SaaS-toepassingen is toouse Hallo enorme hoeveelheid tenant gegevens centraal worden opgeslagen in de cloud Hallo.</span><span class="sxs-lookup"><span data-stu-id="04916-120">One of hello great opportunities with SaaS applications is toouse hello vast amount of tenant data stored centrally in hello cloud.</span></span> <span data-ttu-id="04916-121">Gebruik deze gegevens toogain inzichten Hallo bewerking en het gebruik van uw toepassing, uw tenants, hun gebruikers, voorkeuren, gedrag, enzovoort. Deze inzichten kunnen leiden functie ontwikkeling, bruikbaarheid verbeteringen en andere investeringen in uw apps en services.</span><span class="sxs-lookup"><span data-stu-id="04916-121">Use this data toogain insights into hello operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="04916-122">U kunt gemakkelijk toegang tot deze gegevens krijgen in een database met meerdere tenants, maar dit is niet zo gemakkelijk als de gegevens op schaal zijn verdeeld over misschien wel duizenden databases.</span><span class="sxs-lookup"><span data-stu-id="04916-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="04916-123">Een aanpak is toouse [elastische Query](sql-database-elastic-query-overview.md), waardoor query in een gedistribueerde set van databases met algemene schema.</span><span class="sxs-lookup"><span data-stu-id="04916-123">One approach is toouse [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="04916-124">Elastische Query gebruikt een enkel *head* database waarin externe tabellen worden gedefinieerd met het mirror-tabellen of weergaven in hello (tenant)-databases wordt gedistribueerd.</span><span class="sxs-lookup"><span data-stu-id="04916-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in hello distributed (tenant) databases.</span></span> <span data-ttu-id="04916-125">Query's verzonden toothis head database zijn gecompileerde tooproduce een plan gedistribueerde query met delen van Hallo query omlaag toohello tenant databases gedrukt, indien nodig.</span><span class="sxs-lookup"><span data-stu-id="04916-125">Queries submitted toothis head database are compiled tooproduce a distributed query plan, with portions of hello query pushed down toohello tenant databases as needed.</span></span> <span data-ttu-id="04916-126">Elastische Query gebruikt Hallo shard-toewijzing in Hallo catalogus tooprovide Hallo databaselocatie van Hallo tenant databases.</span><span class="sxs-lookup"><span data-stu-id="04916-126">Elastic Query uses hello shard map in hello catalog database tooprovide hello location of hello tenant databases.</span></span> <span data-ttu-id="04916-127">Installatie en query zijn simpel met behulp van standaard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), en ondersteuning voor ad-hoc opvragen van hulpprogramma's zoals Power BI en Excel.</span><span class="sxs-lookup"><span data-stu-id="04916-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="04916-128">Door query's over Hallo tenant databases verdeeld, biedt elastische Query onmiddellijk inzicht in live productiegegevens.</span><span class="sxs-lookup"><span data-stu-id="04916-128">By distributing queries across hello tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="04916-129">Als elastische Query gegevens op uit mogelijk veel databases haalt, verzonden query latentie kan soms hoger zijn dan voor gelijkwaardige query's tooa één multitenant-database.</span><span class="sxs-lookup"><span data-stu-id="04916-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted tooa single multi-tenant database.</span></span> <span data-ttu-id="04916-130">Voorzichtig bij het ontwerpen van query's toominimize Hallo gegevens die worden geretourneerd.</span><span class="sxs-lookup"><span data-stu-id="04916-130">Care should be taken when designing queries toominimize hello data that is returned.</span></span> <span data-ttu-id="04916-131">Elastische Query is vaak het meest geschikt voor kleine hoeveelheden realtime gegevens opvragen als tegengestelde toobuilding veelgebruikte of complexe analytics query's of rapporten.</span><span class="sxs-lookup"><span data-stu-id="04916-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed toobuilding frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="04916-132">Als het uitvoeren van query's niet goed, bekijkt hello [uitvoeringsplan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee welk gedeelte van het Hallo-query heeft omlaag toohello externe database en hoeveel gegevens wordt geretourneerd is gedrukt.</span><span class="sxs-lookup"><span data-stu-id="04916-132">If queries don't perform well, look at hello [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee what part of hello query has been pushed down toohello remote database and how much data is being returned.</span></span> <span data-ttu-id="04916-133">Query's waarvoor complexe analytische verwerking is wellicht beter afgehandeld in sommige gevallen door tenant-gegevens in te pakken op een specifieke database of het datawarehouse is geoptimaliseerd voor analysequery's.</span><span class="sxs-lookup"><span data-stu-id="04916-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="04916-134">Dit patroon wordt uitgelegd in Hallo [tenant analytics zelfstudie](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="04916-134">This pattern is explained in hello [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="04916-135">Hallo Wingtip toepassingsscripts ophalen</span><span class="sxs-lookup"><span data-stu-id="04916-135">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="04916-136">Hallo Wingtip SaaS-scripts en broncode van toepassing zijn beschikbaar in Hallo [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github-opslagplaats.</span><span class="sxs-lookup"><span data-stu-id="04916-136">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="04916-137">[Stappen toodownload Hallo Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="04916-137">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="04916-138">Ticket verkoopgegevens maken</span><span class="sxs-lookup"><span data-stu-id="04916-138">Create ticket sales data</span></span>

<span data-ttu-id="04916-139">toorun query's op basis van een gegevensset interessanter maken ticket verkoopgegevens met Hallo ticket-generator.</span><span class="sxs-lookup"><span data-stu-id="04916-139">toorun queries against a more interesting data set, create ticket sales data by running hello ticket-generator.</span></span>

1. <span data-ttu-id="04916-140">In Hallo *PowerShell ISE*Open Hallo... \\Learning-Modules\\operationele Analytics\\ad-hoc Analytics\\*Demo AdhocAnalytics.ps1* script en stel Hallo volgende waarden:</span><span class="sxs-lookup"><span data-stu-id="04916-140">In hello *PowerShell ISE*, open hello ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set hello following values:</span></span>
   * <span data-ttu-id="04916-141">**$DemoScenario** = 1, **tickets voor gebeurtenissen op alle plaatsen aanschaffen**.</span><span class="sxs-lookup"><span data-stu-id="04916-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="04916-142">Druk op **F5** Hallo-script uitvoeren en ticket verkoop genereren.</span><span class="sxs-lookup"><span data-stu-id="04916-142">Press **F5** to run hello script and generate ticket sales.</span></span> <span data-ttu-id="04916-143">Tijdens het Hallo-script wordt uitgevoerd, blijven Hallo stappen in deze zelfstudie.</span><span class="sxs-lookup"><span data-stu-id="04916-143">While hello script is running, continue hello steps in this tutorial.</span></span> <span data-ttu-id="04916-144">Hallo ticket gegevens query wordt uitgevoerd in Hallo *ad-hoc gedistribueerde query's uitvoeren* sectie, dus als deze nog wordt uitgevoerd als u krijgt dat oefening toothat Hallo ticket generator toocomplete wachten.</span><span class="sxs-lookup"><span data-stu-id="04916-144">hello ticket data is queried in hello *Run ad-hoc distributed queries* section, so wait for hello ticket generator toocomplete if it's still running when you get toothat exercise.</span></span>

## <a name="explore-hello-global-views"></a><span data-ttu-id="04916-145">Algemene weergaven Hallo verkennen</span><span class="sxs-lookup"><span data-stu-id="04916-145">Explore hello global views</span></span>

<span data-ttu-id="04916-146">Hallo Wingtip SaaS-toepassing is gebouwd met behulp van een model tenant per database zodat Hallo tenant-databaseschema vanuit het perspectief van een één-tenant is gedefinieerd.</span><span class="sxs-lookup"><span data-stu-id="04916-146">hello Wingtip SaaS application is built using a tenant-per-database model, so hello tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="04916-147">Tenant-specifieke informatie in een tabel bestaat *wilt*, die altijd is één rij en wordt geïmplementeerd als een heap, zonder een primaire sleutel.</span><span class="sxs-lookup"><span data-stu-id="04916-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="04916-148">Andere tabellen in het schema Hallo hoeft niet toobe gerelateerde toohello *wetten* tabel, omdat bij normaal gebruik er nooit twijfel welke tenant Hallo gegevens behoort.</span><span class="sxs-lookup"><span data-stu-id="04916-148">Other tables in hello schema don't need toobe related toohello *Venue* table, because in normal use, there is never any doubt which tenant hello data belongs to.</span></span>

<span data-ttu-id="04916-149">Bij het uitvoeren van query's voor alle databases, is het echter belangrijk dat elastische Query Hallo-gegevens kunnen worden behandeld alsof deze een onderdeel van één logische database shard door tenant is.</span><span class="sxs-lookup"><span data-stu-id="04916-149">However, when querying across all databases, it's important that Elastic Query can treat hello data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="04916-150">tooachieve dit een reeks 'global' weergaven zijn toegevoegd toohello tenant-database die een tenant-id in elk van de Hallo-tabellen die zijn opgevraagd globaal project.</span><span class="sxs-lookup"><span data-stu-id="04916-150">tooachieve this, a set of 'global' views are added toohello tenant database that project a tenant id into each of hello tables that are queried globally.</span></span> <span data-ttu-id="04916-151">Bijvoorbeeld, Hallo *VenueEvents* weergave toegevoegd een berekende *VenueId* toohello kolommen geprojecteerd vanuit Hallo *gebeurtenissen* tabel.</span><span class="sxs-lookup"><span data-stu-id="04916-151">For example, hello *VenueEvents* view adds a computed *VenueId* toohello columns projected from hello *Events* table.</span></span> <span data-ttu-id="04916-152">Met het definiëren van de externe tabel Hallo in Hallo head-database via *VenueEvents* (in plaats van de onderliggende hello *gebeurtenissen* tabel), elastische Query is kunnen toopush omlaag joins op basis van *VenueId* zodat ze kunnen worden uitgevoerd parallel op elke externe database (in plaats van op Hallo head database).</span><span class="sxs-lookup"><span data-stu-id="04916-152">By defining hello external table in hello head database over *VenueEvents* (rather than hello underlying *Events* table), Elastic Query is able toopush down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on hello head database).</span></span> <span data-ttu-id="04916-153">Dit vermindert aanzienlijk Hallo en de hoeveelheid gegevens die wordt geretourneerd, wat tot een aanzienlijke toename van de prestaties voor veel query's leidt.</span><span class="sxs-lookup"><span data-stu-id="04916-153">This dramatically reduces hello amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="04916-154">Deze globale weergaven zijn vooraf gemaakte in alle databases van de tenant (en in *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="04916-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="04916-155">Open SSMS en [verbinding toohello tenants1 -&lt;gebruiker&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="04916-155">Open SSMS and [connect toohello tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="04916-156">Vouw **Databases**, met de rechtermuisknop op **contosoconcerthall**, en selecteer **nieuwe Query**.</span><span class="sxs-lookup"><span data-stu-id="04916-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="04916-157">Voer Hallo query's tooexplore Hallo verschil tussen Hallo één tenant tabellen en algemene weergaven hello te volgen:</span><span class="sxs-lookup"><span data-stu-id="04916-157">Run hello following queries tooexplore hello difference between hello single-tenant tables and hello global views:</span></span>

   ```T-SQL
   -- hello base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice hello plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- hello base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects hello VenueId retrieved from hello Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="04916-158">In deze weergaven Hallo *VenueId* wordt berekend, zoals een hash van hello wilt naam maar een benadering gebruikte toointroduce een unieke waarde zijn.</span><span class="sxs-lookup"><span data-stu-id="04916-158">In these views, hello *VenueId* is computed as a hash of hello Venue name, but any approach could be used toointroduce a unique value.</span></span> <span data-ttu-id="04916-159">Deze aanpak is vergelijkbaar toohello manier Hallo-tenantsleutel wordt berekend voor gebruik in Hallo-catalogus.</span><span class="sxs-lookup"><span data-stu-id="04916-159">This approach is similar toohello way hello tenant key is computed for use in hello catalog.</span></span>

<span data-ttu-id="04916-160">tooexamine hello definitie van Hallo *plaatsen* weergeven:</span><span class="sxs-lookup"><span data-stu-id="04916-160">tooexamine hello definition of hello *Venues* view:</span></span>

1. <span data-ttu-id="04916-161">In **Objectverkenner**, vouw **contosoconcethall** > **weergaven**:</span><span class="sxs-lookup"><span data-stu-id="04916-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![Weergaven](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="04916-163">Met de rechtermuisknop op **dbo. Plaatsen**.</span><span class="sxs-lookup"><span data-stu-id="04916-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="04916-164">Selecteer **weergeven als een Script** > **maken naar** > **nieuw venster van de Query-Editor**</span><span class="sxs-lookup"><span data-stu-id="04916-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="04916-165">Script voor Hallo andere *wilt* toosee weergaven hoe ze Hallo toevoegen *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="04916-165">Script any of hello other *Venue* views toosee how they add hello *VenueId*.</span></span>

## <a name="deploy-hello-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="04916-166">Hallo-database gebruikt voor ad-hoc gedistribueerde query's implementeren</span><span class="sxs-lookup"><span data-stu-id="04916-166">Deploy hello database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="04916-167">In deze oefening implementeert Hallo *adhocanalytics* database.</span><span class="sxs-lookup"><span data-stu-id="04916-167">This exercise deploys hello *adhocanalytics* database.</span></span> <span data-ttu-id="04916-168">Dit is head Hallo-database met Hallo schema voor het uitvoeren van query's voor alle databases van de tenant.</span><span class="sxs-lookup"><span data-stu-id="04916-168">This is hello head database that will contain hello schema used for querying across all tenant databases.</span></span> <span data-ttu-id="04916-169">Hallo-database is geïmplementeerde toohello bestaande catalogusserver Hallo-server gebruikt voor alle beheer-gerelateerde databases in Hallo voorbeeld-app.</span><span class="sxs-lookup"><span data-stu-id="04916-169">hello database is deployed toohello existing catalog server, which is hello server used for all management-related databases in hello sample app.</span></span>

1. <span data-ttu-id="04916-170">Open... \\Learning-Modules\\operationele Analytics\\ad-hoc Analytics\\*Demo AdhocAnalytics.ps1* in Hallo *PowerShell ISE* en set Hallo de volgende waarden:</span><span class="sxs-lookup"><span data-stu-id="04916-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in hello *PowerShell ISE* and set hello following values:</span></span>
   * <span data-ttu-id="04916-171">**$DemoScenario** = 2, **Ad-hoc Analytics-database implementeren**.</span><span class="sxs-lookup"><span data-stu-id="04916-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="04916-172">Druk op **F5** toorun Hallo script en maak Hallo *adhocanalytics* database.</span><span class="sxs-lookup"><span data-stu-id="04916-172">Press **F5** toorun hello script and create hello *adhocanalytics* database.</span></span>

<span data-ttu-id="04916-173">In de volgende sectie hello voegt u schema toohello database zodat deze gebruikt toorun gedistribueerde query's worden kan.</span><span class="sxs-lookup"><span data-stu-id="04916-173">In hello next section, you add schema toohello database so it can be used toorun distributed queries.</span></span>

## <a name="configure-hello-database-for-running-distributed-queries"></a><span data-ttu-id="04916-174">Hallo-database voor het uitvoeren van gedistribueerde query's configureren</span><span class="sxs-lookup"><span data-stu-id="04916-174">Configure hello database for running distributed queries</span></span>

<span data-ttu-id="04916-175">In deze oefening voegt schema (Hallo externe gegevensbron en externe tabeldefinities) toohello ad-hoc analytics-database waarmee een query voor alle databases van de tenant.</span><span class="sxs-lookup"><span data-stu-id="04916-175">This exercise adds schema (hello external data source and external table definitions) toohello ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="04916-176">Open SQL Server Management Studio en toohello ad-hoc Analytics-database die u hebt gemaakt in de vorige stap Hallo verbinding.</span><span class="sxs-lookup"><span data-stu-id="04916-176">Open SQL Server Management Studio, and connect toohello Adhoc Analytics database you created in hello previous step.</span></span> <span data-ttu-id="04916-177">Hallo-naam van de database Hallo is adhocanalytics.</span><span class="sxs-lookup"><span data-stu-id="04916-177">hello name of hello database will be adhocanalytics.</span></span>
2. <span data-ttu-id="04916-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *initialiseren AdhocAnalyticsDB.sql* in SSMS.</span><span class="sxs-lookup"><span data-stu-id="04916-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="04916-179">Bekijk Hallo SQL-script en Let op Hallo volgende:</span><span class="sxs-lookup"><span data-stu-id="04916-179">Review hello SQL script and note hello following:</span></span>

   <span data-ttu-id="04916-180">Elastische Query gebruikt een database-scoped referentie tooaccess elke Hallo tenant databases.</span><span class="sxs-lookup"><span data-stu-id="04916-180">Elastic Query uses a database-scoped credential tooaccess each of hello tenant databases.</span></span> <span data-ttu-id="04916-181">Deze referentie moet toobe beschikbaar in alle Hallo-databases en moet normaal gesproken worden verleend Hallo minimale rechten vereist tooenable deze ad-hocquery's.</span><span class="sxs-lookup"><span data-stu-id="04916-181">This credential needs toobe available in all hello databases and should normally be granted hello minimum rights required tooenable these ad-hoc queries.</span></span>

    ![referentie maken](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="04916-183">Hallo externe gegevensbron die is gedefinieerd toouse hello tenant shard-toewijzing in Hallo catalogusdatabase.</span><span class="sxs-lookup"><span data-stu-id="04916-183">hello external data source, that is defined toouse hello tenant shard map in hello catalog database.</span></span> <span data-ttu-id="04916-184">Bij gebruik van deze als de externe gegevensbron hello, zijn query's gedistribueerde tooall databases die zijn geregistreerd in de catalogus Hallo wanneer Hallo query wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="04916-184">By using this as hello external data source, queries are distributed tooall databases registered in hello catalog when hello query is run.</span></span> <span data-ttu-id="04916-185">Omdat servernamen verschillend voor elke implementatie zijn, dit Initialisatiescript Hallo-locatie van Hallo catalogusdatabase opgehaald door op te halen van de huidige server hello (@@servername) waarop Hallo script wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="04916-185">Because server names are different for each deployment, this initialization script gets hello location of hello catalog database by retrieving hello current server (@@servername) where hello script is executed.</span></span>

    ![externe gegevensbron maken](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="04916-187">externe tabellen die verwijzen naar Hallo algemene weergaven beschreven in de vorige sectie Hallo en gedefinieerd met Hallo **DISTRIBUTION = SHARDED(VenueId)**.</span><span class="sxs-lookup"><span data-stu-id="04916-187">hello external tables that reference hello global views described in hello previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="04916-188">Omdat elke *VenueId* tooa één database, wijst dit verbetert de prestaties voor veel scenario's zoals weergegeven in de volgende sectie Hallo.</span><span class="sxs-lookup"><span data-stu-id="04916-188">Because each *VenueId* maps tooa single database, this improves performance for many scenarios as shown in hello next section.</span></span>

    ![externe tabellen maken](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="04916-190">Hallo lokale tabel *VenueTypes* die is gemaakt en ingevuld.</span><span class="sxs-lookup"><span data-stu-id="04916-190">hello local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="04916-191">Deze gegevens verwijzingstabel is gemeenschappelijk in alle databases voor tenant, zodat kan worden weergegeven als een lokale tabel hier en ingevuld met de algemene gegevens Hallo.</span><span class="sxs-lookup"><span data-stu-id="04916-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with hello common data.</span></span> <span data-ttu-id="04916-192">Voor sommige query's hierdoor Hallo hoeveelheid gegevens verplaatst tussen Hallo tenant databases en Hallo *adhocanalytics* database.</span><span class="sxs-lookup"><span data-stu-id="04916-192">For some queries this may reduce hello amount of data moved between hello tenant databases and hello *adhocanalytics* database.</span></span>

    ![Tabel maken](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="04916-194">Als u verwijzingsdimensies op deze manier opneemt, worden ervoor tooupdate Hallo-tabelschema en gegevens wanneer u Hallo tenant databases bijwerken.</span><span class="sxs-lookup"><span data-stu-id="04916-194">If you include reference tables in this manner, be sure tooupdate hello table schema and data whenever you update hello tenant databases.</span></span>

4. <span data-ttu-id="04916-195">Druk op **F5** toorun Hallo script en Hallo initialiseren *adhocanalytics* database.</span><span class="sxs-lookup"><span data-stu-id="04916-195">Press **F5** toorun hello script and initialize hello *adhocanalytics* database.</span></span> 

<span data-ttu-id="04916-196">U kunt nu gedistribueerde query's uitvoeren en inzichten te verzamelen over alle huurders!</span><span class="sxs-lookup"><span data-stu-id="04916-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="04916-197">Ad-hoc gedistribueerde query's uitvoeren</span><span class="sxs-lookup"><span data-stu-id="04916-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="04916-198">Nu dat Hallo *adhocanalytics* database is ingesteld, gaat u verder gaan en sommige gedistribueerde query's uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="04916-198">Now that hello *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="04916-199">Hallo-uitvoeringsplan voor een beter begrip van waar de queryverwerking Hallo gebeurt er bevatten.</span><span class="sxs-lookup"><span data-stu-id="04916-199">Include hello execution plan for a better understanding of where hello query processing is happening.</span></span> 

<span data-ttu-id="04916-200">Bij de inspectie van Hallo uitvoeringsplan Beweeg de muisaanwijzer over Hallo plan pictogrammen voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="04916-200">When inspecting hello execution plan, hover over hello plan icons for details.</span></span> 

<span data-ttu-id="04916-201">Belangrijke toonote is die instelling **DISTRIBUTION = SHARDED(VenueId)** wanneer we de externe gegevensbron Hallo gedefinieerd, verbetert de prestaties voor veel scenario's.</span><span class="sxs-lookup"><span data-stu-id="04916-201">Important toonote, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined hello external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="04916-202">Omdat elke *VenueId* tooa toegewezen individuele database eenvoudig gereed op afstand, terugkerende alleen Hallo gegevens we moeten filteren is.</span><span class="sxs-lookup"><span data-stu-id="04916-202">Because each *VenueId* maps tooa single database, filtering is easily done remotely, returning only hello data we need.</span></span>

1. <span data-ttu-id="04916-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span><span class="sxs-lookup"><span data-stu-id="04916-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="04916-204">Zorg ervoor dat u bent verbonden toohello **adhocanalytics** database.</span><span class="sxs-lookup"><span data-stu-id="04916-204">Ensure you are connected toohello **adhocanalytics** database.</span></span>
3. <span data-ttu-id="04916-205">Selecteer Hallo **Query** en klik op **werkelijke uitvoeringsplan opnemen**</span><span class="sxs-lookup"><span data-stu-id="04916-205">Select hello **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="04916-206">Markeer Hallo *welke plaatsen zijn momenteel geregistreerd?* query en druk op **F5**.</span><span class="sxs-lookup"><span data-stu-id="04916-206">Highlight hello *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="04916-207">Hallo query retourneert Hallo gehele wetten lijst ter illustratie van hoe snel en eenvoudig het is tooquery voor alle tenants en gegevens vanaf elke tenant.</span><span class="sxs-lookup"><span data-stu-id="04916-207">hello query returns hello entire venue list, illustrating how quick and easy it is tooquery across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="04916-208">Inspecteer de Hallo-abonnement en dat alle kosten voor Hallo Hallo externe query is omdat we gewoon gaat tooeach tenant-database en hello wilt informatie te selecteren.</span><span class="sxs-lookup"><span data-stu-id="04916-208">Inspect hello plan and see that hello entire cost is hello remote query because we're simply going tooeach tenant database and selecting hello venue information.</span></span>

   ![Selecteer * uit dbo. Plaatsen](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="04916-210">De volgende query selecteert Hallo en druk op **F5**.</span><span class="sxs-lookup"><span data-stu-id="04916-210">Select hello next query, and press **F5**.</span></span>

   <span data-ttu-id="04916-211">Gegevens van Hallo tenant databases en Hallo lokaal lid wordt van deze query *VenueTypes* tabel (lokale computer, zoals deze wordt een tabel in Hallo *adhocanalytics* database).</span><span class="sxs-lookup"><span data-stu-id="04916-211">This query joins data from hello tenant databases and hello local *VenueTypes* table (local, as its a table in hello *adhocanalytics* database).</span></span>

   <span data-ttu-id="04916-212">Inspecteer de Hallo-plan en Zie dat Hallo meerderheid van de kosten Hallo externe query is omdat we query uitvoeren op elke tenant wilt info (dbo. Plaatsen) en voert u een snelle lokale koppelen met Hallo lokale *VenueTypes* tabel toodisplay Hallo beschrijvende naam.</span><span class="sxs-lookup"><span data-stu-id="04916-212">Inspect hello plan and see that hello majority of cost is hello remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with hello local *VenueTypes* table toodisplay hello friendly name.</span></span>

   ![Lid worden van lokale en externe gegevens](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="04916-214">Nu selecteren Hallo *op welke dag zijn de meeste tickets verkocht Hallo?* query en druk op **F5**.</span><span class="sxs-lookup"><span data-stu-id="04916-214">Now select hello *On which day were hello most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="04916-215">Deze query heeft iets meer complexe lid worden en cumulatie-instellingen.</span><span class="sxs-lookup"><span data-stu-id="04916-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="04916-216">Wat belangrijk toonote is is dat de meeste Hallo verwerking op afstand wordt uitgevoerd, en nogmaals we alleen Hallo rijen die we nodig hebben terugbrengen, slechts één rij voor elke wetten cumulatieve ticket verkoop aantal per dag retourneren.</span><span class="sxs-lookup"><span data-stu-id="04916-216">What's important toonote is that most of hello processing is done remotely, and once again, we bring back only hello rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![query](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="04916-218">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="04916-218">Next steps</span></span>

<span data-ttu-id="04916-219">In deze zelfstudie hebt u het volgende geleerd:</span><span class="sxs-lookup"><span data-stu-id="04916-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="04916-220">Gedistribueerde query's uitvoeren voor alle databases van de tenant</span><span class="sxs-lookup"><span data-stu-id="04916-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="04916-221">Implementeren van een ad-hoc analytics-database en voeg schema tooit toorun gedistribueerde query's.</span><span class="sxs-lookup"><span data-stu-id="04916-221">Deploy an ad-hoc analytics database and add schema tooit toorun distributed queries.</span></span>


<span data-ttu-id="04916-222">Nu proberen Hallo [Tenant Analytics zelfstudie](sql-database-saas-tutorial-tenant-analytics.md) tooexplore gegevens tooa afzonderlijke analytics-database voor complexere analytics verwerking extraheren...</span><span class="sxs-lookup"><span data-stu-id="04916-222">Now try hello [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extracting data tooa separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="04916-223">Aanvullende bronnen</span><span class="sxs-lookup"><span data-stu-id="04916-223">Additional resources</span></span>

* <span data-ttu-id="04916-224">Aanvullende [zelfstudies waarin voort op Hallo Wingtip SaaS-toepassing bouwen](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="04916-224">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="04916-225">Elastische query</span><span class="sxs-lookup"><span data-stu-id="04916-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)
