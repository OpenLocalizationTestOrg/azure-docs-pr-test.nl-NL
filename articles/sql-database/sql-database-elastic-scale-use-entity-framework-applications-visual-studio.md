---
title: aaaUsing elastische database-clientbibliotheek met Entity Framework | Microsoft Docs
description: Gebruik van de clientbibliotheek voor elastische Database en Entity Framework voor het coderen van databases
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
editor: 
ms.assetid: b9c3065b-cb92-41be-aa7f-deba23e7e159
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 03/06/2017
ms.author: torsteng
ms.openlocfilehash: 917f6d28d9855c0b42afe2c008613a9bbb3ec6b6
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="elastic-database-client-library-with-entity-framework"></a><span data-ttu-id="fc4f6-103">Elastische Database-clientbibliotheek met Entity Framework</span><span class="sxs-lookup"><span data-stu-id="fc4f6-103">Elastic Database client library with Entity Framework</span></span>
<span data-ttu-id="fc4f6-104">Dit document bevat Hallo wijzigingen in een Entity Framework-toepassing die vereiste toointegrate Hello [hulpmiddelen voor elastische databases](sql-database-elastic-scale-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-104">This document shows hello changes in an Entity Framework application that are needed toointegrate with hello [Elastic Database tools](sql-database-elastic-scale-introduction.md).</span></span> <span data-ttu-id="fc4f6-105">Hallo richt zich voornamelijk op het samenstellen van [shard kaart management](sql-database-elastic-scale-shard-map-management.md) en [gegevensafhankelijke routering](sql-database-elastic-scale-data-dependent-routing.md) Hello Entity Framework **Code First** benadering.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-105">hello focus is on composing [shard map management](sql-database-elastic-scale-shard-map-management.md) and [data-dependent routing](sql-database-elastic-scale-data-dependent-routing.md) with hello Entity Framework **Code First** approach.</span></span> <span data-ttu-id="fc4f6-106">Hallo [Code eerst - nieuwe Database](http://msdn.microsoft.com/data/jj193542.aspx) zelfstudie voor EF fungeert als het actieve voorbeeld in dit hele document.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-106">hello [Code First - New Database](http://msdn.microsoft.com/data/jj193542.aspx) tutorial for EF serves as our running example throughout this document.</span></span> <span data-ttu-id="fc4f6-107">Hallo voorbeeldcode bij dit document is onderdeel van de elastische database tools van de voorbeelden in Visual Studio-codevoorbeelden Hallo ingesteld.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-107">hello sample code accompanying this document is part of elastic database tools' set of samples in hello Visual Studio Code Samples.</span></span>

## <a name="downloading-and-running-hello-sample-code"></a><span data-ttu-id="fc4f6-108">Downloaden en uitvoeren van Hallo voorbeeldcode</span><span class="sxs-lookup"><span data-stu-id="fc4f6-108">Downloading and Running hello Sample Code</span></span>
<span data-ttu-id="fc4f6-109">toodownload hello code voor dit artikel:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-109">toodownload hello code for this article:</span></span>

* <span data-ttu-id="fc4f6-110">Visual Studio 2012 of hoger is vereist.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-110">Visual Studio 2012 or later is required.</span></span> 
* <span data-ttu-id="fc4f6-111">Hallo downloaden [elastische DB-hulpprogramma's voor Azure SQL - Entity Framework integratie voorbeeld](https://code.msdn.microsoft.com/windowsapps/Elastic-Scale-with-Azure-bae904ba) van MSDN.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-111">Download hello [Elastic DB Tools for Azure SQL - Entity Framework Integration sample](https://code.msdn.microsoft.com/windowsapps/Elastic-Scale-with-Azure-bae904ba) from MSDN.</span></span> <span data-ttu-id="fc4f6-112">Pak Hallo voorbeeld tooa locatie van uw keuze.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-112">Unzip hello sample tooa location of your choosing.</span></span>
* <span data-ttu-id="fc4f6-113">Start Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-113">Start Visual Studio.</span></span> 
* <span data-ttu-id="fc4f6-114">In Visual Studio-Selecteer-Bestand > Open Project/oplossing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-114">In Visual Studio, select File -> Open Project/Solution.</span></span> 
* <span data-ttu-id="fc4f6-115">In Hallo **Project openen** dialoogvenster gaat toohello voorbeeld die u hebt gedownload en selecteert u **EntityFrameworkCodeFirst.sln** tooopen Hallo voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-115">In hello **Open Project** dialog, navigate toohello sample you downloaded and select **EntityFrameworkCodeFirst.sln** tooopen hello sample.</span></span> 

<span data-ttu-id="fc4f6-116">toorun hello voorbeeld moet u drie toocreate leeg databases in Azure SQL Database:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-116">toorun hello sample, you need toocreate three empty databases in Azure SQL Database:</span></span>

* <span data-ttu-id="fc4f6-117">Shard-toewijzing Manager-database</span><span class="sxs-lookup"><span data-stu-id="fc4f6-117">Shard Map Manager database</span></span>
* <span data-ttu-id="fc4f6-118">1 shard-database</span><span class="sxs-lookup"><span data-stu-id="fc4f6-118">Shard 1 database</span></span>
* <span data-ttu-id="fc4f6-119">2 shard-database</span><span class="sxs-lookup"><span data-stu-id="fc4f6-119">Shard 2 database</span></span>

<span data-ttu-id="fc4f6-120">Nadat u deze databases hebt gemaakt, vult u Hallo plaats houders in **Program.cs** met de naam van uw Azure SQL DB, Hallo databasenamen en uw referenties tooconnect toohello databases.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-120">Once you have created these databases, fill in hello place holders in **Program.cs** with your Azure SQL DB server name, hello database names and your credentials tooconnect toohello databases.</span></span> <span data-ttu-id="fc4f6-121">Hallo-oplossing in Visual Studio maken.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-121">Build hello solution in Visual Studio.</span></span> <span data-ttu-id="fc4f6-122">Visual Studio downloadt Hallo vereist NuGet-pakketten voor het Hallo-clientbibliotheek voor elastische database Entity Framework en tijdelijke fout verwerken als onderdeel van Hallo buildproces.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-122">Visual Studio will download hello required NuGet packages for hello elastic database client library, Entity Framework, and Transient Fault handling as part of hello build process.</span></span> <span data-ttu-id="fc4f6-123">Zorg ervoor dat het herstellen van NuGet-pakketten is ingeschakeld voor uw oplossing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-123">Make sure that restoring NuGet packages is enabled for your solution.</span></span> <span data-ttu-id="fc4f6-124">U kunt deze instelling inschakelen door met de rechtermuisknop op Hallo oplossingsbestand in Visual Studio Solution Explorer Hallo.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-124">You can enable this setting by right-clicking on hello solution file in hello Visual Studio Solution Explorer.</span></span> 

## <a name="entity-framework-workflows"></a><span data-ttu-id="fc4f6-125">Entity Framework-werkstromen</span><span class="sxs-lookup"><span data-stu-id="fc4f6-125">Entity Framework workflows</span></span>
<span data-ttu-id="fc4f6-126">Entity Framework ontwikkelaars zijn afhankelijk van een van de volgende vier werkstromen toobuild toepassingen en tooensure persistentie voor toepassingsobjecten hello:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-126">Entity Framework developers rely on one of hello following four workflows toobuild applications and tooensure persistence for application objects:</span></span> 

* <span data-ttu-id="fc4f6-127">**Eerste (nieuwe Database) code**: Hallo EF developer maakt Hallo-model in de toepassingscode Hallo en EF genereert vervolgens Hallo database uit.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-127">**Code First (New Database)**: hello EF developer creates hello model in hello application code and then EF generates hello database from it.</span></span> 
* <span data-ttu-id="fc4f6-128">**Eerste (bestaande Database) code**: Hallo developer kunt EF Hallo toepassingscode voor Hallo model genereren vanuit een bestaande database.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-128">**Code First (Existing Database)**: hello developer lets EF generate hello application code for hello model from an existing database.</span></span>
* <span data-ttu-id="fc4f6-129">**Eerste model**: Hallo developer Hallo-model in Hallo EF designer maakt en EF maakt vervolgens Hallo database uit Hallo-model.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-129">**Model First**: hello developer creates hello model in hello EF designer and then EF creates hello database from hello model.</span></span>
* <span data-ttu-id="fc4f6-130">**Eerste database**: Hallo developer EF tooinfer Hallo model vanuit een bestaande database tooling gebruikt.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-130">**Database First**: hello developer uses EF tooling tooinfer hello model from an existing database.</span></span> 

<span data-ttu-id="fc4f6-131">Alle deze methoden zijn afhankelijk van Hallo DbContext-klasse tootransparently beheren databaseverbindingen en -databaseschema voor een toepassing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-131">All these approaches rely on hello DbContext class tootransparently manage database connections and database schema for an application.</span></span> <span data-ttu-id="fc4f6-132">Database maken van het uitvoeren van de bootstrap- en schema behandeld in meer detail verderop in document Hallo verschillende constructors op Hallo DbContext-basisklasse voor verschillende niveaus van controle over het maken van de verbinding toestaan.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-132">As we will discuss in more detail later in hello document, different constructors on hello DbContext base class allow for different levels of control over connection creation, database bootstrapping and schema creation.</span></span> <span data-ttu-id="fc4f6-133">Uitdagingen ontstaan voornamelijk uit Hallo feit dat de polygoonring Hallo database verbinding management via EF met mogelijkheden voor verbinding Hallo Hallo gegevens afhankelijke routeringsinterfaces opgegeven door Hallo-clientbibliotheek voor elastische database.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-133">Challenges arise primarily from hello fact that hello database connection management provided by EF intersects with hello connection management capabilities of hello data dependent routing interfaces provided by hello elastic database client library.</span></span> 

## <a name="elastic-database-tools-assumptions"></a><span data-ttu-id="fc4f6-134">Veronderstellingen voor elastische database-hulpprogramma 's</span><span class="sxs-lookup"><span data-stu-id="fc4f6-134">Elastic database tools assumptions</span></span>
<span data-ttu-id="fc4f6-135">Zie voor definities van de termijn [verklarende woordenlijst hulpprogramma's van elastische Database](sql-database-elastic-scale-glossary.md).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-135">For term definitions, see [Elastic Database tools glossary](sql-database-elastic-scale-glossary.md).</span></span>

<span data-ttu-id="fc4f6-136">Met de clientbibliotheek voor elastische databases definiëren u partities van de toepassingsgegevens aangeroepen shardlets.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-136">With elastic database client library, you define partitions of your application data called shardlets.</span></span> <span data-ttu-id="fc4f6-137">Shardlets worden geïdentificeerd door een sharding-sleutel en zijn toegewezen toospecific databases.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-137">Shardlets are identified by a sharding key and are mapped toospecific databases.</span></span> <span data-ttu-id="fc4f6-138">Een toepassing kan zo veel databases zo nodig hebt en distribueer Hallo shardlets tooprovide voldoende capaciteit of prestaties gegeven van de huidige zakelijke vereisten.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-138">An application may have as many databases as needed and distribute hello shardlets tooprovide enough capacity or performance given current business requirements.</span></span> <span data-ttu-id="fc4f6-139">Hallo-toewijzing van sharding sleutelwaarden toohello databases wordt opgeslagen in een shard-toewijzing zoals opgegeven door Hallo elastische databaseclient API's.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-139">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello elastic database client APIs.</span></span> <span data-ttu-id="fc4f6-140">We noemen deze mogelijkheid **Shard kaart Management**, of SMM kortweg.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-140">We call this capability **Shard Map Management**, or SMM for short.</span></span> <span data-ttu-id="fc4f6-141">Hallo shard kaart fungeert ook als Hallo broker databaseverbindingen voor aanvragen die een sharding-sleutel bevatten.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-141">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="fc4f6-142">We verwijzen toothis mogelijkheden als **gegevensafhankelijke routering**.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-142">We refer toothis capability as **data-dependent routing**.</span></span> 

<span data-ttu-id="fc4f6-143">Hallo shard-toewijzing manager beveiligt gebruikers tegen inconsistente weergaven in shardlet gegevens die optreden kunnen wanneer de gelijktijdige shardlet management bewerkingen (zoals het verplaatsen van gegevens uit één shard tooanother) plaatsvinden.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-143">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations (such as relocating data from one shard tooanother) are happening.</span></span> <span data-ttu-id="fc4f6-144">toodo Hallo dus shard-kaarten die worden beheerd door Hallo bibliotheek broker Hallo database clientverbindingen voor een toepassing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-144">toodo so, hello shard maps managed by hello client library broker hello database connections for an application.</span></span> <span data-ttu-id="fc4f6-145">Hierdoor kan Hallo shard kaart functionaliteit tooautomatically kill een databaseverbinding wanneer shard-beheerbewerkingen kunnen invloed hebben op Hallo shardlet die Hallo verbinding is gemaakt.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-145">This allows hello shard map functionality tooautomatically kill a database connection when shard management operations could impact hello shardlet that hello connection has been created for.</span></span> <span data-ttu-id="fc4f6-146">Deze aanpak moet toointegrate met enkele van de EF-functionaliteit, zoals het maken van nieuwe verbindingen van een bestaande één toocheck database bestaan.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-146">This approach needs toointegrate with some of EF’s functionality, such as creating new connections from an existing one toocheck for database existence.</span></span> <span data-ttu-id="fc4f6-147">In het algemeen onze observatie is dat Hallo standaard DbContext constructors werken alleen op betrouwbare wijze voor gesloten databaseverbindingen die veilig kunnen worden gekloond voor EF werk.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-147">In general, our observation has been that hello standard DbContext constructors only work reliably for closed database connections that can safely be cloned for EF work.</span></span> <span data-ttu-id="fc4f6-148">Hallo ontwerpprincipe van elastische database is in plaats daarvan tooonly broker geopend verbindingen.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-148">hello design principle of elastic database instead is tooonly broker opened connections.</span></span> <span data-ttu-id="fc4f6-149">Een misschien denkt dat het sluiten van een verbinding die door de clientbibliotheek Hallo brokered voordat het wordt over toohello EF DbContext dit probleem mogelijk oplossen.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-149">One might think that closing a connection brokered by hello client library before handing it over toohello EF DbContext may solve this issue.</span></span> <span data-ttu-id="fc4f6-150">Hallo-verbinding wordt gesloten en vertrouwen op EF toore-open het, foregoes een echter Hallo validatie en consistentie controles uitgevoerd door het Hallo-bibliotheek.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-150">However, by closing hello connection and relying on EF toore-open it, one foregoes hello validation and consistency checks performed by hello library.</span></span> <span data-ttu-id="fc4f6-151">Hallo migraties functionaliteit in EF, gebruikt echter deze verbindingen toomanage Hallo onderliggende databaseschema op een manier die transparant toohello toepassing is.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-151">hello migrations functionality in EF, however, uses these connections toomanage hello underlying database schema in a way that is transparent toohello application.</span></span> <span data-ttu-id="fc4f6-152">In het ideale geval zouden we tooretain, zoals en alle deze mogelijkheden van zowel Hallo-clientbibliotheek voor elastische database als EF in Hallo combineren dezelfde toepassing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-152">Ideally, we would like tooretain and combine all these capabilities from both hello elastic database client library and EF in hello same application.</span></span> <span data-ttu-id="fc4f6-153">Hallo volgende hoofdstuk beschrijft uitgebreid deze eigenschappen en de vereisten in meer detail.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-153">hello following section discusses these properties and requirements in more detail.</span></span> 

## <a name="requirements"></a><span data-ttu-id="fc4f6-154">Vereisten</span><span class="sxs-lookup"><span data-stu-id="fc4f6-154">Requirements</span></span>
<span data-ttu-id="fc4f6-155">Als u werkt met Hallo-clientbibliotheek voor elastische database en Entity Framework-API's, willen we tooretain Hallo volgende eigenschappen:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-155">When working with both hello elastic database client library and Entity Framework APIs, we want tooretain hello following properties:</span></span> 

* <span data-ttu-id="fc4f6-156">**Scale-out**: tooadd of verwijder databases van de gegevenslaag Hallo van shard toepassing hello die nodig zijn voor Hallo capaciteit eisen van de toepassing hello.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-156">**Scale-out**: tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> <span data-ttu-id="fc4f6-157">Dit betekent dat de controle over Hallo Hallo maken en verwijderen van databases en het gebruik Hallo elastische database shard kaart manager-API's toomanage-databases en toewijzingen van shardlets.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-157">This means control over hello hello creation and deletion of databases and using hello elastic database shard map manager APIs toomanage databases, and mappings of shardlets.</span></span> 
* <span data-ttu-id="fc4f6-158">**Consistentie**: toepassing hello veiligheidsmaatregelen sharding en maakt gebruik van gegevens afhankelijke routering mogelijkheden van de clientbibliotheek Hallo Hallo.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-158">**Consistency**: hello application employs sharding, and uses hello data dependent routing capabilities of hello client library.</span></span> <span data-ttu-id="fc4f6-159">tooavoid beschadigd of verkeerd queryresultaten verbindingen zijn brokered via Hallo shard-toewijzing manager.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-159">tooavoid corruption or wrong query results, connections are brokered through hello shard map manager.</span></span> <span data-ttu-id="fc4f6-160">Dit houdt ook validatie en consistentie.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-160">This also retains validation and consistency.</span></span>
* <span data-ttu-id="fc4f6-161">**Eerste code**: tooretain Hallo gemak van de EF code eerste paradigma.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-161">**Code First**: tooretain hello convenience of EF’s code first paradigm.</span></span> <span data-ttu-id="fc4f6-162">In de Code First klassen in de toepassing hello transparant zijn toegewezen toohello onderliggende databasestructuren.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-162">In Code First, classes in hello application are mapped transparently toohello underlying database structures.</span></span> <span data-ttu-id="fc4f6-163">Hallo-toepassingscode communiceert met DbSets die de meeste aspecten die zijn betrokken bij de verwerking van de database onderliggende hello maskeren.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-163">hello application code interacts with DbSets that mask most aspects involved in hello underlying database processing.</span></span>
* <span data-ttu-id="fc4f6-164">**Schema**: Entity Framework initiële database schema maken en latere schema evolutie via migraties worden verwerkt.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-164">**Schema**: Entity Framework handles initial database schema creation and subsequent schema evolution through migrations.</span></span> <span data-ttu-id="fc4f6-165">Als deze mogelijkheden aanhoudt, is het eenvoudig als Hallo gegevens ontwikkeld aanpassing van uw app.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-165">By retaining these capabilities, adapting your app is easy as hello data evolves.</span></span> 

<span data-ttu-id="fc4f6-166">Hallo volgende hulp ontvangt de instructie hoe toosatisfy deze vereisten voor Code First-toepassingen met hulpprogramma's voor elastische database.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-166">hello following guidance instructs how toosatisfy these requirements for Code First applications using elastic database tools.</span></span> 

## <a name="data-dependent-routing-using-ef-dbcontext"></a><span data-ttu-id="fc4f6-167">Gegevens afhankelijke EF DbContext-routering</span><span class="sxs-lookup"><span data-stu-id="fc4f6-167">Data dependent routing using EF DbContext</span></span>
<span data-ttu-id="fc4f6-168">Databaseverbindingen met Entity Framework worden meestal beheerd via subklassen van **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-168">Database connections with Entity Framework are typically managed through subclasses of **DbContext**.</span></span> <span data-ttu-id="fc4f6-169">Deze subklassen maken die zijn afgeleid van **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-169">Create these subclasses by deriving from **DbContext**.</span></span> <span data-ttu-id="fc4f6-170">U definieert uw **DbSets** die Hallo een back-database verzamelingen van CLR-objecten voor uw toepassing implementeren.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-170">This is where you define your **DbSets** that implement hello database-backed collections of CLR objects for your application.</span></span> <span data-ttu-id="fc4f6-171">In de context van de Hallo van gegevensafhankelijke routering, kunnen we enkele nuttige eigenschappen die niet noodzakelijkerwijs voor andere EF code eerste toepassingsscenario's bewaart identificeren:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-171">In hello context of data dependent routing, we can identify several helpful properties that do not necessarily hold for other EF code first application scenarios:</span></span> 

* <span data-ttu-id="fc4f6-172">Hallo-database bestaat al en is geregistreerd in Hallo elastische database shard-toewijzing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-172">hello database already exists and has been registered in hello elastic database shard map.</span></span> 
* <span data-ttu-id="fc4f6-173">Hallo-schema van de toepassing hello is al geïmplementeerde toohello database (Zie hieronder).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-173">hello schema of hello application has already been deployed toohello database (explained below).</span></span> 
* <span data-ttu-id="fc4f6-174">Gegevensafhankelijke routering verbindingen toohello database zijn geleverd door Hallo shard-toewijzing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-174">Data-dependent routing connections toohello database are brokered by hello shard map.</span></span> 

<span data-ttu-id="fc4f6-175">toointegrate **DbContexts** met gegevensafhankelijke routering voor scale-out:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-175">toointegrate **DbContexts** with data-dependent routing for scale-out:</span></span>

1. <span data-ttu-id="fc4f6-176">De fysieke databaseverbindingen via Hallo elastische database clientinterfaces van Hallo shard kaart manager maken</span><span class="sxs-lookup"><span data-stu-id="fc4f6-176">Create physical database connections through hello elastic database client interfaces of hello shard map manager,</span></span> 
2. <span data-ttu-id="fc4f6-177">Hallo-verbinding met de Hallo teruglopen **DbContext** subklasse</span><span class="sxs-lookup"><span data-stu-id="fc4f6-177">Wrap hello connection with hello **DbContext** subclass</span></span>
3. <span data-ttu-id="fc4f6-178">Hallo verbinding omlaag binnenkomen Hallo **DbContext** klassen tooensure Hallo verwerking Hallo EF-zijde ook gebeurt baseren.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-178">Pass hello connection down into hello **DbContext** base classes tooensure all hello processing on hello EF side happens as well.</span></span> 

<span data-ttu-id="fc4f6-179">Hallo volgende codevoorbeeld ziet u deze methode.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-179">hello following code example illustrates this approach.</span></span> <span data-ttu-id="fc4f6-180">(Deze code is ook in Visual Studio-project begeleidende Hallo)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-180">(This code is also in hello accompanying Visual Studio project)</span></span>

    public class ElasticScaleContext<T> : DbContext
    {
    public DbSet<Blog> Blogs { get; set; }
    …

        // C'tor for data dependent routing. This call will open a validated connection 
        // routed toohello proper shard by hello shard map manager. 
        // Note that hello base class c'tor call will fail for an open connection
        // if migrations need toobe done and SQL credentials are used. This is hello reason for hello 
        // separation of c'tors into hello data-dependent routing case (this c'tor) and hello internal c'tor for new shards.
        public ElasticScaleContext(ShardMap shardMap, T shardingKey, string connectionStr)
            : base(CreateDDRConnection(shardMap, shardingKey, connectionStr), 
            true /* contextOwnsConnection */)
        {
        }

        // Only static methods are allowed in calls into base class c'tors.
        private static DbConnection CreateDDRConnection(
        ShardMap shardMap, 
        T shardingKey, 
        string connectionStr)
        {
            // No initialization
            Database.SetInitializer<ElasticScaleContext<T>>(null);

            // Ask shard map toobroker a validated connection for hello given key
            SqlConnection conn = shardMap.OpenConnectionForKey<T>
                                (shardingKey, connectionStr, ConnectionOptions.Validate);
            return conn;
        }    

## <a name="main-points"></a><span data-ttu-id="fc4f6-181">Belangrijkste punten</span><span class="sxs-lookup"><span data-stu-id="fc4f6-181">Main points</span></span>
* <span data-ttu-id="fc4f6-182">Een nieuwe constructor vervangt de standaardconstructor Hallo in Hallo DbContext-subklasse</span><span class="sxs-lookup"><span data-stu-id="fc4f6-182">A new constructor replaces hello default constructor in hello DbContext subclass</span></span> 
* <span data-ttu-id="fc4f6-183">nieuwe Hallo-constructor heeft Hallo argumenten die vereist zijn voor het afhankelijke doorsturen van gegevens via de clientbibliotheek voor elastische database:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-183">hello new constructor takes hello arguments that are required for data dependent routing through elastic database client library:</span></span>
  
  * <span data-ttu-id="fc4f6-184">Hallo shard-toewijzing tooaccess Hallo gegevensafhankelijke routeringsinterfaces,</span><span class="sxs-lookup"><span data-stu-id="fc4f6-184">hello shard map tooaccess hello data-dependent routing interfaces,</span></span>
  * <span data-ttu-id="fc4f6-185">Hallo sharding key tooidentify hello shardlet</span><span class="sxs-lookup"><span data-stu-id="fc4f6-185">hello sharding key tooidentify hello shardlet,</span></span>
  * <span data-ttu-id="fc4f6-186">een verbindingsreeks met het Hallo-referenties voor Hallo gegevensafhankelijke routering verbinding toohello shard.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-186">a connection string with hello credentials for hello data-dependent routing connection toohello shard.</span></span> 
* <span data-ttu-id="fc4f6-187">Hallo aanroep toohello basisklassenconstructor werkt een detour in een statische methode waarmee alle Hallo stappen nodig voor het doorsturen van afhankelijk zijn van gegevens.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-187">hello call toohello base class constructor takes a detour into a static method that performs all hello steps necessary for data-dependent routing.</span></span> 
  
  * <span data-ttu-id="fc4f6-188">Hallo OpenConnectionForKey aanroep van Hallo elastische database clientinterfaces wordt gebruikt op Hallo shard kaart tooestablish een open verbinding.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-188">It uses hello OpenConnectionForKey call of hello elastic database client interfaces on hello shard map tooestablish an open connection.</span></span>
  * <span data-ttu-id="fc4f6-189">Hallo shard-toewijzing maakt Hallo open verbinding toohello shard die Hallo shardlet voor Hallo opgegeven sharding-sleutel bevat.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-189">hello shard map creates hello open connection toohello shard that holds hello shardlet for hello given sharding key.</span></span>
  * <span data-ttu-id="fc4f6-190">Deze verbinding openen wordt back toohello basisklassenconstructor van DbContext tooindicate dat deze verbinding gebruikt door EF in plaats van EF automatisch maken van een nieuwe verbinding laten toobe is doorgegeven.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-190">This open connection is passed back toohello base class constructor of DbContext tooindicate that this connection is toobe used by EF instead of letting EF create a new connection automatically.</span></span> <span data-ttu-id="fc4f6-191">Deze manier Hallo verbinding zijn gelabeld door Hallo elastische databaseclient API zodat zij consistentie onder beheerbewerkingen shard-toewijzing kunt waarborgen.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-191">This way hello connection has been tagged by hello elastic database client API so that it can guarantee consistency under shard map management operations.</span></span>

<span data-ttu-id="fc4f6-192">Gebruik de nieuwe constructor Hallo voor uw DbContext-subklasse in plaats van de standaardconstructor Hallo in uw code.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-192">Use hello new constructor for your DbContext subclass instead of hello default constructor in your code.</span></span> <span data-ttu-id="fc4f6-193">Hier volgt een voorbeeld:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-193">Here is an example:</span></span> 

    // Create and save a new blog.

    Console.Write("Enter a name for a new blog: "); 
    var name = Console.ReadLine(); 

    using (var db = new ElasticScaleContext<int>( 
                            sharding.ShardMap,  
                            tenantId1,  
                            connStrBldr.ConnectionString)) 
    { 
        var blog = new Blog { Name = name }; 
        db.Blogs.Add(blog); 
        db.SaveChanges(); 

        // Display all Blogs for tenant 1 
        var query = from b in db.Blogs 
                    orderby b.Name 
                    select b; 
     … 
    }

<span data-ttu-id="fc4f6-194">nieuwe constructor Hallo opent Hallo verbinding toohello shard dat Hallo-gegevens voor Hallo shardlet geïdentificeerd door de waarde van Hallo bevat **tenantid1**.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-194">hello new constructor opens hello connection toohello shard that holds hello data for hello shardlet identified by hello value of **tenantid1**.</span></span> <span data-ttu-id="fc4f6-195">Hallo-code in Hallo **met** blok blijft ongewijzigd tooaccess hello **DbSet** voor blogs met EF op Hallo shard voor **tenantid1**.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-195">hello code in hello **using** block stays unchanged tooaccess hello **DbSet** for blogs using EF on hello shard for **tenantid1**.</span></span> <span data-ttu-id="fc4f6-196">Hiermee wijzigt u semantiek voor Hallo-code in Hallo met blok dat alle databasebewerkingen nu worden binnen het bereik van één shard toohello waar **tenantid1** wordt bewaard.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-196">This changes semantics for hello code in hello using block such that all database operations are now scoped toohello one shard where **tenantid1** is kept.</span></span> <span data-ttu-id="fc4f6-197">Bijvoorbeeld, een LINQ-query via Hallo blogs **DbSet** zou blogs opgeslagen op de huidige shard Hallo alleen worden geretourneerd, maar niet Hallo zijn opgeslagen op andere shards.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-197">For instance, a LINQ query over hello blogs **DbSet** would only return blogs stored on hello current shard, but not hello ones stored on other shards.</span></span>  

#### <a name="transient-faults-handling"></a><span data-ttu-id="fc4f6-198">Tijdelijke fouten verwerken</span><span class="sxs-lookup"><span data-stu-id="fc4f6-198">Transient faults handling</span></span>
<span data-ttu-id="fc4f6-199">Hallo Microsoft Patterns en procedures in een team gepubliceerde Hallo [Hallo tijdelijke fout afhandeling van Application Block](https://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-199">hello Microsoft Patterns & Practices team published hello [hello Transient Fault Handling Application Block](https://msdn.microsoft.com/library/dn440719.aspx).</span></span> <span data-ttu-id="fc4f6-200">Hallo tapewisselaar wordt gebruikt met de clientbibliotheek elastisch schalen in combinatie met EF.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-200">hello library is used with elastic scale client library in combination with EF.</span></span> <span data-ttu-id="fc4f6-201">Er echter voor zorgen dat een tijdelijke uitzondering tooa plaats waar we dat die nieuwe constructor Hallo na een tijdelijke fout wordt gebruikt retourneert kunnen zodat elke nieuwe verbindingspoging wordt gemaakt met behulp van Hallo constructors die we hebt toegepast.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-201">However, ensure that any transient exception returns tooa place where we can ensure that hello new constructor is being used after a transient fault so that any new connection attempt is made using hello constructors we have tweaked.</span></span> <span data-ttu-id="fc4f6-202">Anders wordt een juiste shard kan niet worden gegarandeerd, en er zijn geen garanties Hallo verbinding verbinding toohello bijgehouden als wijzigingen optreden toohello shard-toewijzing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-202">Otherwise, a connection toohello correct shard is not guaranteed, and there are no assurances hello connection is maintained as changes toohello shard map occur.</span></span> 

<span data-ttu-id="fc4f6-203">Hallo volgende codevoorbeeld ziet u hoe een SQL-beleid voor opnieuw proberen kan worden gebruikt om Hallo nieuwe **DbContext** subklasse constructors:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-203">hello following code sample illustrates how a SQL retry policy can be used around hello new **DbContext** subclass constructors:</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() => 
    { 
        using (var db = new ElasticScaleContext<int>( 
                                sharding.ShardMap,  
                                tenantId1,  
                                connStrBldr.ConnectionString)) 
            { 
                    var blog = new Blog { Name = name }; 
                    db.Blogs.Add(blog); 
                    db.SaveChanges(); 
            … 
            } 
        }); 

<span data-ttu-id="fc4f6-204">**SqlDatabaseUtils.SqlRetryPolicy** in Hallo bovenstaande code wordt gedefinieerd als een **SqlDatabaseTransientErrorDetectionStrategy** met een aantal nieuwe pogingen van 10 en 5 seconden wachttijd tussen nieuwe pogingen.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-204">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="fc4f6-205">Deze aanpak is vergelijkbaar toohello richtlijnen voor EF en transacties gebruiker gestart (Zie [beperkingen in de uitvoering van strategieën opnieuw uit te voeren (EF6 en hoger)](http://msdn.microsoft.com/data/dn307226).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-205">This approach is similar toohello guidance for EF and user-initiated transactions (see [Limitations with Retrying Execution Strategies (EF6 onwards)](http://msdn.microsoft.com/data/dn307226).</span></span> <span data-ttu-id="fc4f6-206">Beide situaties vereisen dat programma van de toepassing hello bepaalt Hallo bereik toowhich Hallo tijdelijke uitzondering retourneert: tooeither Open Hallo transactie of (zoals) opnieuw wilt maken Hallo context van de juiste constructor Hallo dat wordt gebruikt Hallo elastische database clientbibliotheek.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-206">Both situations require that hello application program controls hello scope toowhich hello transient exception returns: tooeither reopen hello transaction, or (as shown) recreate hello context from hello proper constructor that uses hello elastic database client library.</span></span>

<span data-ttu-id="fc4f6-207">Hallo nodig toocontrol waar tijdelijke uitzonderingen in beslag terug in bereik ook uitsluit Hallo gebruik van de ingebouwde Hallo **SqlAzureExecutionStrategy** die wordt geleverd met EF.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-207">hello need toocontrol where transient exceptions take us back in scope also precludes hello use of hello built-in **SqlAzureExecutionStrategy** that comes with EF.</span></span> <span data-ttu-id="fc4f6-208">**SqlAzureExecutionStrategy** zou opnieuw een verbinding openen maar niet **OpenConnectionForKey** en daarom omzeilen Hallo validaties die wordt uitgevoerd als onderdeel van Hallo **OpenConnectionForKey** aanroepen.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-208">**SqlAzureExecutionStrategy** would reopen a connection but not use **OpenConnectionForKey** and therefore bypass all hello validation that is performed as part of hello **OpenConnectionForKey** call.</span></span> <span data-ttu-id="fc4f6-209">In plaats daarvan Hallo voorbeeldcode maakt gebruik van Hallo ingebouwde **DefaultExecutionStrategy** die wordt geleverd met EF.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-209">Instead, hello code sample uses hello built-in **DefaultExecutionStrategy** that also comes with EF.</span></span> <span data-ttu-id="fc4f6-210">In plaats van te**SqlAzureExecutionStrategy**, deze correct werkt in combinatie met Hallo-beleid voor opnieuw proberen van afhandeling van tijdelijke fout.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-210">As opposed too**SqlAzureExecutionStrategy**, it works correctly in combination with hello retry policy from Transient Fault Handling.</span></span> <span data-ttu-id="fc4f6-211">Hallo-uitvoeringsbeleid is ingesteld in Hallo **ElasticScaleDbConfiguration** klasse.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-211">hello execution policy is set in hello **ElasticScaleDbConfiguration** class.</span></span> <span data-ttu-id="fc4f6-212">Opmerking dat we niet toouse besloten **DefaultSqlExecutionStrategy** omdat er wordt verwezen naar toouse **SqlAzureExecutionStrategy** als tijdelijke uitzonderingen optreden - die zouden kunnen leiden toowrong gedrag zoals besproken.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-212">Note that we decided not toouse **DefaultSqlExecutionStrategy** since it suggests toouse **SqlAzureExecutionStrategy** if transient exceptions occur - which would lead toowrong behavior as discussed.</span></span> <span data-ttu-id="fc4f6-213">Zie voor meer informatie over Hallo verschillende retry-beleid en de EF [Verbindingstolerantie in EF](http://msdn.microsoft.com/data/dn456835.aspx).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-213">For more information on hello different retry policies and EF, see [Connection Resiliency in EF](http://msdn.microsoft.com/data/dn456835.aspx).</span></span>     

#### <a name="constructor-rewrites"></a><span data-ttu-id="fc4f6-214">Constructor regeneraties</span><span class="sxs-lookup"><span data-stu-id="fc4f6-214">Constructor rewrites</span></span>
<span data-ttu-id="fc4f6-215">Hallo codevoorbeelden bovenstaande illustratie Hallo standaard constructor herschrijft vereist is voor uw toepassing in volgorde toouse afhankelijk van de gegevens routering met Hallo Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-215">hello code examples above illustrate hello default constructor re-writes required for your application in order toouse  data dependent routing with hello Entity Framework.</span></span> <span data-ttu-id="fc4f6-216">Hallo tabel generaliseert deze benadering tooother constructors.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-216">hello following table generalizes this approach tooother constructors.</span></span> 

| <span data-ttu-id="fc4f6-217">Huidige Constructor</span><span class="sxs-lookup"><span data-stu-id="fc4f6-217">Current Constructor</span></span> | <span data-ttu-id="fc4f6-218">Herschreven Constructor voor gegevens</span><span class="sxs-lookup"><span data-stu-id="fc4f6-218">Rewritten Constructor for data</span></span> | <span data-ttu-id="fc4f6-219">Base-Constructor</span><span class="sxs-lookup"><span data-stu-id="fc4f6-219">Base Constructor</span></span> | <span data-ttu-id="fc4f6-220">Opmerkingen</span><span class="sxs-lookup"><span data-stu-id="fc4f6-220">Notes</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="fc4f6-221">MyContext()</span><span class="sxs-lookup"><span data-stu-id="fc4f6-221">MyContext()</span></span> |<span data-ttu-id="fc4f6-222">ElasticScaleContext (ShardMap, TKey)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-222">ElasticScaleContext(ShardMap, TKey)</span></span> |<span data-ttu-id="fc4f6-223">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-223">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="fc4f6-224">Hallo verbinding moet een functie van Hallo shard-toewijzing en Hallo gegevensafhankelijke routering sleutel toobe.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-224">hello connection needs toobe a function of hello shard map and hello data-dependent routing key.</span></span> <span data-ttu-id="fc4f6-225">U moet tooby pass automatisch verbinding maken met EF en in plaats daarvan Hallo shard kaart toobroker Hallo verbinding gebruiken.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-225">You need tooby-pass automatic connection creation by EF and instead use hello shard map toobroker hello connection.</span></span> |
| <span data-ttu-id="fc4f6-226">MyContext(string)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-226">MyContext(string)</span></span> |<span data-ttu-id="fc4f6-227">ElasticScaleContext (ShardMap, TKey)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-227">ElasticScaleContext(ShardMap, TKey)</span></span> |<span data-ttu-id="fc4f6-228">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-228">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="fc4f6-229">Hallo-verbinding is een functie van Hallo shard-toewijzing en Hallo gegevensafhankelijke routering sleutel.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-229">hello connection is a function of hello shard map and hello data-dependent routing key.</span></span> <span data-ttu-id="fc4f6-230">Een vaste databaserol of verbindingstekenreeks, werken niet als ze validatie omzeilen door Hallo shard-toewijzing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-230">A fixed database name or connection string will not work as they by-pass validation by hello shard map.</span></span> |
| <span data-ttu-id="fc4f6-231">MyContext(DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-231">MyContext(DbCompiledModel)</span></span> |<span data-ttu-id="fc4f6-232">ElasticScaleContext (ShardMap, TKey, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-232">ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</span></span> |<span data-ttu-id="fc4f6-233">DbContext (DbConnection, DbCompiledModel, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-233">DbContext(DbConnection, DbCompiledModel, bool)</span></span> |<span data-ttu-id="fc4f6-234">voor de shard-toewijzing en sharding-sleutel met de Hallo model opgegeven gegeven Hallo Hallo verbinding gemaakt.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-234">hello connection will get created for hello given shard map and sharding key with hello model provided.</span></span> <span data-ttu-id="fc4f6-235">Hallo gecompileerde model worden op basis c'tor toohello doorgegeven.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-235">hello compiled model will be passed on toohello base c’tor.</span></span> |
| <span data-ttu-id="fc4f6-236">MyContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-236">MyContext(DbConnection, bool)</span></span> |<span data-ttu-id="fc4f6-237">ElasticScaleContext (ShardMap, TKey, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-237">ElasticScaleContext(ShardMap, TKey, bool)</span></span> |<span data-ttu-id="fc4f6-238">DbContext (DbConnection, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-238">DbContext(DbConnection, bool)</span></span> |<span data-ttu-id="fc4f6-239">Hallo verbinding moet toobe afgeleid van Hallo shard-toewijzing en het Hallo-sleutel.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-239">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="fc4f6-240">Deze kan niet worden opgegeven als invoer (tenzij deze invoer is al Hallo shard-toewijzing en Hallo sleutel).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-240">It cannot be provided as an input (unless that input was already using hello shard map and hello key).</span></span> <span data-ttu-id="fc4f6-241">Hallo Booleaanse waarde doorgegeven.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-241">hello Boolean will be passed on.</span></span> |
| <span data-ttu-id="fc4f6-242">MyContext (string, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-242">MyContext(string, DbCompiledModel)</span></span> |<span data-ttu-id="fc4f6-243">ElasticScaleContext (ShardMap, TKey, DbCompiledModel)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-243">ElasticScaleContext(ShardMap, TKey, DbCompiledModel)</span></span> |<span data-ttu-id="fc4f6-244">DbContext (DbConnection, DbCompiledModel, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-244">DbContext(DbConnection, DbCompiledModel, bool)</span></span> |<span data-ttu-id="fc4f6-245">Hallo verbinding moet toobe afgeleid van Hallo shard-toewijzing en het Hallo-sleutel.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-245">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="fc4f6-246">Deze kan niet worden opgegeven als invoer (tenzij deze invoer is Hallo shard-toewijzing en Hallo sleutel).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-246">It cannot be provided as an input (unless that input was using hello shard map and hello key).</span></span> <span data-ttu-id="fc4f6-247">Hallo gecompileerde model doorgegeven.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-247">hello compiled model will be passed on.</span></span> |
| <span data-ttu-id="fc4f6-248">MyContext (ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-248">MyContext(ObjectContext, bool)</span></span> |<span data-ttu-id="fc4f6-249">ElasticScaleContext (ShardMap TKey, ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-249">ElasticScaleContext(ShardMap, TKey, ObjectContext, bool)</span></span> |<span data-ttu-id="fc4f6-250">DbContext (ObjectContext, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-250">DbContext(ObjectContext, bool)</span></span> |<span data-ttu-id="fc4f6-251">nieuwe Hallo-constructor moet tooensure die een verbinding in Hallo die ObjectContext als invoer doorgegeven omgeleid tooa verbinding beheerd door de elastische Schaalfunctionaliteit is.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-251">hello new constructor needs tooensure that any connection in hello ObjectContext passed as an input is re-routed tooa connection managed by Elastic Scale.</span></span> <span data-ttu-id="fc4f6-252">Een gedetailleerde discussie over ObjectContexts valt buiten bereik Hallo van dit document.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-252">A detailed discussion of ObjectContexts is beyond hello scope of this document.</span></span> |
| <span data-ttu-id="fc4f6-253">MyContext (DbConnection, DbCompiledModel, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-253">MyContext(DbConnection, DbCompiledModel,bool)</span></span> |<span data-ttu-id="fc4f6-254">ElasticScaleContext (ShardMap TKey, DbCompiledModel, bool)</span><span class="sxs-lookup"><span data-stu-id="fc4f6-254">ElasticScaleContext(ShardMap, TKey, DbCompiledModel, bool)</span></span> |<span data-ttu-id="fc4f6-255">DbContext (DbConnection, DbCompiledModel, bool);</span><span class="sxs-lookup"><span data-stu-id="fc4f6-255">DbContext(DbConnection, DbCompiledModel, bool);</span></span> |<span data-ttu-id="fc4f6-256">Hallo verbinding moet toobe afgeleid van Hallo shard-toewijzing en het Hallo-sleutel.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-256">hello connection needs toobe inferred from hello shard map and hello key.</span></span> <span data-ttu-id="fc4f6-257">Hallo verbinding kan niet worden opgegeven als invoer (tenzij deze invoer is al Hallo shard-toewijzing en Hallo sleutel).</span><span class="sxs-lookup"><span data-stu-id="fc4f6-257">hello connection cannot be provided as an input (unless that input was already using hello shard map and hello key).</span></span> <span data-ttu-id="fc4f6-258">Model en Booleaanse waarde doorgegeven toohello basisklassenconstructor.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-258">Model and Boolean are passed on toohello base class constructor.</span></span> |

## <a name="shard-schema-deployment-through-ef-migrations"></a><span data-ttu-id="fc4f6-259">Implementatie van de shard-schema via EF-migraties</span><span class="sxs-lookup"><span data-stu-id="fc4f6-259">Shard schema deployment through EF migrations</span></span>
<span data-ttu-id="fc4f6-260">Automatische Schemabeheer is voor uw gemak geleverd door Hallo Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-260">Automatic schema management is a convenience provided by hello Entity Framework.</span></span> <span data-ttu-id="fc4f6-261">In de context van de Hallo van toepassingen met elastische database-hulpprogramma's, willen we tooretain deze mogelijkheid tooautomatically inrichten Hallo schema gemaakt toonewly shards wanneer databases toohello shard-toepassing worden toegevoegd.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-261">In hello context of applications using elastic database tools, we want tooretain this capability tooautomatically provision hello schema toonewly created shards when databases are added toohello sharded application.</span></span> <span data-ttu-id="fc4f6-262">Hallo primaire gebruiksvoorbeeld is tooincrease capaciteit op Hallo gegevenslaag voor shard-toepassingen met EF.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-262">hello primary use case is tooincrease capacity at hello data tier for sharded applications using EF.</span></span> <span data-ttu-id="fc4f6-263">Afhankelijk van de EF mogelijkheden voor het Schemabeheer van beperkt Hallo database beheer inspanning met een gebouwd op EF shard-toepassing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-263">Relying on EF’s capabilities for schema management reduces hello database administration effort with a sharded application built on EF.</span></span> 

<span data-ttu-id="fc4f6-264">Schema-implementatie via EF migraties werkt het beste op **nog niet gelezen verbindingen**.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-264">Schema deployment through EF migrations works best on **unopened connections**.</span></span> <span data-ttu-id="fc4f6-265">Dit is daarentegen toohello scenario voor het gegevensafhankelijke routering die afhankelijk van Hallo geopend verbinding geleverd door Hallo elastische databaseclient-API is.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-265">This is in contrast toohello scenario for data dependent routing that relies on hello opened connection provided by hello elastic database client API.</span></span> <span data-ttu-id="fc4f6-266">Een ander verschil is Hallo consistentie vereiste: tijdens het wenselijk tooensure consistentie voor alle gegevensafhankelijke routering verbindingen tooprotect tegen manipulatie van gelijktijdige shard-kaart, het is niet een probleem met het initiële schema implementatie tooa nieuwe database die nog niet is geregistreerd in Hallo shard-kaart, en nog niet is toegewezen toohold shardlets heeft.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-266">Another difference is hello consistency requirement: While desirable tooensure consistency for all data-dependent routing connections tooprotect against concurrent shard map manipulation, it is not a concern with initial schema deployment tooa new database that has not yet been registered in hello shard map, and not yet been allocated toohold shardlets.</span></span> <span data-ttu-id="fc4f6-267">We kunnen daarom zijn afhankelijk van de reguliere databaseverbindingen voor dit scenario's, zoals het tegengestelde toodata-afhankelijke routering.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-267">We can therefore rely on regular database connections for this scenarios, as opposed toodata-dependent routing.</span></span>  

<span data-ttu-id="fc4f6-268">Dit leidt tooan benadering waarbij schema implementatie via EF migraties met registratie van de nieuwe database Hallo Hallo nauw is gekoppeld als een shard in van de toepassing hello shard-toewijzing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-268">This leads tooan approach where schema deployment through EF migrations is tightly coupled with hello registration of hello new database as a shard in hello application’s shard map.</span></span> <span data-ttu-id="fc4f6-269">Dit is afhankelijk van Hallo volgende vereisten:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-269">This relies on hello following prerequisites:</span></span> 

* <span data-ttu-id="fc4f6-270">Hallo database is al gemaakt.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-270">hello database has already been created.</span></span> 
* <span data-ttu-id="fc4f6-271">Hallo-database is leeg: deze bevat geen gebruikersschema en geen gebruikersgegevens.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-271">hello database is empty - it holds no user schema and no user data.</span></span>
* <span data-ttu-id="fc4f6-272">Hallo-database kan niet nog toegankelijk via Hallo elastische databaseclient-API's voor het doorsturen van afhankelijk zijn van gegevens.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-272">hello database cannot yet be accessed through hello elastic database client APIs for data-dependent routing.</span></span> 

<span data-ttu-id="fc4f6-273">Met deze vereisten is voldaan, maken we een gewone niet is geopend **SqlConnection** tookick uit EF migraties voor schema-implementatie.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-273">With these prerequisites in place, we can create a regular un-opened **SqlConnection** tookick off EF migrations for schema deployment.</span></span> <span data-ttu-id="fc4f6-274">Hallo volgende codevoorbeeld ziet u deze methode.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-274">hello following code sample illustrates this approach.</span></span> 

        // Enter a new shard - i.e. an empty database - toohello shard map, allocate a first tenant tooit  
        // and kick off EF intialization of hello database toodeploy schema 

        public void RegisterNewShard(string server, string database, string connStr, int key) 
        { 

            Shard shard = this.ShardMap.CreateShard(new ShardLocation(server, database)); 

            SqlConnectionStringBuilder connStrBldr = new SqlConnectionStringBuilder(connStr); 
            connStrBldr.DataSource = server; 
            connStrBldr.InitialCatalog = database; 

            // Go into a DbContext tootrigger migrations and schema deployment for hello new shard. 
            // This requires an un-opened connection. 
            using (var db = new ElasticScaleContext<int>(connStrBldr.ConnectionString)) 
            { 
                // Run a query tooengage EF migrations 
                (from b in db.Blogs 
                    select b).Count(); 
            } 

            // Register hello mapping of hello tenant toohello shard in hello shard map. 
            // After this step, data-dependent routing on hello shard map can be used 

            this.ShardMap.CreatePointMapping(key, shard); 
        } 


<span data-ttu-id="fc4f6-275">Dit voorbeeld wordt de methode Hallo **RegisterNewShard** dat registers shard in Hallo shard-kaart, Hallo Hallo schema via EF migraties implementeert en een toewijzing van een sleutel toohello sharding shard bewaart.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-275">This sample shows hello method **RegisterNewShard** that registers hello shard in hello shard map, deploys hello schema through EF migrations, and stores a mapping of a sharding key toohello shard.</span></span> <span data-ttu-id="fc4f6-276">Is afhankelijk van een constructor Hallo **DbContext** subklasse (**ElasticScaleContext** in Hallo steekproef) waarmee een SQL-verbindingsreeks als invoer.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-276">It relies on a constructor of hello **DbContext** subclass (**ElasticScaleContext** in hello sample) that takes a SQL connection string as input.</span></span> <span data-ttu-id="fc4f6-277">Hallo-code van deze constructor is ongecompliceerde, als het volgende voorbeeld ziet u Hallo:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-277">hello code of this constructor is straight-forward, as hello following example shows:</span></span> 

        // C'tor toodeploy schema and migrations tooa new shard 
        protected internal ElasticScaleContext(string connectionString) 
            : base(SetInitializerForConnection(connectionString)) 
        { 
        } 

        // Only static methods are allowed in calls into base class c'tors 
        private static string SetInitializerForConnection(string connnectionString) 
        { 
            // We want existence checks so that hello schema can get deployed 
            Database.SetInitializer<ElasticScaleContext<T>>( 
        new CreateDatabaseIfNotExists<ElasticScaleContext<T>>()); 

            return connnectionString; 
        } 

<span data-ttu-id="fc4f6-278">Mogelijk gebruikt een versie van Hallo-constructor die zijn overgenomen van de basisklasse Hallo Hallo.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-278">One might have used hello version of hello constructor inherited from hello base class.</span></span> <span data-ttu-id="fc4f6-279">Maar Hallo code behoeften tooensure die standaard initialisatiefunctie voor EF Hallo wordt gebruikt om verbinding te maken.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-279">But hello code needs tooensure that hello default initializer for EF is used when connecting.</span></span> <span data-ttu-id="fc4f6-280">Daarom Hallo korte detour Hallo aan de statische methode voordat u aan Hallo basisklassenconstructor met Hallo-verbindingsreeks.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-280">Hence hello short detour into hello static method before calling into hello base class constructor with hello connection string.</span></span> <span data-ttu-id="fc4f6-281">Houd er rekening mee dat in een andere app-domein of het proces tooensure Hallo initialisatiefunctie-instellingen voor EF niet conflicteren Hallo registratie van shards moet worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-281">Note that hello registration of shards should run in a different app domain or process tooensure that hello initializer settings for EF do not conflict.</span></span> 

## <a name="limitations"></a><span data-ttu-id="fc4f6-282">Beperkingen</span><span class="sxs-lookup"><span data-stu-id="fc4f6-282">Limitations</span></span>
<span data-ttu-id="fc4f6-283">Hallo-methoden die worden beschreven in dit document leidt tot een aantal beperkingen:</span><span class="sxs-lookup"><span data-stu-id="fc4f6-283">hello approaches outlined in this document entail a couple of limitations:</span></span> 

* <span data-ttu-id="fc4f6-284">EF-toepassingen die gebruikmaken van **LocalDb** moet eerst toomigrate tooa reguliere SQL Server-database voordat u de clientbibliotheek voor elastische database.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-284">EF applications that use **LocalDb** first need toomigrate tooa regular SQL Server database before using elastic database client library.</span></span> <span data-ttu-id="fc4f6-285">Een toepassing via sharding uitbreiden met elastisch schalen is niet mogelijk met **LocalDb**.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-285">Scaling out an application through sharding with Elastic Scale is not possible with **LocalDb**.</span></span> <span data-ttu-id="fc4f6-286">Houd er rekening mee dat ontwikkeling nog steeds kunt gebruiken **LocalDb**.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-286">Note that development can still use **LocalDb**.</span></span> 
* <span data-ttu-id="fc4f6-287">Alle wijzigingen toohello toepassingen die impliceren schemawijzigingen database moet toogo via EF migraties op alle shards.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-287">Any changes toohello application that imply database schema changes need toogo through EF migrations on all shards.</span></span> <span data-ttu-id="fc4f6-288">Hallo voorbeeldcode voor dit document biedt niet laten zien hoe toodo dit.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-288">hello sample code for this document does not demonstrate how toodo this.</span></span> <span data-ttu-id="fc4f6-289">Overweeg het gebruik van de Database bijwerken met een parameter ConnectionString tooiterate via alle shards; of extract Hallo T-SQL-script voor Hallo in behandeling zijnde migratie met behulp van de Update-Database met Hallo - Script optie en toepassing hello T-SQL-script tooyour shards.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-289">Consider using Update-Database with a ConnectionString parameter tooiterate over all shards; or extract hello T-SQL script for hello pending migration using Update-Database with hello -Script option and apply hello T-SQL script tooyour shards.</span></span>  
* <span data-ttu-id="fc4f6-290">Een aanvraag opgegeven, wordt ervan uitgegaan dat alle van de verwerking van de database zich in een enkel shard aangeduid met de Hallo sharding sleutel van het Hallo-aanvraag.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-290">Given a request, it is assumed that all of its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="fc4f6-291">Echter, deze aanname niet altijd bijhoudt true.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-291">However, this assumption does not always hold true.</span></span> <span data-ttu-id="fc4f6-292">Bijvoorbeeld, wanneer is het niet mogelijk toomake een sharding-sleutel beschikbaar.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-292">For example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="fc4f6-293">tooaddress deze, Hallo clientbibliotheek biedt Hallo **MultiShardQuery** klasse die een abstractie van de verbinding voor het uitvoeren van query's via meerdere shards implementeert.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-293">tooaddress this, hello client library provides hello **MultiShardQuery** class that implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="fc4f6-294">Learning toouse hello **MultiShardQuery** in combinatie met EF valt buiten bereik Hallo van dit document</span><span class="sxs-lookup"><span data-stu-id="fc4f6-294">Learning toouse hello **MultiShardQuery** in combination with EF is beyond hello scope of this document</span></span>

## <a name="conclusion"></a><span data-ttu-id="fc4f6-295">Conclusie</span><span class="sxs-lookup"><span data-stu-id="fc4f6-295">Conclusion</span></span>
<span data-ttu-id="fc4f6-296">Hallo stappen die worden beschreven in dit document, EF toepassingen kunnen gebruikmaken van Hallo elastische database clientbibliotheek van mogelijkheden voor gegevens afhankelijk routering door een constructors Hallo refactoring **DbContext** subklassen gebruikt in Hallo EF de toepassing.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-296">Through hello steps outlined in this document, EF applications can use hello elastic database client library's capability for data dependent routing by refactoring constructors of hello **DbContext** subclasses used in hello EF application.</span></span> <span data-ttu-id="fc4f6-297">Deze limieten Hallo wijzigingen vereist toothose plaatsen waar **DbContext** klassen bestaan al.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-297">This limits hello  changes required toothose places where **DbContext** classes already exist.</span></span> <span data-ttu-id="fc4f6-298">EF-toepassingen kunnen bovendien toobenefit uit schema voor automatische implementatie gaan door het combineren van Hallo stappen die Hallo nodig EF migraties met Hallo registratie van nieuwe shards en toewijzingen in de shard-toewijzing Hallo aanroepen.</span><span class="sxs-lookup"><span data-stu-id="fc4f6-298">In addition, EF applications can continue toobenefit from automatic schema deployment by combining hello steps that invoke hello necessary EF migrations with hello registration of new shards and mappings in hello shard map.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-use-entity-framework-applications-visual-studio/sample.png
