---
title: Geo-replicatie configureren voor Azure SQL Database met Transact-SQL | Microsoft Docs
description: Geo-replicatie configureren voor Azure SQL Database Transact-SQL met
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: d94d89a6-3234-46c5-8279-5eb8daad10ac
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: carlrab
ms.openlocfilehash: e5011c1c67e051616d53621b72e46ba894ca3c02
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="configure-active-geo-replication-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="919ef-103">Actieve geo-replicatie configureren voor Azure SQL Database met Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="919ef-103">Configure active geo-replication for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="919ef-104">In dit artikel leest u hoe het configureren van actieve geo-replicatie voor een Azure SQL Database met Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="919ef-104">This article shows you how to configure active geo-replication for an Azure SQL Database with Transact-SQL.</span></span>

<span data-ttu-id="919ef-105">Zie voor het initiëren van failover met Transact-SQL [initiëren van een geplande of niet-geplande failover voor Azure SQL Database met Transact-SQL](sql-database-geo-replication-failover-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="919ef-105">To initiate failover using Transact-SQL, see [Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL](sql-database-geo-replication-failover-transact-sql.md).</span></span>

> [!NOTE]
> <span data-ttu-id="919ef-106">Wanneer u actieve geo-replicatie (leesbare secundaire replica's) voor herstel na noodgevallen gebruikt moet u een failover-groep voor alle databases in een toepassing waarmee automatisch en transparant failover configureren.</span><span class="sxs-lookup"><span data-stu-id="919ef-106">When you use active geo-replication (readable secondaries) for disaster recovery you should configure a failover group for all databases within an application to enable automatic and transparent failover.</span></span> <span data-ttu-id="919ef-107">Deze functie is in preview.</span><span class="sxs-lookup"><span data-stu-id="919ef-107">This feature is in preview.</span></span> <span data-ttu-id="919ef-108">Zie voor meer informatie [automatische failover groepen en geo-replicatie](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="919ef-108">For more information see [Auto-failover groups and geo-replication](sql-database-geo-replication-overview.md).</span></span>
> 
> 

<span data-ttu-id="919ef-109">Actieve geo-replicatie configureren met behulp van Transact-SQL, moet u het volgende:</span><span class="sxs-lookup"><span data-stu-id="919ef-109">To configure active geo-replication using Transact-SQL, you need the following:</span></span>

* <span data-ttu-id="919ef-110">Een Azure-abonnement</span><span class="sxs-lookup"><span data-stu-id="919ef-110">An Azure subscription</span></span>
* <span data-ttu-id="919ef-111">Een logische Azure SQL Database-server <MyLocalServer> en een SQL-database <MyDB> -de primaire database die u wilt repliceren</span><span class="sxs-lookup"><span data-stu-id="919ef-111">A logical Azure SQL Database server <MyLocalServer> and a SQL database <MyDB> - The primary database that you want to replicate</span></span>
* <span data-ttu-id="919ef-112">Een of meer logische Azure SQL Database-servers < MySecondaryServer(n) > - de logische servers die de servers van partners waarin u secundaire databases maakt</span><span class="sxs-lookup"><span data-stu-id="919ef-112">One or more logical Azure SQL Database servers <MySecondaryServer(n)> - The logical servers that will be the partner servers in which you will create secondary databases</span></span>
* <span data-ttu-id="919ef-113">Een aanmelding die op de primaire DBManager</span><span class="sxs-lookup"><span data-stu-id="919ef-113">A login that is DBManager on the primary</span></span>
* <span data-ttu-id="919ef-114">Hebt u db_ownership van de lokale database dat u geo-replicatie gaat</span><span class="sxs-lookup"><span data-stu-id="919ef-114">Have db_ownership of the local database that you will geo-replicate</span></span>
* <span data-ttu-id="919ef-115">DBManager worden op de partner (s) waarvoor u geo-replicatie wilt configureren</span><span class="sxs-lookup"><span data-stu-id="919ef-115">Be DBManager on the partner server(s) to which you will configure geo-replication</span></span>
* <span data-ttu-id="919ef-116">De nieuwste versie van SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="919ef-116">The newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="919ef-117">Het wordt aanbevolen om altijd de nieuwste versie van Management Studio te gebruiken, zodat uw versie gesynchroniseerd blijft met updates voor Microsoft Azure en SQL Database.</span><span class="sxs-lookup"><span data-stu-id="919ef-117">It is recommended that you always use the latest version of Management Studio to remain synchronized with updates to Microsoft Azure and SQL Database.</span></span> <span data-ttu-id="919ef-118">[SQL Server Management Studio bijwerken](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="919ef-118">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
> 
> 

## <a name="add-secondary-database"></a><span data-ttu-id="919ef-119">Secundaire database toevoegen</span><span class="sxs-lookup"><span data-stu-id="919ef-119">Add secondary database</span></span>
<span data-ttu-id="919ef-120">U kunt de **ALTER DATABASE** instructie voor het maken van een secundaire geo-replicatie-database op een partnerserver.</span><span class="sxs-lookup"><span data-stu-id="919ef-120">You can use the **ALTER DATABASE** statement to create a geo-replicated secondary database on a partner server.</span></span> <span data-ttu-id="919ef-121">U deze instructie niet uitvoeren op de database master van de server met de database worden gerepliceerd.</span><span class="sxs-lookup"><span data-stu-id="919ef-121">You execute this statement on the master database of the server containing the database to be replicated.</span></span> <span data-ttu-id="919ef-122">De database geogerepliceerde (de ' primaire database') heeft dezelfde naam als de database wordt gerepliceerd en, standaard, hebben hetzelfde serviceniveau als de primaire database.</span><span class="sxs-lookup"><span data-stu-id="919ef-122">The geo-replicated database (the "primary database") will have the same name as the database being replicated and will, by default, have the same service level as the primary database.</span></span> <span data-ttu-id="919ef-123">De secundaire database kunnen worden gelezen of niet-leesbare en kan een individuele database of in een elastische pool.</span><span class="sxs-lookup"><span data-stu-id="919ef-123">The secondary database can be readable or non-readable, and can be a single database or in an elastic pool.</span></span> <span data-ttu-id="919ef-124">Zie voor meer informatie [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) en [Servicelagen](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="919ef-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>
<span data-ttu-id="919ef-125">Nadat de secundaire database is gemaakt en wordt gemaakt, begint gegevens asynchroon van de primaire database te repliceren.</span><span class="sxs-lookup"><span data-stu-id="919ef-125">After the secondary database is created and seeded, data will begin replicating asynchronously from the primary database.</span></span> <span data-ttu-id="919ef-126">De volgende stappen wordt beschreven hoe u geo-replicatie configureren met behulp van Management Studio.</span><span class="sxs-lookup"><span data-stu-id="919ef-126">The steps below describe how to configure geo-replication using Management Studio.</span></span> <span data-ttu-id="919ef-127">Stappen voor het maken van niet-leesbare en leesbare secundaire databases, als een individuele database of in een elastische pool zijn opgegeven.</span><span class="sxs-lookup"><span data-stu-id="919ef-127">Steps to create non-readable and readable secondaries, either as a single database or in an elastic pool, are provided.</span></span>

> [!NOTE]
> <span data-ttu-id="919ef-128">Als een database op de opgegeven partner-server met dezelfde naam als de primaire database bestaat, de opdracht mislukt.</span><span class="sxs-lookup"><span data-stu-id="919ef-128">If a database exists on the specified partner server with the same name as the primary database the command will fail.</span></span>
> 

### <a name="add-readable-secondary-single-database"></a><span data-ttu-id="919ef-129">Leesbare secundaire database (één database) toevoegen</span><span class="sxs-lookup"><span data-stu-id="919ef-129">Add readable secondary (single database)</span></span>
<span data-ttu-id="919ef-130">Gebruik de volgende stappen voor het maken van een leesbare secundaire database als een individuele database.</span><span class="sxs-lookup"><span data-stu-id="919ef-130">Use the following steps to create a readable secondary as a single database.</span></span>

1. <span data-ttu-id="919ef-131">In de Management Studio verbinding met uw logische Azure SQL Database-server.</span><span class="sxs-lookup"><span data-stu-id="919ef-131">In Management Studio, connect to your Azure SQL Database logical server.</span></span>
2. <span data-ttu-id="919ef-132">Open de map Databases, vouw de **systeemdatabases** map, klik met de rechtermuisknop op **master**, en klik vervolgens op **nieuwe Query**.</span><span class="sxs-lookup"><span data-stu-id="919ef-132">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="919ef-133">Gebruik de volgende **ALTER DATABASE** instructie naar een lokale database in een geo-replicatie primair met een leesbare secundaire database op een secundaire server maken.</span><span class="sxs-lookup"><span data-stu-id="919ef-133">Use the following **ALTER DATABASE** statement to make a local database into a geo-replication primary with a readable secondary database on a secondary server.</span></span>
   
        ALTER DATABASE <MyDB>
           ADD SECONDARY ON SERVER <MySecondaryServer2> WITH (ALLOW_CONNECTIONS = ALL);
4. <span data-ttu-id="919ef-134">Klik op **Uitvoeren** om de query uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="919ef-134">Click **Execute** to run the query.</span></span>

### <a name="add-readable-secondary-elastic-pool"></a><span data-ttu-id="919ef-135">Leesbare secundaire database (elastische pool) toevoegen</span><span class="sxs-lookup"><span data-stu-id="919ef-135">Add readable secondary (elastic pool)</span></span>
<span data-ttu-id="919ef-136">Gebruik de volgende stappen voor het maken van een leesbare secundaire database in een elastische pool.</span><span class="sxs-lookup"><span data-stu-id="919ef-136">Use the following steps to create a readable secondary in an elastic pool.</span></span>

1. <span data-ttu-id="919ef-137">In de Management Studio verbinding met uw logische Azure SQL Database-server.</span><span class="sxs-lookup"><span data-stu-id="919ef-137">In Management Studio, connect to your Azure SQL Database logical server.</span></span>
2. <span data-ttu-id="919ef-138">Open de map Databases, vouw de **systeemdatabases** map, klik met de rechtermuisknop op **master**, en klik vervolgens op **nieuwe Query**.</span><span class="sxs-lookup"><span data-stu-id="919ef-138">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="919ef-139">Gebruik de volgende **ALTER DATABASE** instructie naar een lokale database in een geo-replicatie primair met een leesbare secundaire database op een secundaire server in een elastische pool maken.</span><span class="sxs-lookup"><span data-stu-id="919ef-139">Use the following **ALTER DATABASE** statement to make a local database into a geo-replication primary with a readable secondary database on a secondary server in an elastic pool.</span></span>
   
        ALTER DATABASE <MyDB>
           ADD SECONDARY ON SERVER <MySecondaryServer4> WITH (ALLOW_CONNECTIONS = ALL
           , SERVICE_OBJECTIVE = ELASTIC_POOL (name = MyElasticPool2));
4. <span data-ttu-id="919ef-140">Klik op **Uitvoeren** om de query uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="919ef-140">Click **Execute** to run the query.</span></span>

## <a name="remove-secondary-database"></a><span data-ttu-id="919ef-141">Secundaire database verwijderen</span><span class="sxs-lookup"><span data-stu-id="919ef-141">Remove secondary database</span></span>
<span data-ttu-id="919ef-142">U kunt de **ALTER DATABASE** instructie de replicatiesamenwerking tussen een secundaire database en de primaire permanent is beëindigd.</span><span class="sxs-lookup"><span data-stu-id="919ef-142">You can use the **ALTER DATABASE** statement to permanently terminate the replication partnership between a secondary database and its primary.</span></span> <span data-ttu-id="919ef-143">Deze instructie is uitgevoerd voor de database master waarop de primaire database zich bevindt.</span><span class="sxs-lookup"><span data-stu-id="919ef-143">This statement is executed on the master database on which the primary database resides.</span></span> <span data-ttu-id="919ef-144">Na de relatie wordt beëindigd wordt de secundaire database een normale lezen / schrijven-database.</span><span class="sxs-lookup"><span data-stu-id="919ef-144">After the relationship termination, the secondary database becomes a regular read-write database.</span></span> <span data-ttu-id="919ef-145">De opdracht is geslaagd, maar de secundaire alleen-lezen worden nadat de verbinding is hersteld als de verbinding met de secundaire database verbroken is.</span><span class="sxs-lookup"><span data-stu-id="919ef-145">If the connectivity to secondary database is broken the command succeeds but the secondary will become read-write after connectivity is restored.</span></span> <span data-ttu-id="919ef-146">Zie voor meer informatie [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) en [Servicelagen](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="919ef-146">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="919ef-147">Gebruik de volgende stappen secundaire geo-replicatie verwijderen uit een associatie geo-replicatie.</span><span class="sxs-lookup"><span data-stu-id="919ef-147">Use the following steps to remove geo-replicated secondary from a geo-replication partnership.</span></span>

1. <span data-ttu-id="919ef-148">In de Management Studio verbinding met uw logische Azure SQL Database-server.</span><span class="sxs-lookup"><span data-stu-id="919ef-148">In Management Studio, connect to your Azure SQL Database logical server.</span></span>
2. <span data-ttu-id="919ef-149">Open de map Databases, vouw de **systeemdatabases** map, klik met de rechtermuisknop op **master**, en klik vervolgens op **nieuwe Query**.</span><span class="sxs-lookup"><span data-stu-id="919ef-149">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="919ef-150">Gebruik de volgende **ALTER DATABASE** instructie voor het verwijderen van een secundaire geo-replicatie.</span><span class="sxs-lookup"><span data-stu-id="919ef-150">Use the following **ALTER DATABASE** statement to remove a geo-replicated secondary.</span></span>
   
        ALTER DATABASE <MyDB>
           REMOVE SECONDARY ON SERVER <MySecondaryServer1>;
4. <span data-ttu-id="919ef-151">Klik op **Uitvoeren** om de query uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="919ef-151">Click **Execute** to run the query.</span></span>

## <a name="monitor-active-geo-replication-configuration-and-health"></a><span data-ttu-id="919ef-152">Controleren van actieve geo-replicatie de configuratie en status</span><span class="sxs-lookup"><span data-stu-id="919ef-152">Monitor active geo-replication configuration and health</span></span>

<span data-ttu-id="919ef-153">Monitoringtaken zijn bewaking van de configuratie van de geo-replicatie en de bewaking van de status van replicatie van gegevens.</span><span class="sxs-lookup"><span data-stu-id="919ef-153">Monitoring tasks include monitoring of the geo-replication configuration and monitoring data replication health.</span></span>  <span data-ttu-id="919ef-154">U kunt de **sys.dm_geo_replication_links** dynamische Beheerweergave in de database master om informatie te retourneren over alle afgesloten replicatiekoppelingen voor elke database op de logische Azure SQL Database-server.</span><span class="sxs-lookup"><span data-stu-id="919ef-154">You can use the **sys.dm_geo_replication_links** dynamic management view in the master database to return information about all exiting replication links for each database on the Azure SQL Database logical server.</span></span> <span data-ttu-id="919ef-155">Deze weergave bevat een rij voor elk van de replicatiekoppeling tussen de primaire en secundaire databases.</span><span class="sxs-lookup"><span data-stu-id="919ef-155">This view contains a row for each of the replication link between primary and secondary databases.</span></span> <span data-ttu-id="919ef-156">U kunt de **sys.dm_replication_link_status** dynamische Beheerweergave te retourneren van een rij voor elke Azure SQL Database die momenteel bezig een replicatiekoppeling voor replicatie.</span><span class="sxs-lookup"><span data-stu-id="919ef-156">You can use the **sys.dm_replication_link_status** dynamic management view to return a row for each Azure SQL Database that is currently engaged in a replication replication link.</span></span> <span data-ttu-id="919ef-157">Dit omvat zowel primaire als secundaire databases.</span><span class="sxs-lookup"><span data-stu-id="919ef-157">This includes both primary and secondary databases.</span></span> <span data-ttu-id="919ef-158">Als meer dan één continue replicatie in een koppeling voor een bepaalde primaire database bestaat, wordt in deze tabel een rij bevat voor elk van de relaties.</span><span class="sxs-lookup"><span data-stu-id="919ef-158">If more than one continuous replication link exists for a given primary database, this table contains a row for each of the relationships.</span></span> <span data-ttu-id="919ef-159">De weergave wordt gemaakt in alle databases, met inbegrip van de logische-master.</span><span class="sxs-lookup"><span data-stu-id="919ef-159">The view is created in all databases, including the logical master.</span></span> <span data-ttu-id="919ef-160">Uitvoeren van query's in deze weergave in de logische master retourneert echter een lege set.</span><span class="sxs-lookup"><span data-stu-id="919ef-160">However, querying this view in the logical master returns an empty set.</span></span> <span data-ttu-id="919ef-161">U kunt de **sys.dm_operation_status bevat** dynamische Beheerweergave weer te geven van de status voor alle databasequery bewerkingen, inclusief de status van de replicatiekoppelingen.</span><span class="sxs-lookup"><span data-stu-id="919ef-161">You can use the **sys.dm_operation_status** dynamic management view to show the status for all database operations including the status of the replication links.</span></span> <span data-ttu-id="919ef-162">Zie voor meer informatie [sys.geo_replication_links (Azure SQL Database)](https://msdn.microsoft.com/library/mt575501.aspx), [sys.dm_geo_replication_link_status (Azure SQL Database)](https://msdn.microsoft.com/library/mt575504.aspx), en [sys.dm_operation_status bevat (Azure SQL Database)](https://msdn.microsoft.com/library/dn270022.aspx).</span><span class="sxs-lookup"><span data-stu-id="919ef-162">For more information, see [sys.geo_replication_links (Azure SQL Database)](https://msdn.microsoft.com/library/mt575501.aspx), [sys.dm_geo_replication_link_status (Azure SQL Database)](https://msdn.microsoft.com/library/mt575504.aspx), and [sys.dm_operation_status (Azure SQL Database)](https://msdn.microsoft.com/library/dn270022.aspx).</span></span>

<span data-ttu-id="919ef-163">Gebruik de volgende stappen voor het bewaken van de verbinding van een actieve geo-replicatie.</span><span class="sxs-lookup"><span data-stu-id="919ef-163">Use the following steps to monitor an active geo-replication partnership.</span></span>

1. <span data-ttu-id="919ef-164">In de Management Studio verbinding met uw logische Azure SQL Database-server.</span><span class="sxs-lookup"><span data-stu-id="919ef-164">In Management Studio, connect to your Azure SQL Database logical server.</span></span>
2. <span data-ttu-id="919ef-165">Open de map Databases, vouw de **systeemdatabases** map, klik met de rechtermuisknop op **master**, en klik vervolgens op **nieuwe Query**.</span><span class="sxs-lookup"><span data-stu-id="919ef-165">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="919ef-166">Gebruik de volgende instructie wilt weergeven van alle databases met geo-replicatiekoppelingen.</span><span class="sxs-lookup"><span data-stu-id="919ef-166">Use the following statement to show all databases with geo-replication links.</span></span>
   
        SELECT database_id, start_date, modify_date, partner_server, partner_database, replication_state_desc, role, secondary_allow_connections_desc FROM sys.geo_replication_links;
4. <span data-ttu-id="919ef-167">Klik op **Uitvoeren** om de query uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="919ef-167">Click **Execute** to run the query.</span></span>
5. <span data-ttu-id="919ef-168">Open de map Databases, vouw de **systeemdatabases** map, klik met de rechtermuisknop op **mijndb**, en klik vervolgens op **nieuwe Query**.</span><span class="sxs-lookup"><span data-stu-id="919ef-168">Open the Databases folder, expand the **System Databases** folder, right-click on **MyDB**, and then click **New Query**.</span></span>
6. <span data-ttu-id="919ef-169">Gebruik de volgende instructie voor het weergeven van de replicatie lag en de laatste replicatie van mijn secundaire databases van mijndb tijd.</span><span class="sxs-lookup"><span data-stu-id="919ef-169">Use the following statement to show the replication lags and last replication time of my secondary databases of MyDB.</span></span>
   
        SELECT link_guid, partner_server, last_replication, replication_lag_sec FROM sys.dm_geo_replication_link_status
7. <span data-ttu-id="919ef-170">Klik op **Uitvoeren** om de query uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="919ef-170">Click **Execute** to run the query.</span></span>
8. <span data-ttu-id="919ef-171">Gebruik de volgende instructie om de meest recente geo-replicatie-bewerkingen die zijn gekoppeld aan database mijndb weer te geven.</span><span class="sxs-lookup"><span data-stu-id="919ef-171">Use the following statement to show the most recent geo-replication operations associated with database MyDB.</span></span>
   
        SELECT * FROM sys.dm_operation_status where major_resource_id = 'MyDB'
        ORDER BY start_time DESC
9. <span data-ttu-id="919ef-172">Klik op **Uitvoeren** om de query uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="919ef-172">Click **Execute** to run the query.</span></span>

## <a name="next-steps"></a><span data-ttu-id="919ef-173">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="919ef-173">Next steps</span></span>
* <span data-ttu-id="919ef-174">Zie voor meer informatie over failover-groepen en actieve geo-replicatie - [failover-groepen](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="919ef-174">To learn more about failover groups and active geo-replication, see - [Failover groups](sql-database-geo-replication-overview.md)</span></span>
* <span data-ttu-id="919ef-175">Zie voor een overzicht van zakelijke continuïteit en scenario's [Business continuity-overzicht](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="919ef-175">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>

