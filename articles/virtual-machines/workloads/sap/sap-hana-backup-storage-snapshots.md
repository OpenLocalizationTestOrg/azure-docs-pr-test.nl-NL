---
title: SAP HANA Azure back-up op basis van opslag-momentopnamen | Microsoft Docs
description: Er zijn twee primaire back-mogelijkheden voor SAP HANA op virtuele machines in Azure, in dit artikel bevat informatie over SAP HANA-back-up op basis van opslag-momentopnamen
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: f332b8ac091b75a23489ac27f15ad1fd10d24ec6
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/18/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="0b81b-103">Back-up van SAP HANA op basis van opslagmomentopnamen</span><span class="sxs-lookup"><span data-stu-id="0b81b-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="0b81b-104">Inleiding</span><span class="sxs-lookup"><span data-stu-id="0b81b-104">Introduction</span></span>

<span data-ttu-id="0b81b-105">Dit maakt deel uit van een reeks drie delen met verwante artikelen op SAP HANA back-up.</span><span class="sxs-lookup"><span data-stu-id="0b81b-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="0b81b-106">[Back-handleiding voor SAP HANA op Azure Virtual Machines](sap-hana-backup-guide.md) biedt een overzicht en informatie over het aan de slag, en [SAP HANA Azure Backup op bestandsniveau](sap-hana-backup-file-level.md) wordt ingegaan op de optie back-up-bestand.</span><span class="sxs-lookup"><span data-stu-id="0b81b-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers the file-based backup option.</span></span>

<span data-ttu-id="0b81b-107">Wanneer u een VM-back-upfunctie voor een single instance alles in één demo-systeem, moet een rekening houden met een VM-back-in plaats van het beheren van HANA back-ups op het niveau van het besturingssysteem uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="0b81b-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at the OS level.</span></span> <span data-ttu-id="0b81b-108">Een alternatief is voor Azure blob-momentopnamen kopieën van afzonderlijke virtuele schijven die zijn gekoppeld aan een virtuele machine, te maken en de gegevensbestanden HANA bewaren.</span><span class="sxs-lookup"><span data-stu-id="0b81b-108">An alternative is to take Azure blob snapshots to create copies of individual virtual disks, which are attached to a virtual machine, and keep the HANA data files.</span></span> <span data-ttu-id="0b81b-109">Maar een kritiek punt app consistentie bij het maken van een VM-momentopname voor back-up of schijf terwijl het systeem actief is en actief is.</span><span class="sxs-lookup"><span data-stu-id="0b81b-109">But a critical point is app consistency when creating a VM backup or disk snapshot while the system is up and running.</span></span> <span data-ttu-id="0b81b-110">Zie _SAP HANA gegevensconsistentie bij het maken van opslag-momentopnamen_ in het bijbehorende artikel [back-up-handleiding voor SAP HANA op Azure Virtual Machines](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="0b81b-110">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="0b81b-111">SAP HANA bevat een functie die ondersteuning biedt voor dit soort opslag-momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="0b81b-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="0b81b-112">SAP HANA-momentopnamen</span><span class="sxs-lookup"><span data-stu-id="0b81b-112">SAP HANA snapshots</span></span>

<span data-ttu-id="0b81b-113">Er is een functie in SAP HANA die ondersteuning biedt voor maken van een momentopname van de opslag.</span><span class="sxs-lookup"><span data-stu-id="0b81b-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="0b81b-114">Vanaf December 2016 is er echter een beperking tot één container systemen.</span><span class="sxs-lookup"><span data-stu-id="0b81b-114">However, as of December 2016, there is a restriction to single-container systems.</span></span> <span data-ttu-id="0b81b-115">Multitenant container configuraties bieden geen ondersteuning voor dit soort databasemomentopname (Zie [momentopname maken van een opslaggroep (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="0b81b-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="0b81b-116">Dit werkt als volgt:</span><span class="sxs-lookup"><span data-stu-id="0b81b-116">It works as follows:</span></span>

- <span data-ttu-id="0b81b-117">Voorbereiden op een momentopname van de opslag door het starten van de SAP HANA-momentopname</span><span class="sxs-lookup"><span data-stu-id="0b81b-117">Prepare for a storage snapshot by initiating the SAP HANA snapshot</span></span>
- <span data-ttu-id="0b81b-118">Uitvoeren van de momentopname van de opslag (in Azure blob-momentopname bijvoorbeeld)</span><span class="sxs-lookup"><span data-stu-id="0b81b-118">Run the storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="0b81b-119">Bevestig de SAP HANA-momentopname</span><span class="sxs-lookup"><span data-stu-id="0b81b-119">Confirm the SAP HANA snapshot</span></span>

![Deze schermafbeelding ziet u dat de momentopname van een SAP HANA-gegevens kan worden gemaakt via een SQL-instructie](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="0b81b-121">Deze schermafbeelding ziet u dat de momentopname van een SAP HANA-gegevens kan worden gemaakt via een SQL-instructie.</span><span class="sxs-lookup"><span data-stu-id="0b81b-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![De momentopname wordt ook weergegeven in de back-upcatalogus in SAP HANA-Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="0b81b-123">De momentopname wordt ook weergegeven in de back-upcatalogus in SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="0b81b-123">The snapshot then also appears in the backup catalog in SAP HANA Studio.</span></span>

![Op schijf, de momentopname wordt weergegeven in de map voor SAP HANA-gegevens](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="0b81b-125">Op schijf, de momentopname wordt weergegeven in de map voor SAP HANA-gegevens.</span><span class="sxs-lookup"><span data-stu-id="0b81b-125">On disk, the snapshot shows up in the SAP HANA data directory.</span></span>

<span data-ttu-id="0b81b-126">Een heeft om ervoor te zorgen dat de consistentie van het bestandssysteem ook voordat u de momentopname van de opslag terwijl SAP HANA in de modus van de voorbereiding van momentopname is is gegarandeerd.</span><span class="sxs-lookup"><span data-stu-id="0b81b-126">One has to ensure that the file system consistency is also guaranteed before running the storage snapshot while SAP HANA is in the snapshot preparation mode.</span></span> <span data-ttu-id="0b81b-127">Zie _SAP HANA gegevensconsistentie bij het maken van opslag-momentopnamen_ in het bijbehorende artikel [back-up-handleiding voor SAP HANA op Azure Virtual Machines](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="0b81b-127">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="0b81b-128">Als de momentopname van de opslag is voltooid, is het essentieel om te bevestigen dat de SAP HANA-momentopname.</span><span class="sxs-lookup"><span data-stu-id="0b81b-128">Once the storage snapshot is done, it is critical to confirm the SAP HANA snapshot.</span></span> <span data-ttu-id="0b81b-129">Er is een overeenkomstige SQL-instructie om uit te voeren: sluiten MOMENTOPNAME van de gegevens back-up (Zie [gegevens sluiten MOMENTOPNAME instructie BACKUP (back-up en herstel)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="0b81b-129">There is a corresponding SQL statement to run: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0b81b-130">Bevestig de momentopname HANA.</span><span class="sxs-lookup"><span data-stu-id="0b81b-130">Confirm the HANA snapshot.</span></span> <span data-ttu-id="0b81b-131">Vanwege &quot;kopiëren bij schrijven&quot; SAP HANA mogelijk extra schijfruimte in momentopname-voorbereiden modus en het is niet mogelijk worden nieuwe back-ups gestart totdat de SAP HANA-momentopname is bevestigd.</span><span class="sxs-lookup"><span data-stu-id="0b81b-131">Due to &quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible to start new backups until the SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="0b81b-132">HANA VM back-ups via Azure Backup-service</span><span class="sxs-lookup"><span data-stu-id="0b81b-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="0b81b-133">Vanaf December 2016, zullen de back-upagent van de Azure Backup-service is niet beschikbaar voor virtuele Linux-machines.</span><span class="sxs-lookup"><span data-stu-id="0b81b-133">As of December 2016, the backup agent of the Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="0b81b-134">Om ervoor te gebruiken van Azure back-up op het niveau van het bestand of de map, zou een SAP HANA back-upbestanden kopiëren naar een virtuele machine van Windows en gebruik vervolgens de backup-agent.</span><span class="sxs-lookup"><span data-stu-id="0b81b-134">To make use of Azure backup on the file/directory level, one would copy SAP HANA backup files to a Windows VM and then use the backup agent.</span></span> <span data-ttu-id="0b81b-135">Anders wordt is alleen een volledige Linux VM back-up mogelijk via de Azure Backup-service.</span><span class="sxs-lookup"><span data-stu-id="0b81b-135">Otherwise, only a full Linux VM backup is possible via the Azure Backup service.</span></span> <span data-ttu-id="0b81b-136">Zie [overzicht van de functies in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="0b81b-136">See [Overview of the features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) to find out more.</span></span>

<span data-ttu-id="0b81b-137">De Azure Backup-service biedt een optie voor back-up en herstellen van een virtuele machine.</span><span class="sxs-lookup"><span data-stu-id="0b81b-137">The Azure Backup service offers an option to back up and restore a VM.</span></span> <span data-ttu-id="0b81b-138">Meer informatie over deze service en hoe het werkt vindt u in het artikel [plannen van uw back-infrastructuur van de virtuele machine in Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="0b81b-138">More information about this service and how it works can be found in the article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="0b81b-139">Er zijn twee belangrijke overwegingen volgens dat artikel:</span><span class="sxs-lookup"><span data-stu-id="0b81b-139">There are two important considerations according to that article:</span></span>

<span data-ttu-id="0b81b-140">_&quot;Voor virtuele Linux-machines zijn alleen bestandsconsistente back-ups mogelijk, omdat de Linux beschikt niet over een equivalent platform VSS.&quot;_</span><span class="sxs-lookup"><span data-stu-id="0b81b-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform to VSS.&quot;_</span></span>

<span data-ttu-id="0b81b-141">_&quot;Toepassingen wilt implementeren hun eigen &quot;-reparatietabel&quot; mechanisme op de herstelde gegevens.&quot;_</span><span class="sxs-lookup"><span data-stu-id="0b81b-141">_&quot;Applications need to implement their own &quot;fix-up&quot; mechanism on the restored data.&quot;_</span></span>

<span data-ttu-id="0b81b-142">Daarom heeft een om te controleren of dat SAP HANA is in een consistente status op de schijf wanneer de back-up wordt gestart.</span><span class="sxs-lookup"><span data-stu-id="0b81b-142">Therefore, one has to make sure SAP HANA is in a consistent state on disk when the backup starts.</span></span> <span data-ttu-id="0b81b-143">Zie _SAP HANA momentopnamen_ eerder in het document is beschreven.</span><span class="sxs-lookup"><span data-stu-id="0b81b-143">See _SAP HANA snapshots_ described earlier in the document.</span></span> <span data-ttu-id="0b81b-144">Maar er is een mogelijk probleem wanneer SAP HANA in deze momentopname voorbereiding-modus blijft.</span><span class="sxs-lookup"><span data-stu-id="0b81b-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="0b81b-145">Zie [momentopname maken van een opslaggroep (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="0b81b-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="0b81b-146">Dit artikel staat:</span><span class="sxs-lookup"><span data-stu-id="0b81b-146">That article states:</span></span>

<span data-ttu-id="0b81b-147">_&quot;Het is raadzaam om te bevestigen of een opslag-momentopnamen zo snel mogelijk afbreken nadat deze is gemaakt. Terwijl de opslag momentopname wordt voorbereid of gemaakt, wordt de momentopname relevante gegevens bevroren. Terwijl de momentopname relevante gegevens bevroren blijft, kunnen nog steeds wijzigingen aangebracht in de database. Dergelijke wijzigingen leidt niet tot de bevroren momentopname relevante gegevens worden gewijzigd. In plaats daarvan worden de wijzigingen worden geschreven naar een positie in het gegevensgebied die gescheiden van de momentopname van de opslag zijn. Wijzigingen zijn ook geschreven naar het logboek. Echter, hoe langer de momentopname relevante gegevens wordt opgeslagen bevroren, hoe meer gegevensvolume kan groeien.&quot;_</span><span class="sxs-lookup"><span data-stu-id="0b81b-147">_&quot;It is strongly recommended to confirm or abandon a storage snapshot as soon as possible after it has been created. While the storage snapshot is being prepared or created, the snapshot-relevant data is frozen. While the snapshot-relevant data remains frozen, changes can still be made in the database. Such changes will not cause the frozen snapshot-relevant data to be changed. Instead, the changes are written to positions in the data area that are separate from the storage snapshot. Changes are also written to the log. However, the longer the snapshot-relevant data is kept frozen, the more the data volume can grow.&quot;_</span></span>

<span data-ttu-id="0b81b-148">Azure back-up zorgt voor de consistentie van het bestandssysteem via Azure VM-extensies.</span><span class="sxs-lookup"><span data-stu-id="0b81b-148">Azure Backup takes care of the file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="0b81b-149">Deze uitbreidingen zijn niet beschikbaar zelfstandige en werkt alleen in combinatie met Azure Backup-service.</span><span class="sxs-lookup"><span data-stu-id="0b81b-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="0b81b-150">Het is echter nog steeds een vereiste voor het beheren van een momentopname van een SAP HANA om te garanderen van de consistentie van de app.</span><span class="sxs-lookup"><span data-stu-id="0b81b-150">Nevertheless, it is still a requirement to manage an SAP HANA snapshot to guarantee app consistency.</span></span>

<span data-ttu-id="0b81b-151">Azure Backup bestaat uit twee belangrijke fasen:</span><span class="sxs-lookup"><span data-stu-id="0b81b-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="0b81b-152">Momentopname</span><span class="sxs-lookup"><span data-stu-id="0b81b-152">Take Snapshot</span></span>
- <span data-ttu-id="0b81b-153">Gegevens overdragen naar de kluis</span><span class="sxs-lookup"><span data-stu-id="0b81b-153">Transfer data to vault</span></span>

<span data-ttu-id="0b81b-154">Een kan de momentopname SAP HANA Controleer nadat de Azure Backup-service-fase van het maken van een momentopname is voltooid.</span><span class="sxs-lookup"><span data-stu-id="0b81b-154">So one could confirm the SAP HANA snapshot once the Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="0b81b-155">Het duurt enkele minuten om te zien in de Azure portal.</span><span class="sxs-lookup"><span data-stu-id="0b81b-155">It might take several minutes to see in the Azure portal.</span></span>

![Deze afbeelding ziet u deel van de lijst van de back-uptaak van een Azure Backup-service](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="0b81b-157">Deze afbeelding ziet u deel uitmaakt van de lijst van de back-uptaak van een Azure Backup-service, die werd gebruikt voor het testen van back-up van de HANA VM.</span><span class="sxs-lookup"><span data-stu-id="0b81b-157">This figure shows part of the backup job list of an Azure Backup service, which was used to back up the HANA test VM.</span></span>

![Als u wilt de taakdetails weergeven, klikt u op de back-uptaak in de Azure portal](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="0b81b-159">Als u wilt de taakdetails weergeven, klikt u op de back-uptaak in de Azure portal.</span><span class="sxs-lookup"><span data-stu-id="0b81b-159">To show the job details, click the backup job in the Azure portal.</span></span> <span data-ttu-id="0b81b-160">Hier ziet een twee fasen.</span><span class="sxs-lookup"><span data-stu-id="0b81b-160">Here, one can see the two phases.</span></span> <span data-ttu-id="0b81b-161">Het duurt enkele minuten totdat de momentopname-fase voltooid te zien.</span><span class="sxs-lookup"><span data-stu-id="0b81b-161">It might take a few minutes until it shows the snapshot phase as completed.</span></span> <span data-ttu-id="0b81b-162">De meeste gevallen is besteed in de fase van de gegevensoverdracht.</span><span class="sxs-lookup"><span data-stu-id="0b81b-162">Most of the time is spent in the data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="0b81b-163">Back-automatisering HANA VM via Azure Backup-service</span><span class="sxs-lookup"><span data-stu-id="0b81b-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="0b81b-164">Een kan de momentopname SAP HANA handmatig bevestigen zodra de Azure Backup momentopname-fase is voltooid, zoals eerder beschreven, maar het is handig om rekening houden automation omdat een beheerder niet voor de back-uptaak lijst in de Azure-portal controleren mogelijk.</span><span class="sxs-lookup"><span data-stu-id="0b81b-164">One could manually confirm the SAP HANA snapshot once the Azure Backup snapshot phase is completed, as described earlier, but it is helpful to consider automation because an admin might not monitor the backup job list in the Azure portal.</span></span>

<span data-ttu-id="0b81b-165">Hier volgt een uitleg hoe deze kan worden bereikt via Azure PowerShell-cmdlets.</span><span class="sxs-lookup"><span data-stu-id="0b81b-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Een Azure Backup-service is gemaakt met de naam hana-backup-kluis](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="0b81b-167">Een Azure Backup-service is gemaakt met de naam van de &quot;hana-backup-kluis.&quot; De PS-opdracht **Get-AzureRmRecoveryServicesVault-naam hana-backup-kluis** opgehaald van het bijbehorende object.</span><span class="sxs-lookup"><span data-stu-id="0b81b-167">An Azure Backup service was created with the name &quot;hana-backup-vault.&quot; The PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves the corresponding object.</span></span> <span data-ttu-id="0b81b-168">Dit object wordt vervolgens gebruikt om in te stellen van de back-context weergegeven op de volgende afbeelding.</span><span class="sxs-lookup"><span data-stu-id="0b81b-168">This object is then used to set the backup context as seen on the next figure.</span></span>

![Een kunt controleren of de back-uptaak momenteel bezig](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="0b81b-170">Na het instellen van de juiste context kan een controle voor de back-uptaak momenteel bezig en zoekt u de taakdetails.</span><span class="sxs-lookup"><span data-stu-id="0b81b-170">After setting the correct context, one can check for the backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="0b81b-171">De subtaak-lijst bevat als de momentopname-fase van de Azure back-uptaak is al voltooid:</span><span class="sxs-lookup"><span data-stu-id="0b81b-171">The subtask list shows if the snapshot phase of the Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![De waarde in een lus pollen totdat deze in voltooid verandert](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="0b81b-173">Zodra de taakgegevens zijn opgeslagen in een variabele, is gewoon PS syntaxis voor het ophalen van het eerste item in de matrix en de waarde van de status op te halen.</span><span class="sxs-lookup"><span data-stu-id="0b81b-173">Once the job details are stored in a variable, it is simply PS syntax to get to the first array entry and retrieve the status value.</span></span> <span data-ttu-id="0b81b-174">Als u het automatiseringsscript, de waarde in een lus pollen totdat deze verandert in &quot;voltooid.&quot;</span><span class="sxs-lookup"><span data-stu-id="0b81b-174">To complete the automation script, poll the value in a loop until it turns to &quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="0b81b-175">De licentiesleutel HANA en VM herstellen via de Azure Backup-service</span><span class="sxs-lookup"><span data-stu-id="0b81b-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="0b81b-176">De Azure Backup-service is ontworpen om een nieuwe virtuele machine maken tijdens het terugzetten.</span><span class="sxs-lookup"><span data-stu-id="0b81b-176">The Azure Backup service is designed to create a new VM during restore.</span></span> <span data-ttu-id="0b81b-177">Er is geen nu te doen een &quot;in-place&quot; terugzetten van een bestaande virtuele machine in Azure.</span><span class="sxs-lookup"><span data-stu-id="0b81b-177">There is no plan right now to do an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Deze afbeelding ziet u de optie voor terugzetten van de Azure-service in de Azure portal](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="0b81b-179">Deze afbeelding ziet u de optie voor terugzetten van de Azure-service in de Azure portal.</span><span class="sxs-lookup"><span data-stu-id="0b81b-179">This figure shows the restore option of the Azure service in the Azure portal.</span></span> <span data-ttu-id="0b81b-180">Een kunt kiezen tussen het maken van een virtuele machine tijdens het terugzetten of het herstellen van de schijven.</span><span class="sxs-lookup"><span data-stu-id="0b81b-180">One can choose between creating a VM during restore or restoring the disks.</span></span> <span data-ttu-id="0b81b-181">Na het terugzetten van de schijven is het nog steeds nodig voor het maken van een nieuwe virtuele machine toe.</span><span class="sxs-lookup"><span data-stu-id="0b81b-181">After restoring the disks, it is still necessary to create a new VM on top of it.</span></span> <span data-ttu-id="0b81b-182">Wanneer een nieuwe virtuele machine wordt gemaakt in Azure de unieke ID van VM wordt gewijzigd (Zie [toegang tot en met behulp van Azure VM unieke ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="0b81b-182">Whenever a new VM gets created on Azure the unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Deze afbeelding ziet u de unieke ID van de virtuele machine van Azure voor en na het herstellen via de Azure Backup-service](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="0b81b-184">Deze afbeelding ziet u de unieke ID van de virtuele machine van Azure voor en na het herstellen via de Azure Backup-service.</span><span class="sxs-lookup"><span data-stu-id="0b81b-184">This figure shows the Azure VM unique ID before and after the restore via Azure Backup service.</span></span> <span data-ttu-id="0b81b-185">De sleutel van de hardware SAP, die wordt gebruikt voor SAP-licentieverlening, met behulp van deze unieke id voor de virtuele machine.</span><span class="sxs-lookup"><span data-stu-id="0b81b-185">The SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="0b81b-186">Als gevolg hiervan is een nieuwe SAP-licentie moet worden geïnstalleerd nadat een virtuele machine herstellen.</span><span class="sxs-lookup"><span data-stu-id="0b81b-186">As a consequence, a new SAP license has to be installed after a VM restore.</span></span>

<span data-ttu-id="0b81b-187">Een nieuwe Azure Backup-functie is opgenomen in de voorbeeldmodus tijdens het maken van deze back-handleiding.</span><span class="sxs-lookup"><span data-stu-id="0b81b-187">A new Azure Backup feature was presented in preview mode during the creation of this backup guide.</span></span> <span data-ttu-id="0b81b-188">Kunt u een bestand niveau te herstellen op basis van de VM-momentopname die is uitgevoerd voor de virtuele machine back-up.</span><span class="sxs-lookup"><span data-stu-id="0b81b-188">It allows a file level restore based on the VM snapshot that was taken for the VM backup.</span></span> <span data-ttu-id="0b81b-189">Hiermee voorkomt u de noodzaak voor het implementeren van een nieuwe virtuele machine, en daarom de unieke ID voor VM hetzelfde blijft en geen nieuwe sleutel voor SAP HANA-licentie is vereist.</span><span class="sxs-lookup"><span data-stu-id="0b81b-189">This avoids the need to deploy a new VM, and therefore the unique VM ID stays the same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="0b81b-190">Meer documentatie over deze functie wordt worden opgegeven nadat het volledig is getest.</span><span class="sxs-lookup"><span data-stu-id="0b81b-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="0b81b-191">Azure Backup wordt uiteindelijk back-up van afzonderlijke Azure virtuele schijven, plus bestanden en mappen uit in de virtuele machine toestaan.</span><span class="sxs-lookup"><span data-stu-id="0b81b-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside the VM.</span></span> <span data-ttu-id="0b81b-192">Een belangrijk voordeel van Azure Backup is het beheer van alle back-ups, voor het opslaan van de klant niet hoeft te doen.</span><span class="sxs-lookup"><span data-stu-id="0b81b-192">A major advantage of Azure Backup is its management of all the backups, saving the customer from having to do it.</span></span> <span data-ttu-id="0b81b-193">Als een herstelpunt nodig wordt, wordt Azure Backup selecteert u de juiste back-up moet worden gebruikt.</span><span class="sxs-lookup"><span data-stu-id="0b81b-193">If a restore becomes necessary, Azure Backup will select the correct backup to use.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="0b81b-194">SAP HANA VM back-ups via handmatige schijf momentopname</span><span class="sxs-lookup"><span data-stu-id="0b81b-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="0b81b-195">In plaats van de Azure Backup-service, kan een een afzonderlijke back-upoplossing configureren door het maken van momentopnamen van de blob van Azure VHD's handmatig via PowerShell.</span><span class="sxs-lookup"><span data-stu-id="0b81b-195">Instead of using the Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="0b81b-196">Zie [Using blob momentopnamen met PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) voor een beschrijving van de stappen.</span><span class="sxs-lookup"><span data-stu-id="0b81b-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of the steps.</span></span>

<span data-ttu-id="0b81b-197">Biedt meer flexibiliteit, maar de problemen beschreven eerder in dit document kan niet worden omgezet:</span><span class="sxs-lookup"><span data-stu-id="0b81b-197">It provides more flexibility but does not resolve the issues explained earlier in this document:</span></span>

- <span data-ttu-id="0b81b-198">Een moet nog steeds ervoor zorgen dat de SAP HANA zich in een consistente status</span><span class="sxs-lookup"><span data-stu-id="0b81b-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="0b81b-199">De besturingssysteemschijf kan niet worden overschreven, zelfs als de virtuele machine vanwege een fout die aangeeft dat een lease bestaat toewijzing ongedaan wordt gemaakt.</span><span class="sxs-lookup"><span data-stu-id="0b81b-199">The OS disk cannot be overwritten even if the VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="0b81b-200">Deze functie werkt alleen na het verwijderen van de virtuele machine, die tot een nieuwe unieke ID van virtuele machine en de noodzaak leiden kan voor het installeren van een nieuwe SAP-licentie.</span><span class="sxs-lookup"><span data-stu-id="0b81b-200">It only works after deleting the VM, which would lead to a new unique VM ID and the need to install a new SAP license.</span></span>

![Het is mogelijk te herstellen van de gegevensschijven van een Azure VM](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="0b81b-202">Het is mogelijk te herstellen van de gegevensschijven van een virtuele machine van Azure, waardoor het probleem van het ophalen van een nieuwe unieke ID voor VM voorkomen en de SAP-licentie daarom ongeldig is gemaakt:</span><span class="sxs-lookup"><span data-stu-id="0b81b-202">It is possible to restore only the data disks of an Azure VM, avoiding the problem of getting a new unique VM ID and, therefore, invalidated the SAP license:</span></span>

- <span data-ttu-id="0b81b-203">Twee Azure gegevensschijven zijn gekoppeld aan een VM voor de test en software-RAID boven op ze is gedefinieerd</span><span class="sxs-lookup"><span data-stu-id="0b81b-203">For the test, two Azure data disks were attached to a VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="0b81b-204">Is bevestigd dat SAP HANA in een consistente status door de functie voor SAP HANA-momentopname</span><span class="sxs-lookup"><span data-stu-id="0b81b-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="0b81b-205">Bestandssysteem blokkeren (Zie _SAP HANA gegevensconsistentie bij het maken van opslag-momentopnamen_ in het bijbehorende artikel [back-up-handleiding voor SAP HANA op Azure Virtual Machines](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="0b81b-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="0b81b-206">BLOB momentopnamen zijn vanaf beide gegevensschijven</span><span class="sxs-lookup"><span data-stu-id="0b81b-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="0b81b-207">Bestandssysteem blokkering opheffen</span><span class="sxs-lookup"><span data-stu-id="0b81b-207">File system unfreeze</span></span>
- <span data-ttu-id="0b81b-208">Bevestiging voor SAP HANA-momentopname</span><span class="sxs-lookup"><span data-stu-id="0b81b-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="0b81b-209">Voor het herstellen van de gegevensschijven, de virtuele machine is afgesloten en beide schijven losgekoppeld</span><span class="sxs-lookup"><span data-stu-id="0b81b-209">To restore the data disks, the VM was shut down and both disks detached</span></span>
- <span data-ttu-id="0b81b-210">Na het loskoppelen van de schijven zijn ze overschreven met de voormalige blob-momentopnamen</span><span class="sxs-lookup"><span data-stu-id="0b81b-210">After detaching the disks, they were overwritten with the former blob snapshots</span></span>
- <span data-ttu-id="0b81b-211">Vervolgens zijn de herstelde virtuele schijven opnieuw gekoppeld aan de virtuele machine</span><span class="sxs-lookup"><span data-stu-id="0b81b-211">Then the restored virtual disks were attached again to the VM</span></span>
- <span data-ttu-id="0b81b-212">Na het starten van de virtuele machine alles op de software RAID prima en opnieuw is ingesteld op de tijd van de momentopname blob</span><span class="sxs-lookup"><span data-stu-id="0b81b-212">After starting the VM, everything on the software RAID worked fine and was set back to the blob snapshot time</span></span>
- <span data-ttu-id="0b81b-213">HANA is opnieuw ingesteld op de momentopname HANA</span><span class="sxs-lookup"><span data-stu-id="0b81b-213">HANA was set back to the HANA snapshot</span></span>

<span data-ttu-id="0b81b-214">Als deze mogelijk SAP HANA afsluiten voordat de blob-momentopnamen, zou de procedure minder complex zijn.</span><span class="sxs-lookup"><span data-stu-id="0b81b-214">If it was possible to shut down SAP HANA before the blob snapshots, the procedure would be less complex.</span></span> <span data-ttu-id="0b81b-215">In dat geval kan een de momentopname HANA overslaan en ook het bestand systeem blokkeren als niets in het systeem gebeurt er overslaan.</span><span class="sxs-lookup"><span data-stu-id="0b81b-215">In that case, one could skip the HANA snapshot and, if nothing else is going on in the system, also skip the file system freeze.</span></span> <span data-ttu-id="0b81b-216">Extra complexiteit wordt geleverd in de afbeelding als hoeft te doen momentopnamen terwijl alles online is.</span><span class="sxs-lookup"><span data-stu-id="0b81b-216">Added complexity comes into the picture when it is necessary to do snapshots while everything is online.</span></span> <span data-ttu-id="0b81b-217">Zie _SAP HANA gegevensconsistentie bij het maken van opslag-momentopnamen_ in het bijbehorende artikel [back-up-handleiding voor SAP HANA op Azure Virtual Machines](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="0b81b-217">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="0b81b-218">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="0b81b-218">Next steps</span></span>
* <span data-ttu-id="0b81b-219">[Back-handleiding voor SAP HANA op Azure Virtual Machines](sap-hana-backup-guide.md) biedt een overzicht en informatie over aan de slag.</span><span class="sxs-lookup"><span data-stu-id="0b81b-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="0b81b-220">[SAP HANA back-up die is gebaseerd op bestandsniveau](sap-hana-backup-file-level.md) wordt ingegaan op de optie back-up-bestand.</span><span class="sxs-lookup"><span data-stu-id="0b81b-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers the file-based backup option.</span></span>
* <span data-ttu-id="0b81b-221">Zie voor meer informatie over hoe u hoge beschikbaarheid en herstel na noodgevallen van SAP HANA plannen in Azure (grote exemplaren), [SAP HANA (grote exemplaren) hoge beschikbaarheid en herstel na noodgevallen op Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="0b81b-221">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>
