---
title: Hoge beschikbaarheid en herstel na noodgevallen van SAP HANA in Azure (grote exemplaren) | Microsoft Docs
description: Tot stand brengen voor hoge beschikbaarheid en plan voor herstel na noodgevallen van SAP HANA in Azure (grote exemplaren).
services: virtual-machines-linux
documentationcenter: 
author: RicksterCDN
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 12/01/2016
ms.author: rclaus
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f95e944fc3ec3a831d97386443eb644420ae54dc
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="sap-hana-large-instances-high-availability-and-disaster-recovery-on-azure"></a><span data-ttu-id="fc59a-103">SAP HANA (grote exemplaren) hoge beschikbaarheid en herstel na noodgevallen in Azure</span><span class="sxs-lookup"><span data-stu-id="fc59a-103">SAP HANA (large instances) high availability and disaster recovery on Azure</span></span> 

<span data-ttu-id="fc59a-104">Hoge beschikbaarheid en herstel na noodgevallen zijn belangrijke aspecten van uw bedrijfskritieke SAP HANA worden uitgevoerd op Azure (grote exemplaren)-servers.</span><span class="sxs-lookup"><span data-stu-id="fc59a-104">High availability and disaster recovery are important aspects of running your mission-critical SAP HANA on Azure (large instances) servers.</span></span> <span data-ttu-id="fc59a-105">Het is belangrijk om te werken met SAP, uw system integrator of Microsoft goed ontwerpen en implementeren van de strategie rechts high-availability/herstel na noodgevallen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-105">It's important to work with SAP, your system integrator, or Microsoft to properly architect and implement the right high-availability/disaster-recovery strategy.</span></span> <span data-ttu-id="fc59a-106">Het is ook belangrijk dat u rekening houden met het beoogde herstelpunt en het beoogde hersteltijd, die specifiek voor uw omgeving zijn.</span><span class="sxs-lookup"><span data-stu-id="fc59a-106">It is also important to consider the recovery point objective and recovery time objective, which are specific to your environment.</span></span>

## <a name="high-availability"></a><span data-ttu-id="fc59a-107">Hoge beschikbaarheid</span><span class="sxs-lookup"><span data-stu-id="fc59a-107">High availability</span></span>

<span data-ttu-id="fc59a-108">Microsoft ondersteunt SAP HANA hoge beschikbaarheid methoden 'out van het vak' waaronder:</span><span class="sxs-lookup"><span data-stu-id="fc59a-108">Microsoft supports SAP HANA high-availability methods "out of the box," which include:</span></span>

- <span data-ttu-id="fc59a-109">**Storage-replicatie:** het opslagsysteem mogelijkheid om alle gegevens te repliceren naar een andere locatie (binnen of gescheiden van hetzelfde datacenter).</span><span class="sxs-lookup"><span data-stu-id="fc59a-109">**Storage replication:** The storage system's ability to replicate all data to another location (within, or separate from, the same datacenter).</span></span> <span data-ttu-id="fc59a-110">SAP HANA werkt onafhankelijk van deze methode.</span><span class="sxs-lookup"><span data-stu-id="fc59a-110">SAP HANA operates independently of this method.</span></span>
- <span data-ttu-id="fc59a-111">**HANA system replication:** de replicatie van alle gegevens in SAP HANA naar een afzonderlijke SAP HANA-systeem.</span><span class="sxs-lookup"><span data-stu-id="fc59a-111">**HANA system replication:** The replication of all data in SAP HANA to a separate SAP HANA system.</span></span> <span data-ttu-id="fc59a-112">De beoogde hersteltijd wordt geminimaliseerd door middel van gegevensreplicatie met regelmatige tussenpozen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-112">The recovery time objective is minimized through data replication at regular intervals.</span></span> <span data-ttu-id="fc59a-113">SAP HANA biedt ondersteuning voor asynchrone, synchrone in het geheugen en synchrone modus (alleen aanbevolen voor SAP HANA-systemen die binnen de hetzelfde datacenter of minder dan 100 KM elkaar).</span><span class="sxs-lookup"><span data-stu-id="fc59a-113">SAP HANA supports asynchronous, synchronous in-memory, and synchronous modes (recommended only for SAP HANA systems that are within the same datacenter or less than 100 KM apart).</span></span> <span data-ttu-id="fc59a-114">In het huidige ontwerp HANA grote exemplaar stempels kan HANA system replicatie voor hoge beschikbaarheid alleen worden gebruikt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-114">In the current design of HANA large-instance stamps, HANA system replication can be used for high availability only.</span></span>
- <span data-ttu-id="fc59a-115">**Automatische failover hosten:** een lokale fout--hersteloplossing te gebruiken als alternatief voor systeem-replicatie.</span><span class="sxs-lookup"><span data-stu-id="fc59a-115">**Host auto-failover:** A local fault-recovery solution to use as an alternative to system replication.</span></span> <span data-ttu-id="fc59a-116">Wanneer het hoofdknooppunt niet meer beschikbaar is, een of meer stand-by SAP HANA-knooppunten zijn geconfigureerd in de modus voor scale-out en SAP HANA automatisch wordt overgenomen door een ander knooppunt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-116">When the master node becomes unavailable, one or more standby SAP HANA nodes are configured in scale-out mode and SAP HANA automatically fails over to another node.</span></span>

<span data-ttu-id="fc59a-117">Zie de volgende SAP-informatie voor meer informatie over hoge beschikbaarheid voor SAP HANA:</span><span class="sxs-lookup"><span data-stu-id="fc59a-117">For more information on SAP HANA high availability, see the following SAP information:</span></span>

- [<span data-ttu-id="fc59a-118">Technisch document SAP HANA hoge beschikbaarheid</span><span class="sxs-lookup"><span data-stu-id="fc59a-118">SAP HANA High-Availability Whitepaper</span></span>](http://go.sap.com/documents/2016/05/f8e5eeba-737c-0010-82c7-eda71af511fa.html)
- [<span data-ttu-id="fc59a-119">Handleiding voor SAP HANA-beheer</span><span class="sxs-lookup"><span data-stu-id="fc59a-119">SAP HANA Administration Guide</span></span>](http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf)
- [<span data-ttu-id="fc59a-120">SAP Academy Video voor SAP HANA System replicatie</span><span class="sxs-lookup"><span data-stu-id="fc59a-120">SAP Academy Video on SAP HANA System Replication</span></span>](http://scn.sap.com/community/hana-in-memory/blog/2015/05/19/sap-hana-system-replication)
- [<span data-ttu-id="fc59a-121">SAP-notitie ondersteuning #1999880: veelgestelde vragen over SAP HANA System Replication</span><span class="sxs-lookup"><span data-stu-id="fc59a-121">SAP Support Note #1999880 – FAQ on SAP HANA System Replication</span></span>](https://bcs.wdf.sap.corp/sap/support/notes/1999880)
- <span data-ttu-id="fc59a-122">[SAP-ondersteuning Opmerking #2165547 – SAP HANA back-up en herstel binnen replicatieomgeving voor SAP HANA-systeem](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)</span><span class="sxs-lookup"><span data-stu-id="fc59a-122">[SAP Support Note #2165547 – SAP HANA Backup and Restore within SAP HANA System Replication Environment](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3231363535343726)</span></span>
- <span data-ttu-id="fc59a-123">[SAP-notitie ondersteuning #1984882 – met SAP HANA System replicatie voor Hardware-uitwisseling met minimale/Zero Downtime](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)</span><span class="sxs-lookup"><span data-stu-id="fc59a-123">[SAP Support Note #1984882 – Using SAP HANA System Replication for Hardware Exchange with Minimum/Zero Downtime](https://websmp230.sap-ag.de/sap(bD1lbiZjPTAwMQ==)/bc/bsp/sno/ui_entry/entry.htm?param=69765F6D6F64653D3030312669765F7361706E6F7465735F6E756D6265723D3139383438383226)</span></span>

## <a name="disaster-recovery"></a><span data-ttu-id="fc59a-124">Herstel na noodgevallen</span><span class="sxs-lookup"><span data-stu-id="fc59a-124">Disaster recovery</span></span>

<span data-ttu-id="fc59a-125">SAP HANA in Azure (grote exemplaren) wordt aangeboden in twee Azure-regio's in een geopolitieke regio.</span><span class="sxs-lookup"><span data-stu-id="fc59a-125">SAP HANA on Azure (large instances) is offered in two Azure regions in a geopolitical region.</span></span> <span data-ttu-id="fc59a-126">Is een rechtstreekse netwerkverbinding voor het repliceren van gegevens tijdens herstel na noodgevallen tussen de twee grote exemplaar stempels van twee verschillende regio's.</span><span class="sxs-lookup"><span data-stu-id="fc59a-126">Between the two large-instance stamps of two different regions is a direct network connectivity for replicating data during disaster recovery.</span></span> <span data-ttu-id="fc59a-127">De replicatie van de gegevens is opslaginfrastructuur gebaseerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-127">The replication of the data is storage-infrastructure based.</span></span> <span data-ttu-id="fc59a-128">De replicatie is niet standaard uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-128">The replication is not done by default.</span></span> <span data-ttu-id="fc59a-129">Het is voltooid voor de klant-configuraties die besteld het herstel na noodgevallen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-129">It is done for the customer configurations that ordered the disaster recovery.</span></span> <span data-ttu-id="fc59a-130">In het huidige ontwerp kan niet HANA system replicatie worden gebruikt voor herstel na noodgevallen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-130">In the current design, HANA system replication can't be used for disaster recovery.</span></span>

<span data-ttu-id="fc59a-131">Om te profiteren van het herstel na noodgevallen, moet u echter de netwerkverbinding met twee verschillende Azure-regio's ontwerpt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-131">However, to take advantage of the disaster recovery, you need to start to design the network connectivity to the two different Azure regions.</span></span> <span data-ttu-id="fc59a-132">Om dit te doen, moet u een Azure ExpressRoute-circuit-verbinding van on-premises in uw Azure-regio en een andere circuit verbinding vanaf on-premises voor uw regio herstel na noodgevallen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-132">To do so, you need an Azure ExpressRoute circuit connection from on-premises in your main Azure region and another circuit connection from on-premises to your disaster-recovery region.</span></span> <span data-ttu-id="fc59a-133">Deze meting bevat gewoonlijk een situatie waarin een volledige Azure-regio, met inbegrip van een locatie van Microsoft enterprise edge router (MSEE) een probleem heeft.</span><span class="sxs-lookup"><span data-stu-id="fc59a-133">This measure would cover a situation in which a complete Azure region, including a Microsoft enterprise edge router (MSEE) location, has an issue.</span></span>

<span data-ttu-id="fc59a-134">Als een tweede maat, kunt u alle virtuele Azure-netwerken die verbinding met de SAP HANA in Azure (grote exemplaren maken) in een van de regio's tot zowel de ExpressRoute-circuits.</span><span class="sxs-lookup"><span data-stu-id="fc59a-134">As a second measure, you can connect all Azure virtual networks that connect to SAP HANA on Azure (large instances) in one of the regions to both of those ExpressRoute circuits.</span></span> <span data-ttu-id="fc59a-135">Deze meting heeft betrekking op een aanvraag waarin slechts één van de MSEE-locaties die uw on-premises locatie met Azure verbindt niet actief gaat.</span><span class="sxs-lookup"><span data-stu-id="fc59a-135">This measure addresses a case where only one of the MSEE locations that connects your on-premises location with Azure goes off duty.</span></span>

<span data-ttu-id="fc59a-136">De volgende afbeelding ziet u de optimale configuratie voor herstel na noodgevallen:</span><span class="sxs-lookup"><span data-stu-id="fc59a-136">The following figure shows the optimal configuration for disaster recovery:</span></span>

![Optimale configuratie voor herstel na noodgevallen](./media/hana-overview-high-availability-disaster-recovery/image1-optimal-configuration.png)

<span data-ttu-id="fc59a-138">De optimale aanvraag voor een configuratie voor herstel na noodgevallen van het netwerk is om twee ExpressRoute-circuits on-premises naar twee verschillende Azure-regio's.</span><span class="sxs-lookup"><span data-stu-id="fc59a-138">The optimal case for a disaster-recovery configuration of the network is to have two ExpressRoute circuits from on-premises to the two different Azure regions.</span></span> <span data-ttu-id="fc59a-139">Een circuit gaat naar regio #1, met een exemplaar van de productie.</span><span class="sxs-lookup"><span data-stu-id="fc59a-139">One circuit goes to region #1, running a production instance.</span></span> <span data-ttu-id="fc59a-140">Het tweede ExpressRoute-circuit gaat naar regio #2 sommige exemplaren van niet-productieve HANA uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-140">The second ExpressRoute circuit goes to region #2, running some non-production HANA instances.</span></span> <span data-ttu-id="fc59a-141">(Dit is belangrijk als een volledige Azure-regio, inclusief de MSEE en grote exemplaar stempel, gaat het raster uit).</span><span class="sxs-lookup"><span data-stu-id="fc59a-141">(This is important if an entire Azure region, including the MSEE and large-instance stamp, goes off the grid.)</span></span>

<span data-ttu-id="fc59a-142">Als een tweede maat, worden de verschillende virtuele netwerken zijn verbonden met de verschillende ExpressRoute-circuits die zijn verbonden met een SAP HANA in Azure (grote exemplaren).</span><span class="sxs-lookup"><span data-stu-id="fc59a-142">As a second measure, the various virtual networks are connected to the various ExpressRoute circuits that are connected to SAP HANA on Azure (large instances).</span></span> <span data-ttu-id="fc59a-143">U kunt de locatie waar een MSEE is mislukt, of kunt u het beoogde herstelpunt voor herstel na noodgevallen, verlagen overslaan als we later bespreken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-143">You can bypass the location where an MSEE is failing, or you can lower the recovery point objective for disaster recovery, as we discuss later.</span></span>

<span data-ttu-id="fc59a-144">De volgende vereisten voor een installatie met herstel na noodgevallen zijn:</span><span class="sxs-lookup"><span data-stu-id="fc59a-144">The next requirements for a disaster-recovery setup are:</span></span>

- <span data-ttu-id="fc59a-145">U moet SAP HANA order niet uitvoeren op Azure (grote exemplaren) SKU's van dezelfde grootte hebben als uw productie-SKU's en deze implementeren in de regio van het herstel na noodgevallen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-145">You must order SAP HANA on Azure (large instances) SKUs of the same size as your production SKUs and deploy them in the disaster-recovery region.</span></span> <span data-ttu-id="fc59a-146">Deze instanties kunnen worden gebruikt om test, sandbox of QA HANA exemplaren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-146">These instances can be used to run test, sandbox, or QA HANA instances.</span></span>
- <span data-ttu-id="fc59a-147">Voor elk van uw SAP HANA op Azure (grote exemplaren)-SKU's die u wilt herstellen in de site herstel na noodgevallen, indien nodig moet u een profiel voor herstel na noodgevallen rangschikken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-147">You must order a disaster-recovery profile for each of your SAP HANA on Azure (large instances) SKUs that you want to recover in the disaster-recovery site, if necessary.</span></span> <span data-ttu-id="fc59a-148">Deze bewerking leidt tot de toewijzing van opslagvolumes die het doel van de storage-replicatie van uw productieregio in de regio voor herstel na noodgevallen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-148">This action leads to the allocation of storage volumes, which are the target of the storage replication from your production region into the disaster-recovery region.</span></span>

<span data-ttu-id="fc59a-149">Nadat u aan de bovenstaande vereisten voldoet, is uw verantwoordelijkheid om de storage-replicatie start.</span><span class="sxs-lookup"><span data-stu-id="fc59a-149">After you meet the preceding requirements, it is your responsibility to start the storage replication.</span></span> <span data-ttu-id="fc59a-150">De basis van de storage-replicatie is in de opslaginfrastructuur die gebruikt voor SAP HANA in Azure (grote exemplaren), opslag-momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-150">In the storage infrastructure used for SAP HANA on Azure (large instances), the basis of storage replication is storage snapshots.</span></span> <span data-ttu-id="fc59a-151">U moet uitvoeren voor het starten van de replicatie van herstel na noodgevallen:</span><span class="sxs-lookup"><span data-stu-id="fc59a-151">To start the disaster-recovery replication, you need to perform:</span></span>

- <span data-ttu-id="fc59a-152">Een momentopname van de opstartinstallatiekopie LUN, zoals eerder beschreven.</span><span class="sxs-lookup"><span data-stu-id="fc59a-152">A snapshot of your boot LUN, as described earlier.</span></span>
- <span data-ttu-id="fc59a-153">Een momentopname van de volumes HANA-gerelateerde, zoals eerder beschreven.</span><span class="sxs-lookup"><span data-stu-id="fc59a-153">A snapshot of your HANA-related volumes, as described earlier.</span></span>

<span data-ttu-id="fc59a-154">Nadat u deze momentopnamen worden uitgevoerd, wordt een eerste replica van de volumes seeding op volumes die gekoppeld aan uw profiel herstel na noodgevallen in het gebied van herstel na noodgevallen zijn.</span><span class="sxs-lookup"><span data-stu-id="fc59a-154">After you execute these snapshots, an initial replica of the volumes is seeded on the volumes that are associated with your disaster-recovery profile in the disaster-recovery region.</span></span>

<span data-ttu-id="fc59a-155">De meest recente opslag momentopname wordt elk uur vervolgens gebruikt voor replicatie van de delta's die op de opslagvolumes ontwikkelen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-155">Subsequently, the most recent storage snapshot is used every hour to replicate the deltas that develop on the storage volumes.</span></span>

<span data-ttu-id="fc59a-156">Het beoogde herstelpunt dat wordt gerealiseerd met deze configuratie ligt tussen 60 en 90 minuten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-156">The recovery point objective that's achieved with this configuration is from 60 to 90 minutes.</span></span> <span data-ttu-id="fc59a-157">Om te zorgen voor een betere beoogde herstelpunt in het geval van herstel na noodgevallen, de HANA transactielogboekback-ups van SAP HANA in Azure (grote exemplaren) te kopiëren naar de andere Azure-regio.</span><span class="sxs-lookup"><span data-stu-id="fc59a-157">To achieve a better recovery point objective in the disaster-recovery case, copy the HANA transaction log backups from SAP HANA on Azure (large instances) to the other Azure region.</span></span> <span data-ttu-id="fc59a-158">Als u wilt bereiken deze beoogd herstelpunt, het volgende doen:</span><span class="sxs-lookup"><span data-stu-id="fc59a-158">To achieve this recovery point objective, do the following:</span></span>

1. <span data-ttu-id="fc59a-159">Meld u zo vaak mogelijk /hana/log/backup back-up van de transactie HANA.</span><span class="sxs-lookup"><span data-stu-id="fc59a-159">Back up the HANA transaction log as frequently as possible to /hana/log/backup.</span></span>
2. <span data-ttu-id="fc59a-160">Kopieer de transactielogboekback-ups wanneer ze klaar zijn met een Azure virtuele machine (VM), dat zich bevindt in een virtueel netwerk dat verbonden met de SAP HANA op Azure (grote exemplaren)-server zijn.</span><span class="sxs-lookup"><span data-stu-id="fc59a-160">Copy the transaction log backups when they are finished to an Azure virtual machine (VM), which is in a virtual network that's connected to the SAP HANA on Azure (large instances) server.</span></span>
3. <span data-ttu-id="fc59a-161">Kopieer de back-up naar een virtuele machine die zich in een virtueel netwerk in het gebied van herstel na noodgevallen van die VM.</span><span class="sxs-lookup"><span data-stu-id="fc59a-161">From that VM, copy the backup to a VM that's in a virtual network in the disaster-recovery region.</span></span>
4. <span data-ttu-id="fc59a-162">De transactie logboekback-ups in deze regio in de virtuele machine behouden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-162">Keep the transaction log backups in that region in the VM.</span></span>

<span data-ttu-id="fc59a-163">In noodgevallen nadat het herstel na noodgevallen-profiel is geïmplementeerd op een werkelijke-server, de transactielogboekback-ups van de virtuele machine kopiëren naar de SAP HANA in Azure (grote exemplaren), die nu de primaire server in de regio van het herstel na noodgevallen en herstellen die back-ups.</span><span class="sxs-lookup"><span data-stu-id="fc59a-163">In case of disaster, after the disaster-recovery profile has been deployed on an actual server, copy the transaction log backups from the VM to the SAP HANA on Azure (large instances) that is now the primary server in the disaster-recovery region, and restore those backups.</span></span> <span data-ttu-id="fc59a-164">Dit herstel is mogelijk omdat de status van HANA op de schijven voor herstel na noodgevallen die van een momentopname HANA.</span><span class="sxs-lookup"><span data-stu-id="fc59a-164">This recovery is possible because the state of HANA on the disaster-recovery disks is that of a HANA snapshot.</span></span> <span data-ttu-id="fc59a-165">Dit is de offset voor verdere herstelprocedures van transactielogboekback-ups.</span><span class="sxs-lookup"><span data-stu-id="fc59a-165">This is the offset point for further restorations of transaction log backups.</span></span>

## <a name="backup-and-restore"></a><span data-ttu-id="fc59a-166">Back-ups en herstellen</span><span class="sxs-lookup"><span data-stu-id="fc59a-166">Backup and restore</span></span>

<span data-ttu-id="fc59a-167">Een van de belangrijkste aspecten van de operationele databases brengen ervoor dat de database van verschillende onherstelbare gebeurtenissen kan worden beveiligd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-167">One of the most important aspects to operating databases is making sure the database can be protected from various catastrophic events.</span></span> <span data-ttu-id="fc59a-168">Deze gebeurtenissen kunnen zijn veroorzaakt door alles van natuurramp eenvoudig fouten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-168">These events can be caused by anything from natural disasters to simple user errors.</span></span>

<span data-ttu-id="fc59a-169">Back-ups van een database met de mogelijkheid om het te herstellen naar een willekeurig punt in tijd (zoals voordat iemand kritieke gegevens verwijderd), kunt u herstellen naar een status die zo dicht mogelijk bij de manier waarop deze was voordat de onderbreking is opgetreden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-169">Backing up a database, with the ability to restore it to any point in time (such as before somebody deleted critical data), allows restoration to a state that is as close as possible to the way it was before the disruption occurred.</span></span>

<span data-ttu-id="fc59a-170">Twee soorten back-ups moeten worden uitgevoerd voor de beste resultaten:</span><span class="sxs-lookup"><span data-stu-id="fc59a-170">Two types of backups must be performed for best results:</span></span>

- <span data-ttu-id="fc59a-171">Databaseback-ups</span><span class="sxs-lookup"><span data-stu-id="fc59a-171">Database backups</span></span>
- <span data-ttu-id="fc59a-172">Transactielogboekback-ups</span><span class="sxs-lookup"><span data-stu-id="fc59a-172">Transaction log backups</span></span>

<span data-ttu-id="fc59a-173">Naast volledige databaseback-ups op niveau van een toepassing wordt uitgevoerd, kunt u altijd zelfs uitgebreider door het uitvoeren van back-ups met de opslag-momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-173">In addition to full database backups performed at an application-level, you can be even more thorough by performing backups with storage snapshots.</span></span> <span data-ttu-id="fc59a-174">Logboekback-ups uitvoeren, is ook belangrijk voor het herstellen van de database (en om de logboeken van al leeg doorgevoerd transacties).</span><span class="sxs-lookup"><span data-stu-id="fc59a-174">Performing log backups is also important for restoring the database (and to empty the logs from already committed transactions).</span></span>

<span data-ttu-id="fc59a-175">SAP HANA in Azure (grote exemplaren) biedt twee opties voor back-up en herstel:</span><span class="sxs-lookup"><span data-stu-id="fc59a-175">SAP HANA on Azure (large instances) offers two backup and restore options:</span></span>

- <span data-ttu-id="fc59a-176">Hiervoor zelf (DIY).</span><span class="sxs-lookup"><span data-stu-id="fc59a-176">Do it yourself (DIY).</span></span> <span data-ttu-id="fc59a-177">Nadat u berekenen zodat er voldoende schijfruimte is, voert u de volledige database en logboekbestanden back-ups met behulp van back-methoden van de schijf (om deze schijven).</span><span class="sxs-lookup"><span data-stu-id="fc59a-177">After you calculate to ensure enough disk space, perform full database and log backups by using disk backup methods (to those disks).</span></span> <span data-ttu-id="fc59a-178">Na verloop van tijd de back-ups worden gekopieerd naar een Azure storage-account (na het instellen van een Azure-bestandsserver met vrijwel onbeperkte opslag) of een Azure Backup-kluis of Azure koude opslag gebruiken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-178">Over time, the backups are copied to an Azure storage account (after you set up an Azure-based file server with virtually unlimited storage), or use an Azure Backup vault or Azure cold storage.</span></span> <span data-ttu-id="fc59a-179">Een andere optie is het gebruik van een hulpprogramma van derden gegevens beveiliging, zoals Commvault, voor het opslaan van de back-ups nadat ze zijn gekopieerd naar een opslagaccount.</span><span class="sxs-lookup"><span data-stu-id="fc59a-179">Another option is to use a third-party data protection tool, such as Commvault, to store the backups after they are copied to a storage account.</span></span> <span data-ttu-id="fc59a-180">De optie voor ZELFOPLOSSING back-up kan ook zijn nodig voor gegevens die moeten worden bewaard gedurende langere perioden voor compliancy en controledoeleinden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-180">The DIY backup option might also be necessary for data that needs to be stored for longer periods for compliancy and auditing purposes.</span></span>
- <span data-ttu-id="fc59a-181">Gebruik de back-up en herstel van functionaliteit die de onderliggende infrastructuur van SAP HANA in Azure (grote exemplaren) biedt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-181">Use the backup and restore functionality that the underlying infrastructure of SAP HANA on Azure (large instances) provides.</span></span> <span data-ttu-id="fc59a-182">Deze optie wordt voldaan aan de noodzaak van back-ups en maakt handmatige back-ups bijna verouderd (met uitzondering van gegevensback-ups indien noodzakelijk zijn voor naleving zijn).</span><span class="sxs-lookup"><span data-stu-id="fc59a-182">This option fulfills the need for backups, and it makes manual backups nearly obsolete (except where data backups are required for compliance purposes).</span></span> <span data-ttu-id="fc59a-183">De rest van deze sectie heeft betrekking op de back-up en herstel functionaliteit die wordt aangeboden met HANA (grote exemplaren).</span><span class="sxs-lookup"><span data-stu-id="fc59a-183">The rest of this section addresses the backup and restore functionality that's offered with HANA (large instances).</span></span>

> [!NOTE]
> <span data-ttu-id="fc59a-184">De momentopnametechnologie die wordt gebruikt door de onderliggende infrastructuur van HANA (grote exemplaren) heeft een afhankelijkheid voor SAP HANA-momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-184">The snapshot technology that is used by the underlying infrastructure of HANA (large instances) has a dependency on SAP HANA snapshots.</span></span> <span data-ttu-id="fc59a-185">SAP HANA momentopnamen werken niet in combinatie met SAP HANA Multitenant Database Containers.</span><span class="sxs-lookup"><span data-stu-id="fc59a-185">SAP HANA snapshots do not work in conjunction with SAP HANA Multitenant Database Containers.</span></span> <span data-ttu-id="fc59a-186">Deze methode van back-up kan niet als gevolg hiervan worden gebruikt voor het implementeren van Containers voor SAP HANA Multitenant-Database.</span><span class="sxs-lookup"><span data-stu-id="fc59a-186">As a result, this method of backup cannot be used to deploy SAP HANA Multitenant Database Containers.</span></span>

### <a name="using-storage-snapshots-of-sap-hana-on-azure-large-instances"></a><span data-ttu-id="fc59a-187">Met behulp van opslag-momentopnamen van SAP HANA in Azure (grote exemplaren)</span><span class="sxs-lookup"><span data-stu-id="fc59a-187">Using storage snapshots of SAP HANA on Azure (large instances)</span></span>

<span data-ttu-id="fc59a-188">De infrastructuur van de onderliggende SAP HANA in Azure (grote exemplaren) ondersteunt het principe van een momentopname van de opslag van volumes.</span><span class="sxs-lookup"><span data-stu-id="fc59a-188">The storage infrastructure underlying SAP HANA on Azure (large instances) supports the notion of a storage snapshot of volumes.</span></span> <span data-ttu-id="fc59a-189">Zowel back-up en herstel van een bepaald volume worden ondersteund met de volgende overwegingen:</span><span class="sxs-lookup"><span data-stu-id="fc59a-189">Both backup and restoration of a particular volume are supported, with the following considerations:</span></span>

- <span data-ttu-id="fc59a-190">In plaats van de databaseback-ups, worden opslag volume momentopnamen regelmatig.</span><span class="sxs-lookup"><span data-stu-id="fc59a-190">Instead of database backups, storage volume snapshots are taken on a frequent basis.</span></span>
- <span data-ttu-id="fc59a-191">De momentopname van de opslag initieert een momentopname van een SAP HANA voordat deze de momentopname van de opslag wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-191">The storage snapshot initiates an SAP HANA snapshot before it executes the storage snapshot.</span></span> <span data-ttu-id="fc59a-192">Deze momentopname met de SAP HANA is de installatie voor uiteindelijke logboek herstelbewerkingen kunnen na het herstel van de momentopname van de opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-192">This SAP HANA snapshot is the setup point for eventual log restorations after recovery of the storage snapshot.</span></span>
- <span data-ttu-id="fc59a-193">Op het punt waar de opslag-momentopnamen met succes is uitgevoerd, wordt de momentopname SAP HANA verwijderd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-193">At the point where the storage snapshot is executed successfully, the SAP HANA snapshot is deleted.</span></span>
- <span data-ttu-id="fc59a-194">Logboekback-ups zijn vaak gemaakt en opgeslagen in het logboek-back-volume of in Azure.</span><span class="sxs-lookup"><span data-stu-id="fc59a-194">Log backups are taken frequently and stored in the log backup volume or in Azure.</span></span>
- <span data-ttu-id="fc59a-195">Als de database moet worden hersteld naar een bepaald punt in tijd, een aanvraag wordt gedaan aan Microsoft Azure-ondersteuning (productie uitval) of SAP HANA op Azure-servicebeheer om te zetten op een bepaalde opslag-momentopnamen (bijvoorbeeld een geplande herstel van een sandbox voor de oorspronkelijke status).</span><span class="sxs-lookup"><span data-stu-id="fc59a-195">If the database must be restored to a certain point in time, a request is made to Microsoft Azure Support (production outage) or SAP HANA on Azure Service Management to restore to a certain storage snapshot (for example, a planned restoration of a sandbox system to its original state).</span></span>
- <span data-ttu-id="fc59a-196">De SAP HANA-momentopname die opgenomen in de opslag momentopname is een offset punt voor het toepassen van logboekback-ups die zijn uitgevoerd en opgeslagen nadat de momentopname van de opslag is gemaakt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-196">The SAP HANA snapshot that's included in the storage snapshot is an offset point for applying log backups that have been executed and stored after the storage snapshot was taken.</span></span>
- <span data-ttu-id="fc59a-197">Deze logboekback-ups worden gemaakt op de database herstellen naar een bepaald punt in tijd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-197">These log backups are taken to restore the database back to a certain point in time.</span></span>

<span data-ttu-id="fc59a-198">Het opgeven van de back-up\_naam maakt een momentopname van de volgende volumes:</span><span class="sxs-lookup"><span data-stu-id="fc59a-198">Specifying the backup\_name creates a snapshot of the following volumes:</span></span>

- <span data-ttu-id="fc59a-199">Hana/gegevens</span><span class="sxs-lookup"><span data-stu-id="fc59a-199">hana/data</span></span>
- <span data-ttu-id="fc59a-200">Hana/logboek</span><span class="sxs-lookup"><span data-stu-id="fc59a-200">hana/log</span></span>
- <span data-ttu-id="fc59a-201">Hana/log\_back-up (gekoppeld als back-up in hana/logboek)</span><span class="sxs-lookup"><span data-stu-id="fc59a-201">hana/log\_backup (mounted as backup into hana/log)</span></span>
- <span data-ttu-id="fc59a-202">Hana/gedeeld</span><span class="sxs-lookup"><span data-stu-id="fc59a-202">hana/shared</span></span>

### <a name="storage-snapshot-considerations"></a><span data-ttu-id="fc59a-203">Overwegingen met betrekking tot opslag-momentopnamen</span><span class="sxs-lookup"><span data-stu-id="fc59a-203">Storage snapshot considerations</span></span>

>[!NOTE]
><span data-ttu-id="fc59a-204">Opslag-momentopnamen zijn _niet_ opgegeven gratis, omdat u extra opslagruimte moet worden toegewezen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-204">Storage snapshots are _not_ provided free of charge, because additional storage space must be allocated.</span></span>

<span data-ttu-id="fc59a-205">Het specifieke mechanisme van opslag-momentopnamen voor SAP HANA in Azure (grote exemplaren) zijn onder andere:</span><span class="sxs-lookup"><span data-stu-id="fc59a-205">The specific mechanics of storage snapshots for SAP HANA on Azure (large instances) include:</span></span>

- <span data-ttu-id="fc59a-206">Een momentopname van een bepaalde opslag (op het punt in tijd waarop deze is gemaakt) verbruikt weinig opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-206">A specific storage snapshot (at the point in time when it is taken) consumes very little storage.</span></span>
- <span data-ttu-id="fc59a-207">Als gegevens inhoud wordt gewijzigd en de inhoud van bestanden op het opslagvolume wijzigen SAP HANA-gegevens, moet de momentopname voor het opslaan van de oorspronkelijke inhoud blokkeren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-207">As data content changes and the content in SAP HANA data files change on the storage volume, the snapshot needs to store the original block content.</span></span>
- <span data-ttu-id="fc59a-208">De momentopname van de opslag wordt vergroot.</span><span class="sxs-lookup"><span data-stu-id="fc59a-208">The storage snapshot increases in size.</span></span> <span data-ttu-id="fc59a-209">Hoe langer de momentopname bestaat, hoe groter de momentopname van de opslag wordt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-209">The longer the snapshot exists, the larger the storage snapshot becomes.</span></span>
- <span data-ttu-id="fc59a-210">De meer wijzigingen zijn aangebracht aan het volume SAP HANA-database gedurende de levensduur van een momentopname opslag, hoe groter het verbruik van de ruimte van de momentopname van de opslag wordt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-210">The more changes made to the SAP HANA database volume over the lifetime of a storage snapshot, the larger the space consumption of the storage snapshot becomes.</span></span>

<span data-ttu-id="fc59a-211">SAP HANA in Azure (grote exemplaren) wordt geleverd met grootten voor het volume van gegevens en logboekbestanden SAP HANA vast volume.</span><span class="sxs-lookup"><span data-stu-id="fc59a-211">SAP HANA on Azure (large instances) comes with fixed volume sizes for the SAP HANA data and log volume.</span></span> <span data-ttu-id="fc59a-212">Uitvoeren van momentopnamen van de volumes eats in de ruimte op volume zodat de tekst zelf verantwoordelijk voor het plannen van opslag-momentopnamen (binnen de SAP HANA op Azure [grote exemplaren]-proces).</span><span class="sxs-lookup"><span data-stu-id="fc59a-212">Performing snapshots of those volumes eats into your volume space, so it is your responsibility to schedule storage snapshots (within the SAP HANA on Azure [large instances] process).</span></span>

<span data-ttu-id="fc59a-213">De volgende secties bevatten informatie voor het uitvoeren van deze momentopnamen, waaronder algemene aanbevelingen:</span><span class="sxs-lookup"><span data-stu-id="fc59a-213">The following sections provide information for performing these snapshots, including general recommendations:</span></span>

- <span data-ttu-id="fc59a-214">Hoewel de hardware 255 momentopnamen per volume tolereren kan, wordt ten zeerste aanbevolen ruim onder dit nummer te blijven.</span><span class="sxs-lookup"><span data-stu-id="fc59a-214">Though the hardware can sustain 255 snapshots per volume, we highly recommend that you stay well below this number.</span></span>
- <span data-ttu-id="fc59a-215">Voordat u opslag-momentopnamen uitvoert, bewaken en bijhouden vrije ruimte.</span><span class="sxs-lookup"><span data-stu-id="fc59a-215">Before you perform storage snapshots, monitor and keep track of free space.</span></span>
- <span data-ttu-id="fc59a-216">Verlaag het aantal momentopnamen van opslag op basis van de vrije ruimte.</span><span class="sxs-lookup"><span data-stu-id="fc59a-216">Lower the number of storage snapshots based on free space.</span></span> <span data-ttu-id="fc59a-217">Mogelijk moet u het aantal momentopnamen die u bijhoudt, of moet u mogelijk de volumes uit te breiden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-217">You might need to lower the number of snapshots that you keep, or you might need to extend the volumes.</span></span> <span data-ttu-id="fc59a-218">(U kunt extra opslagruimte bestellen in eenheden van 1 TB.)</span><span class="sxs-lookup"><span data-stu-id="fc59a-218">(You can order additional storage in 1-TB units.)</span></span>
- <span data-ttu-id="fc59a-219">Tijdens de activiteiten zoals het verplaatsen van gegevens in SAP HANA met systeem hulpprogramma's voor migratie (R3load of door te SAP HANA-databases herstellen vanuit back-ups), raden we u alle opslag-momentopnamen niet uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-219">During activities such as moving data into SAP HANA with system migration tools (with R3load, or by restoring SAP HANA databases from backups), we highly recommended that you not perform any storage snapshots.</span></span> <span data-ttu-id="fc59a-220">(Als de migratie van een systeem is op een nieuw SAP HANA-systeem wordt gedaan, opslag-momentopnamen zou niet moeten worden uitgevoerd.)</span><span class="sxs-lookup"><span data-stu-id="fc59a-220">(If a system migration is being done on a new SAP HANA system, storage snapshots would not need to be performed.)</span></span>
- <span data-ttu-id="fc59a-221">Tijdens de grotere reorganisaties SAP HANA-tabellen, moeten de opslag-momentopnamen indien mogelijk worden vermeden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-221">During larger reorganizations of SAP HANA tables, storage snapshots should be avoided if possible.</span></span>
- <span data-ttu-id="fc59a-222">Opslag-momentopnamen zijn vereist voor de mogelijkheden voor herstel na noodgevallen van SAP HANA in Azure (grote exemplaren) bezighouden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-222">Storage snapshots are a prerequisite to engaging the disaster-recovery capabilities of SAP HANA on Azure (large instances).</span></span>

### <a name="setting-up-storage-snapshots"></a><span data-ttu-id="fc59a-223">Instellen van opslag-momentopnamen</span><span class="sxs-lookup"><span data-stu-id="fc59a-223">Setting up storage snapshots</span></span>

1. <span data-ttu-id="fc59a-224">Zorg ervoor dat Perl is geïnstalleerd in de Linux-besturingssysteem op de server HANA (grote exemplaren).</span><span class="sxs-lookup"><span data-stu-id="fc59a-224">Make sure that Perl is installed in the Linux operating system on the HANA (large instances) server.</span></span>
2. <span data-ttu-id="fc59a-225">Wijzig/etc/ssh/ssh\_config voor toevoegen van de regel _MACs hmac-sha1_.</span><span class="sxs-lookup"><span data-stu-id="fc59a-225">Modify /etc/ssh/ssh\_config to add the line _MACs hmac-sha1_.</span></span>
3. <span data-ttu-id="fc59a-226">Maak een back-up SAP HANA-gebruikersaccount op het hoofdknooppunt voor elk SAP HANA-exemplaar dat u uitvoert (indien van toepassing).</span><span class="sxs-lookup"><span data-stu-id="fc59a-226">Create an SAP HANA backup user account on the master node for each SAP HANA instance you are running (if applicable).</span></span>
4. <span data-ttu-id="fc59a-227">De client SAP HANA HDB moet worden geïnstalleerd op alle servers voor SAP HANA (grote exemplaren).</span><span class="sxs-lookup"><span data-stu-id="fc59a-227">The SAP HANA HDB client must be installed on all SAP HANA (large instances) servers.</span></span>
5. <span data-ttu-id="fc59a-228">Op de eerste server voor SAP HANA (grote exemplaren) van elke regio moet een openbare sleutel voor toegang tot de onderliggende opslaginfrastructuur die het maken van momentopnamen bepaalt worden gemaakt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-228">On the first SAP HANA (large instances) server of each region, a public key must be created to access the underlying storage infrastructure that controls snapshot creation.</span></span>
6. <span data-ttu-id="fc59a-229">Kopieer het script azure\_hana\_backup.pl van/scripts naar de locatie van **hdbsql** van de SAP HANA-installatie.</span><span class="sxs-lookup"><span data-stu-id="fc59a-229">Copy the script azure\_hana\_backup.pl from /scripts to the location of **hdbsql** of the SAP HANA installation.</span></span>
7. <span data-ttu-id="fc59a-230">Kopieer het bestand HANABackupDetails.txt uit/scripts naar dezelfde locatie als het Perl-script.</span><span class="sxs-lookup"><span data-stu-id="fc59a-230">Copy the HANABackupDetails.txt file from /scripts to the same location as the Perl script.</span></span>
8. <span data-ttu-id="fc59a-231">Het wijzigen van het bestand HANABackupDetails.txt die nodig zijn voor de gewenste klant-specificaties.</span><span class="sxs-lookup"><span data-stu-id="fc59a-231">Modify the HANABackupDetails.txt file as necessary for the appropriate customer specifications.</span></span>

### <a name="step-1-install-sap-hana-hdbclient"></a><span data-ttu-id="fc59a-232">Stap 1: SAP HANA HDBClient installeren</span><span class="sxs-lookup"><span data-stu-id="fc59a-232">Step 1: Install SAP HANA HDBClient</span></span>

<span data-ttu-id="fc59a-233">De Linux is geïnstalleerd op een SAP HANA in Azure (grote exemplaren) omvat de mappen en scripts nodig zijn voor het uitvoeren van SAP HANA-opslag-momentopnamen voor back-up en herstel na noodgevallen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-233">The Linux installed on SAP HANA on Azure (large instances) includes the folders and scripts necessary to execute SAP HANA storage snapshots for backup and disaster-recovery purposes.</span></span> <span data-ttu-id="fc59a-234">Het is echter zelf verantwoordelijk voor SAP HANA HDBclient installeren tijdens de installatie van SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="fc59a-234">However, it is your responsibility to install SAP HANA HDBclient while you are installing SAP HANA.</span></span> <span data-ttu-id="fc59a-235">(Microsoft installeert de HDBclient, noch SAP HANA.)</span><span class="sxs-lookup"><span data-stu-id="fc59a-235">(Microsoft installs neither the HDBclient nor SAP HANA.)</span></span>

### <a name="step-2-change-etcsshsshconfig"></a><span data-ttu-id="fc59a-236">Stap 2: Wijzig/etc/ssh/ssh\_config</span><span class="sxs-lookup"><span data-stu-id="fc59a-236">Step 2: Change /etc/ssh/ssh\_config</span></span>

<span data-ttu-id="fc59a-237">Wijzig/etc/ssh/ssh\_config door toe te voegen _MACs hmac-sha1_ regel als volgt te werk:</span><span class="sxs-lookup"><span data-stu-id="fc59a-237">Change /etc/ssh/ssh\_config by adding _MACs hmac-sha1_ line as shown here:</span></span>
```
#   RhostsRSAAuthentication no
#   RSAAuthentication yes
#   PasswordAuthentication yes
#   HostbasedAuthentication no
#   GSSAPIAuthentication no
#   GSSAPIDelegateCredentials no
#   GSSAPIKeyExchange no
#   GSSAPITrustDNS no
#   BatchMode no
#   CheckHostIP yes
#   AddressFamily any
#   ConnectTimeout 0
#   StrictHostKeyChecking ask
#   IdentityFile ~/.ssh/identity
#   IdentityFile ~/.ssh/id_rsa
#   IdentityFile ~/.ssh/id_dsa
#   Port 22
Protocol 2
#   Cipher 3des
#   Ciphers aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc
#   MACs hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160
MACs hmac-sha1
#   EscapeChar ~
#   Tunnel no
#   TunnelDevice any:any
#   PermitLocalCommand no
#   VisualHostKey no
#   ProxyCommand ssh -q -W %h:%p gateway.example.com
```

### <a name="step-3-create-a-public-key"></a><span data-ttu-id="fc59a-238">Stap 3: Maak een openbare sleutel</span><span class="sxs-lookup"><span data-stu-id="fc59a-238">Step 3: Create a public key</span></span>

<span data-ttu-id="fc59a-239">Maak een openbare sleutel moet worden gebruikt voor toegang tot de infrastructuur voor opslag zodat u kunt momentopnamen maken op de eerste SAP HANA op Azure (grote exemplaren)-server in elk Azure-regio.</span><span class="sxs-lookup"><span data-stu-id="fc59a-239">On the first SAP HANA on Azure (large instances) server in each Azure region, create a public key to be used to access the storage infrastructure so that you can create snapshots.</span></span> <span data-ttu-id="fc59a-240">De openbare sleutel zorgt ervoor dat een wachtwoord niet aan te melden bij de opslag is vereist en wachtwoordreferenties worden niet gehandhaafd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-240">The public key ensures that a password is not required to sign in to the storage and that password credentials are not maintained.</span></span> <span data-ttu-id="fc59a-241">Voer de volgende opdracht om de openbare sleutel te genereren in Linux op de SAP HANA (grote exemplaren)-server:</span><span class="sxs-lookup"><span data-stu-id="fc59a-241">In Linux on the SAP HANA (large instances) server, execute the following command to generate the public key:</span></span>
```
  ssh-keygen –t dsa –b 1024
```
<span data-ttu-id="fc59a-242">De nieuwe locatie is _/root/.ssh/id\_dsa.pub.</span><span class="sxs-lookup"><span data-stu-id="fc59a-242">The new location is _/root/.ssh/id\_dsa.pub.</span></span> <span data-ttu-id="fc59a-243">Voer een wachtwoordzin werkelijke niet, anders moet u de wachtwoordzin invoeren telkens wanneer die u zich aanmeldt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-243">Do not enter an actual passphrase, or else you will be required to enter the passphrase each time you sign in.</span></span> <span data-ttu-id="fc59a-244">In plaats daarvan, drukt u op **Enter** twee keer te verwijderen van de vereiste enter wachtwoordzin voor het aanmelden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-244">Instead, press **Enter** twice to remove the enter passphrase requirement for signing in.</span></span>

<span data-ttu-id="fc59a-245">Controleer of de openbare sleutel is opgelost, zoals werd verwacht in mappen wijzigen in /root/.ssh/ en vervolgens uitvoert de **ls** opdracht.</span><span class="sxs-lookup"><span data-stu-id="fc59a-245">Check to make sure that the public key was corrected as expected by changing folders to /root/.ssh/ and then executing the **ls** command.</span></span> <span data-ttu-id="fc59a-246">Als de sleutel aanwezig is, kunt u deze kunt kopiëren door de volgende opdracht uit te voeren:</span><span class="sxs-lookup"><span data-stu-id="fc59a-246">If the key is present, you can copy it by running the following command:</span></span>

![Openbare sleutel wordt gekopieerd met deze opdracht uit te voeren](./media/hana-overview-high-availability-disaster-recovery/image2-public-key.png)

<span data-ttu-id="fc59a-248">Op dit moment Neem contact op met de SAP HANA op Azure-servicebeheer en de sleutel opgeven.</span><span class="sxs-lookup"><span data-stu-id="fc59a-248">At this point, contact SAP HANA on Azure Service Management and provide the key.</span></span> <span data-ttu-id="fc59a-249">De klantenservice maakt gebruik van de openbare sleutel registreren in de onderliggende infrastructuur voor opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-249">The service representative uses the public key to register it in the underlying storage infrastructure.</span></span>

### <a name="step-4-create-an-sap-hana-user-account"></a><span data-ttu-id="fc59a-250">Stap 4: Een SAP HANA-gebruikersaccount maken</span><span class="sxs-lookup"><span data-stu-id="fc59a-250">Step 4: Create an SAP HANA user account</span></span>

<span data-ttu-id="fc59a-251">Maak een SAP HANA-gebruikersaccount in SAP HANA Studio voor back-updoeleinden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-251">Create an SAP HANA user account within SAP HANA Studio for backup purposes.</span></span> <span data-ttu-id="fc59a-252">Dit account moet hebben de volgende bevoegdheden: _back-up Admin_ en _catalogus_.</span><span class="sxs-lookup"><span data-stu-id="fc59a-252">This account must have the following privileges: _Backup Admin_ and _Catalog Read_.</span></span> <span data-ttu-id="fc59a-253">In dit voorbeeld wordt de gebruikersnaam SCADMIN wordt gemaakt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-253">In this example, the username SCADMIN is created.</span></span>

![Maken van een gebruiker in HANA Studio](./media/hana-overview-high-availability-disaster-recovery/image3-creating-user.png)

### <a name="step-5-authorize-the-sap-hana-user-account"></a><span data-ttu-id="fc59a-255">Stap 5: Machtig de SAP HANA-gebruikersaccount</span><span class="sxs-lookup"><span data-stu-id="fc59a-255">Step 5: Authorize the SAP HANA user account</span></span>

<span data-ttu-id="fc59a-256">Toestaan dat het gebruikersaccount voor SAP HANA (moet worden gebruikt door de scripts zonder autorisatie telkens wanneer het script wordt uitgevoerd).</span><span class="sxs-lookup"><span data-stu-id="fc59a-256">Authorize the SAP HANA user account (to be used by the scripts without requiring authorization every time the script is run).</span></span> <span data-ttu-id="fc59a-257">De opdracht SAP HANA `hdbuserstore` het maken van een sleutel voor SAP HANA, die is opgeslagen op een of meer SAP HANA-knooppunten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-257">The SAP HANA command `hdbuserstore` allows the creation of an SAP HANA user key, which is stored on one or more SAP HANA nodes.</span></span> <span data-ttu-id="fc59a-258">De sleutel van de gebruiker kan ook de gebruiker toegang tot SAP HANA zonder het beheren van wachtwoorden op in het proces van het uitvoeren van scripts die later wordt besproken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-258">The user key also allows the user to access SAP HANA without having to manage passwords from within the scripting process that's discussed later.</span></span>

>[!IMPORTANT]
><span data-ttu-id="fc59a-259">Voer de volgende opdracht als `_root_`.</span><span class="sxs-lookup"><span data-stu-id="fc59a-259">Run the following command as `_root_`.</span></span> <span data-ttu-id="fc59a-260">Anders wordt kan niet het script correct werken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-260">Otherwise, the script cannot work properly.</span></span>

<span data-ttu-id="fc59a-261">Voer de `hdbuserstore` opdracht als volgt:</span><span class="sxs-lookup"><span data-stu-id="fc59a-261">Enter the `hdbuserstore` command as follows:</span></span>

![Voer de opdracht hdbuserstore](./media/hana-overview-high-availability-disaster-recovery/image4-hdbuserstore-command.png)

<span data-ttu-id="fc59a-263">In het volgende voorbeeld, waarbij de gebruiker SCADMIN01 en de hostnaam van de lhanad01, is de opdracht:</span><span class="sxs-lookup"><span data-stu-id="fc59a-263">In the following example, where the user is SCADMIN01 and the hostname is lhanad01, the command is:</span></span>
```
hdbuserstore set SCADMIN01 lhanad01:30115 <backup username> <password>
```
<span data-ttu-id="fc59a-264">Beheer alle scripts van één server voor scale-out HANA exemplaren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-264">Manage all scripting from a single server for scale-out HANA instances.</span></span> <span data-ttu-id="fc59a-265">In dit voorbeeld moet de sleutel voor SAP HANA SCADMIN01 voor elke host op een manier die overeenkomt met de host die is gerelateerd aan de sleutel worden gewijzigd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-265">In this example, the SAP HANA key SCADMIN01 must be altered for each host in a way that reflects the host that is related to the key.</span></span> <span data-ttu-id="fc59a-266">Dat wil zeggen, de back-up SAP HANA-account wordt gewijzigd met het exemplaarnummer van de DB HANA **lhanad**.</span><span class="sxs-lookup"><span data-stu-id="fc59a-266">That is, the SAP HANA backup account is amended with the instance number of the HANA DB, **lhanad**.</span></span> <span data-ttu-id="fc59a-267">De sleutel moet beheerdersbevoegdheden hebben op de host die is toegewezen en de back-gebruiker voor scale-out moet toegangsrechten tot alle SAP HANA-exemplaren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-267">The key must have administrative privileges on the host it is assigned to, and the backup user for scale-out must have access rights to all SAP HANA instances.</span></span>
```
hdbuserstore set SCADMIN01 lhanad:30015 SCADMIN <password>
hdbuserstore set SCADMIN02 lhanad:30115 SCADMIN <password>
hdbuserstore set SCADMIN03 lhanad:30215 SCADMIN <password>
```

### <a name="step-6-copy-items-from-the-scripts-folder"></a><span data-ttu-id="fc59a-268">Stap 6: Items kopiëren vanuit de map/scripts</span><span class="sxs-lookup"><span data-stu-id="fc59a-268">Step 6: Copy items from the /scripts folder</span></span>

<span data-ttu-id="fc59a-269">Kopieer de volgende items in map/scripts (opgenomen in de Gouden installatiekopie van de installatie) naar de werkmap voor **hdbsql**.</span><span class="sxs-lookup"><span data-stu-id="fc59a-269">Copy the following items from the /scripts folder (included on the gold image of the installation) to the working directory for **hdbsql**.</span></span> <span data-ttu-id="fc59a-270">Deze map is voor installaties van de huidige HANA /hana/shared/D01/exe/linuxx86\_64/hdb.</span><span class="sxs-lookup"><span data-stu-id="fc59a-270">For current HANA installations, this directory is /hana/shared/D01/exe/linuxx86\_64/hdb.</span></span>
```
azure\_hana\_backup.pl
testHANAConnection.pl
testStorageSnapshotConnection.pl
removeTestStorageSnapshot.pl
HANABackupCustomerDetails.txt
```
<span data-ttu-id="fc59a-271">Kopieer de volgende items als ze zijn met scale-out- of OLAP:</span><span class="sxs-lookup"><span data-stu-id="fc59a-271">Copy the following items if they are running scale-out or OLAP:</span></span>
```
azure\_hana\_backup\_bw.pl
testHANAConnectionBW.pl
testStorageSnapshotConnectionBW.pl
removeTestStorageSnapshotBW.pl
HANABackupCustomerDetailsBW.txt
```
<span data-ttu-id="fc59a-272">Het bestand HANABackupCustomerDetails.txt is als volgt voor de implementatie van een scale-up kan worden gewijzigd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-272">The HANABackupCustomerDetails.txt file is modifiable as follows for a scale-up deployment.</span></span> <span data-ttu-id="fc59a-273">Het is het besturingselement en configuratie-bestand voor het script dat wordt uitgevoerd van de opslag-momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-273">It is the control and configuration file for the script that runs the storage snapshots.</span></span> <span data-ttu-id="fc59a-274">U hebt ontvangen de _back-up Opslagnaam_ en _opslag IP-adres_ uit SAP HANA op Azure-servicebeheer wanneer uw exemplaren zijn geïmplementeerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-274">You should have received the _Storage Backup Name_ and _Storage IP Address_ from SAP HANA on Azure Service Management when your instances were deployed.</span></span> <span data-ttu-id="fc59a-275">U kunt de volgorde bestellingen of afstand van een van de variabelen niet wijzigen of het script niet goed wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-275">You cannot modify the sequence, ordering, or spacing of any of the variables, or the script does not run properly.</span></span>

<span data-ttu-id="fc59a-276">Voor de implementatie van een scale-up eruit het configuratiebestand als:</span><span class="sxs-lookup"><span data-stu-id="fc59a-276">For a scale-up deployment, the configuration file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Created by customer using hdbuserstore
HANA Backup Name: SCADMIND01
```
<span data-ttu-id="fc59a-277">Voor een scale-out-configuratie eruit het bestand HANABackupCustomerDetailsBW.txt als:</span><span class="sxs-lookup"><span data-stu-id="fc59a-277">For a scale-out configuration, the HANABackupCustomerDetailsBW.txt file would look like:</span></span>
```
#Provided by Microsoft Service Management
Storage Backup Name: lhanad01backup
Storage IP Address: 10.250.20.21
#Node IP addresses, instance numbers, and HANA backup name
#provided by customer.  HANA backup name created using
#hdbuserstore utility.
Node 1 IP Address: 10.254.15.21
Node 1 HANA instance number: 01
Node 1 HANA Backup Name: SCADMIN01
Node 2 IP Address: 10.254.15.22
Node 2 HANA instance number: 02
Node 2 HANA Backup Name: SCADMIN02
Node 3 IP Address: 10.254.15.23
Node 3 HANA instance number: 03
Node 3 HANA Backup Name: SCADMIN03
Node 4 IP Address: 10.254.15.24
Node 4 HANA instance number: 04
Node 4 HANA Backup Name: SCADMIN04
Node 5 IP Address: 10.254.15.25
Node 5 HANA instance number: 05
Node 5 HANA Backup Name: SCADMIN05
Node 6 IP Address: 10.254.15.26
Node 6 HANA instance number: 06
Node 6 HANA Backup Name: SCADMIN06
Node 7 IP Address: 10.254.15.27
Node 7 HANA instance number: 07
Node 7 HANA Backup Name: SCADMIN07
Node 8 IP Address: 10.254.15.28
Node 8 HANA instance number: 08
Node 8 HANA Backup Name: SCADMIN08
```
>[!NOTE]
><span data-ttu-id="fc59a-278">Op dit moment worden alleen gegevens voor knooppunt 1 in het werkelijke HANA opslag momentopname script gebruikt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-278">Currently, only Node 1 details are used in the actual HANA storage snapshot script.</span></span> <span data-ttu-id="fc59a-279">Het is raadzaam de toegang tot of van alle HANA knooppunten te testen, zodat als de back-hoofdknooppunt ooit wijzigt, al u zorgt dat een ander knooppunt kan worden uitgevoerd zijn door het wijzigen van de details in het knooppunt 1.</span><span class="sxs-lookup"><span data-stu-id="fc59a-279">We recommend that you test access to or from all HANA nodes so that, if the master backup node ever changes, you have already ensured that any other node can take its place by modifying the details in Node 1.</span></span>

<span data-ttu-id="fc59a-280">Om te controleren of de juiste configuratie in het configuratiebestand of de juiste verbinding met de exemplaren HANA, moet u een van de volgende scripts uitvoeren:</span><span class="sxs-lookup"><span data-stu-id="fc59a-280">To check for the correct configurations in the configuration file or proper connectivity to the HANA instances, run either of the following scripts:</span></span>
- <span data-ttu-id="fc59a-281">Voor een scale-up-configuratie (onafhankelijk van de werkbelasting SAP):</span><span class="sxs-lookup"><span data-stu-id="fc59a-281">For a scale-up configuration (independent on SAP workload):</span></span>

 ```
testHANAConnection.pl
```
- <span data-ttu-id="fc59a-282">Voor de configuratie van een scale-out:</span><span class="sxs-lookup"><span data-stu-id="fc59a-282">For a scale-out configuration:</span></span>

 ```
testHANAConnectionBW.pl
```

<span data-ttu-id="fc59a-283">Zorg ervoor dat het master HANA exemplaar toegang tot alle vereiste HANA-servers heeft.</span><span class="sxs-lookup"><span data-stu-id="fc59a-283">Ensure that the master HANA instance has access to all required HANA servers.</span></span> <span data-ttu-id="fc59a-284">Er zijn geen parameters aan het script, maar moet u de juiste HANABackupCustomerDetails / HANABackupCustomerDetailsBW file voor het script correct kunnen worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-284">There are no parameters to the script, but you must complete the appropriate HANABackupCustomerDetails/ HANABackupCustomerDetailsBW file for the script to run properly.</span></span> <span data-ttu-id="fc59a-285">Omdat alleen de shell-opdracht-foutcodes worden geretourneerd, is het niet mogelijk om het script te foutcontrole elke instantie.</span><span class="sxs-lookup"><span data-stu-id="fc59a-285">Because only the shell command error codes are returned, it is not possible for the script to error-check every instance.</span></span> <span data-ttu-id="fc59a-286">Het script biedt, zodat sommige nuttige opmerkingen voor u om te controleren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-286">Even so, the script does provide some helpful comments for you to double-check.</span></span>

<span data-ttu-id="fc59a-287">Het script uitvoeren:</span><span class="sxs-lookup"><span data-stu-id="fc59a-287">To run the script:</span></span>
```
 ./testHANAConnection.pl
```
 <span data-ttu-id="fc59a-288">Als het script is de status van het exemplaar HANA krijgt, wordt er een bericht weergegeven dat de HANA-verbinding geslaagd is.</span><span class="sxs-lookup"><span data-stu-id="fc59a-288">If the script successfully obtains the status of the HANA instance, it displays a message that the HANA connection was successful.</span></span>

<span data-ttu-id="fc59a-289">Er is bovendien een tweede type script dat u gebruiken kunt om te controleren of master HANA exemplaar van de server aan te melden bij de opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-289">Additionally, there is a second type of script you can use to check the master HANA instance server's ability to sign in to the storage.</span></span> <span data-ttu-id="fc59a-290">Voordat u de azure uitvoert\_hana\_back-up (\_bw) .pl script, moet u het volgende script uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-290">Before you execute the azure\_hana\_backup(\_bw).pl script, you must execute the next script.</span></span> <span data-ttu-id="fc59a-291">Als een volume geen momentopnamen bevat, is het onmogelijk om te bepalen of het volume gewoon leeg is, of er is een ssh verkrijgen van de details van de momentopname is mislukt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-291">If a volume contains no snapshots, it is impossible to determine whether the volume is simply empty or there is an ssh failure to obtain the snapshot details.</span></span> <span data-ttu-id="fc59a-292">Daarom wordt het script wordt uitgevoerd twee stappen:</span><span class="sxs-lookup"><span data-stu-id="fc59a-292">For this reason, the script executes two steps:</span></span>

- <span data-ttu-id="fc59a-293">Er wordt gecontroleerd of de console opslag toegankelijk is.</span><span class="sxs-lookup"><span data-stu-id="fc59a-293">It verifies that the storage console is accessible.</span></span>
- <span data-ttu-id="fc59a-294">Een test- of pop, momentopname voor elk volume wordt gemaakt door HANA-exemplaar.</span><span class="sxs-lookup"><span data-stu-id="fc59a-294">It creates a test, or dummy, snapshot for each volume by HANA instance.</span></span>

<span data-ttu-id="fc59a-295">Daarom is het exemplaar HANA als argument.</span><span class="sxs-lookup"><span data-stu-id="fc59a-295">For this reason, the HANA instance is included as an argument.</span></span> <span data-ttu-id="fc59a-296">Nogmaals, het is niet mogelijk voor het leveren van controleren voor de opslagverbinding, maar het script geeft nuttige tips als de uitvoering mislukt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-296">Again, it is not possible to provide error checking for the storage connection, but the script provides helpful hints if the execution fails.</span></span>

<span data-ttu-id="fc59a-297">Als wordt het script uitgevoerd:</span><span class="sxs-lookup"><span data-stu-id="fc59a-297">The script is run as:</span></span>
```
 ./testStorageSnapshotConnection.pl <hana instance>
```
<span data-ttu-id="fc59a-298">Of die wordt uitgevoerd als:</span><span class="sxs-lookup"><span data-stu-id="fc59a-298">Or it is run as:</span></span>
```
./testStorageSnapshotConnectionBW.pl <hana instance>
```
<span data-ttu-id="fc59a-299">Het script wordt ook een bericht weergegeven dat u kunt op de juiste wijze aanmelden bij uw tenant geïmplementeerde opslag, die is ingedeeld op basis van de logische eenheden (LUN) die worden gebruikt door de server-exemplaren die u bezit.</span><span class="sxs-lookup"><span data-stu-id="fc59a-299">The script also displays a message that you are able to sign in appropriately to your deployed storage tenant, which is organized around the logical unit numbers (LUNs) that are used by the server instances you own.</span></span>

<span data-ttu-id="fc59a-300">Voordat u de eerste opslag op basis van een momentopname back-ups worden uitgevoerd, voert u de volgende scripts om ervoor te zorgen dat de configuratie juist is.</span><span class="sxs-lookup"><span data-stu-id="fc59a-300">Before you execute the first storage snapshot-based backups, run the next scripts to make sure that the configuration is correct.</span></span>

<span data-ttu-id="fc59a-301">U kunt de momentopnamen na het uitvoeren van deze scripts verwijderen door te voeren:</span><span class="sxs-lookup"><span data-stu-id="fc59a-301">After running these scripts, you can delete the snapshots by executing:</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```
<span data-ttu-id="fc59a-302">of</span><span class="sxs-lookup"><span data-stu-id="fc59a-302">Or</span></span>
```
./removeTestStorageSnapshot.pl <hana instance>
```

### <a name="step-7-perform-on-demand-snapshots"></a><span data-ttu-id="fc59a-303">Stap 7: Momentopnamen op aanvraag uitvoeren</span><span class="sxs-lookup"><span data-stu-id="fc59a-303">Step 7: Perform on-demand snapshots</span></span>

<span data-ttu-id="fc59a-304">Momentopnamen op aanvraag uitvoeren (evenals regelmatig momentopnamen plannen met behulp van cron) zoals hier wordt beschreven.</span><span class="sxs-lookup"><span data-stu-id="fc59a-304">Perform on-demand snapshots (as well as schedule regular snapshots by using cron) as described here.</span></span>

<span data-ttu-id="fc59a-305">Omhoog schalen-configuraties, moet u het volgende script uitvoeren:</span><span class="sxs-lookup"><span data-stu-id="fc59a-305">For scale-up configurations, execute the following script:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="fc59a-306">Voor scale-out-configuraties, moet u het volgende script uitvoeren:</span><span class="sxs-lookup"><span data-stu-id="fc59a-306">For scale-out configurations, execute the following script:</span></span>
```
./azure_hana_backup_bw.pl lhanad01 customer 20
```
<span data-ttu-id="fc59a-307">Het script scale-out biedt een aantal extra controles om ervoor te zorgen dat alle HANA servers toegankelijk zijn en alle exemplaren van HANA juiste status van het exemplaar voordat u doorgaat retourneren met het maken van momentopnamen voor SAP HANA of opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-307">The scale-out script does some additional checking to make sure that all HANA servers can be accessed, and all HANA instances return appropriate status of the instance before proceeding with creating SAP HANA or storage snapshots.</span></span>

<span data-ttu-id="fc59a-308">De volgende argumenten zijn vereist:</span><span class="sxs-lookup"><span data-stu-id="fc59a-308">The following arguments are required:</span></span>

- <span data-ttu-id="fc59a-309">De HANA exemplaar vereisen back-up.</span><span class="sxs-lookup"><span data-stu-id="fc59a-309">The HANA instance requiring backup.</span></span>
- <span data-ttu-id="fc59a-310">Het voorvoegsel van de momentopname van de momentopname van de opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-310">The snapshot prefix for the storage snapshot.</span></span>
- <span data-ttu-id="fc59a-311">Het aantal momentopnamen worden bewaard voor de specifieke voorvoegsel.</span><span class="sxs-lookup"><span data-stu-id="fc59a-311">The number of snapshots to be kept for the specific prefix.</span></span>

```
./azure_hana_backup.pl lhanad01 customer 20
```

<span data-ttu-id="fc59a-312">De uitvoering van het script maakt een momentopname van de opslag in deze drie afzonderlijke fasen:</span><span class="sxs-lookup"><span data-stu-id="fc59a-312">The execution of the script creates the storage snapshot in these three distinct phases:</span></span>

- <span data-ttu-id="fc59a-313">Uitvoeren van een momentopname HANA.</span><span class="sxs-lookup"><span data-stu-id="fc59a-313">Execute a HANA snapshot.</span></span>
- <span data-ttu-id="fc59a-314">Uitvoeren van een momentopname van de opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-314">Execute a storage snapshot.</span></span>
- <span data-ttu-id="fc59a-315">Verwijder de momentopname HANA.</span><span class="sxs-lookup"><span data-stu-id="fc59a-315">Remove the HANA snapshot.</span></span>

<span data-ttu-id="fc59a-316">Voer het script door het aanroepen van de uitvoerbare map op HDB die is gekopieerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-316">Execute the script by calling it from the HDB executable folder that it was copied to.</span></span> <span data-ttu-id="fc59a-317">Deze back-ups van ten minste de volgende volumes, maar deze ook back-ups van volumes met de naam van de expliciete SAP HANA-sessie in de naam van het volume.</span><span class="sxs-lookup"><span data-stu-id="fc59a-317">It backs up at least the following volumes, but it also backs up any volume that has the explicit SAP HANA instance name in the volume name.</span></span>
```
hana_data_<hana instance>_prod_t020_vol
hana_log_<hana instance>_prod_t020_vol
hana_log_backup_<hana instance>_prod_t020_vol
hana_shared_<hana instance>_prod_t020_vol
```
<span data-ttu-id="fc59a-318">De bewaarperiode is uitsluitend beheerd met het aantal momentopnamen verzonden als een parameter tijdens het uitvoeren van het script (zoals 20 eerder weergegeven).</span><span class="sxs-lookup"><span data-stu-id="fc59a-318">The retention period is strictly administered, with the number of snapshots submitted as a parameter when you execute the script (such as 20, shown previously).</span></span> <span data-ttu-id="fc59a-319">De hoeveelheid tijd is dus een functie van de periode van uitvoering en het aantal momentopnamen in de aanroep van het script.</span><span class="sxs-lookup"><span data-stu-id="fc59a-319">So the amount of time is a function of the period of execution and the number of snapshots in the call of the script.</span></span> <span data-ttu-id="fc59a-320">Als het aantal momentopnamen worden bewaard overschrijdt het aantal die als een parameter in de aanroep van het script de oudste opslag momentopname van dit label worden genoemd (in ons geval vorige _aangepaste_) is verwijderd voordat een nieuwe momentopname wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-320">If the number of snapshots that are kept exceeds the number that are named as a parameter in the call of the script, the oldest storage snapshot of this label (in our previous case, _custom_) is deleted before a new snapshot is executed.</span></span> <span data-ttu-id="fc59a-321">Dit betekent dat het aantal geeft u de laatste parameter van de aanroep is het aantal kunt u bepalen het aantal momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-321">This means the number you give as the last parameter of the call is the number you can use to control the number of snapshots.</span></span>

>[!NOTE]
><span data-ttu-id="fc59a-322">Als u het label wijzigt, wordt de telling opnieuw gestart.</span><span class="sxs-lookup"><span data-stu-id="fc59a-322">As soon as you change the label, the counting starts again.</span></span>

<span data-ttu-id="fc59a-323">U moet de naam van het HANA-exemplaar dat wordt geleverd door SAP HANA op Azure Service Management als een argument als ze bij het maken van momentopnamen in omgevingen met meerdere knooppunten bevatten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-323">You need to include the HANA instance name that's provided by SAP HANA on Azure Service Management as an argument if they are creating snapshots in multi-node environments.</span></span> <span data-ttu-id="fc59a-324">In omgevingen met één knooppunt, de naam van de SAP HANA op Azure (grote exemplaren) eenheid voldoende is, maar de exemplaarnaam HANA nog steeds wordt aanbevolen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-324">In single-node environments, the name of the SAP HANA on Azure (large instances) unit is sufficient, but the HANA instance name is still recommended.</span></span>

<span data-ttu-id="fc59a-325">Bovendien, kunt u back-up boot volumes\LUNs met behulp van hetzelfde script.</span><span class="sxs-lookup"><span data-stu-id="fc59a-325">Additionally, you can back up boot volumes\LUNs by using the same script.</span></span> <span data-ttu-id="fc59a-326">U moet back-up het opstartvolume ten minste één keer tijdens de eerste uitvoering HANA, hoewel wordt aangeraden een back-upschema voor het opstarten in cron wekelijks of elke nacht.</span><span class="sxs-lookup"><span data-stu-id="fc59a-326">You must back up your boot volume at least once when you first run HANA, although we recommend a weekly or nightly backup schedule for booting in cron.</span></span> <span data-ttu-id="fc59a-327">In plaats daarvan dan het toevoegen van een SAP HANA-instantienaam, invoegen _boot_ als het argument in het script als volgt:</span><span class="sxs-lookup"><span data-stu-id="fc59a-327">Rather than add an SAP HANA instance name, insert _boot_ as the argument into the script as follows:</span></span>
```
./azure_hana_backup boot customer 20
```
<span data-ttu-id="fc59a-328">Hetzelfde bewaarbeleid wordt geboden voor het opstartvolume bevinden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-328">The same retention policy is afforded to the boot volume as well.</span></span> <span data-ttu-id="fc59a-329">Op aanvraag momentopnamen, zoals is beschreven voorheen voor bijzondere gevallen, zoals tijdens een upgrade SAP verbetering pakket (EHP), of wanneer u wilt maken van een momentopname van een afzonderlijke opslag gebruiken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-329">Use on-demand snapshots, as described previously, for special cases only, such as during an SAP enhancement package (EHP) upgrade, or when you need to create a distinct storage snapshot.</span></span>

<span data-ttu-id="fc59a-330">We raden u aan het uitvoeren van geplande opslag-momentopnamen met cron en het is raadzaam dat u hetzelfde script voor alle back-ups en herstel na noodgevallen behoeften (de script-invoer overeenkomen met de verschillende aangevraagd back-ups wijzigen).</span><span class="sxs-lookup"><span data-stu-id="fc59a-330">We encourage you to perform scheduled storage snapshots using cron, and we recommend that you use the same script for all backups and disaster-recovery needs (modifying the script inputs to match the various requested backup times).</span></span> <span data-ttu-id="fc59a-331">Dit zijn alle anders gepland in cron, afhankelijk van hun uitvoeringstijd: elk uur, 12 uur, dagelijks of wekelijks.</span><span class="sxs-lookup"><span data-stu-id="fc59a-331">These are all scheduled differently in cron depending on their execution time: hourly, 12-hour, daily, or weekly.</span></span> <span data-ttu-id="fc59a-332">De cron-schema is ontworpen voor opslag-momentopnamen die overeenkomen met de eerder besproken bewaren labels voor lange termijn off-site back-up maken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-332">The cron schedule is designed to create storage snapshots that match the previously discussed retention labeling for long-term off-site backup.</span></span> <span data-ttu-id="fc59a-333">Het script bevat opdrachten voor back-up van alle productievolumes, afhankelijk van de aangevraagde frequentie (gegevens en logboekbestanden worden back-up gemaakt elk uur, terwijl het opstartvolume back-up dagelijks).</span><span class="sxs-lookup"><span data-stu-id="fc59a-333">The script includes commands to back up all production volumes, depending on their requested frequency (data and log files are backed up hourly, whereas the boot volume is backed up daily).</span></span>

<span data-ttu-id="fc59a-334">De vermeldingen in het volgende cron-script wordt elk uur uitgevoerd op de tien minuten, elke 12 uur op de tien minuten en dagelijks op de tien minuten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-334">The entries in the following cron script run every hour at the tenth minute, every 12 hours at the tenth minute, and daily at the tenth minute.</span></span> <span data-ttu-id="fc59a-335">De cron taken worden gemaakt op zodanige wijze die slechts één SAP HANA opslag momentopname plaatsvindt tijdens een bepaald uur zodat de back-ups per uur en per dag wordt niet op hetzelfde moment (12:10 uur bijgewerkt).</span><span class="sxs-lookup"><span data-stu-id="fc59a-335">The cron jobs are created in such a way that only one SAP HANA storage snapshot takes place during any particular hour, so that the hourly and daily backups do not occur at the same time (12:10 AM).</span></span> <span data-ttu-id="fc59a-336">SAP HANA op Azure Service Management biedt om te optimaliseren van uw momentopnamen worden gemaakt en replicatie, de aanbevolen tijd voor u uw back-ups uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-336">To help optimize your snapshot creation and replication, SAP HANA on Azure Service Management provides the recommended time for you to run your backups.</span></span>

<span data-ttu-id="fc59a-337">De standaard cron planning in /etc/crontab is als volgt:</span><span class="sxs-lookup"><span data-stu-id="fc59a-337">The default cron scheduling in /etc/crontab is as follows:</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 14
```
<span data-ttu-id="fc59a-338">De volumes HANA (zonder opstartvolume) ophalen in de voorgaande instructies voor het cron uur momentopname te maken met het label.</span><span class="sxs-lookup"><span data-stu-id="fc59a-338">In the previous cron instructions, the HANA volumes (without boot volume) get an hourly snapshot with the label.</span></span> <span data-ttu-id="fc59a-339">Van deze momentopnamen worden 66 bewaard.</span><span class="sxs-lookup"><span data-stu-id="fc59a-339">Of these snapshots, 66 are retained.</span></span> <span data-ttu-id="fc59a-340">Bovendien worden 14 momentopnamen met het label 12 uur bewaard.</span><span class="sxs-lookup"><span data-stu-id="fc59a-340">Additionally, 14 snapshots with the 12-hour label are retained.</span></span> <span data-ttu-id="fc59a-341">Mogelijk krijgt u elk uur momentopnamen voor drie dagen, plus momentopnamen van 12 uur voor een andere vier dagen, waarmee u een hele week van momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-341">You potentially get hourly snapshots for three days, plus 12-hour snapshots for another four days, which gives you an entire week of snapshots.</span></span>

<span data-ttu-id="fc59a-342">Planning binnen cron worden lastig, omdat er slechts één script moet worden uitgevoerd op een willekeurig moment, tenzij de scripts gespreid door enkele minuten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-342">Scheduling within cron can be tricky, because only one script should be executed at any particular time, unless the scripts are staggered by several minutes.</span></span> <span data-ttu-id="fc59a-343">Als u dagelijkse back-ups op lange termijn wilt, een dagelijkse momentopname wordt opgeslagen samen met een momentopname 12 uur (met een telling van de bewaartermijn van elke zeven) of momentopname van het uur worden gehouden 10 minuten later is gespreid.</span><span class="sxs-lookup"><span data-stu-id="fc59a-343">If you want daily backups for long-term retention, either a daily snapshot is kept along with a 12-hour snapshot (with a retention count of seven each), or the hourly snapshot is staggered to take place 10 minutes later.</span></span> <span data-ttu-id="fc59a-344">Slechts één dagelijkse momentopname wordt opgeslagen in de productievolume.</span><span class="sxs-lookup"><span data-stu-id="fc59a-344">Only one daily snapshot is kept in the production volume.</span></span>
```
10 1-11,13-23 * * * ./azure_hana_backup.pl lhanad01 hourly 66
10 12 * * *  ./azure_hana_backup.pl lhanad01 12hour 7
10 0 * * * ./azure_hana_backup.pl lhanad01 daily 7
```
<span data-ttu-id="fc59a-345">De hier vermelde frequenties zijn alleen voorbeelden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-345">The frequencies listed here are only examples.</span></span> <span data-ttu-id="fc59a-346">Als u wilt het optimale aantal momentopnamen worden afgeleid, gebruikt u de volgende criteria:</span><span class="sxs-lookup"><span data-stu-id="fc59a-346">To derive your optimum number of snapshots, use the following criteria:</span></span>

- <span data-ttu-id="fc59a-347">De vereisten in de beoogde hersteltijd voor herstel van de punt in tijd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-347">Requirements in recovery time objective for point-in-time recovery.</span></span>
- <span data-ttu-id="fc59a-348">Gebruik van schijfruimte.</span><span class="sxs-lookup"><span data-stu-id="fc59a-348">Space usage.</span></span>
- <span data-ttu-id="fc59a-349">Vereisten bij het herstellen van punt doel en de beoogde hersteltijd op mogelijk noodherstel.</span><span class="sxs-lookup"><span data-stu-id="fc59a-349">Requirements in recovery point objective and recovery time objective for potential disaster recovery.</span></span>
- <span data-ttu-id="fc59a-350">Uiteindelijke uitvoering van HANA volledige databaseback-ups op basis van schijven.</span><span class="sxs-lookup"><span data-stu-id="fc59a-350">Eventual execution of HANA full database backups against disks.</span></span> <span data-ttu-id="fc59a-351">Wanneer een volledige databaseback-up op basis van schijven, of _backint_ interface, wordt uitgevoerd, de uitvoering van opslag-momentopnamen is mislukt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-351">Whenever a full database backup against disks, or _backint_ interface, is performed, the execution of storage snapshots fails.</span></span> <span data-ttu-id="fc59a-352">Als u van plan bent om uit te voeren volledige databaseback-ups boven op de opslag-momentopnamen, zorg ervoor dat de uitvoering van opslag-momentopnamen gedurende deze tijd is uitgeschakeld.</span><span class="sxs-lookup"><span data-stu-id="fc59a-352">If you plan to execute full database backups on top of storage snapshots, make sure that the execution of storage snapshots is disabled during this time.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="fc59a-353">Het gebruik van opslag-momentopnamen voor SAP HANA back-ups is alleen geldig wanneer de momentopnamen die in combinatie met SAP HANA logboekback-ups worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-353">The use of storage snapshots for SAP HANA backups is valid only when the snapshots are performed in conjunction with SAP HANA log backups.</span></span> <span data-ttu-id="fc59a-354">Deze logboekback-ups moeten kunnen omvatten de tijd tussen de opslag-momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-354">These log backups need to be able to cover the time periods between the storage snapshots.</span></span> <span data-ttu-id="fc59a-355">Als u een toezegging voor gebruikers van een punt in tijd herstel van 30 dagen hebt ingesteld, moet u het volgende:</span><span class="sxs-lookup"><span data-stu-id="fc59a-355">If you've set a commitment to users of a point-in-time recovery of 30 days, you need the following:</span></span>

- <span data-ttu-id="fc59a-356">De mogelijkheid voor toegang tot een momentopname van een opslaggroep die 30 dagen oud is.</span><span class="sxs-lookup"><span data-stu-id="fc59a-356">Ability to access a storage snapshot that is 30 days old.</span></span>
- <span data-ttu-id="fc59a-357">Aaneengesloten logboekback-ups gedurende de afgelopen 30 dagen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-357">Contiguous log backups over the last 30 days.</span></span>

<span data-ttu-id="fc59a-358">In het bereik van logboekback-ups, een momentopname van de back-uplogboek-volume te maken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-358">In the range of log backups, create a snapshot of the backup log volume as well.</span></span> <span data-ttu-id="fc59a-359">Echter, moet u regelmatig logboekback-ups uitvoeren, zodat u kunt:</span><span class="sxs-lookup"><span data-stu-id="fc59a-359">However, be sure to perform regular log backups so that you can:</span></span>

- <span data-ttu-id="fc59a-360">Hebben de aaneengesloten logboekback-ups die nodig zijn voor het punt in tijd herstelacties uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-360">Have the contiguous log backups needed to perform point-in-time recoveries.</span></span>
- <span data-ttu-id="fc59a-361">Voorkomen dat de SAP HANA-logboekvolume uitgevoerd geen ruimte meer.</span><span class="sxs-lookup"><span data-stu-id="fc59a-361">Prevent the SAP HANA log volume from running out of space.</span></span>

<span data-ttu-id="fc59a-362">Een van de laatste stappen is SAP HANA back-uplogboeken in SAP HANA Studio plannen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-362">One of the last steps is to schedule SAP HANA backup logs in SAP HANA Studio.</span></span> <span data-ttu-id="fc59a-363">De doellocatie voor SAP HANA-back-uplogboek is het speciaal gemaakt hana/logboek\_back-ups volume met het koppelpunt van /hana/log/backups.</span><span class="sxs-lookup"><span data-stu-id="fc59a-363">The SAP HANA backup log target destination is the specially created hana/log\_backups volume with the mount point of /hana/log/backups.</span></span>

![Back-uplogboeken SAP HANA in SAP HANA Studio plannen](./media/hana-overview-high-availability-disaster-recovery/image5-schedule-backup.png)

<span data-ttu-id="fc59a-365">U kunt back-ups die vaker plaatsvinden dan om de 15 minuten zijn.</span><span class="sxs-lookup"><span data-stu-id="fc59a-365">You can choose backups that are more frequent than every 15 minutes.</span></span> <span data-ttu-id="fc59a-366">Sommige gebruikers zelfs uitvoeren logboekback-ups elke minuut, maar we niet gaat raden _via_ 15 minuten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-366">Some users even perform log backups every minute, although we do not recommend going _over_ 15 minutes.</span></span>

<span data-ttu-id="fc59a-367">De laatste stap is het uitvoeren van een back-ups (na de initiële installatie van de SAP HANA) voor het maken van een afzonderlijke back-post moet bestaan binnen de back-catalogus.</span><span class="sxs-lookup"><span data-stu-id="fc59a-367">The final step is to perform a file-based backup (after the initial installation of SAP HANA) to create a single backup entry that must exist within the backup catalog.</span></span> <span data-ttu-id="fc59a-368">SAP HANA kan niet anders uw opgegeven logboekback-ups gestart.</span><span class="sxs-lookup"><span data-stu-id="fc59a-368">Otherwise SAP HANA cannot initiate your specified log backups.</span></span>

![Maken van een back-ups maken van een afzonderlijke back-post](./media/hana-overview-high-availability-disaster-recovery/image6-make-backup.png)

### <a name="monitoring-the-number-and-size-of-snapshots-on-the-disk-volume"></a><span data-ttu-id="fc59a-370">Het aantal en de grootte van momentopnamen op het schijfvolume bewaking</span><span class="sxs-lookup"><span data-stu-id="fc59a-370">Monitoring the number and size of snapshots on the disk volume</span></span>

<span data-ttu-id="fc59a-371">U kunt het aantal momentopnamen en het opslagverbruik van momentopnamen bewaken op een bepaalde opslagvolume.</span><span class="sxs-lookup"><span data-stu-id="fc59a-371">On a particular storage volume, you can monitor the number of snapshots and the storage consumption of snapshots.</span></span> <span data-ttu-id="fc59a-372">De `ls` opdracht de momentopname-map of bestanden wordt niet weergegeven.</span><span class="sxs-lookup"><span data-stu-id="fc59a-372">The `ls` command doesn't show the snapshot directory or files.</span></span> <span data-ttu-id="fc59a-373">Echter, de opdracht Linux-besturingssysteem `du` komt met de volgende opdrachten:</span><span class="sxs-lookup"><span data-stu-id="fc59a-373">However, the Linux OS command `du` does, with the following commands:</span></span>

- <span data-ttu-id="fc59a-374">`du –sh .snapshot`biedt een totaal van alle momentopnamen binnen de momentopname-directory.</span><span class="sxs-lookup"><span data-stu-id="fc59a-374">`du –sh .snapshot` provides a total of all snapshots within the snapshot directory.</span></span>
- <span data-ttu-id="fc59a-375">`du –sh --max-depth=1`een lijst met alle momentopnamen die zijn opgeslagen in de map .snapshot en de grootte van elke momentopname.</span><span class="sxs-lookup"><span data-stu-id="fc59a-375">`du –sh --max-depth=1` lists all snapshots that are saved in the .snapshot folder and the size of each snapshot.</span></span>
- <span data-ttu-id="fc59a-376">`du –hc`Geeft de totale grootte, die wordt gebruikt door alle momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-376">`du –hc` provides the total size used by all snapshots.</span></span>

<span data-ttu-id="fc59a-377">Deze opdrachten gebruiken om ervoor te zorgen dat de momentopnamen die zijn gemaakt en opgeslagen geen de opslag op de volumes worden verbruikt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-377">Use these commands to make sure that the snapshots that are taken and stored are not consuming all the storage on the volumes.</span></span>

### <a name="reducing-the-number-of-snapshots-on-a-server"></a><span data-ttu-id="fc59a-378">Het aantal momentopnamen op een server verminderen</span><span class="sxs-lookup"><span data-stu-id="fc59a-378">Reducing the number of snapshots on a server</span></span>

<span data-ttu-id="fc59a-379">Zoals eerder beschreven, kunt u Verminder het aantal bepaalde labels van de momentopnamen die u opslaat.</span><span class="sxs-lookup"><span data-stu-id="fc59a-379">As explained earlier, you can reduce the number of certain labels of snapshots that you store.</span></span> <span data-ttu-id="fc59a-380">De laatste twee parameters van de opdracht voor het initiëren van een momentopname zijn een label en het aantal momentopnamen die u wilt behouden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-380">The last two parameters of the command to initiate a snapshot are a label and the number of snapshots you want to retain.</span></span>
```
./azure_hana_backup.pl lhanad01 customer 20
```
<span data-ttu-id="fc59a-381">In het vorige voorbeeld de label van de momentopname is _klant_ en is het aantal momentopnamen met dit label moet worden bewaard _20_.</span><span class="sxs-lookup"><span data-stu-id="fc59a-381">In the previous example, the snapshot label is _customer_ and the number of snapshots with this label to be retained is _20_.</span></span> <span data-ttu-id="fc59a-382">Als u op verbruik van schijfruimte reageren, wilt u misschien Verminder het aantal opgeslagen momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-382">As you respond to disk space consumption, you might want to reduce the number of stored snapshots.</span></span> <span data-ttu-id="fc59a-383">Er is een eenvoudige manier om het aantal momentopnamen beperken het script uitvoeren met de laatste parameter die is ingesteld op 5:</span><span class="sxs-lookup"><span data-stu-id="fc59a-383">The easy way to reduce the number of snapshots is to run the script with the last parameter set to 5:</span></span>
```
./azure_hana_backup.pl lhanad01 customer 5
```
<span data-ttu-id="fc59a-384">Als gevolg van het script uitgevoerd met deze instelling, het aantal momentopnamen, met inbegrip van de momentopname van de nieuwe opslag, is de _5_.</span><span class="sxs-lookup"><span data-stu-id="fc59a-384">As a result of running the script with this setting, the number of snapshots, including the new storage snapshot, is _5_.</span></span>

 >[!NOTE]
 > <span data-ttu-id="fc59a-385">Dit script vermindert het aantal momentopnamen alleen als de meest recente vorige momentopname meer dan een uur oud is.</span><span class="sxs-lookup"><span data-stu-id="fc59a-385">This script reduces the number of snapshots only if the most recent previous snapshot is more than one hour old.</span></span> <span data-ttu-id="fc59a-386">Het script worden niet verwijderd voor momentopnamen die minder dan een uur oud.</span><span class="sxs-lookup"><span data-stu-id="fc59a-386">The script does not delete snapshots that are less than one hour old.</span></span>

<span data-ttu-id="fc59a-387">Deze beperkingen zijn gerelateerd aan de optionele herstel na noodgevallen-functionaliteit.</span><span class="sxs-lookup"><span data-stu-id="fc59a-387">These restrictions are related to the optional disaster-recovery functionality offered.</span></span>

<span data-ttu-id="fc59a-388">Als u niet langer onderhouden van een set van momentopnamen met voorvoegsel wilt, kunt u het script uitvoeren _0_ nummer bewaarperiode alle momentopnamen die overeenkomt met dat voorvoegsel te verwijderen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-388">If you no longer want to maintain a set of snapshots with that prefix, you can execute the script with _0_ as the retention number to remove all snapshots matching that prefix.</span></span> <span data-ttu-id="fc59a-389">Alle momentopnamen verwijderen kan echter de mogelijkheden van herstel na noodgevallen beïnvloeden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-389">However, removing all snapshots can affect the capabilities of disaster recovery.</span></span>

### <a name="recovering-to-the-most-recent-hana-snapshot"></a><span data-ttu-id="fc59a-390">Herstellen naar de meest recente HANA momentopname</span><span class="sxs-lookup"><span data-stu-id="fc59a-390">Recovering to the most recent HANA snapshot</span></span>

<span data-ttu-id="fc59a-391">In het geval dat er een productie-down-scenario, kan het proces van het herstellen van een momentopname van de opslag kan worden gestart als een klant incident met SAP HANA op Azure Service Management.</span><span class="sxs-lookup"><span data-stu-id="fc59a-391">In the event that you experience a production-down scenario, the process of recovering from a storage snapshot can be initiated as a customer incident with SAP HANA on Azure Service Management.</span></span> <span data-ttu-id="fc59a-392">Een onverwachte scenario mogelijk een hoge urgentie kwestie als gegevens in een productiesysteem is verwijderd en de enige manier om de gegevens worden opgehaald, is de productiedatabase herstellen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-392">Such an unexpected scenario might be a high-urgency matter if data was deleted in a production system and the only way to retrieve the data is to restore the production database.</span></span>

<span data-ttu-id="fc59a-393">Anderzijds, kan het herstel van een punt in tijd lage urgentie en geplande dagen van tevoren.</span><span class="sxs-lookup"><span data-stu-id="fc59a-393">On the other hand, a point-in-time recovery could be low urgency and planned for days in advance.</span></span> <span data-ttu-id="fc59a-394">U kunt dit herstel met SAP HANA plannen op Azure Service Management in plaats van een probleem met hoge prioriteit verhogen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-394">You can plan this recovery with SAP HANA on Azure Service Management instead of raising a high-priority issue.</span></span> <span data-ttu-id="fc59a-395">U kunt bijvoorbeeld planning probeert een upgrade van de SAP-software door het toepassen van een nieuw pakket in de uitbreiding, en u vervolgens wilt terugkeren naar een momentopname die de status voor de upgrade EHP vertegenwoordigt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-395">For example, you might be planning to try an upgrade of the SAP software by applying a new enhancement package, and you then need to revert back to a snapshot that represents the state before the EHP upgrade.</span></span>

<span data-ttu-id="fc59a-396">Voordat u de aanvraag verzendt, moet u de voorbereiding.</span><span class="sxs-lookup"><span data-stu-id="fc59a-396">Before you issue the request, you need to do some preparation.</span></span> <span data-ttu-id="fc59a-397">SAP HANA in Azure Service Management-team kunt vervolgens de aanvraag te verwerken en de herstelde volumes bieden.</span><span class="sxs-lookup"><span data-stu-id="fc59a-397">SAP HANA on Azure Service Management team can then handle the request and provide the restored volumes.</span></span> <span data-ttu-id="fc59a-398">Het is daarna tot u de HANA-database op basis van de momentopnamen terugzetten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-398">Afterward, it is up to you to restore the HANA database based on the snapshots.</span></span> <span data-ttu-id="fc59a-399">Ga als volgt om voor te bereiden voor de aanvraag:</span><span class="sxs-lookup"><span data-stu-id="fc59a-399">Here is how to prepare for the request:</span></span>

>[!NOTE]
><span data-ttu-id="fc59a-400">De gebruikersinterface kan afwijken van de volgende schermafbeeldingen, afhankelijk van de SAP HANA-versie die u gebruikt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-400">Your user interface might vary from the following screenshots, depending on the SAP HANA release you are using.</span></span>

1. <span data-ttu-id="fc59a-401">Bepaal welke momentopname om terug te zetten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-401">Decide which snapshot to restore.</span></span> <span data-ttu-id="fc59a-402">Alleen hana/gegevensvolume zou worden teruggezet, tenzij anders wordt aangegeven.</span><span class="sxs-lookup"><span data-stu-id="fc59a-402">Only the hana/data volume would be restored unless you are instructed otherwise.</span></span>

2. <span data-ttu-id="fc59a-403">Het exemplaar HANA afgesloten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-403">Shut down the HANA instance.</span></span>

 ![Het exemplaar HANA afsluiten](./media/hana-overview-high-availability-disaster-recovery/image7-shutdown-hana.png)

3. <span data-ttu-id="fc59a-405">Ontkoppel de gegevensvolumes op elk knooppunt HANA-database.</span><span class="sxs-lookup"><span data-stu-id="fc59a-405">Unmount the data volumes on each HANA database node.</span></span> <span data-ttu-id="fc59a-406">Het herstel van de momentopname mislukt als de gegevensvolumes niet ontkoppeld zijn.</span><span class="sxs-lookup"><span data-stu-id="fc59a-406">The restoration of the snapshot fails if the data volumes are not unmounted.</span></span>

 ![Ontkoppel de gegevensvolumes op elk knooppunt HANA-database](./media/hana-overview-high-availability-disaster-recovery/image8-unmount-data-volumes.png)

4. <span data-ttu-id="fc59a-408">Een Azure ondersteuningsaanvraag om het herstel van een momentopname van een specifieke opdracht te openen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-408">Open an Azure support request to instruct the restoration of a specific snapshot.</span></span>

 - <span data-ttu-id="fc59a-409">Tijdens het terugzetten: SAP HANA op Azure Service Management kan u vragen om een telefonische om ervoor te zorgen dat er geen gegevens ophalen van kwijt bent is letten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-409">During the restoration: SAP HANA on Azure Service Management might ask you to attend a conference call to ensure that no data is getting lost.</span></span>

 - <span data-ttu-id="fc59a-410">Na het herstel van de: SAP HANA op Azure Service Management waarschuwt u als de opslag momentopname is teruggezet.</span><span class="sxs-lookup"><span data-stu-id="fc59a-410">After the restoration: SAP HANA on Azure Service Management notifies you when the storage snapshot has been restored.</span></span>

5. <span data-ttu-id="fc59a-411">Nadat het herstelproces voltooid is, opnieuw koppelen alle gegevensvolumes.</span><span class="sxs-lookup"><span data-stu-id="fc59a-411">After the restoration process is complete, remount all data volumes.</span></span>

 ![Alle gegevensvolumes opnieuw koppelen](./media/hana-overview-high-availability-disaster-recovery/image9-remount-data-volumes.png)

6. <span data-ttu-id="fc59a-413">Selecteer opties voor herstel in SAP HANA Studio als ze niet automatisch afkomstig zijn van wanneer u opnieuw verbinding met HANA-database met SAP HANA-Studio maken.</span><span class="sxs-lookup"><span data-stu-id="fc59a-413">Select recovery options within SAP HANA Studio, if they do not automatically come up when you reconnect to HANA DB through SAP HANA Studio.</span></span> <span data-ttu-id="fc59a-414">Het volgende voorbeeld ziet een herstelbewerking tot de laatste HANA momentopname.</span><span class="sxs-lookup"><span data-stu-id="fc59a-414">The following example shows a restoration to the last HANA snapshot.</span></span> <span data-ttu-id="fc59a-415">Een momentopname van een HANA opslag momentopnamen en als u naar de meest recente momentopname voor de opslag terugzetten wilt, moet de meest recente HANA momentopname.</span><span class="sxs-lookup"><span data-stu-id="fc59a-415">A storage snapshot embeds one HANA snapshot, and if you are restoring to the most recent storage snapshot, it should be the most recent HANA snapshot.</span></span> <span data-ttu-id="fc59a-416">(Als u naar oudere opslag-momentopnamen terugzetten wilt, moet u zoeken van de momentopname HANA is gebaseerd op de tijd dat de opslag momentopname werd gemaakt.)</span><span class="sxs-lookup"><span data-stu-id="fc59a-416">(If you are restoring to older storage snapshots, you need to locate the HANA snapshot based on the time the storage snapshot was taken.)</span></span>

 ![Selecteer de opties herstellen vanuit SAP HANA-Studio](./media/hana-overview-high-availability-disaster-recovery/image10-recover-options-a.png)

7. <span data-ttu-id="fc59a-418">Selecteer **herstel de database naar een specifieke gegevens back-up of opslag momentopname**.</span><span class="sxs-lookup"><span data-stu-id="fc59a-418">Select **Recover the database to a specific data backup or storage snapshot**.</span></span>

 ![Het venster "Hersteltype opgeven"](./media/hana-overview-high-availability-disaster-recovery/image11-recover-options-b.png)

8. <span data-ttu-id="fc59a-420">Selecteer **Geef back-up zonder catalogus**.</span><span class="sxs-lookup"><span data-stu-id="fc59a-420">Select **Specify backup without catalog**.</span></span>

 ![Het venster 'Back-up locatie opgeven'](./media/hana-overview-high-availability-disaster-recovery/image12-recover-options-c.png)

9. <span data-ttu-id="fc59a-422">In de **doeltype** selecteert **momentopname**.</span><span class="sxs-lookup"><span data-stu-id="fc59a-422">In the **Destination Type** list, select **Snapshot**.</span></span>

 ![Het venster 'Geef de back-up te herstellen'](./media/hana-overview-high-availability-disaster-recovery/image13-recover-options-d.png)

10. <span data-ttu-id="fc59a-424">Klik op **voltooien** het herstelproces te starten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-424">Click **Finish** to start the recovery process.</span></span>

 ![Klik op 'Voltooid' aan het herstelproces start](./media/hana-overview-high-availability-disaster-recovery/image14-recover-options-e.png)

11. <span data-ttu-id="fc59a-426">De HANA-database is hersteld en hersteld naar de HANA momentopname die opgenomen in de momentopname van de opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-426">The HANA database is restored and recovered to the HANA snapshot that's included in the storage snapshot.</span></span>

 ![HANA-database is hersteld en hersteld op de momentopname HANA](./media/hana-overview-high-availability-disaster-recovery/image15-recover-options-f.png)

### <a name="recovering-to-the-most-recent-state"></a><span data-ttu-id="fc59a-428">Herstellen naar de meest recente status</span><span class="sxs-lookup"><span data-stu-id="fc59a-428">Recovering to the most recent state</span></span>

<span data-ttu-id="fc59a-429">Het volgende proces herstelt de HANA momentopname die is opgenomen in de momentopname van de opslag.</span><span class="sxs-lookup"><span data-stu-id="fc59a-429">The following process restores the HANA snapshot that is included in the storage snapshot.</span></span> <span data-ttu-id="fc59a-430">Vervolgens worden hersteld de transactielogboekback-ups naar de meest recente status van de database voordat u de opslag momentopname terugzet.</span><span class="sxs-lookup"><span data-stu-id="fc59a-430">It then restores the transaction log backups to the most recent state of the database before restoring the storage snapshot.</span></span>

>[!IMPORTANT]
><span data-ttu-id="fc59a-431">Voordat u doorgaat, zorg ervoor dat er een volledige en aaneengesloten reeks transactielogboekback-ups.</span><span class="sxs-lookup"><span data-stu-id="fc59a-431">Before you proceed, make sure that you have a complete and contiguous chain of transaction log backups.</span></span> <span data-ttu-id="fc59a-432">Zonder deze back-ups, kunt u de huidige status van de database niet terugzetten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-432">Without these backups, you cannot restore the current state of the database.</span></span>

1. <span data-ttu-id="fc59a-433">Voltooi de stappen 1-6 van de vorige procedure in "Herstellen met de momentopname van de meest recente HANA."</span><span class="sxs-lookup"><span data-stu-id="fc59a-433">Complete steps 1-6 of the preceding procedure in "Recovering to the most recent HANA snapshot."</span></span>

2. <span data-ttu-id="fc59a-434">Selecteer **herstel de database naar de meest recente status**.</span><span class="sxs-lookup"><span data-stu-id="fc59a-434">Select **Recover the database to its most recent state**.</span></span>

 ![Selecteer 'De database naar de meest recente status herstellen'](./media/hana-overview-high-availability-disaster-recovery/image16-recover-database-a.png)

3. <span data-ttu-id="fc59a-436">Geef de locatie van de meest recente HANA logboekback-ups.</span><span class="sxs-lookup"><span data-stu-id="fc59a-436">Specify the location of the most recent HANA log backups.</span></span> <span data-ttu-id="fc59a-437">De locatie moet bevatten alle HANA transactielogboekback-ups van de momentopname HANA naar de meest recente status.</span><span class="sxs-lookup"><span data-stu-id="fc59a-437">The location needs to contain all HANA transaction log backups from the HANA snapshot to the most recent state.</span></span>

 ![Geef de locatie van de meest recente HANA logboekback-ups](./media/hana-overview-high-availability-disaster-recovery/image17-recover-database-b.png)

4. <span data-ttu-id="fc59a-439">Selecteer een back-up als uitgangspunt van waaruit de database herstellen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-439">Select a backup as a base from which to recover the database.</span></span> <span data-ttu-id="fc59a-440">In ons voorbeeld is dit de HANA momentopname die is opgenomen in de opslag-momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-440">In our example, this is the HANA snapshot that was included in the storage snapshot.</span></span> <span data-ttu-id="fc59a-441">(Alleen een momentopname is opgenomen in de volgende schermopname).</span><span class="sxs-lookup"><span data-stu-id="fc59a-441">(Only one snapshot is listed in the following screenshot.)</span></span>

 ![Selecteer een back-up als uitgangspunt van waaruit de database herstellen](./media/hana-overview-high-availability-disaster-recovery/image18-recover-database-c.png)

5. <span data-ttu-id="fc59a-443">Schakel de **gebruik Delta back-ups** selectievakje in als delta's niet bestaan tussen de tijd van de momentopname HANA en de meest recente status.</span><span class="sxs-lookup"><span data-stu-id="fc59a-443">Clear the **Use Delta Backups** check box if deltas do not exist between the time of the HANA snapshot and the most recent state.</span></span>

 ![Schakel het selectievakje 'Gebruik Delta back-ups' uit als er geen delta's bestaan](./media/hana-overview-high-availability-disaster-recovery/image19-recover-database-d.png)

6. <span data-ttu-id="fc59a-445">Klik op het scherm Samenvatting **voltooien** te beginnen met de procedure voor herstel.</span><span class="sxs-lookup"><span data-stu-id="fc59a-445">On the summary screen, click **Finish** to start the restoration procedure.</span></span>

 ![Klik op 'Voltooid' in het scherm Samenvatting](./media/hana-overview-high-availability-disaster-recovery/image20-recover-database-e.png)

### <a name="recovering-to-another-point-in-time"></a><span data-ttu-id="fc59a-447">Herstellen naar een ander punt in tijd</span><span class="sxs-lookup"><span data-stu-id="fc59a-447">Recovering to another point in time</span></span>
<span data-ttu-id="fc59a-448">Als u wilt herstellen naar een punt in tijd tussen de HANA-momentopname (opgenomen in de opslag momentopname) en één die later is dan het herstel HANA momentopname punt in tijd, het volgende doen:</span><span class="sxs-lookup"><span data-stu-id="fc59a-448">To recover to a point in time between the HANA snapshot (included in the storage snapshot) and one that is later than the HANA snapshot point-in-time recovery, do the following:</span></span>

1. <span data-ttu-id="fc59a-449">Zorg ervoor dat u alle transactielogboekback-ups van de momentopname HANA aan de tijd die u wilt herstellen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-449">Make sure that you have all transaction log backups from the HANA snapshot to the time you want to recover.</span></span>
2. <span data-ttu-id="fc59a-450">Beginnen met de procedure onder 'Herstellen naar de meest recente status'.</span><span class="sxs-lookup"><span data-stu-id="fc59a-450">Begin the procedure under "Recovering to the most recent state."</span></span>
3. <span data-ttu-id="fc59a-451">In stap 2 van de procedure in de **hersteltype opgeven** Selecteer **herstel de database naar het volgende punt in tijd**, Geef op het punt in tijd en voltooi stap 3-6.</span><span class="sxs-lookup"><span data-stu-id="fc59a-451">In step 2 of the procedure, in the **Specify Recovery Type** window, select **Recover the database to the following point in time**, specify the point in time, and then complete steps 3-6.</span></span>

## <a name="monitoring-the-execution-of-snapshots"></a><span data-ttu-id="fc59a-452">Bewaking van de uitvoering van momentopnamen</span><span class="sxs-lookup"><span data-stu-id="fc59a-452">Monitoring the execution of snapshots</span></span>

<span data-ttu-id="fc59a-453">U moet controleren van de uitvoering van opslag-momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="fc59a-453">You need to monitor the execution of storage snapshots.</span></span> <span data-ttu-id="fc59a-454">Het script dat wordt uitgevoerd een opslag-momentopnamen schrijft uitvoer naar een bestand en slaat deze op dezelfde locatie als de Perl-scripts.</span><span class="sxs-lookup"><span data-stu-id="fc59a-454">The script that executes a storage snapshot writes output to a file and then saves it to the same location as the Perl scripts.</span></span> <span data-ttu-id="fc59a-455">Een afzonderlijk bestand is geschreven voor elke momentopname.</span><span class="sxs-lookup"><span data-stu-id="fc59a-455">A separate file is written for each snapshot.</span></span> <span data-ttu-id="fc59a-456">De uitvoer van elk bestand duidelijk ziet u de verschillende fasen dat de momentopname-script wordt uitgevoerd:</span><span class="sxs-lookup"><span data-stu-id="fc59a-456">The output of each file clearly shows the various phases that the snapshot script executes:</span></span>

- <span data-ttu-id="fc59a-457">Zoeken naar de volumes die u nodig hebt om een momentopname te maken</span><span class="sxs-lookup"><span data-stu-id="fc59a-457">Finding the volumes that need to create a snapshot</span></span>
- <span data-ttu-id="fc59a-458">Zoeken naar de momentopnamen die afkomstig zijn uit deze volumes</span><span class="sxs-lookup"><span data-stu-id="fc59a-458">Finding the snapshots taken from these volumes</span></span>
- <span data-ttu-id="fc59a-459">Eventuele momentopnamen bestaande overeenkomen met het aantal momentopnamen die u hebt opgegeven</span><span class="sxs-lookup"><span data-stu-id="fc59a-459">Deleting eventual existing snapshots to match the number of snapshots you specified</span></span>
- <span data-ttu-id="fc59a-460">Maken van een momentopname HANA</span><span class="sxs-lookup"><span data-stu-id="fc59a-460">Creating a HANA snapshot</span></span>
- <span data-ttu-id="fc59a-461">Maken van een momentopname opslag via de volumes</span><span class="sxs-lookup"><span data-stu-id="fc59a-461">Creating the storage snapshot over the volumes</span></span>
- <span data-ttu-id="fc59a-462">Verwijderen van de momentopname HANA</span><span class="sxs-lookup"><span data-stu-id="fc59a-462">Deleting the HANA snapshot</span></span>
- <span data-ttu-id="fc59a-463">Naam van de meest recente momentopname **.0**</span><span class="sxs-lookup"><span data-stu-id="fc59a-463">Renaming the most recent snapshot to **.0**</span></span>

<span data-ttu-id="fc59a-464">Het belangrijkste deel van het script is als volgt:</span><span class="sxs-lookup"><span data-stu-id="fc59a-464">The most important part of the script is this:</span></span>
```
**********************Creating HANA snapshot**********************
Creating the HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data create snapshot"" ...
HANA snapshot created successfully.
**********************Creating Storage snapshot**********************
Taking snapshot hourly.recent for hana_data_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_backup_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_log_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for hana_shared_lhanad01_t020_vol ...
Snapshot created successfully.
Taking snapshot hourly.recent for sapmnt_lhanad01_t020_vol ...
Snapshot created successfully.
**********************Deleting HANA snapshot**********************
Deleting the HANA snapshot with command: "./hdbsql -n localhost -i 01 -U SCADMIN01 "backup data drop snapshot"" ...
HANA snapshot deletion successfully.
```
<span data-ttu-id="fc59a-465">U kunt van dit voorbeeld zien hoe het script registreert voor het maken van de momentopname HANA.</span><span class="sxs-lookup"><span data-stu-id="fc59a-465">You can see from this sample how the script records the creation of the HANA snapshot.</span></span> <span data-ttu-id="fc59a-466">Dit proces wordt in het geval van scale-out is gestart op het hoofdknooppunt.</span><span class="sxs-lookup"><span data-stu-id="fc59a-466">In the scale-out case, this process is initiated on the master node.</span></span> <span data-ttu-id="fc59a-467">Het hoofdknooppunt initieert de synchrone maken van de momentopnamen op elke worker-knooppunten.</span><span class="sxs-lookup"><span data-stu-id="fc59a-467">The master node initiates the synchronous creation of the snapshots on each of the worker nodes.</span></span> <span data-ttu-id="fc59a-468">De momentopname van de opslag is gehaald.</span><span class="sxs-lookup"><span data-stu-id="fc59a-468">Then the storage snapshot is taken.</span></span> <span data-ttu-id="fc59a-469">Na de voltooiing van uitvoering van de opslag-momentopnamen, wordt de momentopname HANA verwijderd.</span><span class="sxs-lookup"><span data-stu-id="fc59a-469">After the successful execution of the storage snapshots, the HANA snapshot is deleted.</span></span>
