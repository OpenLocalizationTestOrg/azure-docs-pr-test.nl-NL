---
title: Gedetailleerde extern bureaublad probleemoplossing in Azure | Microsoft Docs
description: Bekijk de gedetailleerde stappen voor het externe bureaublad fouten waar u kunt niet naar een Windows virtuele machines in Azure
services: virtual-machines-windows
documentationcenter: 
author: genlin
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
keywords: kan geen verbinding maken met extern bureaublad, problemen met extern bureaublad, extern bureaublad geen verbinding maken, extern bureaublad-fouten, probleemoplossing extern bureaublad, problemen met extern bureaublad
ms.assetid: 9da36f3d-30dd-44af-824b-8ce5ef07e5e0
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: support-article
ms.date: 07/25/2017
ms.author: genli
ms.openlocfilehash: 22080b9402b13fd8162024db10aef5475880e4a7
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 08/03/2017
---
# <a name="detailed-troubleshooting-steps-for-remote-desktop-connection-issues-to-windows-vms-in-azure"></a><span data-ttu-id="d8e67-104">Gedetailleerde probleemoplossing voor problemen met extern bureaublad-verbinding voor Windows-VM's in Azure</span><span class="sxs-lookup"><span data-stu-id="d8e67-104">Detailed troubleshooting steps for remote desktop connection issues to Windows VMs in Azure</span></span>
<span data-ttu-id="d8e67-105">In dit artikel bevat gedetailleerde stappen voor probleemoplossing opsporen en oplossen van complexe extern bureaublad-fouten voor op basis van Windows Azure virtual machines.</span><span class="sxs-lookup"><span data-stu-id="d8e67-105">This article provides detailed troubleshooting steps to diagnose and fix complex Remote Desktop errors for Windows-based Azure virtual machines.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d8e67-106">Om te voorkomen de veelvoorkomende fouten voor extern bureaublad, zorg ervoor dat u Lees [de basic probleemoplossingsartikel voor extern bureaublad](troubleshoot-rdp-connection.md) voordat u doorgaat.</span><span class="sxs-lookup"><span data-stu-id="d8e67-106">To eliminate the more common Remote Desktop errors, make sure to read [the basic troubleshooting article for Remote Desktop](troubleshoot-rdp-connection.md) before proceeding.</span></span>

<span data-ttu-id="d8e67-107">U kunt tegenkomen een extern bureaublad foutbericht die op een van de specifieke foutberichten niet lijken behandeld in [de basic extern bureaublad-probleemoplossingsgids](troubleshoot-rdp-connection.md).</span><span class="sxs-lookup"><span data-stu-id="d8e67-107">You may encounter a Remote Desktop error message that does not resemble any of the specific error messages covered in [the basic Remote Desktop troubleshooting guide](troubleshoot-rdp-connection.md).</span></span> <span data-ttu-id="d8e67-108">Volg deze stappen om te bepalen waarom de Remote Desktop (RDP)-client kan geen verbinding maken met de RDP-service op de virtuele machine in Azure.</span><span class="sxs-lookup"><span data-stu-id="d8e67-108">Follow these steps to determine why the Remote Desktop (RDP) client is unable to connect to the RDP service on the Azure VM.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="d8e67-109">Als u meer hulp op elk gewenst moment in dit artikel nodig hebt, kunt u de Azure-experts raadplegen op [de Azure MSDN en de Stack Overflow-forums](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="d8e67-109">If you need more help at any point in this article, you can contact the Azure experts on [the MSDN Azure and the Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="d8e67-110">U kunt ook kunt u ook een incident voor ondersteuning van Azure bestand.</span><span class="sxs-lookup"><span data-stu-id="d8e67-110">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="d8e67-111">Ga naar de [ondersteuning van Azure site](https://azure.microsoft.com/support/options/) en klik op **Get Support**.</span><span class="sxs-lookup"><span data-stu-id="d8e67-111">Go to the [Azure Support site](https://azure.microsoft.com/support/options/) and click **Get Support**.</span></span> <span data-ttu-id="d8e67-112">Voor meer informatie over het gebruik van Azure-ondersteuning, de [Veelgestelde vragen over Microsoft Azure-ondersteuning](https://azure.microsoft.com/support/faq/).</span><span class="sxs-lookup"><span data-stu-id="d8e67-112">For information about using Azure Support, read the [Microsoft Azure Support FAQ](https://azure.microsoft.com/support/faq/).</span></span>

## <a name="components-of-a-remote-desktop-connection"></a><span data-ttu-id="d8e67-113">Onderdelen van een extern bureaublad-verbinding</span><span class="sxs-lookup"><span data-stu-id="d8e67-113">Components of a Remote Desktop connection</span></span>
<span data-ttu-id="d8e67-114">De volgende onderdelen betrokken zijn bij een RDP-verbinding:</span><span class="sxs-lookup"><span data-stu-id="d8e67-114">The following components are involved in an RDP connection:</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_0.png)

<span data-ttu-id="d8e67-115">Voordat u doorgaat, kan het handig geestelijk bekijken wat is gewijzigd sinds de laatste geslaagde extern bureaublad-verbinding naar de virtuele machine.</span><span class="sxs-lookup"><span data-stu-id="d8e67-115">Before proceeding, it might help to mentally review what has changed since the last successful Remote Desktop connection to the VM.</span></span> <span data-ttu-id="d8e67-116">Bijvoorbeeld:</span><span class="sxs-lookup"><span data-stu-id="d8e67-116">For example:</span></span>

* <span data-ttu-id="d8e67-117">Het openbare IP-adres van de virtuele machine of de cloudservice met de virtuele machine (ook wel het virtuele IP-adres [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) is gewijzigd.</span><span class="sxs-lookup"><span data-stu-id="d8e67-117">The public IP address of the VM or the cloud service containing the VM (also called the virtual IP address [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) has changed.</span></span> <span data-ttu-id="d8e67-118">De RDP-fout kan worden, omdat de DNS client-cache nog steeds heeft de *oude IP-adres* geregistreerd voor de DNS-naam.</span><span class="sxs-lookup"><span data-stu-id="d8e67-118">The RDP failure could be because your DNS client cache still has the *old IP address* registered for the DNS name.</span></span> <span data-ttu-id="d8e67-119">Uw DNS-client-cache leegmaken en probeer de virtuele machine opnieuw verbinding te maken.</span><span class="sxs-lookup"><span data-stu-id="d8e67-119">Flush your DNS client cache and try connecting the VM again.</span></span> <span data-ttu-id="d8e67-120">Of probeer verbinding te maken met het nieuwe VIP rechtstreeks.</span><span class="sxs-lookup"><span data-stu-id="d8e67-120">Or try connecting directly with the new VIP.</span></span>
* <span data-ttu-id="d8e67-121">U gebruikt een toepassing van derden voor het beheren van uw extern bureaublad-verbindingen in plaats van de verbinding die is gegenereerd door de Azure-portal.</span><span class="sxs-lookup"><span data-stu-id="d8e67-121">You are using a third-party application to manage your Remote Desktop connections instead of using the connection generated by the Azure portal.</span></span> <span data-ttu-id="d8e67-122">Controleer of de configuratie van de toepassing bevat de juiste TCP-poort voor het extern bureaublad-verkeer.</span><span class="sxs-lookup"><span data-stu-id="d8e67-122">Verify that the application configuration includes the correct TCP port for the Remote Desktop traffic.</span></span> <span data-ttu-id="d8e67-123">U kunt deze poort voor een klassieke virtuele machine in controleren de [Azure-portal](https://portal.azure.com), door te klikken op de VM-instellingen > eindpunten.</span><span class="sxs-lookup"><span data-stu-id="d8e67-123">You can check this port for a classic virtual machine in the [Azure portal](https://portal.azure.com), by clicking the VM's Settings > Endpoints.</span></span>

## <a name="preliminary-steps"></a><span data-ttu-id="d8e67-124">Voorbereidende stappen</span><span class="sxs-lookup"><span data-stu-id="d8e67-124">Preliminary steps</span></span>
<span data-ttu-id="d8e67-125">Voordat u doorgaat naar de gedetailleerde probleemoplossing</span><span class="sxs-lookup"><span data-stu-id="d8e67-125">Before proceeding to the detailed troubleshooting,</span></span>

* <span data-ttu-id="d8e67-126">Controleer de status van de virtuele machine in de Azure portal voor de hand liggende problemen.</span><span class="sxs-lookup"><span data-stu-id="d8e67-126">Check the status of the virtual machine in the Azure portal for any obvious issues.</span></span>
* <span data-ttu-id="d8e67-127">Ga als volgt de [quick fix stappen voor veelvoorkomende RDP-fouten in de basis probleemoplossingsgids](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span><span class="sxs-lookup"><span data-stu-id="d8e67-127">Follow the [quick fix steps for common RDP errors in the basic troubleshooting guide](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span></span>

<span data-ttu-id="d8e67-128">Probeer opnieuw verbinding te maken met de virtuele machine via Extern bureaublad na deze stappen.</span><span class="sxs-lookup"><span data-stu-id="d8e67-128">Try reconnecting to the VM via Remote Desktop after these steps.</span></span>

## <a name="detailed-troubleshooting-steps"></a><span data-ttu-id="d8e67-129">Gedetailleerde stappen voor het oplossen van problemen</span><span class="sxs-lookup"><span data-stu-id="d8e67-129">Detailed troubleshooting steps</span></span>
<span data-ttu-id="d8e67-130">De extern bureaublad-client mogelijk niet kunnen bereiken van de extern bureaublad-service op de Azure VM vanwege problemen met de volgende bronnen:</span><span class="sxs-lookup"><span data-stu-id="d8e67-130">The Remote Desktop client may not be able to reach the Remote Desktop service on the Azure VM due to issues at the following sources:</span></span>

* [<span data-ttu-id="d8e67-131">Extern-bureaubladclient computer</span><span class="sxs-lookup"><span data-stu-id="d8e67-131">Remote Desktop client computer</span></span>](#source-1-remote-desktop-client-computer)
* [<span data-ttu-id="d8e67-132">Organisatie intranet randapparaat</span><span class="sxs-lookup"><span data-stu-id="d8e67-132">Organization intranet edge device</span></span>](#source-2-organization-intranet-edge-device)
* [<span data-ttu-id="d8e67-133">De cloud service-eindpunt en toegangsbeheerlijsten (ACL)</span><span class="sxs-lookup"><span data-stu-id="d8e67-133">Cloud service endpoint and access control list (ACL)</span></span>](#source-3-cloud-service-endpoint-and-acl)
* [<span data-ttu-id="d8e67-134">Netwerkbeveiligingsgroepen</span><span class="sxs-lookup"><span data-stu-id="d8e67-134">Network security groups</span></span>](#source-4-network-security-groups)
* [<span data-ttu-id="d8e67-135">Op basis van Windows Azure VM</span><span class="sxs-lookup"><span data-stu-id="d8e67-135">Windows-based Azure VM</span></span>](#source-5-windows-based-azure-vm)

## <a name="source-1-remote-desktop-client-computer"></a><span data-ttu-id="d8e67-136">: 1 extern-bureaubladclient broncomputer</span><span class="sxs-lookup"><span data-stu-id="d8e67-136">Source 1: Remote Desktop client computer</span></span>
<span data-ttu-id="d8e67-137">Controleer of dat de computer extern bureaublad-verbindingen met een andere on-premises, op basis van Windows-computer kunt maken.</span><span class="sxs-lookup"><span data-stu-id="d8e67-137">Verify that your computer can make Remote Desktop connections to another on-premises, Windows-based computer.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_1.png)

<span data-ttu-id="d8e67-138">Als u niet, Controleer op de volgende instellingen op uw computer:</span><span class="sxs-lookup"><span data-stu-id="d8e67-138">If you cannot, check for the following settings on your computer:</span></span>

* <span data-ttu-id="d8e67-139">Een lokale firewall-instelling wordt extern bureaublad-verkeer blokkeert.</span><span class="sxs-lookup"><span data-stu-id="d8e67-139">A local firewall setting that is blocking Remote Desktop traffic.</span></span>
* <span data-ttu-id="d8e67-140">Lokaal geïnstalleerde clientsoftware proxy dat voorkomt extern bureaublad-verbindingen dat.</span><span class="sxs-lookup"><span data-stu-id="d8e67-140">Locally installed client proxy software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="d8e67-141">Lokaal geïnstalleerde software die wordt verhinderd door een extern bureaublad-verbindingen voor netwerkbeheer.</span><span class="sxs-lookup"><span data-stu-id="d8e67-141">Locally installed network monitoring software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="d8e67-142">Andere typen beveiligingssoftware die om verkeer te controleren of in een specifieke typen verkeer dat wordt verhinderd door een extern bureaublad-verbindingen toestaan/weigeren.</span><span class="sxs-lookup"><span data-stu-id="d8e67-142">Other types of security software that either monitor traffic or allow/disallow specific types of traffic that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="d8e67-143">In dergelijke gevallen tijdelijk uitschakelen van de software en probeer het verbinding maken met een on-premises computer via Extern bureaublad.</span><span class="sxs-lookup"><span data-stu-id="d8e67-143">In all these cases, temporarily disable the software and try to connect to an on-premises computer via Remote Desktop.</span></span> <span data-ttu-id="d8e67-144">Als u de werkelijke oorzaak op deze manier vinden kunt, samen met de netwerkbeheerder om het corrigeren van de software-instellingen voor extern bureaublad-verbindingen.</span><span class="sxs-lookup"><span data-stu-id="d8e67-144">If you can find out the actual cause this way, work with your network administrator to correct the software settings to allow Remote Desktop connections.</span></span>

## <a name="source-2-organization-intranet-edge-device"></a><span data-ttu-id="d8e67-145">Bron 2: Organisatie intranet randapparaat</span><span class="sxs-lookup"><span data-stu-id="d8e67-145">Source 2: Organization intranet edge device</span></span>
<span data-ttu-id="d8e67-146">Controleer of dat een computer die rechtstreeks zijn verbonden met Internet kan worden gebruikt voor het aanbrengen van extern bureaublad-verbindingen met uw Azure virtuele machine.</span><span class="sxs-lookup"><span data-stu-id="d8e67-146">Verify that a computer directly connected to the Internet can make Remote Desktop connections to your Azure virtual machine.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_2.png)

<span data-ttu-id="d8e67-147">Als u geen over een computer die direct is verbonden met Internet maken en testen met een nieuwe Azure virtuele machine in een bronservice groep of cloud.</span><span class="sxs-lookup"><span data-stu-id="d8e67-147">If you do not have a computer that is directly connected to the Internet, create and test with a new Azure virtual machine in a resource group or cloud service.</span></span> <span data-ttu-id="d8e67-148">Zie voor meer informatie [maken van een virtuele machine waarop Windows wordt uitgevoerd in Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="d8e67-148">For more information, see [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="d8e67-149">Nadat de test kunt u de virtuele machine en de resourcegroep of de cloudservice verwijderen.</span><span class="sxs-lookup"><span data-stu-id="d8e67-149">You can delete the virtual machine and the resource group or the cloud service, after the test.</span></span>

<span data-ttu-id="d8e67-150">Als u een extern bureaublad-verbinding met een computer die rechtstreeks zijn verbonden met Internet maken kunt, controleert u het apparaat aan uw organisatie intranet rand voor:</span><span class="sxs-lookup"><span data-stu-id="d8e67-150">If you can create a Remote Desktop connection with a computer directly attached to the Internet, check your organization intranet edge device for:</span></span>

* <span data-ttu-id="d8e67-151">Een interne firewall blokkeert HTTPS-verbindingen met het Internet.</span><span class="sxs-lookup"><span data-stu-id="d8e67-151">An internal firewall blocking HTTPS connections to the Internet.</span></span>
* <span data-ttu-id="d8e67-152">Een proxyserver extern bureaublad-verbindingen te blokkeren.</span><span class="sxs-lookup"><span data-stu-id="d8e67-152">A proxy server preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="d8e67-153">Inbraakdetectie of software die wordt uitgevoerd op apparaten in uw netwerk rand dat voorkomt extern bureaublad-verbindingen dat voor netwerkbeheer.</span><span class="sxs-lookup"><span data-stu-id="d8e67-153">Intrusion detection or network monitoring software running on devices in your edge network that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="d8e67-154">Werken met de netwerkbeheerder om de instellingen van uw organisatie intranet edge-apparaat om HTTPS-gebaseerde extern bureaublad-verbindingen met het Internet toe te corrigeren.</span><span class="sxs-lookup"><span data-stu-id="d8e67-154">Work with your network administrator to correct the settings of your organization intranet edge device to allow HTTPS-based Remote Desktop connections to the Internet.</span></span>

## <a name="source-3-cloud-service-endpoint-and-acl"></a><span data-ttu-id="d8e67-155">Bron 3: De Cloud service-eindpunt en ACL</span><span class="sxs-lookup"><span data-stu-id="d8e67-155">Source 3: Cloud service endpoint and ACL</span></span>
<span data-ttu-id="d8e67-156">Controleer voor VM's zijn gemaakt met behulp van het klassieke implementatiemodel, of dat een andere virtuele machine van Azure die zich in dezelfde cloudservice- of virtueel netwerk extern bureaublad-verbindingen in uw Azure-VM aanbrengen kunt.</span><span class="sxs-lookup"><span data-stu-id="d8e67-156">For VMs created using the Classic deployment model, verify that another Azure VM that is in the same cloud service or virtual network can make Remote Desktop connections to your Azure VM.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_3.png)

> [!NOTE]
> <span data-ttu-id="d8e67-157">Voor virtuele machines in de Resource Manager gemaakt, gaat u verder met [bron 4: Netwerkbeveiligingsgroepen](#source-4-network-security-groups).</span><span class="sxs-lookup"><span data-stu-id="d8e67-157">For virtual machines created in Resource Manager, skip to [Source 4: Network Security Groups](#source-4-network-security-groups).</span></span>

<span data-ttu-id="d8e67-158">Als u geen een andere virtuele machine in dezelfde cloudservice- of virtueel netwerk, een maken.</span><span class="sxs-lookup"><span data-stu-id="d8e67-158">If you do not have another virtual machine in the same cloud service or virtual network, create one.</span></span> <span data-ttu-id="d8e67-159">Volg de stappen in [maken van een virtuele machine waarop Windows wordt uitgevoerd in Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="d8e67-159">Follow the steps in [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="d8e67-160">Verwijder de virtuele testmachine nadat de test is voltooid.</span><span class="sxs-lookup"><span data-stu-id="d8e67-160">Delete the test virtual machine after the test is completed.</span></span>

<span data-ttu-id="d8e67-161">Als u een verbinding via Extern bureaublad met een virtuele machine in dezelfde cloudservice- of virtueel netwerk maken kan, controleert deze instellingen:</span><span class="sxs-lookup"><span data-stu-id="d8e67-161">If you can connect via Remote Desktop to a virtual machine in the same cloud service or virtual network, check for these settings:</span></span>

* <span data-ttu-id="d8e67-162">De eindpuntconfiguratie voor extern bureaublad-verkeer op de doel-virtuele machine: de persoonlijke TCP-poort van het eindpunt moet overeenkomen met de TCP-poort waarop Extern bureaublad-service van de VM luistert (de standaardwaarde is 3389).</span><span class="sxs-lookup"><span data-stu-id="d8e67-162">The endpoint configuration for Remote Desktop traffic on the target VM: The private TCP port of the endpoint must match the TCP port on which the VM's Remote Desktop service is listening (default is 3389).</span></span>
* <span data-ttu-id="d8e67-163">De ACL voor het eindpunt van de extern bureaublad-verkeer op de doel-virtuele machine: ACL's kunnen u opgeven toegestaan of geweigerd inkomend verkeer van Internet op basis van de bron-IP-adres.</span><span class="sxs-lookup"><span data-stu-id="d8e67-163">The ACL for the Remote Desktop traffic endpoint on the target VM: ACLs allow you to specify allowed or denied incoming traffic from the Internet based on its source IP address.</span></span> <span data-ttu-id="d8e67-164">Onjuist geconfigureerde ACL's kunnen voorkomen dat binnenkomend verkeer van de extern bureaublad naar het eindpunt.</span><span class="sxs-lookup"><span data-stu-id="d8e67-164">Misconfigured ACLs can prevent incoming Remote Desktop traffic to the endpoint.</span></span> <span data-ttu-id="d8e67-165">Controleer de ACL's om ervoor te zorgen dat binnenkomend verkeer van uw openbare IP-adressen van uw proxy of andere edge-server is toegestaan.</span><span class="sxs-lookup"><span data-stu-id="d8e67-165">Check your ACLs to ensure that incoming traffic from your public IP addresses of your proxy or other edge server is allowed.</span></span> <span data-ttu-id="d8e67-166">Zie voor meer informatie [wat is er een netwerk lijst ACL (Access Control)?](../../virtual-network/virtual-networks-acl.md)</span><span class="sxs-lookup"><span data-stu-id="d8e67-166">For more information, see [What is a Network Access Control List (ACL)?](../../virtual-network/virtual-networks-acl.md)</span></span>

<span data-ttu-id="d8e67-167">Verwijder het huidige eindpunt en maak een nieuwe, kiezen van een willekeurige poort tussen 49152 – 65535 voor het poortnummer van de externe om te controleren of het eindpunt de bron van het probleem.</span><span class="sxs-lookup"><span data-stu-id="d8e67-167">To check if the endpoint is the source of the problem, remove the current endpoint and create a new one, choosing a random port in the range 49152–65535 for the external port number.</span></span> <span data-ttu-id="d8e67-168">Zie voor meer informatie [het instellen van eindpunten aan een virtuele machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="d8e67-168">For more information, see [How to set up endpoints to a virtual machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

## <a name="source-4-network-security-groups"></a><span data-ttu-id="d8e67-169">Bron 4: Netwerkbeveiligingsgroepen</span><span class="sxs-lookup"><span data-stu-id="d8e67-169">Source 4: Network Security Groups</span></span>
<span data-ttu-id="d8e67-170">Netwerkbeveiligingsgroepen toestaan meer gedetailleerd beheer van toegestane binnenkomend en uitgaand verkeer.</span><span class="sxs-lookup"><span data-stu-id="d8e67-170">Network Security Groups allow more granular control of allowed inbound and outbound traffic.</span></span> <span data-ttu-id="d8e67-171">U kunt maken van regels spanning subnetten en cloudservices in een Azure-netwerk.</span><span class="sxs-lookup"><span data-stu-id="d8e67-171">You can create rules spanning subnets and cloud services in an Azure virtual network.</span></span>

<span data-ttu-id="d8e67-172">Gebruik [IP-stroom controleren](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) om te bevestigen of verkeer naar of van een virtuele machine wordt geblokkeerd door een regel in een netwerkbeveiligingsgroep.</span><span class="sxs-lookup"><span data-stu-id="d8e67-172">Use [IP flow verify](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) to confirm if a rule in a Network Security Group is blocking traffic to or from a virtual machine.</span></span> <span data-ttu-id="d8e67-173">U kunt ook een effectieve beveiligingsmethode groep regels om ervoor te zorgen inkomende 'toestaan' NSG bekijken regel bestaat en is geplaatst voor RDP-poort (standaard 3389).</span><span class="sxs-lookup"><span data-stu-id="d8e67-173">You can also review effective security group rules to ensure inbound "Allow" NSG rule exists and is prioritized for RDP port(default 3389).</span></span> <span data-ttu-id="d8e67-174">Zie voor meer informatie [effectieve beveiligingsregels gebruiken om op te lossen VM verkeer stroom](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span><span class="sxs-lookup"><span data-stu-id="d8e67-174">For more information, see [Using Effective Security Rules to troubleshoot VM traffic flow](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span></span>

## <a name="source-5-windows-based-azure-vm"></a><span data-ttu-id="d8e67-175">Bron 5: Op basis van Windows Azure VM</span><span class="sxs-lookup"><span data-stu-id="d8e67-175">Source 5: Windows-based Azure VM</span></span>
![](./media/detailed-troubleshoot-rdp/tshootrdp_5.png)

<span data-ttu-id="d8e67-176">Volg de instructies in [in dit artikel](reset-rdp.md).</span><span class="sxs-lookup"><span data-stu-id="d8e67-176">Follow the instructions in [this article](reset-rdp.md).</span></span> <span data-ttu-id="d8e67-177">In dit artikel stelt de extern bureaublad-service op de virtuele machine:</span><span class="sxs-lookup"><span data-stu-id="d8e67-177">This article resets the Remote Desktop service on the virtual machine:</span></span>

* <span data-ttu-id="d8e67-178">De standaardregel 'Extern bureaublad' Windows Firewall (TCP-poort 3389) inschakelen.</span><span class="sxs-lookup"><span data-stu-id="d8e67-178">Enable the "Remote Desktop" Windows Firewall default rule (TCP port 3389).</span></span>
* <span data-ttu-id="d8e67-179">Extern bureaublad-verbindingen inschakelen door de registerwaarde HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections op 0.</span><span class="sxs-lookup"><span data-stu-id="d8e67-179">Enable Remote Desktop connections by setting the HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registry value to 0.</span></span>

<span data-ttu-id="d8e67-180">Probeer opnieuw de verbinding van uw computer.</span><span class="sxs-lookup"><span data-stu-id="d8e67-180">Try the connection from your computer again.</span></span> <span data-ttu-id="d8e67-181">Als u nog steeds geen verbinding maken via Extern bureaublad, controleren op mogelijke problemen met het volgende:</span><span class="sxs-lookup"><span data-stu-id="d8e67-181">If you are still not able to connect via Remote Desktop, check for the following possible problems:</span></span>

* <span data-ttu-id="d8e67-182">De extern bureaublad-service wordt niet uitgevoerd op de doel-virtuele machine.</span><span class="sxs-lookup"><span data-stu-id="d8e67-182">The Remote Desktop service is not running on the target VM.</span></span>
* <span data-ttu-id="d8e67-183">De extern bureaublad-service luistert niet op TCP-poort 3389.</span><span class="sxs-lookup"><span data-stu-id="d8e67-183">The Remote Desktop service is not listening on TCP port 3389.</span></span>
* <span data-ttu-id="d8e67-184">Windows Firewall of een andere lokale firewall heeft een uitgaande regel dat voorkomt extern bureaublad-verkeer dat.</span><span class="sxs-lookup"><span data-stu-id="d8e67-184">Windows Firewall or another local firewall has an outbound rule that is preventing Remote Desktop traffic.</span></span>
* <span data-ttu-id="d8e67-185">Inbraakdetectie of netwerkbeheer software die wordt uitgevoerd op virtuele machine van Azure kan geen extern bureaublad-verbindingen.</span><span class="sxs-lookup"><span data-stu-id="d8e67-185">Intrusion detection or network monitoring software running on the Azure virtual machine is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="d8e67-186">Voor virtuele machines gemaakt met behulp van het klassieke implementatiemodel, kunt u een externe Azure PowerShell-sessie met de Azure virtuele machine.</span><span class="sxs-lookup"><span data-stu-id="d8e67-186">For VMs created using the classic deployment model, you can use a remote Azure PowerShell session to the Azure virtual machine.</span></span> <span data-ttu-id="d8e67-187">U moet eerst een certificaat van de virtuele machine hosting cloudservice installeren.</span><span class="sxs-lookup"><span data-stu-id="d8e67-187">First, you need to install a certificate for the virtual machine's hosting cloud service.</span></span> <span data-ttu-id="d8e67-188">Ga naar [beveiligde externe PowerShell toegang configureren voor Azure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) en download de **InstallWinRMCertAzureVM.ps1** -scriptbestand op uw lokale computer.</span><span class="sxs-lookup"><span data-stu-id="d8e67-188">Go to [Configure Secure Remote PowerShell Access to Azure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) and download the **InstallWinRMCertAzureVM.ps1** script file to your local computer.</span></span>

<span data-ttu-id="d8e67-189">Vervolgens installeert u Azure PowerShell als u dat nog niet gedaan hebt.</span><span class="sxs-lookup"><span data-stu-id="d8e67-189">Next, install Azure PowerShell if you haven't already.</span></span> <span data-ttu-id="d8e67-190">Zie [Azure PowerShell installeren en configureren](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="d8e67-190">See [How to install and configure Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="d8e67-191">Open een Azure PowerShell-opdrachtprompt en wijzig de huidige map naar de locatie van de **InstallWinRMCertAzureVM.ps1** scriptbestand.</span><span class="sxs-lookup"><span data-stu-id="d8e67-191">Next, open an Azure PowerShell command prompt and change the current folder to the location of the **InstallWinRMCertAzureVM.ps1** script file.</span></span> <span data-ttu-id="d8e67-192">U kunt een Azure PowerShell-script uitvoeren, moet u het juiste uitvoeringsbeleid instellen.</span><span class="sxs-lookup"><span data-stu-id="d8e67-192">To run an Azure PowerShell script, you must set the correct execution policy.</span></span> <span data-ttu-id="d8e67-193">Voer de **Get-ExecutionPolicy** opdracht om te bepalen van uw huidige beleidsniveau.</span><span class="sxs-lookup"><span data-stu-id="d8e67-193">Run the **Get-ExecutionPolicy** command to determine your current policy level.</span></span> <span data-ttu-id="d8e67-194">Zie voor meer informatie over het instellen van het juiste niveau [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span><span class="sxs-lookup"><span data-stu-id="d8e67-194">For information about setting the appropriate level, see [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span></span>

<span data-ttu-id="d8e67-195">Vul vervolgens de naam van uw Azure-abonnement, de naam van de cloudservice en de naam van uw virtuele machine (verwijderen van de < en > tekens), en voer deze opdrachten.</span><span class="sxs-lookup"><span data-stu-id="d8e67-195">Next, fill in your Azure subscription name, the cloud service name, and your virtual machine name (removing the < and > characters), and then run these commands.</span></span>

```powershell
$subscr="<Name of your Azure subscription>"
$serviceName="<Name of the cloud service that contains the target virtual machine>"
$vmName="<Name of the target virtual machine>"
.\InstallWinRMCertAzureVM.ps1 -SubscriptionName $subscr -ServiceName $serviceName -Name $vmName
```

<span data-ttu-id="d8e67-196">U krijgt de naam van het juiste abonnement van de *SubscriptionName* eigenschap van de weergave van de **Get-AzureSubscription** opdracht.</span><span class="sxs-lookup"><span data-stu-id="d8e67-196">You can get the correct subscription name from the *SubscriptionName* property of the display of the **Get-AzureSubscription** command.</span></span> <span data-ttu-id="d8e67-197">U krijgt de naam van de cloudservice voor de virtuele machine van de *ServiceName* kolom in de weergave van de **Get-AzureVM** opdracht.</span><span class="sxs-lookup"><span data-stu-id="d8e67-197">You can get the cloud service name for the virtual machine from the *ServiceName* column in the display of the **Get-AzureVM** command.</span></span>

<span data-ttu-id="d8e67-198">Controleer of u het nieuwe certificaat hebt.</span><span class="sxs-lookup"><span data-stu-id="d8e67-198">Check if you have the new certificate.</span></span> <span data-ttu-id="d8e67-199">Open een module Certificaten voor de huidige gebruiker en kijk in de **Trusted Root Certification certificeringsinstanties\certificaten** map.</span><span class="sxs-lookup"><span data-stu-id="d8e67-199">Open a Certificates snap-in for the current user and look in the **Trusted Root Certification Authorities\Certificates** folder.</span></span> <span data-ttu-id="d8e67-200">Er is een certificaat met de DNS-naam van uw cloudservice in de kolom verleend aan (voorbeeld: cloudservice4testing.cloudapp.net).</span><span class="sxs-lookup"><span data-stu-id="d8e67-200">You should see a certificate with the DNS name of your cloud service in the Issued To column (example: cloudservice4testing.cloudapp.net).</span></span>

<span data-ttu-id="d8e67-201">Vervolgens een externe Azure PowerShell-sessie starten met behulp van deze opdrachten.</span><span class="sxs-lookup"><span data-stu-id="d8e67-201">Next, initiate a remote Azure PowerShell session by using these commands.</span></span>

```powershell
$uri = Get-AzureWinRMUri -ServiceName $serviceName -Name $vmName
$creds = Get-Credential
Enter-PSSession -ConnectionUri $uri -Credential $creds
```

<span data-ttu-id="d8e67-202">Na het invoeren van geldige beheerdersreferenties, ziet u iets soortgelijks als in de volgende Azure PowerShell-prompt:</span><span class="sxs-lookup"><span data-stu-id="d8e67-202">After entering valid administrator credentials, you should see something similar to the following Azure PowerShell prompt:</span></span>

```powershell
[cloudservice4testing.cloudapp.net]: PS C:\Users\User1\Documents>
```

<span data-ttu-id="d8e67-203">Het eerste deel van deze vraag is de naam van uw cloud-service met de doel-virtuele machine, die kan afwijken van 'cloudservice4testing.cloudapp.net'.</span><span class="sxs-lookup"><span data-stu-id="d8e67-203">The first part of this prompt is your cloud service name that contains the target VM, which could be different from "cloudservice4testing.cloudapp.net".</span></span> <span data-ttu-id="d8e67-204">Nu kunt u Azure PowerShell-opdrachten voor deze cloudservice om de problemen te onderzoeken vermeld en corrigeer de configuratie uitgeven.</span><span class="sxs-lookup"><span data-stu-id="d8e67-204">You can now issue Azure PowerShell commands for this cloud service to investigate the problems mentioned and correct the configuration.</span></span>

### <a name="to-manually-correct-the-remote-desktop-services-listening-tcp-port"></a><span data-ttu-id="d8e67-205">De extern bureaublad-Services TCP-poort luistert handmatig corrigeren</span><span class="sxs-lookup"><span data-stu-id="d8e67-205">To manually correct the Remote Desktop Services listening TCP port</span></span>
<span data-ttu-id="d8e67-206">Bij de externe Azure PowerShell-sessie-prompt, moet u deze opdracht uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="d8e67-206">At the remote Azure PowerShell session prompt, run this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="d8e67-207">De eigenschap PortNumber geeft het huidige poortnummer.</span><span class="sxs-lookup"><span data-stu-id="d8e67-207">The PortNumber property shows the current port number.</span></span> <span data-ttu-id="d8e67-208">Wijzig indien nodig de extern bureaublad poort nummer terug naar de standaardwaarde (3389) met deze opdracht.</span><span class="sxs-lookup"><span data-stu-id="d8e67-208">If needed, change the Remote Desktop port number back to its default value (3389) by using this command.</span></span>

```powershell
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber" -Value 3389
```

<span data-ttu-id="d8e67-209">Controleer of dat de poort is gewijzigd in 3389 met deze opdracht.</span><span class="sxs-lookup"><span data-stu-id="d8e67-209">Verify that the port has been changed to 3389 by using this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="d8e67-210">Sluit de externe Azure PowerShell-sessie met deze opdracht.</span><span class="sxs-lookup"><span data-stu-id="d8e67-210">Exit the remote Azure PowerShell session by using this command.</span></span>

```powershell
Exit-PSSession
```

<span data-ttu-id="d8e67-211">Controleer of de extern bureaublad-eindpunt voor de Azure VM is ook TCP-poort 3398 als de interne poort.</span><span class="sxs-lookup"><span data-stu-id="d8e67-211">Verify that the Remote Desktop endpoint for the Azure VM is also using TCP port 3398 as its internal port.</span></span> <span data-ttu-id="d8e67-212">Start van de Azure VM en probeer opnieuw de verbinding met extern bureaublad.</span><span class="sxs-lookup"><span data-stu-id="d8e67-212">Restart the Azure VM and try the Remote Desktop connection again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="d8e67-213">Aanvullende bronnen</span><span class="sxs-lookup"><span data-stu-id="d8e67-213">Additional resources</span></span>
[<span data-ttu-id="d8e67-214">Het opnieuw instellen van een wachtwoord of de service Extern bureaublad voor virtuele machines van Windows</span><span class="sxs-lookup"><span data-stu-id="d8e67-214">How to reset a password or the Remote Desktop service for Windows virtual machines</span></span>](reset-rdp.md)

[<span data-ttu-id="d8e67-215">Azure PowerShell installeren en configureren</span><span class="sxs-lookup"><span data-stu-id="d8e67-215">How to install and configure Azure PowerShell</span></span>](/powershell/azure/overview)

[<span data-ttu-id="d8e67-216">Secure Shell (SSH)-verbindingen met een op basis van Linux virtuele machine van Azure oplossen</span><span class="sxs-lookup"><span data-stu-id="d8e67-216">Troubleshoot Secure Shell (SSH) connections to a Linux-based Azure virtual machine</span></span>](../linux/troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[<span data-ttu-id="d8e67-217">Toegang tot een toepassing die wordt uitgevoerd op een virtuele machine van Azure oplossen</span><span class="sxs-lookup"><span data-stu-id="d8e67-217">Troubleshoot access to an application running on an Azure virtual machine</span></span>](../linux/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

