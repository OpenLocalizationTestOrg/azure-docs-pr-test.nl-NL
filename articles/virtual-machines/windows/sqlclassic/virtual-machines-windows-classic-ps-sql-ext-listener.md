---
title: Een externe-Listener voor AlwaysOn-beschikbaarheidsgroepen configureren | Microsoft Docs
description: Deze zelfstudie leert u stappen voor het maken van een altijd op beschikbaarheidsgroep-Listener in Azure die extern toegankelijk is via de openbare virtuele IP-adres van de gekoppelde cloud-service.
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: a2453032-94ab-4775-b976-c74d24716728
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/31/2017
ms.author: mikeray
ms.openlocfilehash: 8e506be42aea4fb3c48c29b771a78dcf694f4518
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="configure-an-external-listener-for-always-on-availability-groups-in-azure"></a><span data-ttu-id="595a9-103">Een externe-listener voor AlwaysOn-beschikbaarheidsgroepen configureren in Azure</span><span class="sxs-lookup"><span data-stu-id="595a9-103">Configure an external listener for Always On Availability Groups in Azure</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="595a9-104">Interne Listener</span><span class="sxs-lookup"><span data-stu-id="595a9-104">Internal Listener</span></span>](../classic/ps-sql-int-listener.md)
> * [<span data-ttu-id="595a9-105">Externe-Listener</span><span class="sxs-lookup"><span data-stu-id="595a9-105">External Listener</span></span>](../classic/ps-sql-ext-listener.md)
> 
> 

<span data-ttu-id="595a9-106">Dit onderwerp leest u hoe u configureert een listener voor een AlwaysOn-beschikbaarheidsgroep die extern toegankelijk is via het internet.</span><span class="sxs-lookup"><span data-stu-id="595a9-106">This topic shows you how to configure a listener for an Always On Availability Group that is externally accessible on the internet.</span></span> <span data-ttu-id="595a9-107">Dit wordt mogelijk gemaakt door te koppelen van de cloudservice **openbare virtuele IP-adres (VIP)** adres met de listener.</span><span class="sxs-lookup"><span data-stu-id="595a9-107">This is made possible by associating the cloud service's **public Virtual IP (VIP)** address with the listener.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="595a9-108">Azure heeft twee verschillende implementatiemodellen voor het maken en werken met resources: [Resource Manager en Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="595a9-108">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="595a9-109">In dit artikel bevat informatie over met behulp van het klassieke implementatiemodel.</span><span class="sxs-lookup"><span data-stu-id="595a9-109">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="595a9-110">U doet er verstandig aan voor de meeste nieuwe implementaties het Resource Manager-model te gebruiken.</span><span class="sxs-lookup"><span data-stu-id="595a9-110">Microsoft recommends that most new deployments use the Resource Manager model.</span></span>

<span data-ttu-id="595a9-111">De beschikbaarheidsgroep kunt replica's die zich on-premises alleen Azure alleen, of bevatten zowel on-premises en Azure span voor hybride configuraties.</span><span class="sxs-lookup"><span data-stu-id="595a9-111">Your Availability Group can contain replicas that are on-premises only, Azure only, or span both on-premises and Azure for hybrid configurations.</span></span> <span data-ttu-id="595a9-112">Azure replica's kunnen zich binnen dezelfde regio of tussen meerdere regio's met meerdere virtuele netwerken (vnet's).</span><span class="sxs-lookup"><span data-stu-id="595a9-112">Azure replicas can reside within the same region or across multiple regions using multiple virtual networks (VNets).</span></span> <span data-ttu-id="595a9-113">De volgende stappen wordt ervan uitgegaan dat u al hebt [geconfigureerd een beschikbaarheidsgroep](../classic/portal-sql-alwayson-availability-groups.md) maar een listener niet hebt geconfigureerd.</span><span class="sxs-lookup"><span data-stu-id="595a9-113">The steps below assume you have already [configured an availability group](../classic/portal-sql-alwayson-availability-groups.md) but have not configured a listener.</span></span>

## <a name="guidelines-and-limitations-for-external-listeners"></a><span data-ttu-id="595a9-114">Richtlijnen en beperkingen voor externe listeners</span><span class="sxs-lookup"><span data-stu-id="595a9-114">Guidelines and limitations for external listeners</span></span>
<span data-ttu-id="595a9-115">Houd rekening met de volgende richtlijnen over de beschikbaarheidsgroeplistener in Azure wanneer u implementeert met behulp van de cloud service symphysis VIP-adres:</span><span class="sxs-lookup"><span data-stu-id="595a9-115">Note the following guidelines about the availability group listener in Azure when you are deploying using the cloud service pubic VIP address:</span></span>

* <span data-ttu-id="595a9-116">De beschikbaarheidsgroep-listener wordt ondersteund op Windows Server 2008 R2, Windows Server 2012 en Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="595a9-116">The availability group listener is supported on Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2.</span></span>
* <span data-ttu-id="595a9-117">De clienttoepassing moet zich bevinden op een andere cloudservice dan de database met uw virtuele machines van de beschikbaarheidsgroep.</span><span class="sxs-lookup"><span data-stu-id="595a9-117">The client application must reside on a different cloud service than the one that contains your availability group VMs.</span></span> <span data-ttu-id="595a9-118">Azure biedt geen ondersteuning voor rechtstreekse serverretournering met de client en server in dezelfde cloudservice.</span><span class="sxs-lookup"><span data-stu-id="595a9-118">Azure does not support direct server return with client and server in the same cloud service.</span></span>
* <span data-ttu-id="595a9-119">Standaard is de stappen in dit artikel laten zien hoe een listener voor het gebruik van het hulpprogramma voor het virtuele IP-adres (VIP) van de cloud-serviceadres configureren.</span><span class="sxs-lookup"><span data-stu-id="595a9-119">By default, the steps in this article show how to configure one listener to use the cloud service Virtual IP (VIP) address.</span></span> <span data-ttu-id="595a9-120">Het is echter mogelijk te reserveren en meerdere VIP-adressen voor uw cloudservice maken.</span><span class="sxs-lookup"><span data-stu-id="595a9-120">However, it is possible to reserve and create multiple VIP addresses for your cloud service.</span></span> <span data-ttu-id="595a9-121">Hiermee kunt u de stappen in dit artikel gebruiken voor het maken van meerdere-listeners die gekoppeld aan een andere VIP zijn.</span><span class="sxs-lookup"><span data-stu-id="595a9-121">This enables you to use the steps in this article to create multiple listeners that are each associated with a different VIP.</span></span> <span data-ttu-id="595a9-122">Zie voor meer informatie over het maken van meerdere VIP-adressen [meerdere VIP's per cloudservice](../../../load-balancer/load-balancer-multivip.md).</span><span class="sxs-lookup"><span data-stu-id="595a9-122">For information on how to create multiple VIP addresses, see [Multiple VIPs per cloud service](../../../load-balancer/load-balancer-multivip.md).</span></span>
* <span data-ttu-id="595a9-123">Als u een listener voor een hybride omgeving maken wilt, moet de on-premises netwerk verbonden zijn met het openbare Internet naast de site-naar-site VPN-verbinding met het Azure-netwerk hebben.</span><span class="sxs-lookup"><span data-stu-id="595a9-123">If you are creating a listener for a hybrid environment, the on-premises network must have connectivity to the public Internet in addition to the site-to-site VPN with the Azure virtual network.</span></span> <span data-ttu-id="595a9-124">De beschikbaarheidsgroep-listener is in de Azure-subnet bereikbaar alleen voor het openbare IP-adres van de respectievelijke cloud-service.</span><span class="sxs-lookup"><span data-stu-id="595a9-124">When in the Azure subnet, the availability group listener is reachable only by the public IP address of the respective cloud service.</span></span>
* <span data-ttu-id="595a9-125">Maken van een externe-listener in dezelfde cloudservice waar hebt u ook een interne listener met behulp van de interne Load Balancer (ILB) wordt niet ondersteund.</span><span class="sxs-lookup"><span data-stu-id="595a9-125">It is not supported to create an external listener in the same cloud service where you also have an internal listener using the Internal Load Balancer (ILB).</span></span>

## <a name="determine-the-accessibility-of-the-listener"></a><span data-ttu-id="595a9-126">De toegankelijkheid van de listener bepalen</span><span class="sxs-lookup"><span data-stu-id="595a9-126">Determine the accessibility of the listener</span></span>
[!INCLUDE [ag-listener-accessibility](../../../../includes/virtual-machines-ag-listener-determine-accessibility.md)]

<span data-ttu-id="595a9-127">In dit artikel is gericht op het maken van een listener die gebruikmaakt van **externe load balancing**.</span><span class="sxs-lookup"><span data-stu-id="595a9-127">This article focuses on creating a listener that uses **external load balancing**.</span></span> <span data-ttu-id="595a9-128">Als u een listener waarvoor priv√© met het virtuele netwerk is wilt, raadpleegt u de versie van dit artikel die voorziet in stappen voor het instellen van een [listener met ILB](../classic/ps-sql-int-listener.md)</span><span class="sxs-lookup"><span data-stu-id="595a9-128">If you want a listener that is private to your virtual network, see the version of this article that provides steps for setting up an [listener with ILB](../classic/ps-sql-int-listener.md)</span></span>

## <a name="create-load-balanced-vm-endpoints-with-direct-server-return"></a><span data-ttu-id="595a9-129">VM-eindpunten taakverdeling met direct server return maken</span><span class="sxs-lookup"><span data-stu-id="595a9-129">Create load-balanced VM endpoints with direct server return</span></span>
<span data-ttu-id="595a9-130">Externe load balancing maakt gebruik van de virtuele de openbare virtuele IP-adres van de cloudservice die als host fungeert voor uw virtuele machines.</span><span class="sxs-lookup"><span data-stu-id="595a9-130">External load balancing uses the virtual the public Virtual IP address of the cloud service that hosts your VMs.</span></span> <span data-ttu-id="595a9-131">U hoeft dus niet te maken of configureren van de load balancer in dit geval.</span><span class="sxs-lookup"><span data-stu-id="595a9-131">So you do not need to create or configure the load balancer in this case.</span></span>

<span data-ttu-id="595a9-132">U moet een eindpunt met gelijke taakverdeling maken voor elke virtuele machine die als host fungeert voor de replica van een Azure.</span><span class="sxs-lookup"><span data-stu-id="595a9-132">You must create a load-balanced endpoint for each VM hosting an Azure replica.</span></span> <span data-ttu-id="595a9-133">Als u replica's in meerdere regio's hebt, moet elke replica voor de regio die zich in dezelfde cloudservice in hetzelfde VNet.</span><span class="sxs-lookup"><span data-stu-id="595a9-133">If you have replicas in multiple regions, each replica for that region must be in the same cloud service in the same VNet.</span></span> <span data-ttu-id="595a9-134">Beschikbaarheidsgroep maken van replica's die meerdere Azure-regio's omvatten is vereist voor het configureren van meerdere VNets.</span><span class="sxs-lookup"><span data-stu-id="595a9-134">Creating Availability Group replicas that span multiple Azure regions requires configuring multiple VNets.</span></span> <span data-ttu-id="595a9-135">Zie voor meer informatie over het configureren van cross-VNet-connectiviteit [configureren VNet-naar-VNet-connectiviteit](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="595a9-135">For more information on configuring cross VNet connectivity, see  [Configure VNet to VNet Connectivity](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

1. <span data-ttu-id="595a9-136">Navigeer naar elke VM die als host fungeert voor een replica in de Azure portal en bekijk de details.</span><span class="sxs-lookup"><span data-stu-id="595a9-136">In the Azure portal, navigate to each VM hosting a replica and view the details.</span></span>
2. <span data-ttu-id="595a9-137">Klik op de **eindpunten** tabblad voor elk van de virtuele machines.</span><span class="sxs-lookup"><span data-stu-id="595a9-137">Click the **Endpoints** tab for each of the VMs.</span></span>
3. <span data-ttu-id="595a9-138">Controleer de **naam** en **openbare poort** van de listener eindpunt dat u wilt gebruiken is niet al in gebruik.</span><span class="sxs-lookup"><span data-stu-id="595a9-138">Verify that the **Name** and **Public Port** of the listener endpoint you want to use is not already in use.</span></span> <span data-ttu-id="595a9-139">In het onderstaande voorbeeld is de naam 'MyEndpoint' en de poort is "1433".</span><span class="sxs-lookup"><span data-stu-id="595a9-139">In the example below, the name is ‚ÄúMyEndpoint‚Äù and the port is ‚Äú1433‚Äù.</span></span>
4. <span data-ttu-id="595a9-140">Op de lokale client downloaden en installeren [de meest recente PowerShell-module](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="595a9-140">On your local client, download and install [the latest PowerShell module](https://azure.microsoft.com/downloads/).</span></span>
5. <span data-ttu-id="595a9-141">Start **Azure PowerShell**.</span><span class="sxs-lookup"><span data-stu-id="595a9-141">Launch **Azure PowerShell**.</span></span> <span data-ttu-id="595a9-142">Een nieuwe PowerShell-sessie is geopend met de Azure beheerdersrechten modules geladen.</span><span class="sxs-lookup"><span data-stu-id="595a9-142">A new PowerShell session is opened with the Azure administrative modules loaded.</span></span>
6. <span data-ttu-id="595a9-143">Voer **Get-AzurePublishSettingsFile**.</span><span class="sxs-lookup"><span data-stu-id="595a9-143">Run **Get-AzurePublishSettingsFile**.</span></span> <span data-ttu-id="595a9-144">Deze cmdlet wordt verwezen naar een browser om te downloaden van een bestand met publicatie-instellingen naar een lokale map.</span><span class="sxs-lookup"><span data-stu-id="595a9-144">This cmdlet directs you to a browser to download a publish settings file to a local directory.</span></span> <span data-ttu-id="595a9-145">U mogelijk gevraagd om uw referenties aanmelden voor uw Azure-abonnement.</span><span class="sxs-lookup"><span data-stu-id="595a9-145">You may be prompted for your log-in credentials for your Azure subscription.</span></span>
7. <span data-ttu-id="595a9-146">Voer de **importeren AzurePublishSettingsFile** opdracht met het pad van het bestand publiceren instellingen die u hebt gedownload:</span><span class="sxs-lookup"><span data-stu-id="595a9-146">Run the **Import-AzurePublishSettingsFile** command with the path of the publish settings file that you downloaded:</span></span>
   
        Import-AzurePublishSettingsFile -PublishSettingsFile <PublishSettingsFilePath>
   
    <span data-ttu-id="595a9-147">Zodra het instellingenbestand publiceren wordt ge√Ømporteerd, kunt u uw Azure-abonnement in de PowerShell-sessie kunt beheren.</span><span class="sxs-lookup"><span data-stu-id="595a9-147">Once the publish settings file is imported, you can manage your Azure subscription in the PowerShell session.</span></span>
    
1. <span data-ttu-id="595a9-148">Kopieer het onderstaande PowerShell-script in een teksteditor en stel de variabele waarden aanpassen aan uw omgeving (standaardwaarden zijn opgegeven voor sommige parameters).</span><span class="sxs-lookup"><span data-stu-id="595a9-148">Copy the PowerShell script below into a text editor and set the variable values to suit your environment (defaults have been provided for some parameters).</span></span> <span data-ttu-id="595a9-149">Houd er rekening mee dat als uw beschikbaarheidsgroep Azure-regio's omvat, u moet het script eenmaal uitgevoerd in elk datacenter voor de cloudservice en de knooppunten die zich in dat datacenter bevinden.</span><span class="sxs-lookup"><span data-stu-id="595a9-149">Note that if your availability group spans Azure regions, you must run the script once in each datacenter for the cloud service and nodes that reside in that datacenter.</span></span>
   
        # Define variables
        $ServiceName = "<MyCloudService>" # the name of the cloud service that contains the availability group nodes
        $AGNodes = "<VM1>","<VM2>","<VM3>" # all availability group nodes containing replicas in the same cloud service, separated by commas
   
        # Configure a load balanced endpoint for each node in $AGNodes, with direct server return enabled
        ForEach ($node in $AGNodes)
        {
            Get-AzureVM -ServiceName $ServiceName -Name $node | Add-AzureEndpoint -Name "ListenerEndpoint" -Protocol "TCP" -PublicPort 1433 -LocalPort 1433 -LBSetName "ListenerEndpointLB" -ProbePort 59999 -ProbeProtocol "TCP" -DirectServerReturn $true | Update-AzureVM
        }

2. <span data-ttu-id="595a9-150">Als u de variabelen hebt ingesteld, Kopieer het script in de teksteditor in uw Azure PowerShell-sessie uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="595a9-150">Once you have set the variables, copy the script from the text editor into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="595a9-151">Als de prompt nog steeds >>, typt u ENTER opnieuw te controleren of het script wordt gestart.</span><span class="sxs-lookup"><span data-stu-id="595a9-151">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>

## <a name="verify-that-kb2854082-is-installed-if-necessary"></a><span data-ttu-id="595a9-152">Controleer of KB2854082 wordt indien nodig ge√Ønstalleerd</span><span class="sxs-lookup"><span data-stu-id="595a9-152">Verify that KB2854082 is installed if necessary</span></span>
[!INCLUDE [kb2854082](../../../../includes/virtual-machines-ag-listener-kb2854082.md)]

## <a name="open-the-firewall-ports-in-availability-group-nodes"></a><span data-ttu-id="595a9-153">De firewallpoorten openen in de beschikbaarheid van groepsknooppunten</span><span class="sxs-lookup"><span data-stu-id="595a9-153">Open the firewall ports in availability group nodes</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-open-firewall.md)]

## <a name="create-the-availability-group-listener"></a><span data-ttu-id="595a9-154">Maken van de beschikbaarheidsgroep-listener</span><span class="sxs-lookup"><span data-stu-id="595a9-154">Create the availability group listener</span></span>

<span data-ttu-id="595a9-155">Maak de beschikbaarheidsgroep-listener in twee stappen.</span><span class="sxs-lookup"><span data-stu-id="595a9-155">Create the availability group listener in two steps.</span></span> <span data-ttu-id="595a9-156">Eerst de clusterbron van client access point maken en configureren van afhankelijkheden.</span><span class="sxs-lookup"><span data-stu-id="595a9-156">First, create the client access point cluster resource and configure  dependencies.</span></span> <span data-ttu-id="595a9-157">Ten tweede de clusterbronnen configureren met PowerShell.</span><span class="sxs-lookup"><span data-stu-id="595a9-157">Second, configure the cluster resources with PowerShell.</span></span>

### <a name="create-the-client-access-point-and-configure-the-cluster-dependencies"></a><span data-ttu-id="595a9-158">De client access point maken en configureren van de cluster-afhankelijkheden</span><span class="sxs-lookup"><span data-stu-id="595a9-158">Create the client access point and configure the cluster dependencies</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-create-listener.md)]

### <a name="configure-the-cluster-resources-in-powershell"></a><span data-ttu-id="595a9-159">Configureer de clusterbronnen in PowerShell</span><span class="sxs-lookup"><span data-stu-id="595a9-159">Configure the cluster resources in PowerShell</span></span>
1. <span data-ttu-id="595a9-160">Externe load balancing, moet u de openbare virtuele IP-adres van de cloudservice die uw replica's bevat.</span><span class="sxs-lookup"><span data-stu-id="595a9-160">For external load balancing, you must obtain the public virtual IP address of the cloud service that contains your replicas.</span></span> <span data-ttu-id="595a9-161">Meld u aan bij de Azure-portal.</span><span class="sxs-lookup"><span data-stu-id="595a9-161">Log into the Azure portal.</span></span> <span data-ttu-id="595a9-162">Navigeer naar de cloudservice die uw beschikbaarheidsgroep VM bevat.</span><span class="sxs-lookup"><span data-stu-id="595a9-162">Navigate to the cloud service that contains your availability group VM.</span></span> <span data-ttu-id="595a9-163">Open de **Dashboard** weergeven.</span><span class="sxs-lookup"><span data-stu-id="595a9-163">Open the **Dashboard** view.</span></span>
2. <span data-ttu-id="595a9-164">Let op het adres dat in **adres van de openbare virtuele IP-adres (VIP)**.</span><span class="sxs-lookup"><span data-stu-id="595a9-164">Note the address shown under **Public Virtual IP (VIP) Address**.</span></span> <span data-ttu-id="595a9-165">Als uw oplossing VNets omvat, moet u deze stap herhalen voor elke cloudservice die een virtuele machine die als host fungeert voor een replica bevat.</span><span class="sxs-lookup"><span data-stu-id="595a9-165">If your solution spans VNets, repeat this step for each cloud service that contains a VM that hosts a replica.</span></span>
3. <span data-ttu-id="595a9-166">Op een van de virtuele machines, Kopieer het onderstaande PowerShell-script in een teksteditor en stel de variabelen op de waarden die u eerder hebt genoteerd.</span><span class="sxs-lookup"><span data-stu-id="595a9-166">On one of the VMs, copy the PowerShell script below into a text editor and set the variables to the values you noted earlier.</span></span>
   
        # Define variables
        $ClusterNetworkName = "<ClusterNetworkName>" # the cluster network name (Use Get-ClusterNetwork on Windows Server 2012 of higher to find the name)
        $IPResourceName = "<IPResourceName>" # the IP Address resource name
        $CloudServiceIP = "<X.X.X.X>" # Public Virtual IP (VIP) address of your cloud service
   
        Import-Module FailoverClusters
   
        # If you are using Windows Server 2012 or higher, use the Get-Cluster Resource command. If you are using Windows Server 2008 R2, use the cluster res command. Both commands are commented out. Choose the one applicable to your environment and remove the # at the beginning of the line to convert the comment to an executable line of code.
   
        # Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$CloudServiceIP";"ProbePort"="59999";"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"OverrideAddressMatch"=1;"EnableDhcp"=0}
        # cluster res $IPResourceName /priv enabledhcp=0 overrideaddressmatch=1 address=$CloudServiceIP probeport=59999  subnetmask=255.255.255.255
4. <span data-ttu-id="595a9-167">Eenmaal u de variabelen hebt ingesteld, opent u een Windows PowerShell-venster met verhoogde bevoegdheid, en vervolgens Kopieer het script in de teksteditor en plak in uw Azure PowerShell-sessie uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="595a9-167">Once you have set the variables, open an elevated Windows PowerShell window, then copy the script from the text editor and paste into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="595a9-168">Als de prompt nog steeds >>, typt u ENTER opnieuw te controleren of het script wordt gestart.</span><span class="sxs-lookup"><span data-stu-id="595a9-168">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>
5. <span data-ttu-id="595a9-169">Herhaal deze procedure op elke virtuele machine.</span><span class="sxs-lookup"><span data-stu-id="595a9-169">Repeat this on each VM.</span></span> <span data-ttu-id="595a9-170">Dit script voor het configureren van de bron-IP-adres met het IP-adres van de cloudservice en stelt u andere parameters zoals de testpoort.</span><span class="sxs-lookup"><span data-stu-id="595a9-170">This script configures the IP Address resource with the IP address of the cloud service and sets other parameters like the probe port.</span></span> <span data-ttu-id="595a9-171">Wanneer de bron-IP-adres online wordt gebracht, kan deze vervolgens reageren op de polling op de testpoort van het eindpunt taakverdeling eerder in deze zelfstudie hebt gemaakt.</span><span class="sxs-lookup"><span data-stu-id="595a9-171">When the IP Address resource is brought online, it can then respond to the polling on the probe port from the load-balanced endpoint created earlier in this tutorial.</span></span>

## <a name="bring-the-listener-online"></a><span data-ttu-id="595a9-172">De listener online brengen</span><span class="sxs-lookup"><span data-stu-id="595a9-172">Bring the listener online</span></span>
[!INCLUDE [Bring-Listener-Online](../../../../includes/virtual-machines-ag-listener-bring-online.md)]

## <a name="follow-up-items"></a><span data-ttu-id="595a9-173">Items worden opgevolgd</span><span class="sxs-lookup"><span data-stu-id="595a9-173">Follow-up items</span></span>
[!INCLUDE [Follow-up](../../../../includes/virtual-machines-ag-listener-follow-up.md)]

## <a name="test-the-availability-group-listener-within-the-same-vnet"></a><span data-ttu-id="595a9-174">Testen van de beschikbaarheidsgroep-listener (binnen hetzelfde VNet)</span><span class="sxs-lookup"><span data-stu-id="595a9-174">Test the availability group listener (within the same VNet)</span></span>
[!INCLUDE [Test-Listener-Within-VNET](../../../../includes/virtual-machines-ag-listener-test.md)]

## <a name="test-the-availability-group-listener-over-the-internet"></a><span data-ttu-id="595a9-175">Testen van de beschikbaarheidsgroep-listener (via het internet)</span><span class="sxs-lookup"><span data-stu-id="595a9-175">Test the availability group listener (over the internet)</span></span>
<span data-ttu-id="595a9-176">Voor toegang tot de listener van buiten het virtuele netwerk, moet u extern/openbare load balancing (in dit onderwerp beschreven) in plaats van een ILB, dit is alleen toegankelijk binnen hetzelfde VNet.</span><span class="sxs-lookup"><span data-stu-id="595a9-176">In order to access the listener from outside the virtual network, you must be using external/public load balancing (described in this topic) rather than ILB, which is only accesible within the same VNet.</span></span> <span data-ttu-id="595a9-177">In de verbindingsreeks, moet u de naam van de cloud-service opgeven.</span><span class="sxs-lookup"><span data-stu-id="595a9-177">In the connection string, you specify the cloud service name.</span></span> <span data-ttu-id="595a9-178">Bijvoorbeeld, als u een cloudservice met de naam van de had *mycloudservice*, de instructie sqlcmd zou als volgt zijn:</span><span class="sxs-lookup"><span data-stu-id="595a9-178">For example, if you had a cloud service with the name *mycloudservice*, the sqlcmd statement would be as follows:</span></span>

    sqlcmd -S "mycloudservice.cloudapp.net,<EndpointPort>" -d "<DatabaseName>" -U "<LoginId>" -P "<Password>"  -Q "select @@servername, db_name()" -l 15

<span data-ttu-id="595a9-179">In tegenstelling tot het vorige voorbeeld moet SQL-verificatie worden gebruikt, omdat de aanroeper kan geen van windows-verificatie via internet gebruikmaken.</span><span class="sxs-lookup"><span data-stu-id="595a9-179">Unlike the previous example, SQL authentication must be used, because the caller cannot use windows authentication over the internet.</span></span> <span data-ttu-id="595a9-180">Zie voor meer informatie [AlwaysOn-beschikbaarheidsgroep in Azure VM: Client-scenario's voor connectiviteit](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span><span class="sxs-lookup"><span data-stu-id="595a9-180">For more information, see [Always On Availability Group in Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span></span> <span data-ttu-id="595a9-181">Wanneer u SQL-verificatie gebruikt, zorg er dan voor dat u dezelfde aanmeldingsnaam maakt op beide replica's.</span><span class="sxs-lookup"><span data-stu-id="595a9-181">When using SQL authentication, make sure that you create the same login on both replicas.</span></span> <span data-ttu-id="595a9-182">Zie voor meer informatie over het oplossen van aanmeldingen met beschikbaarheidsgroepen [aanmeldingen toewijzen of gebruik opgenomen SQL database-gebruiker om te verbinden met andere replica's en toewijzen aan de beschikbaarheidsdatabases](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span><span class="sxs-lookup"><span data-stu-id="595a9-182">For more information about troubleshooting logins with Availability Groups, see [How to map logins or use contained SQL database user to connect to other replicas and map to availability databases](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span></span>

<span data-ttu-id="595a9-183">Als wordt altijd op replica's in verschillende subnetten, moeten clients opgeven **MultisubnetFailover = True** in de verbindingstekenreeks.</span><span class="sxs-lookup"><span data-stu-id="595a9-183">If the Always On replicas are in different subnets, clients must specify **MultisubnetFailover=True** in the connection string.</span></span> <span data-ttu-id="595a9-184">Dit resulteert in parallelle verbindingspogingen met replica's in de verschillende subnetten.</span><span class="sxs-lookup"><span data-stu-id="595a9-184">This results in parallel connection attempts to replicas in the different subnets.</span></span> <span data-ttu-id="595a9-185">Houd er rekening mee dat dit scenario een regio-overschrijdende altijd op beschikbaarheidsgroep-implementatie bevat.</span><span class="sxs-lookup"><span data-stu-id="595a9-185">Note that this scenario includes a cross-region Always On Availability Group deployment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="595a9-186">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="595a9-186">Next steps</span></span>
[!INCLUDE [Listener-Next-Steps](../../../../includes/virtual-machines-ag-listener-next-steps.md)]

