---
title: Sleutelkluis integreert met SQL Server op Windows-machines in Azure (klassiek) | Microsoft Docs
description: Informatie over het automatiseren van de configuratie van SQL Server-versleuteling voor gebruik met Azure Sleutelkluis. Dit onderwerp wordt uitgelegd hoe u Azure Sleutelkluis-integratie met SQL Server-virtuele machines in het klassieke implementatiemodel maken.
services: virtual-machines-windows
documentationcenter: 
author: rothja
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: ab8d41a7-1971-4032-ab71-eb435c455dc1
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 02/17/2017
ms.author: jroth
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 2a9ac5763bb934bd0646e47c3936f7bdd0d603b1
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="configure-azure-key-vault-integration-for-sql-server-on-azure-virtual-machines-classic"></a><span data-ttu-id="0c2e4-104">Configureren van Azure Sleutelkluis-integratie voor SQL Server op virtuele Machines in Azure (klassiek)</span><span class="sxs-lookup"><span data-stu-id="0c2e4-104">Configure Azure Key Vault Integration for SQL Server on Azure Virtual Machines (Classic)</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="0c2e4-105">Resource Manager</span><span class="sxs-lookup"><span data-stu-id="0c2e4-105">Resource Manager</span></span>](../sql/virtual-machines-windows-ps-sql-keyvault.md)
> * [<span data-ttu-id="0c2e4-106">Klassiek</span><span class="sxs-lookup"><span data-stu-id="0c2e4-106">Classic</span></span>](../classic/ps-sql-keyvault.md)
> 
> 

## <a name="overview"></a><span data-ttu-id="0c2e4-107">Overzicht</span><span class="sxs-lookup"><span data-stu-id="0c2e4-107">Overview</span></span>
<span data-ttu-id="0c2e4-108">Er zijn meerdere onderdelen van SQL Server-versleuteling, zoals [transparante gegevensversleuteling (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [kolom: versleuteling op bestandsniveau (wissen)](https://msdn.microsoft.com/library/ms173744.aspx), en [back-upversleuteling](https://msdn.microsoft.com/library/dn449489.aspx).</span><span class="sxs-lookup"><span data-stu-id="0c2e4-108">There are multiple SQL Server encryption features, such as [transparent data encryption (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [column level encryption (CLE)](https://msdn.microsoft.com/library/ms173744.aspx), and [backup encryption](https://msdn.microsoft.com/library/dn449489.aspx).</span></span> <span data-ttu-id="0c2e4-109">Deze vormen van versleuteling hoeft te beheren en opslaan van de cryptografische sleutels die u voor versleuteling gebruikt.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-109">These forms of encryption require you to manage and store the cryptographic keys you use for encryption.</span></span> <span data-ttu-id="0c2e4-110">De service Azure Key Vault (Azure Sleutelkluis) is ontworpen voor het verbeteren van de beveiliging en beheer van deze sleutels op een locatie met veilige en maximaal beschikbaar.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-110">The Azure Key Vault (AKV) service is designed to improve the security and management of these keys in a secure and highly available location.</span></span> <span data-ttu-id="0c2e4-111">De [SQL Server-Connector](http://www.microsoft.com/download/details.aspx?id=45344) kan SQL-Server in het gebruik van deze sleutels van Azure Sleutelkluis.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-111">The [SQL Server Connector](http://www.microsoft.com/download/details.aspx?id=45344) enables SQL Server to use these keys from Azure Key Vault.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="0c2e4-112">Azure heeft twee verschillende implementatiemodellen voor het maken en werken met resources: [Resource Manager en Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="0c2e4-112">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="0c2e4-113">In dit artikel bevat informatie over met behulp van het klassieke implementatiemodel.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-113">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="0c2e4-114">U doet er verstandig aan voor de meeste nieuwe implementaties het Resource Manager-model te gebruiken.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-114">Microsoft recommends that most new deployments use the Resource Manager model.</span></span>

<span data-ttu-id="0c2e4-115">Als u SQL Server met lokale virtuele machines uitvoert, zijn er [stappen die u kunt volgen om toegang tot Azure Key Vault vanuit uw on-premises SQL Server-machine](https://msdn.microsoft.com/library/dn198405.aspx).</span><span class="sxs-lookup"><span data-stu-id="0c2e4-115">If you are running SQL Server with on-premises machines, there are [steps you can follow to access Azure Key Vault from your on-premises SQL Server machine](https://msdn.microsoft.com/library/dn198405.aspx).</span></span> <span data-ttu-id="0c2e4-116">Maar voor SQL Server in Azure VM's, kunt u tijd besparen met behulp van de *Azure Sleutelkluis-integratie* functie.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-116">But for SQL Server in Azure VMs, you can save time by using the *Azure Key Vault Integration* feature.</span></span> <span data-ttu-id="0c2e4-117">Met een paar Azure PowerShell-cmdlets voor deze functie inschakelt, kunt u de configuratie die nodig zijn voor een SQL-VM voor toegang tot de sleutelkluis automatiseren.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-117">With a few Azure PowerShell cmdlets to enable this feature, you can automate the configuration necessary for a SQL VM to access your key vault.</span></span>

<span data-ttu-id="0c2e4-118">Wanneer deze functie is ingeschakeld, en deze automatisch de SQL Server-Connector installeert, configureert u de EKM-provider voor toegang tot Azure Sleutelkluis, maakt u de referentie zodat u toegang tot uw kluis.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-118">When this feature is enabled, it automatically installs the SQL Server Connector, configures the EKM provider to access Azure Key Vault, and creates the credential to allow you to access your vault.</span></span> <span data-ttu-id="0c2e4-119">Als u de stappen in de documentatie van de eerder genoemde lokale bekeken, ziet u dat deze functie stap 2 en 3 automatiseert.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-119">If you looked at the steps in the previously mentioned on-premises documentation, you can see that this feature automates steps 2 and 3.</span></span> <span data-ttu-id="0c2e4-120">Het enige dat u toch wilt handmatig doen is de sleutelkluis en de sleutels te maken.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-120">The only thing you would still need to do manually is to create the key vault and keys.</span></span> <span data-ttu-id="0c2e4-121">Van daaruit wordt de volledige installatie van de SQL-VM geautomatiseerd.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-121">From there, the entire setup of your SQL VM is automated.</span></span> <span data-ttu-id="0c2e4-122">Zodra deze functie kan voor deze installatie is voltooid, kunt u de T-SQL-instructies om te beginnen met het versleutelen van uw databases of back-ups normaal uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-122">Once this feature has completed this setup, you can execute T-SQL statements to begin encrypting your databases or backups as you normally would.</span></span>

[!INCLUDE [AKV Integration Prepare](../../../../includes/virtual-machines-sql-server-akv-prepare.md)]

## <a name="configure-akv-integration"></a><span data-ttu-id="0c2e4-123">Configureren van Azure Sleutelkluis-integratie</span><span class="sxs-lookup"><span data-stu-id="0c2e4-123">Configure AKV Integration</span></span>
<span data-ttu-id="0c2e4-124">PowerShell gebruiken voor het configureren van Azure Sleutelkluis-integratie.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-124">Use PowerShell to configure Azure Key Vault Integration.</span></span> <span data-ttu-id="0c2e4-125">De volgende secties bevatten een overzicht van de vereiste parameters en vervolgens een PowerShell-voorbeeldscript.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-125">The following sections provide an overview of the required parameters and then a sample PowerShell script.</span></span>

### <a name="install-the-sql-server-iaas-extension"></a><span data-ttu-id="0c2e4-126">De SQL Server IaaS-uitbreiding installeren</span><span class="sxs-lookup"><span data-stu-id="0c2e4-126">Install the SQL Server IaaS Extension</span></span>
<span data-ttu-id="0c2e4-127">Eerst [installeren van de SQL Server IaaS-extensie](../classic/sql-server-agent-extension.md).</span><span class="sxs-lookup"><span data-stu-id="0c2e4-127">First, [install the SQL Server IaaS Extension](../classic/sql-server-agent-extension.md).</span></span>

### <a name="understand-the-input-parameters"></a><span data-ttu-id="0c2e4-128">De invoerparameters begrijpen</span><span class="sxs-lookup"><span data-stu-id="0c2e4-128">Understand the input parameters</span></span>
<span data-ttu-id="0c2e4-129">De volgende tabel bevat de vereiste parameters voor de PowerShell-script uitvoeren in de volgende sectie.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-129">The following table lists the parameters required to run the PowerShell script in the next section.</span></span>

| <span data-ttu-id="0c2e4-130">Parameter</span><span class="sxs-lookup"><span data-stu-id="0c2e4-130">Parameter</span></span> | <span data-ttu-id="0c2e4-131">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="0c2e4-131">Description</span></span> | <span data-ttu-id="0c2e4-132">Voorbeeld</span><span class="sxs-lookup"><span data-stu-id="0c2e4-132">Example</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0c2e4-133">**$akvURL**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-133">**$akvURL**</span></span> |<span data-ttu-id="0c2e4-134">**De sleutelkluis-URL**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-134">**The key vault URL**</span></span> |<span data-ttu-id="0c2e4-135">'https://contosokeyvault.vault.azure.net/'</span><span class="sxs-lookup"><span data-stu-id="0c2e4-135">"https://contosokeyvault.vault.azure.net/"</span></span> |
| <span data-ttu-id="0c2e4-136">**$spName**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-136">**$spName**</span></span> |<span data-ttu-id="0c2e4-137">**Service-Principal-naam**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-137">**Service Principal name**</span></span> |<span data-ttu-id="0c2e4-138">'fde2b411 - 33d 5-4e11-af04eb07b669ccf2'</span><span class="sxs-lookup"><span data-stu-id="0c2e4-138">"fde2b411-33d5-4e11-af04eb07b669ccf2"</span></span> |
| <span data-ttu-id="0c2e4-139">**$spSecret**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-139">**$spSecret**</span></span> |<span data-ttu-id="0c2e4-140">**Service-Principal-geheim**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-140">**Service Principal secret**</span></span> |<span data-ttu-id="0c2e4-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM ="</span><span class="sxs-lookup"><span data-stu-id="0c2e4-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="</span></span> |
| <span data-ttu-id="0c2e4-142">**$credName**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-142">**$credName**</span></span> |<span data-ttu-id="0c2e4-143">**Referentienaam**: de Azure Sleutelkluis-integratie maakt een referentie in SQL Server, zodat de virtuele machine toegang heeft tot de sleutelkluis.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-143">**Credential name**: AKV Integration creates a credential within SQL Server, allowing the VM to have access to the key vault.</span></span> <span data-ttu-id="0c2e4-144">Kies een naam voor deze referentie.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-144">Choose a name for this credential.</span></span> |<span data-ttu-id="0c2e4-145">'mycred1'</span><span class="sxs-lookup"><span data-stu-id="0c2e4-145">"mycred1"</span></span> |
| <span data-ttu-id="0c2e4-146">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-146">**$vmName**</span></span> |<span data-ttu-id="0c2e4-147">**Naam van virtuele machine**: de naam van een eerder gemaakte SQL-VM.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-147">**Virtual machine name**: The name of a previously created SQL VM.</span></span> |<span data-ttu-id="0c2e4-148">'myvmname'</span><span class="sxs-lookup"><span data-stu-id="0c2e4-148">"myvmname"</span></span> |
| <span data-ttu-id="0c2e4-149">**$serviceName**</span><span class="sxs-lookup"><span data-stu-id="0c2e4-149">**$serviceName**</span></span> |<span data-ttu-id="0c2e4-150">**Servicenaam**: naam van de Cloudservice die is gekoppeld aan de SQL VM.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-150">**Service name**: The Cloud Service name that is associated with the SQL VM.</span></span> |<span data-ttu-id="0c2e4-151">'mycloudservicename'</span><span class="sxs-lookup"><span data-stu-id="0c2e4-151">"mycloudservicename"</span></span> |

### <a name="enable-akv-integration-with-powershell"></a><span data-ttu-id="0c2e4-152">Inschakelen van Azure Sleutelkluis-integratie met PowerShell</span><span class="sxs-lookup"><span data-stu-id="0c2e4-152">Enable AKV Integration with PowerShell</span></span>
<span data-ttu-id="0c2e4-153">De **nieuw AzureVMSqlServerKeyVaultCredentialConfig** cmdlet maakt een configuratieobject voor de functie Azure Sleutelkluis-integratie.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-153">The **New-AzureVMSqlServerKeyVaultCredentialConfig** cmdlet creates a configuration object for the Azure Key Vault Integration feature.</span></span> <span data-ttu-id="0c2e4-154">De **Set AzureVMSqlServerExtension** configureert u deze integratie met de **KeyVaultCredentialSettings** parameter.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-154">The **Set-AzureVMSqlServerExtension** configures this integration with the **KeyVaultCredentialSettings** parameter.</span></span> <span data-ttu-id="0c2e4-155">De volgende stappen laten zien hoe deze opdrachten gebruiken.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-155">The following steps show how to use these commands.</span></span>

1. <span data-ttu-id="0c2e4-156">In Azure PowerShell eerst configureren de invoerparameters met uw specifieke waarden zoals beschreven in de voorgaande secties in dit onderwerp.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-156">In Azure PowerShell, first configure the input parameters with your specific values as described in the previous sections of this topic.</span></span> <span data-ttu-id="0c2e4-157">Het volgende script is een voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-157">The following script is an example.</span></span>
   
        $akvURL = "https://contosokeyvault.vault.azure.net/"
        $spName = "fde2b411-33d5-4e11-af04eb07b669ccf2"
        $spSecret = "9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="
        $credName = "mycred1"
        $vmName = "myvmname"
        $serviceName = "mycloudservicename"
2. <span data-ttu-id="0c2e4-158">Het volgende script vervolgens gebruiken voor het configureren en inschakelen van Azure Sleutelkluis-integratie.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-158">Then use the following script to configure and enable AKV Integration.</span></span>
   
        $secureakv =  $spSecret | ConvertTo-SecureString -AsPlainText -Force
        $akvs = New-AzureVMSqlServerKeyVaultCredentialConfig -Enable -CredentialName $credname -AzureKeyVaultUrl $akvURL -ServicePrincipalName $spName -ServicePrincipalSecret $secureakv
        Get-AzureVM -ServiceName $serviceName -Name $vmName | Set-AzureVMSqlServerExtension -KeyVaultCredentialSettings $akvs | Update-AzureVM

<span data-ttu-id="0c2e4-159">De SQL-uitbreiding voor IaaS-Agent wordt de SQL VM bijgewerkt met deze nieuwe configuratie.</span><span class="sxs-lookup"><span data-stu-id="0c2e4-159">The SQL IaaS Agent Extension will update the SQL VM with this new configuration.</span></span>

[!INCLUDE [AKV Integration Next Steps](../../../../includes/virtual-machines-sql-server-akv-next-steps.md)]

