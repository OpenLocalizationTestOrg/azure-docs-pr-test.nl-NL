---
title: Begin met het ontwikkelen met Visual Studio-projectsjablonen - Azure Batch-oplossingen | Microsoft Docs
description: Meer informatie over hoe sjablonen voor Visual Studio-project kunt implementeren en uitvoeren van uw rekenintensieve workloads op Azure Batch.
services: batch
documentationcenter: .net
author: fayora
manager: timlt
editor: 
ms.assetid: 5e041ae2-25af-4882-a79e-3aa63c4bfb20
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 02/27/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: da77ce827c65deb18d9d84ce5cf768d89788e205
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="use-visual-studio-project-templates-to-jump-start-batch-solutions"></a><span data-ttu-id="2db6f-103">Gebruik Visual Studio-projectsjablonen Batch-oplossingen snel op</span><span class="sxs-lookup"><span data-stu-id="2db6f-103">Use Visual Studio project templates to jump-start Batch solutions</span></span>

<span data-ttu-id="2db6f-104">De **Job Manager** en **taak Processor Visual Studio sjablonen** bieden code om te implementeren en uitvoeren van uw rekenintensieve workloads op Batch met zo min mogelijk moeite voor Batch.</span><span class="sxs-lookup"><span data-stu-id="2db6f-104">The **Job Manager** and **Task Processor Visual Studio templates** for Batch provide code to help you to implement and run your compute-intensive workloads on Batch with the least amount of effort.</span></span> <span data-ttu-id="2db6f-105">Dit document beschrijft deze sjablonen en biedt richtlijnen voor het gebruik ervan.</span><span class="sxs-lookup"><span data-stu-id="2db6f-105">This document describes these templates and provides guidance for how to use them.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2db6f-106">In dit artikel vindt u alleen informatie die van toepassing op deze twee sjablonen en wordt ervan uitgegaan dat u bekend met de Batch-service en de belangrijkste concepten die betrekking hebben op het bent: pools, rekenknooppunten, taken en taken, jobbeheertaken, omgevingsvariabelen en andere relevante informatie.</span><span class="sxs-lookup"><span data-stu-id="2db6f-106">This article discusses only information applicable to these two templates, and assumes that you are familiar with the Batch service and key concepts related to it: pools, compute nodes, jobs and tasks, job manager tasks, environment variables, and other relevant information.</span></span> <span data-ttu-id="2db6f-107">U vindt meer informatie in [basisbeginselen van Azure Batch](batch-technical-overview.md), [overzicht van de Batch-functies voor ontwikkelaars](batch-api-basics.md), en [aan de slag met de Azure Batch-bibliotheek voor .NET](batch-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="2db6f-107">You can find more information in [Basics of Azure Batch](batch-technical-overview.md), [Batch feature overview for developers](batch-api-basics.md), and [Get started with the Azure Batch library for .NET](batch-dotnet-get-started.md).</span></span>
> 
> 

## <a name="high-level-overview"></a><span data-ttu-id="2db6f-108">Overzicht</span><span class="sxs-lookup"><span data-stu-id="2db6f-108">High-level overview</span></span>
<span data-ttu-id="2db6f-109">De Job Manager en de processorsnelheid van de taak sjablonen kunnen worden gebruikt voor het maken van twee nuttig onderdelen:</span><span class="sxs-lookup"><span data-stu-id="2db6f-109">The Job Manager and Task Processor templates can be used to create two useful components:</span></span>

* <span data-ttu-id="2db6f-110">Een jobbeheertaak waarmee de splitser van een taak die een taak verbreken kunt omlaag in meerdere taken die onafhankelijk, parallel kunnen worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-110">A job manager task that implements a job splitter that can break a job down into multiple tasks that can run independently, in parallel.</span></span>
* <span data-ttu-id="2db6f-111">Een taak processor dat voorverwerking en naverwerking rond een toepassing vanaf de opdrachtregel uit te voeren kan worden gebruikt.</span><span class="sxs-lookup"><span data-stu-id="2db6f-111">A task processor that can be used to perform pre-processing and post-processing around an application command line.</span></span>

<span data-ttu-id="2db6f-112">Bijvoorbeeld in een scenario film rendering van zou de splitser taak zet een taak één film in honderden of duizenden afzonderlijke taken die afzonderlijke frames afzonderlijk wilt verwerken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-112">For example, in a movie rendering scenario, the job splitter would turn a single movie job into hundreds or thousands of separate tasks that would process individual frames separately.</span></span> <span data-ttu-id="2db6f-113">: De taak processor de van renderingtoepassing zou aanroepen en alle afhankelijke processen die nodig zijn om weer te geven elk frame, evenals aanvullende acties (bijvoorbeeld het gerenderde frame kopiëren naar een opslaglocatie) uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="2db6f-113">Correspondingly, the task processor would invoke the rendering application and all dependent processes that are needed to render each frame, as well as perform any additional actions (for example, copying the rendered frame to a storage location).</span></span>

> [!NOTE]
> <span data-ttu-id="2db6f-114">De Job Manager en de processorsnelheid van de taak sjablonen zijn onafhankelijk van elkaar, zodat u kiezen kunt om beide of slechts één van beide, afhankelijk van de vereisten van uw compute-taak en op uw voorkeuren te gebruiken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-114">The Job Manager and Task Processor templates are independent of each other, so you can choose to use both, or only one of them, depending on the requirements of your compute job and on your preferences.</span></span>
> 
> 

<span data-ttu-id="2db6f-115">Zoals u in het onderstaande diagram, doorlopen een compute-taak die gebruikmaakt van deze sjablonen drie fasen:</span><span class="sxs-lookup"><span data-stu-id="2db6f-115">As shown in the diagram below, a compute job that uses these templates will go through three stages:</span></span>

1. <span data-ttu-id="2db6f-116">De clientcode (bijvoorbeeld toepassingen, web-service, enzovoort) verzendt een taak met de Batch-service op Azure, zoals de manager van de taak van de taak programma voor de taak opgeven.</span><span class="sxs-lookup"><span data-stu-id="2db6f-116">The client code (e.g., application, web service, etc.) submits a job to the Batch service on Azure, specifying as its job manager task the job manager program.</span></span>
2. <span data-ttu-id="2db6f-117">De jobbeheertaak wordt in de Batch-service op een rekenknooppunt uitgevoerd en de splitser taak start het opgegeven aantal taak processor taken op als veel waar nodig rekenknooppunten, op basis van de parameters en -specificaties in de code van de splitser taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-117">The Batch service runs the job manager task on a compute node and the job splitter launches the specified number of task processor tasks, on as many compute nodes as required, based on the parameters and specifications in the job splitter code.</span></span>
3. <span data-ttu-id="2db6f-118">De taken van de processor taak uitgevoerd onafhankelijk, parallel voor de invoergegevens verwerkt en het genereren van de uitvoergegevens.</span><span class="sxs-lookup"><span data-stu-id="2db6f-118">The task processor tasks run independently, in parallel, to process the input data and generate the output data.</span></span>

![Diagram die weergeeft hoe clientcode samenwerkt met de Batch-service][diagram01]

## <a name="prerequisites"></a><span data-ttu-id="2db6f-120">Vereisten</span><span class="sxs-lookup"><span data-stu-id="2db6f-120">Prerequisites</span></span>
<span data-ttu-id="2db6f-121">De Batch als sjablonen wilt gebruiken, moet u het volgende:</span><span class="sxs-lookup"><span data-stu-id="2db6f-121">To use the Batch templates, you will need the following:</span></span>

* <span data-ttu-id="2db6f-122">Een computer met Visual Studio 2015 geïnstalleerd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-122">A computer with Visual Studio 2015 installed.</span></span> <span data-ttu-id="2db6f-123">Batch-sjablonen zijn momenteel alleen ondersteund voor Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="2db6f-123">Batch templates are currently only supported for Visual Studio 2015.</span></span>
* <span data-ttu-id="2db6f-124">De Batch-sjablonen, die beschikbaar zijn vanuit de [Visual Studio-galerie] [ vs_gallery] als Visual Studio-extensies.</span><span class="sxs-lookup"><span data-stu-id="2db6f-124">The Batch templates, which are available from the [Visual Studio Gallery][vs_gallery] as Visual Studio extensions.</span></span> <span data-ttu-id="2db6f-125">Er zijn twee manieren om de sjablonen te verkrijgen:</span><span class="sxs-lookup"><span data-stu-id="2db6f-125">There are two ways to get the templates:</span></span>
  
  * <span data-ttu-id="2db6f-126">Installeren van de sjablonen met behulp van de **uitbreidingen en Updates** dialoogvenster in Visual Studio (Zie voor meer informatie [zoeken en met behulp van Visual Studio Extensions][vs_find_use_ext]).</span><span class="sxs-lookup"><span data-stu-id="2db6f-126">Install the templates using the **Extensions and Updates** dialog box in Visual Studio (for more information, see [Finding and Using Visual Studio Extensions][vs_find_use_ext]).</span></span> <span data-ttu-id="2db6f-127">In de **uitbreidingen en Updates** dialoogvenster vak, zoeken en downloaden van de volgende twee extensies:</span><span class="sxs-lookup"><span data-stu-id="2db6f-127">In the **Extensions and Updates** dialog box, search and download the following two extensions:</span></span>
    
    * <span data-ttu-id="2db6f-128">Azure Batch-Job Manager met de taak splitsen</span><span class="sxs-lookup"><span data-stu-id="2db6f-128">Azure Batch Job Manager with Job Splitter</span></span>
    * <span data-ttu-id="2db6f-129">Processor van Azure Batch-taak</span><span class="sxs-lookup"><span data-stu-id="2db6f-129">Azure Batch Task Processor</span></span>
  * <span data-ttu-id="2db6f-130">De sjablonen gedownload vanuit de online-galerie voor Visual Studio: [projectsjablonen voor Microsoft Azure-Batch][vs_gallery_templates]</span><span class="sxs-lookup"><span data-stu-id="2db6f-130">Download the templates from the online gallery for Visual Studio: [Microsoft Azure Batch Project Templates][vs_gallery_templates]</span></span>
* <span data-ttu-id="2db6f-131">Als u wilt gebruiken de [toepassingspakketten](batch-application-packages.md) functie voor het implementeren van de manager van de taak en taak processor naar de Batch-rekenknooppunten, moet u een opslagaccount aan uw Batch-account koppelen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-131">If you plan to use the [Application Packages](batch-application-packages.md) feature to deploy the job manager and task processor to the Batch compute nodes, you need to link a storage account to your Batch account.</span></span>

## <a name="preparation"></a><span data-ttu-id="2db6f-132">Voorbereiding</span><span class="sxs-lookup"><span data-stu-id="2db6f-132">Preparation</span></span>
<span data-ttu-id="2db6f-133">Het is raadzaam om een oplossing met uw job manager, evenals de processor taak maken omdat hierdoor kunt u gemakkelijker code tussen uw job manager en de taak processor-programma's te delen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-133">We recommend creating a solution that can contain your job manager as well as your task processor, because this can make it easier to share code between your job manager and task processor programs.</span></span> <span data-ttu-id="2db6f-134">Volg deze stappen voor het maken van deze oplossing:</span><span class="sxs-lookup"><span data-stu-id="2db6f-134">To create this solution, follow these steps:</span></span>

1. <span data-ttu-id="2db6f-135">Open Visual Studio en selecteer **bestand** > **nieuw** > **Project**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-135">Open Visual Studio and select **File** > **New** > **Project**.</span></span>
2. <span data-ttu-id="2db6f-136">Onder **sjablonen**, vouw **andere projecttypen**, klikt u op **Visual Studio-oplossingen**, en selecteer vervolgens **blanco-oplossing**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-136">Under **Templates**, expand **Other Project Types**, click **Visual Studio Solutions**, and then select **Blank Solution**.</span></span>
3. <span data-ttu-id="2db6f-137">Typ een naam voor uw toepassing en het doel van deze oplossing (bijvoorbeeld ' LitwareBatchTaskPrograms').</span><span class="sxs-lookup"><span data-stu-id="2db6f-137">Type a name that describes your application and the purpose of this solution (e.g., "LitwareBatchTaskPrograms").</span></span>
4. <span data-ttu-id="2db6f-138">Klik op om de nieuwe oplossing **OK**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-138">To create the new solution, click **OK**.</span></span>

## <a name="job-manager-template"></a><span data-ttu-id="2db6f-139">Taak Manager-sjabloon</span><span class="sxs-lookup"><span data-stu-id="2db6f-139">Job Manager template</span></span>
<span data-ttu-id="2db6f-140">De sjabloon Job Manager helpt u bij het implementeren van een jobbeheertaak die u kunt de volgende acties uitvoeren:</span><span class="sxs-lookup"><span data-stu-id="2db6f-140">The Job Manager template helps you to implement a job manager task that can perform the following actions:</span></span>

* <span data-ttu-id="2db6f-141">Een job onderverdeeld in meerdere taken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-141">Split a job into multiple tasks.</span></span>
* <span data-ttu-id="2db6f-142">Deze taken uit te voeren op Batch verzenden.</span><span class="sxs-lookup"><span data-stu-id="2db6f-142">Submit those tasks to run on Batch.</span></span>

> [!NOTE]
> <span data-ttu-id="2db6f-143">Zie voor meer informatie over jobbeheertaken [overzicht van de Batch-functies voor ontwikkelaars](batch-api-basics.md#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="2db6f-143">For more information about job manager tasks, see [Batch feature overview for developers](batch-api-basics.md#job-manager-task).</span></span>
> 
> 

### <a name="create-a-job-manager-using-the-template"></a><span data-ttu-id="2db6f-144">Een Job Manager met behulp van de sjabloon maken</span><span class="sxs-lookup"><span data-stu-id="2db6f-144">Create a Job Manager using the template</span></span>
<span data-ttu-id="2db6f-145">Als u wilt een taak toevoegen aan de oplossing die u eerder hebt gemaakt, de volgende stappen uit:</span><span class="sxs-lookup"><span data-stu-id="2db6f-145">To add a job manager to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="2db6f-146">Open uw bestaande oplossing in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2db6f-146">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="2db6f-147">Klik in Solution Explorer met de rechtermuisknop op de oplossing, klikt u op **toevoegen** > **nieuw Project**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-147">In Solution Explorer, right-click the solution, click **Add** > **New Project**.</span></span>
3. <span data-ttu-id="2db6f-148">Onder **Visual C#**, klikt u op **Cloud**, en klik vervolgens op **Azure Batch-Job Manager met taak splitser**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-148">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Job Manager with Job Splitter**.</span></span>
4. <span data-ttu-id="2db6f-149">Typ een naam waarmee u een beschrijving van uw toepassing en dit project (bijvoorbeeld als de beheerder van de taak identificeert 'LitwareJobManager').</span><span class="sxs-lookup"><span data-stu-id="2db6f-149">Type a name that describes your application and identifies this project as the job manager (e.g. "LitwareJobManager").</span></span>
5. <span data-ttu-id="2db6f-150">Klik op om het project **OK**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-150">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="2db6f-151">Bouw ten slotte het project om af te dwingen van Visual Studio laden alle waarnaar wordt verwezen NuGet-pakketten en om te controleren of het project geldig is voordat u begint met het wijzigen van deze.</span><span class="sxs-lookup"><span data-stu-id="2db6f-151">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="job-manager-template-files-and-their-purpose"></a><span data-ttu-id="2db6f-152">De sjabloonbestanden Job Manager en hun doel</span><span class="sxs-lookup"><span data-stu-id="2db6f-152">Job Manager template files and their purpose</span></span>
<span data-ttu-id="2db6f-153">Wanneer u een project met behulp van de Job Manager-sjabloon maakt, genereert het codebestanden drie groepen:</span><span class="sxs-lookup"><span data-stu-id="2db6f-153">When you create a project using the Job Manager template, it generates three groups of code files:</span></span>

* <span data-ttu-id="2db6f-154">Het belangrijkste programmabestand (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="2db6f-154">The main program file (Program.cs).</span></span> <span data-ttu-id="2db6f-155">Dit document bevat de programma-ingangspunt en uitzonderingsverwerking op het hoogste niveau.</span><span class="sxs-lookup"><span data-stu-id="2db6f-155">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="2db6f-156">U mag niet normaal gesproken moet dit wijzigen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-156">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="2db6f-157">De Framework-map.</span><span class="sxs-lookup"><span data-stu-id="2db6f-157">The Framework directory.</span></span> <span data-ttu-id="2db6f-158">Dit bevat de bestanden die verantwoordelijk is voor het 'standaard'-werk dat door het programma job manager – uitpakken van de parameters, taken toe te voegen aan de Batch-job, enzovoort. U mag niet normaal gesproken moet deze bestanden wijzigen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-158">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="2db6f-159">De taak splitser-bestand (JobSplitter.cs).</span><span class="sxs-lookup"><span data-stu-id="2db6f-159">The job splitter file (JobSplitter.cs).</span></span> <span data-ttu-id="2db6f-160">Dit is waar u uw toepassingsspecifieke logica voor het splitsen van een taak in taken wordt geplaatst.</span><span class="sxs-lookup"><span data-stu-id="2db6f-160">This is where you will put your application-specific logic for splitting a job into tasks.</span></span>

<span data-ttu-id="2db6f-161">Natuurlijk kunt u aanvullende bestanden toevoegen als vereist ter ondersteuning van uw taak splitser code, afhankelijk van de complexiteit van de taak logica splitsen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-161">Of course you can add additional files as required to support your job splitter code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="2db6f-162">De sjabloon genereert ook standaard .NET projectbestanden zoals een .csproj-bestand, app.config, packages.config, enz.</span><span class="sxs-lookup"><span data-stu-id="2db6f-162">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="2db6f-163">De rest van deze sectie beschrijft de verschillende bestanden en de codestructuur en wordt uitgelegd wat elke klasse doet.</span><span class="sxs-lookup"><span data-stu-id="2db6f-163">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Visual Studio Solution Explorer toont de Job Manager sjabloonoplossing][solution_explorer01]

<span data-ttu-id="2db6f-165">**Framework-bestanden**</span><span class="sxs-lookup"><span data-stu-id="2db6f-165">**Framework files**</span></span>

* <span data-ttu-id="2db6f-166">`Configuration.cs`: Het laden van gegevens van de taak configuratie zoals details van de Batch-account, gekoppelde opslagaccountreferenties taak en taakgegevens en taakparameters ingekapseld.</span><span class="sxs-lookup"><span data-stu-id="2db6f-166">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="2db6f-167">Bovendien wordt toegang tot Batch gedefinieerde omgevingsvariabelen (Zie omgevingsinstellingen voor taken in de documentatie van de Batch) via de Configuration.EnvironmentVariable-klasse.</span><span class="sxs-lookup"><span data-stu-id="2db6f-167">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="2db6f-168">`IConfiguration.cs`: Hiermee isoleert de implementatie van de Configuration-klasse, zodat u kunt testen van eenheden uw taak splitser met behulp van een valse of mock configuration-object.</span><span class="sxs-lookup"><span data-stu-id="2db6f-168">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="2db6f-169">`JobManager.cs`: De onderdelen van het programma job manager ingedeeld.</span><span class="sxs-lookup"><span data-stu-id="2db6f-169">`JobManager.cs`: Orchestrates the components of the job manager program.</span></span> <span data-ttu-id="2db6f-170">Het is verantwoordelijk voor het initialiseren van de splitser taak, het aanroepen van de splitser taak en tijdens het verzenden van de taken die zijn geretourneerd door de taak splitser naar de aanvrager taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-170">It is responsible for the initializing the job splitter, invoking the job splitter, and dispatching the tasks returned by the job splitter to the task submitter.</span></span>
* <span data-ttu-id="2db6f-171">`JobManagerException.cs`: Hiermee geeft u een fout is van de manager van de taak is beëindigd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-171">`JobManagerException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="2db6f-172">JobManagerException wordt laten teruglopen 'verwachte' fouten waarin specifieke diagnostische informatie kan worden opgegeven als onderdeel van de beëindiging gebruikt.</span><span class="sxs-lookup"><span data-stu-id="2db6f-172">JobManagerException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>
* <span data-ttu-id="2db6f-173">`TaskSubmitter.cs`: Deze klasse is die verantwoordelijk zijn voor het toevoegen van taken die zijn geretourneerd door de splitser taak op de batchverwerking.</span><span class="sxs-lookup"><span data-stu-id="2db6f-173">`TaskSubmitter.cs`: This class is responsible to adding tasks returned by the job splitter to the Batch job.</span></span> <span data-ttu-id="2db6f-174">De aggregaties van de klasse Taakbeheer heeft de volgorde van de taken in batches efficiënt, maar tijdig toegevoegd aan de taak vervolgens roept TaskSubmitter.SubmitTasks in een achtergrondthread voor elke batch.</span><span class="sxs-lookup"><span data-stu-id="2db6f-174">The JobManager class aggregates the sequence of tasks into batches for efficient but timely addition to the job, then calls TaskSubmitter.SubmitTasks on a background thread for each batch.</span></span>

<span data-ttu-id="2db6f-175">**Taak splitsen**</span><span class="sxs-lookup"><span data-stu-id="2db6f-175">**Job Splitter**</span></span>

<span data-ttu-id="2db6f-176">`JobSplitter.cs`: Met deze klasse bevat toepassingsspecifieke logica voor het verdelen van de taak in de taken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-176">`JobSplitter.cs`: This class contains application-specific logic for splitting the job into tasks.</span></span> <span data-ttu-id="2db6f-177">Het framework roept de methode JobSplitter.Split voor het verkrijgen van een reeks van taken, die wordt toegevoegd aan het project als de methode ze retourneert.</span><span class="sxs-lookup"><span data-stu-id="2db6f-177">The framework invokes the JobSplitter.Split method to obtain a sequence of tasks, which it adds to the job as the method returns them.</span></span> <span data-ttu-id="2db6f-178">Dit is de klasse waarop u de logica van de taak wordt invoeren.</span><span class="sxs-lookup"><span data-stu-id="2db6f-178">This is the class where you will inject the logic of your job.</span></span> <span data-ttu-id="2db6f-179">De Split-methode om een reeks CloudTask-exemplaren die de taken in die u wilt dat voor het partitioneren van de taak vertegenwoordigt terug te implementeren.</span><span class="sxs-lookup"><span data-stu-id="2db6f-179">Implement the Split method to return a sequence of CloudTask instances representing the tasks into which you want to partition the job.</span></span>

<span data-ttu-id="2db6f-180">**Standaard projectbestanden voor .NET-opdrachtregel**</span><span class="sxs-lookup"><span data-stu-id="2db6f-180">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="2db6f-181">`App.config`: De standaard .NET toepassingsconfiguratiebestand.</span><span class="sxs-lookup"><span data-stu-id="2db6f-181">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="2db6f-182">`Packages.config`: Standaard bestand NuGet-pakket voor afhankelijkheid.</span><span class="sxs-lookup"><span data-stu-id="2db6f-182">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="2db6f-183">`Program.cs`: De programma-toegangspunt en op het hoogste niveau uitzonderingsverwerking bevat.</span><span class="sxs-lookup"><span data-stu-id="2db6f-183">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

### <a name="implementing-the-job-splitter"></a><span data-ttu-id="2db6f-184">Implementatie van de splitser taak</span><span class="sxs-lookup"><span data-stu-id="2db6f-184">Implementing the job splitter</span></span>
<span data-ttu-id="2db6f-185">Wanneer u het sjabloonproject Taakbeheer opent, wordt in het project het standaard geopend JobSplitter.cs-bestand hebben.</span><span class="sxs-lookup"><span data-stu-id="2db6f-185">When you open the Job Manager template project, the project will have the JobSplitter.cs file open by default.</span></span> <span data-ttu-id="2db6f-186">U kunt de split-logica voor de taken in uw werkbelasting implementeren met behulp van het onderstaande Split() methode weergeven:</span><span class="sxs-lookup"><span data-stu-id="2db6f-186">You can implement the split logic for the tasks in your workload by using the Split() method show below:</span></span>

```csharp
/// <summary>
/// Gets the tasks into which to split the job. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The job manager framework invokes the Split method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and the "yield return" statement; this allows tasks to be added
/// and to start running while splitting is still in progress.
/// </summary>
/// <returns>The tasks to be added to the job. Tasks are added automatically
/// by the job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for the split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

> [!NOTE]
> <span data-ttu-id="2db6f-187">De sectie aantekeningen in de `Split()` methode is het alleen-lezen gedeelte van de sjablooncode van de Job Manager-die is bedoeld voor u om te wijzigen door de logica toe te voegen aan uw taken splitsen in verschillende taken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-187">The annotated section in the `Split()` method is the only section of the Job Manager template code that is intended for you to modify by adding the logic to split your jobs into different tasks.</span></span> <span data-ttu-id="2db6f-188">Als u een andere sectie van de sjabloon wijzigt wilt, zorg ervoor dat u met Batch werking, zijn familiarized en probeer uit slechts enkele van de [Batch-codevoorbeelden][github_samples].</span><span class="sxs-lookup"><span data-stu-id="2db6f-188">If you want to modify a different section of the template, please ensure you are familiarized with how Batch works, and try out a few of the [Batch code samples][github_samples].</span></span>
> 
> 

<span data-ttu-id="2db6f-189">Uw implementatie Split() heeft toegang tot:</span><span class="sxs-lookup"><span data-stu-id="2db6f-189">Your Split() implementation has access to:</span></span>

* <span data-ttu-id="2db6f-190">De taakparameters via de `_parameters` veld.</span><span class="sxs-lookup"><span data-stu-id="2db6f-190">The job parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="2db6f-191">Het CloudJob-object dat de taak vertegenwoordigt de `_job` veld.</span><span class="sxs-lookup"><span data-stu-id="2db6f-191">The CloudJob object representing the job, via the `_job` field.</span></span>
* <span data-ttu-id="2db6f-192">Het CloudTask-object dat de jobbeheertaak vertegenwoordigt de `_jobManagerTask` veld.</span><span class="sxs-lookup"><span data-stu-id="2db6f-192">The CloudTask object representing the job manager task, via the `_jobManagerTask` field.</span></span>

<span data-ttu-id="2db6f-193">Uw `Split()` implementatie hoeft niet rechtstreeks taken toevoegen aan de taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-193">Your `Split()` implementation does not need to add tasks to the job directly.</span></span> <span data-ttu-id="2db6f-194">In plaats daarvan een reeks CloudTask objecten in uw code moet worden geretourneerd en worden deze toegevoegd aan de job automatisch door de framework-klassen die gebruikmaken van de splitser taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-194">Instead, your code should return a sequence of CloudTask objects, and these will be added to the job automatically by the framework classes that invoke the job splitter.</span></span> <span data-ttu-id="2db6f-195">Wordt meestal gebruik van C# iterator (`yield return`) functie taak splitsbalken implementeren, zoals Hierdoor kan de taken te starten in zo snel mogelijk worden uitgevoerd in plaats van wachten tot alle taken moet worden berekend.</span><span class="sxs-lookup"><span data-stu-id="2db6f-195">It's common to use C#'s iterator (`yield return`) feature to implement job splitters as this allows the tasks to start running as soon as possible rather than waiting for all tasks to be calculated.</span></span>

<span data-ttu-id="2db6f-196">**Taak splitser is mislukt**</span><span class="sxs-lookup"><span data-stu-id="2db6f-196">**Job splitter failure**</span></span>

<span data-ttu-id="2db6f-197">Als de splitser taak er een fout optreedt, moet deze ofwel het volgende doen:</span><span class="sxs-lookup"><span data-stu-id="2db6f-197">If your job splitter encounters an error, it should either:</span></span>

* <span data-ttu-id="2db6f-198">Beëindigen van de reeks met de C# `yield break` -instructie waarin geval de manager van de taak wordt beschouwd als geslaagd; of</span><span class="sxs-lookup"><span data-stu-id="2db6f-198">Terminate the sequence using the C# `yield break` statement, in which case the job manager will be treated as successful; or</span></span>
* <span data-ttu-id="2db6f-199">Veroorzaak een uitzondering, waarin de taak manager case wordt beschouwd als mislukt en mogelijk opnieuw worden geprobeerd, afhankelijk van hoe de client deze heeft geconfigureerd).</span><span class="sxs-lookup"><span data-stu-id="2db6f-199">Throw an exception, in which case the job manager will be treated as failed and may be retried depending on how the client has configured it).</span></span>

<span data-ttu-id="2db6f-200">In beide gevallen worden alle taken die al worden geretourneerd door de splitser taak en toegevoegd aan de batchverwerking kunnen worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-200">In both cases, any tasks already returned by the job splitter and added to the Batch job will be eligible to run.</span></span> <span data-ttu-id="2db6f-201">Als u niet wilt dat dit gebeurt, klikt u vervolgens kunt u:</span><span class="sxs-lookup"><span data-stu-id="2db6f-201">If you don't want this to happen, then you could:</span></span>

* <span data-ttu-id="2db6f-202">De taak beëindigen voordat u terugkeert uit de splitser taak</span><span class="sxs-lookup"><span data-stu-id="2db6f-202">Terminate the job before returning from the job splitter</span></span>
* <span data-ttu-id="2db6f-203">De verzameling gehele taak voordat deze wordt teruggezonden formuleren (dat wil zeggen, retourneren een `ICollection<CloudTask>` of `IList<CloudTask>` in plaats van de implementatie van uw taak splitser met behulp van een iterator C#)</span><span class="sxs-lookup"><span data-stu-id="2db6f-203">Formulate the entire task collection before returning it (that is, return an `ICollection<CloudTask>` or `IList<CloudTask>` instead of implementing your job splitter using a C# iterator)</span></span>
* <span data-ttu-id="2db6f-204">Taakafhankelijkheden zouden gebruiken om alle taken die afhankelijk zijn van de voltooiing van de job manager</span><span class="sxs-lookup"><span data-stu-id="2db6f-204">Use task dependencies to make all tasks depend on the successful completion of the job manager</span></span>

<span data-ttu-id="2db6f-205">**Nieuwe pogingen van Job manager**</span><span class="sxs-lookup"><span data-stu-id="2db6f-205">**Job manager retries**</span></span>

<span data-ttu-id="2db6f-206">Als de manager van de taak is mislukt, mogelijk opnieuw door de Batch-service, afhankelijk van de instellingen van de client opnieuw worden uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-206">If the job manager fails, it may be retried by the Batch service depending on the client retry settings.</span></span> <span data-ttu-id="2db6f-207">Dit is in het algemeen veilig, omdat wanneer het framework taken aan de taak toevoegt, worden alle taken die al bestaan genegeerd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-207">In general, this is safe, because when the framework adds tasks to the job, it ignores any tasks that already exist.</span></span> <span data-ttu-id="2db6f-208">Echter, als het berekenen van taken dure is, mogelijk niet wilt u de kosten van de taken die al zijn toegevoegd aan de taak; herberekenen in rekening gebracht Als u daarentegen als het opnieuw uitvoeren kan niet worden gegarandeerd voor het genereren van de dezelfde taak-id's wordt vervolgens het negeren van duplicaten gedrag niet starten.</span><span class="sxs-lookup"><span data-stu-id="2db6f-208">However, if calculating tasks is expensive, you may not wish to incur the cost of recalculating tasks that have already been added to the job; conversely, if the re-run is not guaranteed to generate the same task IDs then the 'ignore duplicates' behavior will not kick in.</span></span> <span data-ttu-id="2db6f-209">In dergelijke gevallen moet u uw splitser taak voor het detecteren van het werk dat al is uitgevoerd en wordt niet herhaald, bijvoorbeeld door het uitvoeren van een CloudJob.ListTasks voordat u begint met het rendement van taken ontwerpen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-209">In these cases you should design your job splitter to detect the work that has already been done and not repeat it, for example by performing a CloudJob.ListTasks before starting to yield tasks.</span></span>

### <a name="exit-codes-and-exceptions-in-the-job-manager-template"></a><span data-ttu-id="2db6f-210">Afsluitcodes en uitzonderingen in de sjabloon Job Manager</span><span class="sxs-lookup"><span data-stu-id="2db6f-210">Exit codes and exceptions in the Job Manager template</span></span>
<span data-ttu-id="2db6f-211">Afsluitcodes en uitzonderingen bieden een mechanisme om te bepalen van het resultaat van het programma uitvoeren en ze kunnen helpen bij het identificeren van problemen met de uitvoering van het programma.</span><span class="sxs-lookup"><span data-stu-id="2db6f-211">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help to identify any problems with the execution of the program.</span></span> <span data-ttu-id="2db6f-212">De sjabloon Job Manager implementeert de afsluitcodes en uitzonderingen in deze sectie beschreven.</span><span class="sxs-lookup"><span data-stu-id="2db6f-212">The Job Manager template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="2db6f-213">Een jobbeheertaak die wordt geïmplementeerd met de Job Manager-sjabloon kunt drie mogelijke afsluitcodes retourneren:</span><span class="sxs-lookup"><span data-stu-id="2db6f-213">A job manager task that is implemented with the Job Manager template can return three possible exit codes:</span></span>

| <span data-ttu-id="2db6f-214">Code</span><span class="sxs-lookup"><span data-stu-id="2db6f-214">Code</span></span> | <span data-ttu-id="2db6f-215">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="2db6f-215">Description</span></span> |
| --- | --- |
| <span data-ttu-id="2db6f-216">0</span><span class="sxs-lookup"><span data-stu-id="2db6f-216">0</span></span> |<span data-ttu-id="2db6f-217">De taak manager is voltooid.</span><span class="sxs-lookup"><span data-stu-id="2db6f-217">The job manager completed successfully.</span></span> <span data-ttu-id="2db6f-218">De code van de splitser taak uitgevoerd worden voltooid en alle taken zijn toegevoegd aan de taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-218">Your job splitter code ran to completion, and all tasks were added to the job.</span></span> |
| <span data-ttu-id="2db6f-219">1</span><span class="sxs-lookup"><span data-stu-id="2db6f-219">1</span></span> |<span data-ttu-id="2db6f-220">De jobbeheertaak is mislukt met een uitzondering in een 'verwachte' deel van het programma.</span><span class="sxs-lookup"><span data-stu-id="2db6f-220">The job manager task failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="2db6f-221">De uitzondering is vertaald naar een JobManagerException met diagnostische gegevens en, indien mogelijk, suggesties voor het oplossen van de fout.</span><span class="sxs-lookup"><span data-stu-id="2db6f-221">The exception was translated to a JobManagerException with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="2db6f-222">2</span><span class="sxs-lookup"><span data-stu-id="2db6f-222">2</span></span> |<span data-ttu-id="2db6f-223">De jobbeheertaak is mislukt met een 'onverwachte'-uitzondering.</span><span class="sxs-lookup"><span data-stu-id="2db6f-223">The job manager task failed with an 'unexpected' exception.</span></span> <span data-ttu-id="2db6f-224">De uitzondering is vastgelegd in het logboek voor standaarduitvoer, maar de manager van de taak is niet toegevoegd eventuele aanvullende informatie voor diagnose of herstel.</span><span class="sxs-lookup"><span data-stu-id="2db6f-224">The exception was logged to standard output, but the job manager was unable to add any additional diagnostic or remediation information.</span></span> |

<span data-ttu-id="2db6f-225">In het geval van een taak manager taak is mislukt, kunnen sommige taken nog steeds zijn toegevoegd aan de service voordat de fout is opgetreden.</span><span class="sxs-lookup"><span data-stu-id="2db6f-225">In the case of job manager task failure, some tasks may still have been added to the service before the error occurred.</span></span> <span data-ttu-id="2db6f-226">Deze taken worden uitgevoerd die normaal werken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-226">These tasks will run as normal.</span></span> <span data-ttu-id="2db6f-227">Zie 'Splitser taakfout' hierboven voor bespreking van dit codepad.</span><span class="sxs-lookup"><span data-stu-id="2db6f-227">See "Job Splitter Failure" above for discussion of this code path.</span></span>

<span data-ttu-id="2db6f-228">Alle informatie die wordt geretourneerd door uitzonderingen is geschreven in stdout.txt en stderr.txt-bestanden.</span><span class="sxs-lookup"><span data-stu-id="2db6f-228">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="2db6f-229">Zie voor meer informatie [fouten afhandelen](batch-api-basics.md#error-handling).</span><span class="sxs-lookup"><span data-stu-id="2db6f-229">For more information, see [Error Handling](batch-api-basics.md#error-handling).</span></span>

### <a name="client-considerations"></a><span data-ttu-id="2db6f-230">Overwegingen voor clients</span><span class="sxs-lookup"><span data-stu-id="2db6f-230">Client considerations</span></span>
<span data-ttu-id="2db6f-231">Deze sectie beschrijft de vereisten voor een implementatie van de client wanneer een job manager op basis van deze sjabloon wordt aangeroepen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-231">This section describes some client implementation requirements when invoking a job manager based on this template.</span></span> <span data-ttu-id="2db6f-232">Zie [parameters en variabelen doorgeven van de clientcode](#pass-environment-settings) voor meer informatie over parameters en omgevingsinstellingen wordt doorgegeven.</span><span class="sxs-lookup"><span data-stu-id="2db6f-232">See [How to pass parameters and environment variables from the client code](#pass-environment-settings) for details on passing parameters and environment settings.</span></span>

<span data-ttu-id="2db6f-233">**Verplichte referenties**</span><span class="sxs-lookup"><span data-stu-id="2db6f-233">**Mandatory credentials**</span></span>

<span data-ttu-id="2db6f-234">De jobbeheertaak vereist om de taken toevoegen aan de Azure Batch-taak, de URL van de Azure Batch-account en -sleutel.</span><span class="sxs-lookup"><span data-stu-id="2db6f-234">In order to add tasks to the Azure Batch job, the job manager task requires your Azure Batch account URL and key.</span></span> <span data-ttu-id="2db6f-235">U moet deze in de omgevingsvariabelen met de naam YOUR_BATCH_URL en YOUR_BATCH_KEY doorgeven.</span><span class="sxs-lookup"><span data-stu-id="2db6f-235">You must pass these in environment variables named YOUR_BATCH_URL and YOUR_BATCH_KEY.</span></span> <span data-ttu-id="2db6f-236">U kunt deze Job Manager instellen omgevingsinstellingen voor taken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-236">You can set these in the Job Manager task environment settings.</span></span> <span data-ttu-id="2db6f-237">Bijvoorbeeld in een C#-client:</span><span class="sxs-lookup"><span data-stu-id="2db6f-237">For example, in a C# client:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
<span data-ttu-id="2db6f-238">**Storage-referenties**</span><span class="sxs-lookup"><span data-stu-id="2db6f-238">**Storage credentials**</span></span>

<span data-ttu-id="2db6f-239">De client hoeft normaal gesproken niet te bieden de referenties van gekoppelde opslagaccount naar de jobbeheertaak omdat (a) meeste taak managers niet hoeven te expliciet toegang tot het gekoppelde opslagaccount en (b) het gekoppelde opslagaccount vaak is opgegeven voor alle taken als een algemene omgevingsinstelling voor de taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-239">Typically, the client does not need to provide the linked storage account credentials to the job manager task because (a) most job managers do not need to explicitly access the linked storage account and (b) the linked storage account is often provided to all tasks as a common environment setting for the job.</span></span> <span data-ttu-id="2db6f-240">Als u de gekoppelde storage-account via de algemene omgevingsinstellingen voor de niet opgeeft, en de manager van de taak toegang tot de gekoppelde opslag vereist, moet u opgeven de referenties van de gekoppelde opslag als volgt:</span><span class="sxs-lookup"><span data-stu-id="2db6f-240">If you are not providing the linked storage account via the common environment settings, and the job manager requires access to linked storage, then you should supply the linked storage credentials as follows:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="2db6f-241">**Instellingen voor de taken van Job manager**</span><span class="sxs-lookup"><span data-stu-id="2db6f-241">**Job manager task settings**</span></span>

<span data-ttu-id="2db6f-242">De client moet de manager van de taak ingesteld *killJobOnCompletion* markering **false**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-242">The client should set the job manager *killJobOnCompletion* flag to **false**.</span></span>

<span data-ttu-id="2db6f-243">Het is doorgaans veilig voor de client in te stellen *runExclusive* naar **false**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-243">It is usually safe for the client to set *runExclusive* to **false**.</span></span>

<span data-ttu-id="2db6f-244">De client moet gebruiken de *resourceFiles* of *applicationPackageReferences* verzameling om te zorgen dat de taak manager uitvoerbare (en de vereiste DLL's) naar het rekenknooppunt wordt geïmplementeerd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-244">The client should use the *resourceFiles* or *applicationPackageReferences* collection to have the job manager executable (and its required DLLs) deployed to the compute node.</span></span>

<span data-ttu-id="2db6f-245">Standaard de manager van de taak wordt niet opnieuw worden uitgevoerd als deze uitvalt.</span><span class="sxs-lookup"><span data-stu-id="2db6f-245">By default, the job manager will not be retried if it fails.</span></span> <span data-ttu-id="2db6f-246">Afhankelijk van uw job manager logica, de client mogelijk wilt inschakelen pogingen via *beperkingen*/*maxTaskRetryCount*.</span><span class="sxs-lookup"><span data-stu-id="2db6f-246">Depending on your job manager logic, the client may want to enable retries via *constraints*/*maxTaskRetryCount*.</span></span>

<span data-ttu-id="2db6f-247">**Instellingen van de taak**</span><span class="sxs-lookup"><span data-stu-id="2db6f-247">**Job settings**</span></span>

<span data-ttu-id="2db6f-248">Als de splitser taak taken met afhankelijkheden verzendt, moet de client van de taak usesTaskDependencies ingesteld op true.</span><span class="sxs-lookup"><span data-stu-id="2db6f-248">If the job splitter emits tasks with dependencies, the client must set the job's usesTaskDependencies to true.</span></span>

<span data-ttu-id="2db6f-249">In het model van de splitser taak is het ongebruikelijk voor clients wilt taken toevoegen aan taken dan wat de splitser taak maakt.</span><span class="sxs-lookup"><span data-stu-id="2db6f-249">In the job splitter model, it is unusual for clients to wish to add tasks to jobs over and above what the job splitter creates.</span></span> <span data-ttu-id="2db6f-250">De taak moet daarom normaal ingesteld door de client *onAllTasksComplete* naar **terminatejob**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-250">The client should therefore normally set the job's *onAllTasksComplete* to **terminatejob**.</span></span>

## <a name="task-processor-template"></a><span data-ttu-id="2db6f-251">Sjabloon voor taak-Processor</span><span class="sxs-lookup"><span data-stu-id="2db6f-251">Task Processor template</span></span>
<span data-ttu-id="2db6f-252">Een sjabloon taak Processor helpt u bij het implementeren van een taak processor die u kunt de volgende acties uitvoeren:</span><span class="sxs-lookup"><span data-stu-id="2db6f-252">A Task Processor template helps you to implement a task processor that can perform the following actions:</span></span>

* <span data-ttu-id="2db6f-253">Instellen van de informatie die door elke Batch-taak moet uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="2db6f-253">Set up the information required by each Batch task to run.</span></span>
* <span data-ttu-id="2db6f-254">Alle acties die zijn vereist voor elke Batch-taak uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-254">Run all actions required by each Batch task.</span></span>
* <span data-ttu-id="2db6f-255">Sla taak uitvoer naar de permanente opslag.</span><span class="sxs-lookup"><span data-stu-id="2db6f-255">Save task outputs to persistent storage.</span></span>

<span data-ttu-id="2db6f-256">Hoewel een processor van de taak niet vereist is voor het uitvoeren van taken in Batch, is het belangrijkste voordeel van een processor van de taak dat deze een wrapper biedt voor het implementeren van alle acties van de taak kan worden uitgevoerd op één locatie.</span><span class="sxs-lookup"><span data-stu-id="2db6f-256">Although a task processor is not required to run tasks on Batch, the key advantage of using a task processor is that it provides a wrapper to implement all task execution actions in one location.</span></span> <span data-ttu-id="2db6f-257">Bijvoorbeeld, moet u meerdere toepassingen in de context van de afzonderlijke taken uitvoeren of als u wilt kopiëren van gegevens naar de permanente opslag na het voltooien van elke taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-257">For example, if you need to run several applications in the context of each task, or if you need to copy data to persistent storage after completing each task.</span></span>

<span data-ttu-id="2db6f-258">De acties die worden uitgevoerd door de processor van de taak kunnen worden als eenvoudig of complex zijn, en zo veel of weinig, zoals vereist door uw workload.</span><span class="sxs-lookup"><span data-stu-id="2db6f-258">The actions performed by the task processor can be as simple or complex, and as many or as few, as required by your workload.</span></span> <span data-ttu-id="2db6f-259">Bovendien door het implementeren van alle acties in de taak in één taak processor, kunt u direct bijwerken of toevoegen acties op basis van wijzigingen naar toepassingen of werklastvereisten.</span><span class="sxs-lookup"><span data-stu-id="2db6f-259">Additionally, by implementing all task actions into one task processor, you can readily update or add actions based on changes to applications or workload requirements.</span></span> <span data-ttu-id="2db6f-260">Echter, in sommige gevallen een processor van de taak mogelijk niet de optimale oplossing voor uw implementatie als deze onnodige complexiteit, bijvoorbeeld wanneer de uitvoering van taken die snel kunnen worden gestart vanaf een opdrachtregel eenvoudig kunt toevoegen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-260">However, in some cases a task processor might not be the optimal solution for your implementation as it can add unnecessary complexity, for example when running jobs that can be quickly started from a simple command line.</span></span>

### <a name="create-a-task-processor-using-the-template"></a><span data-ttu-id="2db6f-261">De Processor van een taak met de sjabloon maken</span><span class="sxs-lookup"><span data-stu-id="2db6f-261">Create a Task Processor using the template</span></span>
<span data-ttu-id="2db6f-262">Als de processor van een taak toevoegen aan de oplossing die u eerder hebt gemaakt, de volgende stappen uit:</span><span class="sxs-lookup"><span data-stu-id="2db6f-262">To add a task processor to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="2db6f-263">Open uw bestaande oplossing in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2db6f-263">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="2db6f-264">Klik in Solution Explorer met de rechtermuisknop op de oplossing, klikt u op **toevoegen**, en klik vervolgens op **nieuw Project**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-264">In Solution Explorer, right-click the solution, click **Add**, and then click **New Project**.</span></span>
3. <span data-ttu-id="2db6f-265">Onder **Visual C#**, klikt u op **Cloud**, en klik vervolgens op **Azure Batch-taak Processor**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-265">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Task Processor**.</span></span>
4. <span data-ttu-id="2db6f-266">Typ een naam waarmee u een beschrijving van uw toepassing en geeft aan dit project (bijvoorbeeld als de taak-processor 'LitwareTaskProcessor').</span><span class="sxs-lookup"><span data-stu-id="2db6f-266">Type a name that describes your application and identifies this project as the task processor (e.g. "LitwareTaskProcessor").</span></span>
5. <span data-ttu-id="2db6f-267">Klik op om het project **OK**.</span><span class="sxs-lookup"><span data-stu-id="2db6f-267">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="2db6f-268">Bouw ten slotte het project om af te dwingen van Visual Studio laden alle waarnaar wordt verwezen NuGet-pakketten en om te controleren of het project geldig is voordat u begint met het wijzigen van deze.</span><span class="sxs-lookup"><span data-stu-id="2db6f-268">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="task-processor-template-files-and-their-purpose"></a><span data-ttu-id="2db6f-269">Taak Processor sjabloonbestanden en hun doel</span><span class="sxs-lookup"><span data-stu-id="2db6f-269">Task Processor template files and their purpose</span></span>
<span data-ttu-id="2db6f-270">Wanneer u een project met de taak processor-sjabloon maakt, genereert het codebestanden drie groepen:</span><span class="sxs-lookup"><span data-stu-id="2db6f-270">When you create a project using the task processor template, it generates three groups of code files:</span></span>

* <span data-ttu-id="2db6f-271">Het belangrijkste programmabestand (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="2db6f-271">The main program file (Program.cs).</span></span> <span data-ttu-id="2db6f-272">Dit document bevat de programma-ingangspunt en uitzonderingsverwerking op het hoogste niveau.</span><span class="sxs-lookup"><span data-stu-id="2db6f-272">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="2db6f-273">U mag niet normaal gesproken moet dit wijzigen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-273">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="2db6f-274">De Framework-map.</span><span class="sxs-lookup"><span data-stu-id="2db6f-274">The Framework directory.</span></span> <span data-ttu-id="2db6f-275">Dit bevat de bestanden die verantwoordelijk is voor het 'standaard'-werk dat door het programma job manager – uitpakken van de parameters, taken toe te voegen aan de Batch-job, enzovoort. U mag niet normaal gesproken moet deze bestanden wijzigen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-275">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="2db6f-276">De taak processor-bestand (TaskProcessor.cs).</span><span class="sxs-lookup"><span data-stu-id="2db6f-276">The task processor file (TaskProcessor.cs).</span></span> <span data-ttu-id="2db6f-277">Dit is waar u uw toepassingsspecifieke logica voor het uitvoeren van een taak (doorgaans door bellen naar een bestaand uitvoerbaar bestand) wordt geplaatst.</span><span class="sxs-lookup"><span data-stu-id="2db6f-277">This is where you will put your application-specific logic for executing a task (typically by calling out to an existing executable).</span></span> <span data-ttu-id="2db6f-278">Vóór en na verwerking komt, zoals aanvullende gegevens te downloaden of uploaden van bestanden met resultaten, ook hier code.</span><span class="sxs-lookup"><span data-stu-id="2db6f-278">Pre- and post-processing code, such as downloading additional data or uploading result files, also goes here.</span></span>

<span data-ttu-id="2db6f-279">Natuurlijk kunt u aanvullende bestanden toevoegen als vereist ter ondersteuning van uw taak processor code, afhankelijk van de complexiteit van de taak logica splitsen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-279">Of course you can add additional files as required to support your task processor code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="2db6f-280">De sjabloon genereert ook standaard .NET projectbestanden zoals een .csproj-bestand, app.config, packages.config, enz.</span><span class="sxs-lookup"><span data-stu-id="2db6f-280">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="2db6f-281">De rest van deze sectie beschrijft de verschillende bestanden en de codestructuur en wordt uitgelegd wat elke klasse doet.</span><span class="sxs-lookup"><span data-stu-id="2db6f-281">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Visual Studio Solution Explorer met de sjabloon-oplossing taak-Processor][solution_explorer02]

<span data-ttu-id="2db6f-283">**Framework-bestanden**</span><span class="sxs-lookup"><span data-stu-id="2db6f-283">**Framework files**</span></span>

* <span data-ttu-id="2db6f-284">`Configuration.cs`: Het laden van gegevens van de taak configuratie zoals details van de Batch-account, gekoppelde opslagaccountreferenties taak en taakgegevens en taakparameters ingekapseld.</span><span class="sxs-lookup"><span data-stu-id="2db6f-284">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="2db6f-285">Bovendien wordt toegang tot Batch gedefinieerde omgevingsvariabelen (Zie omgevingsinstellingen voor taken in de documentatie van de Batch) via de Configuration.EnvironmentVariable-klasse.</span><span class="sxs-lookup"><span data-stu-id="2db6f-285">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="2db6f-286">`IConfiguration.cs`: Hiermee isoleert de implementatie van de Configuration-klasse, zodat u kunt testen van eenheden uw taak splitser met behulp van een valse of mock configuration-object.</span><span class="sxs-lookup"><span data-stu-id="2db6f-286">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="2db6f-287">`TaskProcessorException.cs`: Hiermee geeft u een fout is van de manager van de taak is beëindigd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-287">`TaskProcessorException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="2db6f-288">TaskProcessorException wordt laten teruglopen 'verwachte' fouten waarin specifieke diagnostische informatie kan worden opgegeven als onderdeel van de beëindiging gebruikt.</span><span class="sxs-lookup"><span data-stu-id="2db6f-288">TaskProcessorException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>

<span data-ttu-id="2db6f-289">**Taak-Processor**</span><span class="sxs-lookup"><span data-stu-id="2db6f-289">**Task Processor**</span></span>

* <span data-ttu-id="2db6f-290">`TaskProcessor.cs`: De taak wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="2db6f-290">`TaskProcessor.cs`: Runs the task.</span></span> <span data-ttu-id="2db6f-291">Het framework roept de methode TaskProcessor.Run.</span><span class="sxs-lookup"><span data-stu-id="2db6f-291">The framework invokes the TaskProcessor.Run method.</span></span> <span data-ttu-id="2db6f-292">Dit is de klasse waarop u de toepassingsspecifieke logica van de taak wordt invoeren.</span><span class="sxs-lookup"><span data-stu-id="2db6f-292">This is the class where you will inject the application-specific logic of your task.</span></span> <span data-ttu-id="2db6f-293">De methode uitvoeren om te implementeren:</span><span class="sxs-lookup"><span data-stu-id="2db6f-293">Implement the Run method to:</span></span>
  * <span data-ttu-id="2db6f-294">Parseren en valideer de taakparameters van een</span><span class="sxs-lookup"><span data-stu-id="2db6f-294">Parse and validate any task parameters</span></span>
  * <span data-ttu-id="2db6f-295">De opdrachtregel voor een extern programma dat u wilt aanroepen opstellen</span><span class="sxs-lookup"><span data-stu-id="2db6f-295">Compose the command line for any external program you want to invoke</span></span>
  * <span data-ttu-id="2db6f-296">Meld u diagnostische informatie die hebt u mogelijk nodig voor foutopsporing</span><span class="sxs-lookup"><span data-stu-id="2db6f-296">Log any diagnostic information you may require for debugging purposes</span></span>
  * <span data-ttu-id="2db6f-297">Een proces starten met deze opdrachtregel</span><span class="sxs-lookup"><span data-stu-id="2db6f-297">Start a process using that command line</span></span>
  * <span data-ttu-id="2db6f-298">Wacht totdat het proces om af te sluiten</span><span class="sxs-lookup"><span data-stu-id="2db6f-298">Wait for the process to exit</span></span>
  * <span data-ttu-id="2db6f-299">Vastleggen van de afsluitcode van het proces om te bepalen of deze is geslaagd of mislukt</span><span class="sxs-lookup"><span data-stu-id="2db6f-299">Capture the exit code of the process to determine if it succeeded or failed</span></span>
  * <span data-ttu-id="2db6f-300">Sla alle uitvoerbestanden die u wilt behouden voor permanente opslag</span><span class="sxs-lookup"><span data-stu-id="2db6f-300">Save any output files you want to keep to persistent storage</span></span>

<span data-ttu-id="2db6f-301">**Standaard projectbestanden voor .NET-opdrachtregel**</span><span class="sxs-lookup"><span data-stu-id="2db6f-301">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="2db6f-302">`App.config`: De standaard .NET toepassingsconfiguratiebestand.</span><span class="sxs-lookup"><span data-stu-id="2db6f-302">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="2db6f-303">`Packages.config`: Standaard bestand NuGet-pakket voor afhankelijkheid.</span><span class="sxs-lookup"><span data-stu-id="2db6f-303">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="2db6f-304">`Program.cs`: De programma-toegangspunt en op het hoogste niveau uitzonderingsverwerking bevat.</span><span class="sxs-lookup"><span data-stu-id="2db6f-304">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

## <a name="implementing-the-task-processor"></a><span data-ttu-id="2db6f-305">Implementatie van de taak-processor</span><span class="sxs-lookup"><span data-stu-id="2db6f-305">Implementing the task processor</span></span>
<span data-ttu-id="2db6f-306">Wanneer u de taak Processor sjabloonproject opent, wordt in het project het standaard geopend TaskProcessor.cs-bestand hebben.</span><span class="sxs-lookup"><span data-stu-id="2db6f-306">When you open the Task Processor template project, the project will have the TaskProcessor.cs file open by default.</span></span> <span data-ttu-id="2db6f-307">De uitvoering logica voor de taken kunt u implementeren in uw werkbelasting met behulp van de methode Run() hieronder wordt weergegeven:</span><span class="sxs-lookup"><span data-stu-id="2db6f-307">You can implement the run logic for the tasks in your workload by using the Run() method shown below:</span></span>

```csharp
/// <summary>
/// Runs the task processing logic. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The task processor framework invokes the Run method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check the exit code of that program and
/// save output files to persistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for the task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
> [!NOTE]
> <span data-ttu-id="2db6f-308">De sectie aantekeningen in de methode Run() is het alleen-lezen gedeelte van de taak Processor sjabloon-code die is bedoeld voor u door het toevoegen van de uitgevoerde instructies voor de taken in uw werkbelasting te wijzigen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-308">The annotated section in the Run() method is the only section of the Task Processor template code that is intended for you to modify by adding the run logic for the tasks in your workload.</span></span> <span data-ttu-id="2db6f-309">Als u wijzigen van een andere sectie van de sjabloon wilt, moet eerst raken met de werking van Batch door de documentatie van de Batch controleren en enkele van de Batch-codevoorbeelden uitprobeert.</span><span class="sxs-lookup"><span data-stu-id="2db6f-309">If you want to modify a different section of the template, please first familiarize yourself with how Batch works by reviewing the Batch documentation and trying out a few of the Batch code samples.</span></span>
> 
> 

<span data-ttu-id="2db6f-310">De methode Run() is verantwoordelijk voor het starten van de opdrachtregel voor het starten van een of meer processen, wacht tot alle proces te voltooien, de resultaten worden opgeslagen en ten slotte te retourneren met de afsluitcode.</span><span class="sxs-lookup"><span data-stu-id="2db6f-310">The Run() method is responsible for launching the command line, starting one or more processes, waiting for all process to complete, saving the results, and finally returning with an exit code.</span></span> <span data-ttu-id="2db6f-311">De methode Run() is waar u de verwerking van logica implementeren voor uw taken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-311">The Run() method is where you implement the processing logic for your tasks.</span></span> <span data-ttu-id="2db6f-312">De taak processor framework roept de methode Run() voor u; u hoeft niet zelf aanroepen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-312">The task processor framework invokes the Run() method for you; you do not need to call it yourself.</span></span>

<span data-ttu-id="2db6f-313">Uw implementatie Run() heeft toegang tot:</span><span class="sxs-lookup"><span data-stu-id="2db6f-313">Your Run() implementation has access to:</span></span>

* <span data-ttu-id="2db6f-314">De taakparameters via de `_parameters` veld.</span><span class="sxs-lookup"><span data-stu-id="2db6f-314">The task parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="2db6f-315">De taak en taak-id's, via de `_jobId` en `_taskId` velden.</span><span class="sxs-lookup"><span data-stu-id="2db6f-315">The job and task ids, via the `_jobId` and `_taskId` fields.</span></span>
* <span data-ttu-id="2db6f-316">De taakconfiguratie via de `_configuration` veld.</span><span class="sxs-lookup"><span data-stu-id="2db6f-316">The task configuration, via the `_configuration` field.</span></span>

<span data-ttu-id="2db6f-317">**Taak mislukt**</span><span class="sxs-lookup"><span data-stu-id="2db6f-317">**Task failure**</span></span>

<span data-ttu-id="2db6f-318">In geval van storing, kunt u de methode Run() afsluiten door er een uitzondering is opgetreden, maar dit laat het bovenste niveau uitzonderings-handler de controle over de afsluitcode van de taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-318">In case of failure, you can exit the Run() method by throwing an exception, but this leaves the top level exception handler in control of the task exit code.</span></span> <span data-ttu-id="2db6f-319">Als u de afsluitcode beheren wilt zodat u verschillende soorten mislukt, bijvoorbeeld voor diagnostische doeleinden onderscheiden kunt is of omdat de taak moeten worden beëindigd door een aantal fout-modi en anderen mag niet, moet u sluit de methode Run() door te retourneren van een niet-nul afsluitcode.</span><span class="sxs-lookup"><span data-stu-id="2db6f-319">If you need to control the exit code so that you can distinguish different types of failure, for example for diagnostic purposes or because some failure modes should terminate the job and others should not, then you should exit the Run() method by returning a non-zero exit code.</span></span> <span data-ttu-id="2db6f-320">Dit wordt de afsluitcode van de taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-320">This becomes the task exit code.</span></span>

### <a name="exit-codes-and-exceptions-in-the-task-processor-template"></a><span data-ttu-id="2db6f-321">Afsluitcodes en uitzonderingen in de sjabloon taak Processor</span><span class="sxs-lookup"><span data-stu-id="2db6f-321">Exit codes and exceptions in the Task Processor template</span></span>
<span data-ttu-id="2db6f-322">Afsluitcodes en uitzonderingen bieden een mechanisme om te bepalen van het resultaat van het programma uitvoeren en deze kunt identificeren van problemen met de uitvoering van het programma.</span><span class="sxs-lookup"><span data-stu-id="2db6f-322">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help identify any problems with the execution of the program.</span></span> <span data-ttu-id="2db6f-323">De taak Processor sjabloon implementeert de afsluitcodes en uitzonderingen in deze sectie beschreven.</span><span class="sxs-lookup"><span data-stu-id="2db6f-323">The Task Processor template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="2db6f-324">Processor met een taak die is geïmplementeerd met de taak Processor-sjabloon kunt drie mogelijke afsluitcodes retourneren:</span><span class="sxs-lookup"><span data-stu-id="2db6f-324">A task processor task that is implemented with the Task Processor template can return three possible exit codes:</span></span>

| <span data-ttu-id="2db6f-325">Code</span><span class="sxs-lookup"><span data-stu-id="2db6f-325">Code</span></span> | <span data-ttu-id="2db6f-326">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="2db6f-326">Description</span></span> |
| --- | --- |
| <span data-ttu-id="2db6f-327">[Process.ExitCode][process_exitcode]</span><span class="sxs-lookup"><span data-stu-id="2db6f-327">[Process.ExitCode][process_exitcode]</span></span> |<span data-ttu-id="2db6f-328">De processor van de taak uitgevoerd worden voltooid.</span><span class="sxs-lookup"><span data-stu-id="2db6f-328">The task processor ran to completion.</span></span> <span data-ttu-id="2db6f-329">Let op: dit niet impliceert dat het programma dat u aangeroepen geslaagd – alleen dat de processor van de taak met succes gestart en uitgevoerd na verwerking zonder uitzonderingen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-329">Note that this does not imply that the program you invoked was successful – only that the task processor invoked it successfully and performed any post-processing without exceptions.</span></span> <span data-ttu-id="2db6f-330">De betekenis van de afsluitcode is afhankelijk van het aangeroepen programma – doorgaans afsluitcode 0 betekent dat het programma is voltooid en andere afsluitcode betekent dat het programma is mislukt.</span><span class="sxs-lookup"><span data-stu-id="2db6f-330">The meaning of the exit code depends on the invoked program – typically exit code 0 means the program succeeded and any other exit code means the program failed.</span></span> |
| <span data-ttu-id="2db6f-331">1</span><span class="sxs-lookup"><span data-stu-id="2db6f-331">1</span></span> |<span data-ttu-id="2db6f-332">De processor van de taak is mislukt met een uitzondering in een 'verwachte' deel van het programma.</span><span class="sxs-lookup"><span data-stu-id="2db6f-332">The task processor failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="2db6f-333">De uitzondering is vertaald naar een `TaskProcessorException` met diagnostische gegevens en, indien mogelijk, suggesties voor het oplossen van de fout.</span><span class="sxs-lookup"><span data-stu-id="2db6f-333">The exception was translated to a `TaskProcessorException` with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="2db6f-334">2</span><span class="sxs-lookup"><span data-stu-id="2db6f-334">2</span></span> |<span data-ttu-id="2db6f-335">De processor van de taak is mislukt met een 'onverwachte'-uitzondering.</span><span class="sxs-lookup"><span data-stu-id="2db6f-335">The task processor failed with an 'unexpected' exception.</span></span> <span data-ttu-id="2db6f-336">De uitzondering is vastgelegd in het logboek voor standaarduitvoer, maar de processor van de taak is niet toegevoegd eventuele aanvullende informatie voor diagnose of herstel.</span><span class="sxs-lookup"><span data-stu-id="2db6f-336">The exception was logged to standard output, but the task processor was unable to add any additional diagnostic or remediation information.</span></span> |

> [!NOTE]
> <span data-ttu-id="2db6f-337">Als het programma dat u aanroept afsluitcodes 1 en 2 gebruikt om aan te geven van de specifieke fout modi, is vervolgens met afsluitcodes 1 en 2 voor taak processor fouten dubbelzinnig.</span><span class="sxs-lookup"><span data-stu-id="2db6f-337">If the program you invoke uses exit codes 1 and 2 to indicate specific failure modes, then using exit codes 1 and 2 for task processor errors is ambiguous.</span></span> <span data-ttu-id="2db6f-338">U kunt deze taak processor-foutcodes onderscheidende afsluitcodes wijzigen door de uitzondering aanvragen in het bestand Program.cs te bewerken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-338">You can change these task processor error codes to distinctive exit codes by editing the exception cases in the Program.cs file.</span></span>
> 
> 

<span data-ttu-id="2db6f-339">Alle informatie die wordt geretourneerd door uitzonderingen is geschreven in stdout.txt en stderr.txt-bestanden.</span><span class="sxs-lookup"><span data-stu-id="2db6f-339">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="2db6f-340">Zie de afhandeling van de fout in de Batch-documentatie voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="2db6f-340">For more information, see Error Handling, in the Batch documentation.</span></span>

### <a name="client-considerations"></a><span data-ttu-id="2db6f-341">Overwegingen voor clients</span><span class="sxs-lookup"><span data-stu-id="2db6f-341">Client considerations</span></span>
<span data-ttu-id="2db6f-342">**Storage-referenties**</span><span class="sxs-lookup"><span data-stu-id="2db6f-342">**Storage credentials**</span></span>

<span data-ttu-id="2db6f-343">Als uw taak processor Azure blob storage gebruikt om vast te leggen uitvoer, bijvoorbeeld met behulp van het bestand conventies hulpbibliotheek, dan toegang tot moet *beide* de cloud opslagaccountreferenties *of* een blob container-URL met een shared access signature (SAS).</span><span class="sxs-lookup"><span data-stu-id="2db6f-343">If your task processor uses Azure blob storage to persist outputs, for example using the file conventions helper library, then it needs access to *either* the cloud storage account credentials *or* a blob container URL that includes a shared access signature (SAS).</span></span> <span data-ttu-id="2db6f-344">De sjabloon biedt ondersteuning voor het opgeven van de referenties via algemene omgevingsvariabelen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-344">The template includes support for providing credentials via common environment variables.</span></span> <span data-ttu-id="2db6f-345">De client kan doorgeven de storage-referenties als volgt:</span><span class="sxs-lookup"><span data-stu-id="2db6f-345">Your client can pass the storage credentials as follows:</span></span>

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="2db6f-346">Het opslagaccount is beschikbaar in de klasse TaskProcessor via de `_configuration.StorageAccount` eigenschap.</span><span class="sxs-lookup"><span data-stu-id="2db6f-346">The storage account is then available in the TaskProcessor class via the `_configuration.StorageAccount` property.</span></span>

<span data-ttu-id="2db6f-347">Als u liever een container-URL met SAS gebruiken, kunt u dit ook doorgeven via een gemeenschappelijke omgevingsinstelling van taak, maar de taak processor sjabloon omvat ingebouwde ondersteuning voor dit niet op dit moment.</span><span class="sxs-lookup"><span data-stu-id="2db6f-347">If you prefer to use a container URL with SAS, you can also pass this via an job common environment setting, but the task processor template does not currently include built-in support for this.</span></span>

<span data-ttu-id="2db6f-348">**Setup van opslag**</span><span class="sxs-lookup"><span data-stu-id="2db6f-348">**Storage setup**</span></span>

<span data-ttu-id="2db6f-349">Het wordt aanbevolen dat de taak van de manager-client of de taak geen containers die voor de taken vereist voordat de taken toe te voegen aan de taak maken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-349">It is recommended that the client or job manager task create any containers required by tasks before adding the tasks to the job.</span></span> <span data-ttu-id="2db6f-350">Dit is verplicht dat als u de URL van een container met SAS, als zodanig een URL bevat geen machtiging voor het maken van de container.</span><span class="sxs-lookup"><span data-stu-id="2db6f-350">This is mandatory if you use a container URL with SAS, as such a URL does not include permission to create the container.</span></span> <span data-ttu-id="2db6f-351">Het verdient aanbeveling zelfs als u opslagaccountreferenties, zoals bespaart u elke taak hoeven CloudBlobContainer.CreateIfNotExistsAsync aanroepen voor de container.</span><span class="sxs-lookup"><span data-stu-id="2db6f-351">It is recommended even if you pass storage account credentials, as it saves every task having to call CloudBlobContainer.CreateIfNotExistsAsync on the container.</span></span>

## <a name="pass-parameters-and-environment-variables"></a><span data-ttu-id="2db6f-352">Pass-parameters en variabelen</span><span class="sxs-lookup"><span data-stu-id="2db6f-352">Pass parameters and environment variables</span></span>
### <a name="pass-environment-settings"></a><span data-ttu-id="2db6f-353">Omgevingsinstellingen doorgeven</span><span class="sxs-lookup"><span data-stu-id="2db6f-353">Pass environment settings</span></span>
<span data-ttu-id="2db6f-354">Een client kan informatie doorgeven aan de jobbeheertaak in de vorm van omgevingsinstellingen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-354">A client can pass information to the job manager task in the form of environment settings.</span></span> <span data-ttu-id="2db6f-355">Deze informatie kan vervolgens worden gebruikt door de jobbeheertaak bij het genereren van de taak processor-taken die wordt uitgevoerd als onderdeel van de compute-taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-355">This information can then be used by the job manager task when generating the task processor tasks that will run as part of the compute job.</span></span> <span data-ttu-id="2db6f-356">Voorbeelden van de informatie die u als omgevingsinstellingen doorgeven kunt zijn:</span><span class="sxs-lookup"><span data-stu-id="2db6f-356">Examples of the information that you can pass as environment settings are:</span></span>

* <span data-ttu-id="2db6f-357">Naam en het account toegangscodes voor opslag</span><span class="sxs-lookup"><span data-stu-id="2db6f-357">Storage account name and account keys</span></span>
* <span data-ttu-id="2db6f-358">URL van de batch-account</span><span class="sxs-lookup"><span data-stu-id="2db6f-358">Batch account URL</span></span>
* <span data-ttu-id="2db6f-359">De sleutel van de batch-account</span><span class="sxs-lookup"><span data-stu-id="2db6f-359">Batch account key</span></span>

<span data-ttu-id="2db6f-360">De Batch-service heeft een eenvoudig mechanisme omgevingsinstellingen doorgeven aan een jobbeheertaak met behulp van de `EnvironmentSettings` eigenschap in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span><span class="sxs-lookup"><span data-stu-id="2db6f-360">The Batch service has a simple mechanism to pass environment settings to a job manager task by using the `EnvironmentSettings` property in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span></span>

<span data-ttu-id="2db6f-361">Bijvoorbeeld, om op te halen de `BatchClient` exemplaar voor een Batch-account, kunt u als omgevingsvariabelen van de client de URL en de gedeelde sleutel referenties voor het Batch-account code doorgeven.</span><span class="sxs-lookup"><span data-stu-id="2db6f-361">For example, to get the `BatchClient` instance for a Batch account, you can pass as environment variables from the client code the URL and shared key credentials for the Batch account.</span></span> <span data-ttu-id="2db6f-362">Evenzo voor toegang tot het opslagaccount dat is gekoppeld aan het Batch-account, kunt u de opslagaccountnaam en doorgeven de opslagaccountsleutel als omgevingsvariabelen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-362">Likewise, to access the storage account that is linked to the Batch account, you can pass the storage account name and the storage account key as environment variables.</span></span>

### <a name="pass-parameters-to-the-job-manager-template"></a><span data-ttu-id="2db6f-363">Parameters doorgeven aan de Job Manager-sjabloon</span><span class="sxs-lookup"><span data-stu-id="2db6f-363">Pass parameters to the Job Manager template</span></span>
<span data-ttu-id="2db6f-364">In veel gevallen is het handig voor de per taak parameters doorgeven aan de jobbeheertaak om te bepalen van de taak proces splitsen of voor het configureren van de taken voor de taak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-364">In many cases, it's useful to pass per-job parameters to the job manager task, either to control the job splitting process or to configure the tasks for the job.</span></span> <span data-ttu-id="2db6f-365">U kunt dit doen door het uploaden van een JSON-bestand parameters.json met de naam als een bronbestand voor de jobbeheertaak.</span><span class="sxs-lookup"><span data-stu-id="2db6f-365">You can do this by uploading a JSON file named parameters.json as a resource file for the job manager task.</span></span> <span data-ttu-id="2db6f-366">De parameters kunnen vervolgens beschikbaar gesteld in de `JobSplitter._parameters` veld in de Job Manager-sjabloon.</span><span class="sxs-lookup"><span data-stu-id="2db6f-366">The parameters can then become available in the `JobSplitter._parameters` field in the Job Manager template.</span></span>

> [!NOTE]
> <span data-ttu-id="2db6f-367">De ingebouwde parameter handler ondersteunt alleen string-naar-tekenreeks woordenlijsten.</span><span class="sxs-lookup"><span data-stu-id="2db6f-367">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="2db6f-368">Als u complexe JSON-waarden als parameterwaarden doorgeven wilt, moet u deze poorten als tekenreeksen doorgeven en ze in de splitser taak parseert of te wijzigen van het framework `Configuration.GetJobParameters` methode.</span><span class="sxs-lookup"><span data-stu-id="2db6f-368">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the job splitter, or modify the framework's `Configuration.GetJobParameters` method.</span></span>
> 
> 

### <a name="pass-parameters-to-the-task-processor-template"></a><span data-ttu-id="2db6f-369">Parameters doorgeven aan de sjabloon taak Processor</span><span class="sxs-lookup"><span data-stu-id="2db6f-369">Pass parameters to the Task Processor template</span></span>
<span data-ttu-id="2db6f-370">U kunt ook parameters doorgeven aan de afzonderlijke taken die zijn geïmplementeerd met behulp van de taak Processor-sjabloon.</span><span class="sxs-lookup"><span data-stu-id="2db6f-370">You can also pass parameters to individual tasks implemented using the Task Processor template.</span></span> <span data-ttu-id="2db6f-371">Net zoals met de taak manager-sjabloon de sjabloon voor de taak-processor wordt gezocht naar een resource-bestand met de naam</span><span class="sxs-lookup"><span data-stu-id="2db6f-371">Just as with the job manager template, the task processor template looks for a resource file named</span></span>

<span data-ttu-id="2db6f-372">parameters.JSON, en, indien deze gevonden geladen als de parameters-woordenlijst.</span><span class="sxs-lookup"><span data-stu-id="2db6f-372">parameters.json, and if found it loads it as the parameters dictionary.</span></span> <span data-ttu-id="2db6f-373">Er zijn een aantal opties voor het parameters doorgeven aan de taak processor taken:</span><span class="sxs-lookup"><span data-stu-id="2db6f-373">There are a couple of options for how to pass parameters to the task processor tasks:</span></span>

* <span data-ttu-id="2db6f-374">De taakparameters JSON hergebruiken.</span><span class="sxs-lookup"><span data-stu-id="2db6f-374">Reuse the job parameters JSON.</span></span> <span data-ttu-id="2db6f-375">Dit werkt goed als de enige parameters taak wide (voor bijvoorbeeld een render hoogte en breedte zijn).</span><span class="sxs-lookup"><span data-stu-id="2db6f-375">This works well if the only parameters are job-wide ones (for example, a render height and width).</span></span> <span data-ttu-id="2db6f-376">U doet dit door bij het maken van een CloudTask in de splitser taak, Voeg een verwijzing naar het object parameters.json resource-bestand van de jobbeheertaak ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) aan de CloudTask ResourceFiles verzameling.</span><span class="sxs-lookup"><span data-stu-id="2db6f-376">To do this, when creating a CloudTask in the job splitter, add a reference to the parameters.json resource file object from the job manager task's ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) to the CloudTask's ResourceFiles collection.</span></span>
* <span data-ttu-id="2db6f-377">Genereren en uploaden van een document taakspecifieke parameters.json als onderdeel van de splitser taakuitvoering en verwijzen naar blob in verzameling voor de taak resource files.</span><span class="sxs-lookup"><span data-stu-id="2db6f-377">Generate and upload a task-specific parameters.json document as part of job splitter execution, and reference that blob in the task's resource files collection.</span></span> <span data-ttu-id="2db6f-378">Dit is nodig als u verschillende taken verschillende parameters hebben.</span><span class="sxs-lookup"><span data-stu-id="2db6f-378">This is necessary if different tasks have different parameters.</span></span> <span data-ttu-id="2db6f-379">Een voorbeeld is mogelijk een 3D-rendering scenario waar de frame-index wordt doorgegeven aan de taak als parameter.</span><span class="sxs-lookup"><span data-stu-id="2db6f-379">An example might be a 3D rendering scenario where the frame index is passed to the task as a parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="2db6f-380">De ingebouwde parameter handler ondersteunt alleen string-naar-tekenreeks woordenlijsten.</span><span class="sxs-lookup"><span data-stu-id="2db6f-380">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="2db6f-381">Als u complexe JSON-waarden als parameterwaarden doorgeven wilt, moet u deze poorten als tekenreeksen doorgeven en in de processor van de taak worden geparseerd of te wijzigen van het framework `Configuration.GetTaskParameters` methode.</span><span class="sxs-lookup"><span data-stu-id="2db6f-381">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the task processor, or modify the framework's `Configuration.GetTaskParameters` method.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="2db6f-382">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="2db6f-382">Next steps</span></span>
### <a name="persist-job-and-task-output-to-azure-storage"></a><span data-ttu-id="2db6f-383">Behouden van de taak en uitvoer naar Azure Storage</span><span class="sxs-lookup"><span data-stu-id="2db6f-383">Persist job and task output to Azure Storage</span></span>
<span data-ttu-id="2db6f-384">Een ander handig hulpmiddel in ontwikkeling van de Batch-oplossingen is [Azure Batch-bestand conventies][nuget_package].</span><span class="sxs-lookup"><span data-stu-id="2db6f-384">Another helpful tool in Batch solution development is [Azure Batch File Conventions][nuget_package].</span></span> <span data-ttu-id="2db6f-385">Gebruik deze bibliotheek van de .NET-klasse (momenteel in preview) in uw Batch .NET-toepassingen eenvoudig opslaan en ophalen van de taak uitvoer en naar Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="2db6f-385">Use this .NET class library (currently in preview) in your Batch .NET applications to easily store and retrieve task outputs to and from Azure Storage.</span></span> <span data-ttu-id="2db6f-386">[Azure Batch-taak en uitvoer behouden](batch-task-output.md) bevat een volledige beschrijving van de tapewisselaar en het gebruik ervan.</span><span class="sxs-lookup"><span data-stu-id="2db6f-386">[Persist Azure Batch job and task output](batch-task-output.md) contains a full discussion of the library and its usage.</span></span>

### <a name="batch-forum"></a><span data-ttu-id="2db6f-387">Batch-Forum</span><span class="sxs-lookup"><span data-stu-id="2db6f-387">Batch Forum</span></span>
<span data-ttu-id="2db6f-388">De [Azure Batch-Forum] [ forum] is een goede plaats om te bespreken Batch en vragen over de service op MSDN.</span><span class="sxs-lookup"><span data-stu-id="2db6f-388">The [Azure Batch Forum][forum] on MSDN is a great place to discuss Batch and ask questions about the service.</span></span> <span data-ttu-id="2db6f-389">Kop op via voor nuttige 'een tijdelijke' berichten, en stel uw vragen wanneer deze zich voordoen tijdens het bouwen van uw Batch-oplossingen.</span><span class="sxs-lookup"><span data-stu-id="2db6f-389">Head on over for helpful "sticky" posts, and post your questions as they arise while you build your Batch solutions.</span></span>

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png
