---
title: een Azure Automation-Runbook uit een Log Analytics waarschuwing aaaCalling | Microsoft Docs
description: In dit artikel biedt een overzicht van hoe tooinvoke een Automation-runbook uit een Microsoft OMS Log Analytics-waarschuwing.
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="93263-103">Een Azure Automation-runbook aanroepen vanuit een Log Analytics-waarschuwing</span><span class="sxs-lookup"><span data-stu-id="93263-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="93263-104">Wanneer een waarschuwing is geconfigureerd in logboekanalyse toocreate mislukt record voor een waarschuwing als resultaten overeenkomt met een bepaald criterium, zoals een langdurige piek in de processorgebruik of een bepaalde toepassing proces kritieke toohello functionaliteit van een zakelijke toepassing en een overeenkomende gebeurtenis in het gebeurtenislogboek van Windows hello, schrijft deze waarschuwing kan automatisch een Automation-runbook wordt uitgevoerd in een poging tooauto-Hallo-probleem opgelost.</span><span class="sxs-lookup"><span data-stu-id="93263-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="93263-105">Er zijn twee opties toocall een runbook bij het Hallo-waarschuwing configureren.</span><span class="sxs-lookup"><span data-stu-id="93263-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="93263-106">Met name:</span><span class="sxs-lookup"><span data-stu-id="93263-106">Specifically,</span></span>

1. <span data-ttu-id="93263-107">Een webhook gebruiken.</span><span class="sxs-lookup"><span data-stu-id="93263-107">Using a Webhook.</span></span>
   * <span data-ttu-id="93263-108">Dit is Hallo enige beschikbare optie als de OMS-werkruimte geen gekoppelde tooan Automation-account is.</span><span class="sxs-lookup"><span data-stu-id="93263-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="93263-109">Als u al een Automation-account gekoppeld tooan OMS-werkruimte, wordt deze optie nog steeds beschikbaar is.</span><span class="sxs-lookup"><span data-stu-id="93263-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="93263-110">Een runbook direct selecteren.</span><span class="sxs-lookup"><span data-stu-id="93263-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="93263-111">Deze optie is alleen beschikbaar als Hallo OMS-werkruimte gekoppelde tooan Automation-account.</span><span class="sxs-lookup"><span data-stu-id="93263-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="93263-112">Een runbook aanroepen met behulp van een webhook</span><span class="sxs-lookup"><span data-stu-id="93263-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="93263-113">Een webhook kunt u een bepaald runbook toostart in Azure Automation via één HTTP-aanvraag.</span><span class="sxs-lookup"><span data-stu-id="93263-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="93263-114">Voordat u configureert Hallo [logboekanalyse waarschuwing](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook met behulp van een webhook als een waarschuwing actie moet u toofirst maken van een webhook voor Hallo runbook dat moet worden aangeroepen met deze methode.</span><span class="sxs-lookup"><span data-stu-id="93263-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="93263-115">Lees en volg de stappen in Hallo Hallo [maken van een webhook](automation-webhooks.md#creating-a-webhook) artikel en onthouden toorecord hello webhook-URL, zodat u ernaar verwijzen kunt tijdens het configureren van de waarschuwingsregel Hallo.</span><span class="sxs-lookup"><span data-stu-id="93263-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="93263-116">Een runbook direct aanroepen</span><span class="sxs-lookup"><span data-stu-id="93263-116">Calling a runbook directly</span></span>

<span data-ttu-id="93263-117">Als er Hallo Automation & besturingselement aanbieding geïnstalleerd en geconfigureerd in de OMS-werkruimte bij het configureren van Hallo runbookoptie acties voor Hallo waarschuwing, kunt u alle runbooks van Hallo bekijken **selecteert u een runbook** vervolgkeuzelijst en selecteer Hallo specifiek runbook gewenste toorun in antwoord toohello waarschuwing.</span><span class="sxs-lookup"><span data-stu-id="93263-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="93263-118">Hallo geselecteerd runbook kan worden uitgevoerd in een werkruimte hello Azure-cloud op of in een hybride runbook worker.</span><span class="sxs-lookup"><span data-stu-id="93263-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="93263-119">Wanneer Hallo waarschuwing is gemaakt met behulp van de runbookoptie hello, wordt een webhook gemaakt voor runbook Hallo.</span><span class="sxs-lookup"><span data-stu-id="93263-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="93263-120">U kunt Hallo webhook zien als u toohello Automation-account gaat en navigeer toohello webhook blade van Hallo geselecteerde runbook.</span><span class="sxs-lookup"><span data-stu-id="93263-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="93263-121">Als u de waarschuwing Hallo verwijdert, Hallo webhook wordt niet verwijderd, maar Hallo-gebruiker kunt Hallo webhook handmatig verwijderen.</span><span class="sxs-lookup"><span data-stu-id="93263-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="93263-122">Er is geen probleem als Hallo webhook niet worden verwijderd, is alleen een zwevende item die uiteindelijk toobe moet verwijderd in volgorde toomaintain een geordende Automation-account.</span><span class="sxs-lookup"><span data-stu-id="93263-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="93263-123">Kenmerken van een runbook (voor beide opties)</span><span class="sxs-lookup"><span data-stu-id="93263-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="93263-124">Beide methoden voor het aanroepen van Hallo runbook vanuit Hallo logboekanalyse waarschuwing hebben verschillende gedragskenmerken waarvoor toobe begrijpt voordat u uw regels voor waarschuwingen configureren.</span><span class="sxs-lookup"><span data-stu-id="93263-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="93263-125">U moet een runbook-invoerparameter hebben met de naam **WebhookData** en van het type **Object**.</span><span class="sxs-lookup"><span data-stu-id="93263-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="93263-126">Deze kan verplicht of optioneel zijn.</span><span class="sxs-lookup"><span data-stu-id="93263-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="93263-127">Hallo-waarschuwing wordt doorgegeven Hallo zoeken resultaten toohello runbook met behulp van deze invoerparameter.</span><span class="sxs-lookup"><span data-stu-id="93263-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="93263-128">U moet de code tooconvert hello WebhookData tooa PowerShell-object hebben.</span><span class="sxs-lookup"><span data-stu-id="93263-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="93263-129">*$SearchResults* is een matrix met objecten; elk object Hallo velden met waarden van een zoekresultaat bevat</span><span class="sxs-lookup"><span data-stu-id="93263-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="93263-130">WebhookData inconsistenties tussen Hallo webhook optie en runbookoptie</span><span class="sxs-lookup"><span data-stu-id="93263-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="93263-131">Bij het configureren van een waarschuwing toocall een Webhook invoeren van een webhook-URL die u voor een runbook hebt gemaakt en klikt u op Hallo **Test Webhook** knop.</span><span class="sxs-lookup"><span data-stu-id="93263-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="93263-132">Hallo resulterende WebhookData verzonden toohello runbook bevat geen ofwel *. SearchResult* of *. Zoekresultaten*.</span><span class="sxs-lookup"><span data-stu-id="93263-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="93263-133">Als u deze waarschuwing opslaat wanneer Hallo waarschuwing wordt geactiveerd en Hallo webhook aanroepen, Hallo WebhookData toohello runbook verzonden bevat *. SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="93263-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="93263-134">Als u een waarschuwing genereren en toocall een runbook (die u maakt ook een webhook) configureert, waarschuwing triggers WebhookData toohello runbook met worden verzonden wanneer Hallo *. Zoekresultaten*.</span><span class="sxs-lookup"><span data-stu-id="93263-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="93263-135">Dus in Hallo-codevoorbeeld hierboven, moet u tooget *. SearchResult* als Hallo waarschuwing een webhook aanroepen en tooget moet *. Zoekresultaten* als Hallo waarschuwing een runbook rechtstreeks aanroept.</span><span class="sxs-lookup"><span data-stu-id="93263-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="93263-136">Voorbeeldscenario</span><span class="sxs-lookup"><span data-stu-id="93263-136">Example walkthrough</span></span>

<span data-ttu-id="93263-137">Wordt gedemonstreerd hoe dit werkt met behulp van Hallo na voorbeeld grafisch runbook, een Windows-service te starten.</span><span class="sxs-lookup"><span data-stu-id="93263-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Grafisch runbook dat Windows-service start](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="93263-139">Hallo runbook heeft één invoerparameter van het type **Object** die wordt aangeroepen **WebhookData** en bevat Hallo webhook gegevens van de waarschuwing die Hallo doorgegeven *. Zoekresultaten*.</span><span class="sxs-lookup"><span data-stu-id="93263-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="93263-140">![Invoerparameters voor runbook](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="93263-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="93263-141">In dit voorbeeld in logboekanalyse er gemaakt met twee aangepaste velden, *SvcDisplayName_CF* en *SvcState_CF*, tooextract Hallo service naam en het Hallo weergavestatus van Hallo-service (dat wil zeggen uitgevoerd of gestopt) geschreven logboek met systeemgebeurtenissen toohello van Hallo-gebeurtenis.</span><span class="sxs-lookup"><span data-stu-id="93263-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="93263-142">Vervolgens maken we een waarschuwingsregel Hello zoekopdracht te volgen: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` zodat we kan waarnemen Hallo afdrukspoolerservice op Hallo Windows-systeem wordt gestopt.</span><span class="sxs-lookup"><span data-stu-id="93263-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="93263-143">Alle services die van belang kan zijn, maar in dit voorbeeld verwijzen we een van de bestaande Hallo-services die opgenomen in het Windows-besturingssysteem Hallo zijn.</span><span class="sxs-lookup"><span data-stu-id="93263-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="93263-144">Hallo meldingsactie is geconfigureerde tooexecute ons runbook in dit voorbeeld gebruikt en uitgevoerd op Hallo Hybrid Runbook Worker die zijn ingeschakeld op Hallo doelsystemen.</span><span class="sxs-lookup"><span data-stu-id="93263-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="93263-145">Hallo code runbookactiviteit **servicenaam ophalen van LA** wordt Hallo JSON-indeling van tekenreeks geconverteerd naar een type en object-filter op Hallo item *SvcDisplayName_CF* tooextract Hallo weergavenaam Hallo Windows-service en dit doorgeven naar de volgende Hallo-activiteit die wordt geverifieerd Hallo-service wordt gestopt voordat u probeert toorestart deze.</span><span class="sxs-lookup"><span data-stu-id="93263-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="93263-146">*SvcDisplayName_CF* is een [aangepast veld](../log-analytics/log-analytics-custom-fields.md) gemaakt in logboekanalyse toodemonstrate in dit voorbeeld.</span><span class="sxs-lookup"><span data-stu-id="93263-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="93263-147">Wanneer het Hallo-service stopt, Hallo waarschuwingsregel in logboekanalyse detecteert een overeenkomst en om Hallo runbook te activeren en Hallo waarschuwingscontext toohello runbook verzenden.</span><span class="sxs-lookup"><span data-stu-id="93263-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="93263-148">Hallo runbook zal actie ondernemen tooverify Hallo-service wordt gestopt, en als zodanig poging toorestart Hallo service en controleer of deze juist gestart en uitvoer Hallo resultaten.</span><span class="sxs-lookup"><span data-stu-id="93263-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="93263-149">U kunt ook als u uw Automation-account gekoppeld tooyour OMS-werkruimte niet hebt, u Hallo waarschuwingsregel configureren met een webhook actie tootrigger hello runbook en Hallo runbook tooconvert Hallo JSON-indeling tekenreeks en filter op configureren*. SearchResult* eerder genoemde Hallo-richtlijnen te volgen.</span><span class="sxs-lookup"><span data-stu-id="93263-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="93263-150">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="93263-150">Next steps</span></span>

* <span data-ttu-id="93263-151">meer informatie over waarschuwingen in logboekanalyse toolearn en hoe toocreate, Zie [waarschuwingen in logboekanalyse](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="93263-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="93263-152">hoe tootrigger runbooks met behulp van een webhook zien toounderstand [Azure Automation webhooks](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="93263-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>
