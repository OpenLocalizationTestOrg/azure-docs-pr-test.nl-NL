---
title: aaaLoad Balancer aangepaste tests en bewaking gezondheidsstatus | Microsoft Docs
description: Meer informatie over hoe toouse aangepaste tests voor exemplaren van Azure Load Balancer toomonitor achter de Load Balancer
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 3dfcfcd2d5cffa58b160cb38d63acffbd997d452
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="32f4b-103">Load Balancer-testen</span><span class="sxs-lookup"><span data-stu-id="32f4b-103">Understand load balancer probes</span></span>

<span data-ttu-id="32f4b-104">Azure Load Balancer biedt Hallo mogelijkheid toomonitor Hallo status van exemplaren van de server met behulp van de tests.</span><span class="sxs-lookup"><span data-stu-id="32f4b-104">Azure Load Balancer offers hello capability toomonitor hello health of server instances by using probes.</span></span> <span data-ttu-id="32f4b-105">Wanneer een test toorespond mislukt stopt Load Balancer nieuwe verbindingen toohello slecht exemplaar verzenden.</span><span class="sxs-lookup"><span data-stu-id="32f4b-105">When a probe fails toorespond, Load Balancer stops sending new connections toohello unhealthy instance.</span></span> <span data-ttu-id="32f4b-106">Hallo bestaande verbindingen worden niet be√Ønvloed en nieuwe verbindingen toohealthy exemplaren worden verzonden.</span><span class="sxs-lookup"><span data-stu-id="32f4b-106">hello existing connections are not affected, and new connections are sent toohealthy instances.</span></span>

<span data-ttu-id="32f4b-107">Guest agent cloud service-rollen (werkrollen en webrollen) gebruiken voor het bewaken van de test.</span><span class="sxs-lookup"><span data-stu-id="32f4b-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="32f4b-108">Aangepaste TCP- of HTTP-tests moeten worden geconfigureerd wanneer u virtuele machines achter de Load Balancer gebruiken.</span><span class="sxs-lookup"><span data-stu-id="32f4b-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="32f4b-109">Aantal van de test- en time begrijpen</span><span class="sxs-lookup"><span data-stu-id="32f4b-109">Understand probe count and timeout</span></span>

<span data-ttu-id="32f4b-110">Afhankelijk van het gedrag van de test:</span><span class="sxs-lookup"><span data-stu-id="32f4b-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="32f4b-111">Hallo aantal geslaagde tests die een exemplaar toobe gelabeld als bedrijfs toestaan.</span><span class="sxs-lookup"><span data-stu-id="32f4b-111">hello number of successful probes that allow an instance toobe labeled as up.</span></span>
* <span data-ttu-id="32f4b-112">Hallo aantal mislukte tests die ertoe leiden een exemplaar toobe gelabeld als omlaag dat.</span><span class="sxs-lookup"><span data-stu-id="32f4b-112">hello number of failed probes that cause an instance toobe labeled as down.</span></span>

<span data-ttu-id="32f4b-113">Hallo-waarde voor time-outs en frequentie instellen in SuccessFailCount bepalen of een exemplaar bevestigde toobe uitgevoerd of niet actief is.</span><span class="sxs-lookup"><span data-stu-id="32f4b-113">hello timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed toobe running or not running.</span></span> <span data-ttu-id="32f4b-114">In hello Azure-portal, Hallo time-out tootwo keren Hallo waarde van Hallo frequentie ingesteld.</span><span class="sxs-lookup"><span data-stu-id="32f4b-114">In hello Azure portal, hello timeout is set tootwo times hello value of hello frequency.</span></span>

<span data-ttu-id="32f4b-115">Hallo test de configuratie van alle exemplaren van de taakverdeling voor een eindpunt (dat wil zeggen, een set taakverdeling) moet Hallo dezelfde.</span><span class="sxs-lookup"><span data-stu-id="32f4b-115">hello probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be hello same.</span></span> <span data-ttu-id="32f4b-116">Dit betekent dat er geen een andere test-configuratie voor elke rolinstantie of de virtuele machine in Hallo dezelfde gehoste service voor de combinatie van een bepaald eindpunt.</span><span class="sxs-lookup"><span data-stu-id="32f4b-116">This means you cannot have a different probe configuration for each role instance or virtual machine in hello same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="32f4b-117">Elk exemplaar moet bijvoorbeeld identieke lokale poorten en time-outs.</span><span class="sxs-lookup"><span data-stu-id="32f4b-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="32f4b-118">Hallo IP-adres 168.63.129.16 maakt gebruik van een Load Balancer-test.</span><span class="sxs-lookup"><span data-stu-id="32f4b-118">A Load Balancer probe uses hello IP address 168.63.129.16.</span></span> <span data-ttu-id="32f4b-119">Dit openbare IP-adres vergemakkelijkt de communicatie toointernal platform resources voor Hallo bring-your-eigenaar-IP-scenario Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="32f4b-119">This public IP address facilitates communication toointernal platform resources for hello bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="32f4b-120">Hallo virtuele openbare IP-adres 168.63.129.16 wordt gebruikt in alle regio's en wordt niet gewijzigd.</span><span class="sxs-lookup"><span data-stu-id="32f4b-120">hello virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="32f4b-121">We raden u aan dit IP-adres in een lokale firewall-beleid.</span><span class="sxs-lookup"><span data-stu-id="32f4b-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="32f4b-122">Deze mogen niet worden beschouwd als een beveiligingsrisico omdat er een bericht van dat adres kan als bron worden alleen Hallo interne Azure-platform.</span><span class="sxs-lookup"><span data-stu-id="32f4b-122">It should not be considered a security risk because only hello internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="32f4b-123">Als u dit doet, zullen er onverwacht gedrag in verschillende scenario's zoals het configureren van Hallo hetzelfde IP-adresbereik van 168.63.129.16 en IP-adressen die worden gedupliceerd.</span><span class="sxs-lookup"><span data-stu-id="32f4b-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring hello same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-hello-types-of-probes"></a><span data-ttu-id="32f4b-124">Meer informatie over Hallo typen tests</span><span class="sxs-lookup"><span data-stu-id="32f4b-124">Learn about hello types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="32f4b-125">Test voor gast-agent</span><span class="sxs-lookup"><span data-stu-id="32f4b-125">Guest agent probe</span></span>

<span data-ttu-id="32f4b-126">Deze test is alleen beschikbaar voor Azure Cloud Services.</span><span class="sxs-lookup"><span data-stu-id="32f4b-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="32f4b-127">Load Balancer gebruikmaakt van de gastagent Hallo in Hallo virtuele machine, en vervolgens luistert en reageert met een HTTP 200 OK antwoord alleen wanneer hello exemplaar is Hallo status Ready heeft (dat wil zeggen, niet in een andere status zoals bezet, Recycling of stoppen).</span><span class="sxs-lookup"><span data-stu-id="32f4b-127">Load Balancer utilizes hello guest agent inside hello virtual machine, and then listens and responds with an HTTP 200 OK response only when hello instance is in hello Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="32f4b-128">Zie voor meer informatie [configureren Hallo servicedefinitiebestand (csdef) voor statuscontroles](https://msdn.microsoft.com/library/azure/ee758710.aspx) of [maken van een Internet gerichte load balancer voor cloudservices aan de slag](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="32f4b-128">For more information, see [Configuring hello service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="32f4b-129">Een test voor gast-agent is een exemplaar als beschadigd gemarkeerd is?</span><span class="sxs-lookup"><span data-stu-id="32f4b-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="32f4b-130">Als Hallo guest-agent toorespond met HTTP 200 OK mislukt, Hallo Hallo load balancer aanhalingstekens exemplaar als niet-reagerende en stopt met het verzenden van verkeer toothat exemplaar.</span><span class="sxs-lookup"><span data-stu-id="32f4b-130">If hello guest agent fails toorespond with HTTP 200 OK, hello load balancer marks hello instance as unresponsive and stops sending traffic toothat instance.</span></span> <span data-ttu-id="32f4b-131">Hallo load balancer blijft tooping Hallo-exemplaar.</span><span class="sxs-lookup"><span data-stu-id="32f4b-131">hello load balancer continues tooping hello instance.</span></span> <span data-ttu-id="32f4b-132">Als Hallo guest-agent met een HTTP 200 reageert, verzendt Hallo load balancer verkeer toothat exemplaar opnieuw.</span><span class="sxs-lookup"><span data-stu-id="32f4b-132">If hello guest agent responds with an HTTP 200, hello load balancer sends traffic toothat instance again.</span></span>

<span data-ttu-id="32f4b-133">Wanneer u een Webrol gebruikt, wordt Hallo websitecode gewoonlijk wordt uitgevoerd in w3wp.exe die niet wordt bewaakt door hello Azure-infrastructuur of guest-agent.</span><span class="sxs-lookup"><span data-stu-id="32f4b-133">When you use a web role, hello website code typically runs in w3wp.exe, which is not monitored by hello Azure fabric or guest agent.</span></span> <span data-ttu-id="32f4b-134">Dit betekent dat fouten in w3wp.exe (bijvoorbeeld HTTP 500-antwoorden) niet gemeld toohello guest-agent worden en Hallo load balancer niet in werking te dat exemplaar buiten de draaihoek laten.</span><span class="sxs-lookup"><span data-stu-id="32f4b-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported toohello guest agent, and hello load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="32f4b-135">Aangepaste HTTP-test</span><span class="sxs-lookup"><span data-stu-id="32f4b-135">HTTP custom probe</span></span>

<span data-ttu-id="32f4b-136">aangepaste HTTP-Load Balancer-test Hallo overschrijft Hallo standaard guest agent test, wat betekent dat u uw eigen aangepaste regels toodetermine Hallo gezondheid van de rolinstantie Hallo kunt maken.</span><span class="sxs-lookup"><span data-stu-id="32f4b-136">hello custom HTTP Load Balancer probe overrides hello default guest agent probe, which means that you can create your own custom logic toodetermine hello health of hello role instance.</span></span> <span data-ttu-id="32f4b-137">Hallo load balancer-tests uw eindpunt elke 15 seconden standaard.</span><span class="sxs-lookup"><span data-stu-id="32f4b-137">hello load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="32f4b-138">Hallo-exemplaar als toobe in Hallo load balancer rotatie beschouwd als deze met een HTTP 200 binnen Hallo time-outperiode (31 seconden standaard reageert).</span><span class="sxs-lookup"><span data-stu-id="32f4b-138">hello instance is considered toobe in hello load balancer rotation if it responds with an HTTP 200 within hello timeout period (31 seconds by default).</span></span>

<span data-ttu-id="32f4b-139">Dit is handig als u uw eigen logica tooremove exemplaren van de load balancer rotatie tooimplement wilt.</span><span class="sxs-lookup"><span data-stu-id="32f4b-139">This can be useful if you want tooimplement your own logic tooremove instances from load balancer rotation.</span></span> <span data-ttu-id="32f4b-140">U kan bijvoorbeeld tooremove een exemplaar besluit als deze hoger dan 90% CPU is en een niet-200 opgevraagd.</span><span class="sxs-lookup"><span data-stu-id="32f4b-140">For example, you could decide tooremove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="32f4b-141">Als u web-functies die er gebruik van w3wp.exe hebt, betekent dit ook dat krijgt u automatische bewaking van uw website, omdat er fouten in uw websitecode retourneert een niet-200 status toohello load balancer-test.</span><span class="sxs-lookup"><span data-stu-id="32f4b-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status toohello load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="32f4b-142">aangepaste HTTP-test Hallo ondersteunt relatieve paden en HTTP-protocol.</span><span class="sxs-lookup"><span data-stu-id="32f4b-142">hello HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="32f4b-143">HTTPS wordt niet ondersteund.</span><span class="sxs-lookup"><span data-stu-id="32f4b-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="32f4b-144">Een aangepaste HTTP-test een exemplaar als beschadigd gemarkeerd is?</span><span class="sxs-lookup"><span data-stu-id="32f4b-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="32f4b-145">HTTP-toepassing Hello retourneert een HTTP-antwoordcode dan 200 (bijvoorbeeld 403, 404 of 500).</span><span class="sxs-lookup"><span data-stu-id="32f4b-145">hello HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="32f4b-146">Dit is een positieve bevestiging die toepassing hello exemplaar moet worden uitgevoerd buiten de service meteen.</span><span class="sxs-lookup"><span data-stu-id="32f4b-146">This is a positive acknowledgment that hello application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="32f4b-147">Hallo HTTP-server reageert niet op alle na het Hallo-time-outperiode.</span><span class="sxs-lookup"><span data-stu-id="32f4b-147">hello HTTP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="32f4b-148">Afhankelijk van Hallo time-outwaarde die is ingesteld, kan dit betekenen dat meerdere test Ga voordat Hallo test opgehaald gemarkeerd als niet wordt uitgevoerd met openstaande aanvragen (dat wil zeggen, voordat SuccessFailCount tests worden verzonden).</span><span class="sxs-lookup"><span data-stu-id="32f4b-148">Depending on hello timeout value that is set, this might mean that multiple probe requests go unanswered before hello probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="32f4b-149">Hallo server sluit Hallo verbinding via een TCP-reset.</span><span class="sxs-lookup"><span data-stu-id="32f4b-149">hello server closes hello connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="32f4b-150">Aangepaste TCP-test</span><span class="sxs-lookup"><span data-stu-id="32f4b-150">TCP custom probe</span></span>

<span data-ttu-id="32f4b-151">Een verbinding starten TCP tests door het uitvoeren van een handshake drie richtingen met poort Hallo gedefinieerd.</span><span class="sxs-lookup"><span data-stu-id="32f4b-151">TCP probes initiate a connection by performing a three-way handshake with hello defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="32f4b-152">Een aangepaste TCP-test een exemplaar als beschadigd gemarkeerd is?</span><span class="sxs-lookup"><span data-stu-id="32f4b-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="32f4b-153">Hallo TCP-server reageert niet op alle na het Hallo-time-outperiode.</span><span class="sxs-lookup"><span data-stu-id="32f4b-153">hello TCP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="32f4b-154">Wanneer de test Hallo is gemarkeerd als niet actief is afhankelijk van het aantal mislukte test Hallo aanvragen die zijn geconfigureerd toogo openstaande voordat u markeert Hallo test niet uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="32f4b-154">When hello probe is marked as not running depends on hello number of failed probe requests that were configured toogo unanswered before marking hello probe as not running.</span></span>
* <span data-ttu-id="32f4b-155">Hallo test ontvangt een opnieuw instellen van de rolinstantie Hallo TCP.</span><span class="sxs-lookup"><span data-stu-id="32f4b-155">hello probe receives a TCP reset from hello role instance.</span></span>

<span data-ttu-id="32f4b-156">Zie voor meer informatie over het configureren van de statuscontrole van een HTTP- of een TCP-controle [een internetgerichte load balancer maken in Resource Manager, met behulp van PowerShell](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="32f4b-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="32f4b-157">In orde exemplaren weer in de load balancer rotatie toevoegen</span><span class="sxs-lookup"><span data-stu-id="32f4b-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="32f4b-158">TCP- en HTTP-tests worden beschouwd als in orde en markeren Hallo rolinstantie als in orde wanneer:</span><span class="sxs-lookup"><span data-stu-id="32f4b-158">TCP and HTTP probes are considered healthy and mark hello role instance as healthy when:</span></span>

* <span data-ttu-id="32f4b-159">Hallo load balancer opgehaald uit een positief test Hallo eerste tijd Hallo die VM wordt opgestart.</span><span class="sxs-lookup"><span data-stu-id="32f4b-159">hello load balancer gets a positive probe hello first time hello VM boots.</span></span>
* <span data-ttu-id="32f4b-160">Hallo getal SuccessFailCount (zoals eerder beschreven) definieert Hallo-waarde van geslaagde tests die vereist toomark hello rolinstantie als in orde zijn.</span><span class="sxs-lookup"><span data-stu-id="32f4b-160">hello number SuccessFailCount (described earlier) defines hello value of successful probes that are required toomark hello role instance as healthy.</span></span> <span data-ttu-id="32f4b-161">Als een rolinstantie werd verwijderd, moet Hallo aantal geslaagd, opeenvolgende tests gelijk zijn aan of groter zijn dan de waarde Hallo van SuccessFailCount toomark hello rolinstantie als die wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="32f4b-161">If a role instance was removed, hello number of successful, successive probes must equal or exceed hello value of SuccessFailCount toomark hello role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="32f4b-162">Als Hallo status van een rolinstantie is veranderen, wordt Hallo load balancer meer wacht voordat u Hallo rolinstantie terug in Hallo foutloze toestand bevindt.</span><span class="sxs-lookup"><span data-stu-id="32f4b-162">If hello health of a role instance is fluctuating, hello load balancer waits longer before putting hello role instance back in hello healthy state.</span></span> <span data-ttu-id="32f4b-163">Dit wordt gedaan via beleid tooprotect Hallo gebruiker en het Hallo-infrastructuur.</span><span class="sxs-lookup"><span data-stu-id="32f4b-163">This is done via policy tooprotect hello user and hello infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="32f4b-164">Log analytics gebruiken voor de Load Balancer</span><span class="sxs-lookup"><span data-stu-id="32f4b-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="32f4b-165">U kunt [analytics aanmelden voor de Load Balancer](load-balancer-monitor-log.md) toocheck op Hallo test health-status en test count.</span><span class="sxs-lookup"><span data-stu-id="32f4b-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) toocheck on hello probe health status and probe count.</span></span> <span data-ttu-id="32f4b-166">Logboekregistratie kan worden gebruikt met Power BI of Azure Operational Insights tooprovide statistieken over de status van de Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="32f4b-166">Logging can be used with Power BI or Azure Operational Insights tooprovide statistics about Load Balancer health status.</span></span>
