---
title: Load Balancer aangepaste tests en de status controleren | Microsoft Docs
description: Informatie over het gebruik van aangepaste tests voor de Azure Load Balancer instanties achter de Load Balancer bewaken
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: cab028fed58d544a56f2f6b12b72364c7baf4d86
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="fa7a5-103">Load Balancer-testen</span><span class="sxs-lookup"><span data-stu-id="fa7a5-103">Understand load balancer probes</span></span>

<span data-ttu-id="fa7a5-104">Azure Load Balancer biedt de mogelijkheid om te controleren van de status van exemplaren van de server met behulp van de tests.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-104">Azure Load Balancer offers the capability to monitor the health of server instances by using probes.</span></span> <span data-ttu-id="fa7a5-105">Wanneer een test niet reageert, stopt Load Balancer nieuwe verbindingen verzenden naar het exemplaar niet in orde.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-105">When a probe fails to respond, Load Balancer stops sending new connections to the unhealthy instance.</span></span> <span data-ttu-id="fa7a5-106">De bestaande verbindingen worden niet be√Ønvloed en nieuwe verbindingen worden verzonden naar orde exemplaren.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-106">The existing connections are not affected, and new connections are sent to healthy instances.</span></span>

<span data-ttu-id="fa7a5-107">Guest agent cloud service-rollen (werkrollen en webrollen) gebruiken voor het bewaken van de test.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="fa7a5-108">Aangepaste TCP- of HTTP-tests moeten worden geconfigureerd wanneer u virtuele machines achter de Load Balancer gebruiken.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="fa7a5-109">Aantal van de test- en time begrijpen</span><span class="sxs-lookup"><span data-stu-id="fa7a5-109">Understand probe count and timeout</span></span>

<span data-ttu-id="fa7a5-110">Afhankelijk van het gedrag van de test:</span><span class="sxs-lookup"><span data-stu-id="fa7a5-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="fa7a5-111">Het aantal geslaagde tests waarmee een exemplaar moet het worden gelabeld als bedrijfs.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-111">The number of successful probes that allow an instance to be labeled as up.</span></span>
* <span data-ttu-id="fa7a5-112">Het aantal mislukte tests die ertoe leiden een exemplaar dat moet het worden gelabeld als omlaag.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-112">The number of failed probes that cause an instance to be labeled as down.</span></span>

<span data-ttu-id="fa7a5-113">De waarde voor time-outs en frequentie in SuccessFailCount bepalen of een exemplaar moet worden uitgevoerd of niet actief is bevestigd.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-113">The timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed to be running or not running.</span></span> <span data-ttu-id="fa7a5-114">In de Azure portal, is de time-out ingesteld op tweemaal de waarde van de frequentie.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-114">In the Azure portal, the timeout is set to two times the value of the frequency.</span></span>

<span data-ttu-id="fa7a5-115">De configuratie van de test van alle exemplaren met gelijke taakverdeling voor een eindpunt (dat wil zeggen, een set taakverdeling) moet hetzelfde zijn.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-115">The probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be the same.</span></span> <span data-ttu-id="fa7a5-116">Dit betekent dat er geen een andere test-configuratie voor elke rolinstantie of de virtuele machine in dezelfde gehoste service voor de combinatie van een bepaald eindpunt.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-116">This means you cannot have a different probe configuration for each role instance or virtual machine in the same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="fa7a5-117">Elk exemplaar moet bijvoorbeeld identieke lokale poorten en time-outs.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="fa7a5-118">Een Load Balancer-test maakt gebruik van het IP-adres 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-118">A Load Balancer probe uses the IP address 168.63.129.16.</span></span> <span data-ttu-id="fa7a5-119">Dit openbare IP-adres vergemakkelijkt de communicatie met interne platform bronnen voor de bring-your-eigenaar-IP-scenario in Azure Virtual Network.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-119">This public IP address facilitates communication to internal platform resources for the bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="fa7a5-120">De virtuele openbare IP-adres 168.63.129.16 wordt gebruikt in alle regio's en wordt niet gewijzigd.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-120">The virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="fa7a5-121">We raden u aan dit IP-adres in een lokale firewall-beleid.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="fa7a5-122">Deze mogen niet worden beschouwd als een beveiligingsrisico met zich mee omdat alleen de interne Azure-platform kan een bericht van dat adres bron.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-122">It should not be considered a security risk because only the internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="fa7a5-123">Als u dit doet, zullen er onverwacht gedrag in verschillende scenario's zoals het configureren van hetzelfde IP-adresbereik van 168.63.129.16 en IP-adressen die worden gedupliceerd.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring the same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-the-types-of-probes"></a><span data-ttu-id="fa7a5-124">Meer informatie over de typen tests</span><span class="sxs-lookup"><span data-stu-id="fa7a5-124">Learn about the types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="fa7a5-125">Test voor gast-agent</span><span class="sxs-lookup"><span data-stu-id="fa7a5-125">Guest agent probe</span></span>

<span data-ttu-id="fa7a5-126">Deze test is alleen beschikbaar voor Azure Cloud Services.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="fa7a5-127">Load Balancer gebruikmaakt van de guest-agent op de virtuele machine, en vervolgens luistert en reageert met een HTTP 200 OK antwoord wanneer het exemplaar in de status gereed (dat wil zeggen, niet in een andere status zoals bezet, Recycling of stoppen).</span><span class="sxs-lookup"><span data-stu-id="fa7a5-127">Load Balancer utilizes the guest agent inside the virtual machine, and then listens and responds with an HTTP 200 OK response only when the instance is in the Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="fa7a5-128">Zie voor meer informatie [het servicedefinitiebestand (csdef) configureren voor statuscontroles](https://msdn.microsoft.com/library/azure/ee758710.aspx) of [maken van een Internet gerichte load balancer voor cloudservices aan de slag](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="fa7a5-128">For more information, see [Configuring the service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="fa7a5-129">Een test voor gast-agent is een exemplaar als beschadigd gemarkeerd is?</span><span class="sxs-lookup"><span data-stu-id="fa7a5-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="fa7a5-130">Als de guest agent niet reageert met HTTP 200 OK, wordt de load balancer markeert de instantie als niet-reagerende en stopt verkeer kunnen verzenden naar dit exemplaar.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-130">If the guest agent fails to respond with HTTP 200 OK, the load balancer marks the instance as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="fa7a5-131">De load balancer, blijft het pingen van het exemplaar.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-131">The load balancer continues to ping the instance.</span></span> <span data-ttu-id="fa7a5-132">Als u de guest-agent reageert met een HTTP 200, verzendt de load balancer verkeer opnieuw naar dit exemplaar.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-132">If the guest agent responds with an HTTP 200, the load balancer sends traffic to that instance again.</span></span>

<span data-ttu-id="fa7a5-133">Wanneer u een Webrol, de websitecode doorgaans wordt uitgevoerd in w3wp.exe die niet wordt bewaakt door de Azure fabric of Gast-agent.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-133">When you use a web role, the website code typically runs in w3wp.exe, which is not monitored by the Azure fabric or guest agent.</span></span> <span data-ttu-id="fa7a5-134">Dit betekent dat fouten in w3wp.exe (bijvoorbeeld HTTP 500-antwoorden) wordt niet gerapporteerd aan de guest-agent en de load balancer niet in werking te dat exemplaar buiten de draaihoek laten.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported to the guest agent, and the load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="fa7a5-135">Aangepaste HTTP-test</span><span class="sxs-lookup"><span data-stu-id="fa7a5-135">HTTP custom probe</span></span>

<span data-ttu-id="fa7a5-136">De aangepaste HTTP-Load Balancer-test heeft voorrang op de standaard guest agent test, wat betekent dat u uw eigen aangepaste regels om te bepalen van de status van de rolinstantie kunt maken.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-136">The custom HTTP Load Balancer probe overrides the default guest agent probe, which means that you can create your own custom logic to determine the health of the role instance.</span></span> <span data-ttu-id="fa7a5-137">De load balancer-tests uw eindpunt elke 15 seconden standaard.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-137">The load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="fa7a5-138">Het exemplaar wordt beschouwd als in de load balancer rotatie als deze met een HTTP 200 binnen de time-outperiode (31 seconden standaard reageert).</span><span class="sxs-lookup"><span data-stu-id="fa7a5-138">The instance is considered to be in the load balancer rotation if it responds with an HTTP 200 within the timeout period (31 seconds by default).</span></span>

<span data-ttu-id="fa7a5-139">Dit is handig als u implementeren van uw eigen logica wilt voor het verwijderen van exemplaren van load balancer worden gedraaid.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-139">This can be useful if you want to implement your own logic to remove instances from load balancer rotation.</span></span> <span data-ttu-id="fa7a5-140">U kan bijvoorbeeld besluiten om te verwijderen van een exemplaar als het hoger dan 90% CPU is en de status van een niet-200 retourneert.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-140">For example, you could decide to remove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="fa7a5-141">Als u web-functies die er gebruik van w3wp.exe hebt, betekent dit ook dat krijgt u automatische bewaking van uw website, omdat er fouten in de websitecode van uw de status van een niet-200 wordt geretourneerd naar de load balancer-test.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status to the load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="fa7a5-142">De aangepaste HTTP-test ondersteunt relatieve paden en HTTP-protocol.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-142">The HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="fa7a5-143">HTTPS wordt niet ondersteund.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="fa7a5-144">Een aangepaste HTTP-test een exemplaar als beschadigd gemarkeerd is?</span><span class="sxs-lookup"><span data-stu-id="fa7a5-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="fa7a5-145">De HTTP-toepassing retourneert een HTTP-antwoordcode dan 200 (bijvoorbeeld 403, 404 of 500).</span><span class="sxs-lookup"><span data-stu-id="fa7a5-145">The HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="fa7a5-146">Dit is een positieve bevestiging dat exemplaar van de toepassing moet worden uitgevoerd buiten de service meteen.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-146">This is a positive acknowledgment that the application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="fa7a5-147">De HTTP-server reageert niet op alle na de time-outperiode.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-147">The HTTP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="fa7a5-148">Afhankelijk van de time-outwaarde die is ingesteld, kan dit betekenen dat meerdere test Ga voordat de test wordt gemarkeerd als niet wordt uitgevoerd met openstaande aanvragen (dat wil zeggen, voordat SuccessFailCount tests worden verzonden).</span><span class="sxs-lookup"><span data-stu-id="fa7a5-148">Depending on the timeout value that is set, this might mean that multiple probe requests go unanswered before the probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="fa7a5-149">De server sluit de verbinding via een TCP-reset.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-149">The server closes the connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="fa7a5-150">Aangepaste TCP-test</span><span class="sxs-lookup"><span data-stu-id="fa7a5-150">TCP custom probe</span></span>

<span data-ttu-id="fa7a5-151">Een verbinding starten TCP tests door het uitvoeren van een handshake drie richtingen met de opgegeven poort.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-151">TCP probes initiate a connection by performing a three-way handshake with the defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="fa7a5-152">Een aangepaste TCP-test een exemplaar als beschadigd gemarkeerd is?</span><span class="sxs-lookup"><span data-stu-id="fa7a5-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="fa7a5-153">De TCP-server reageert niet op alle na de time-outperiode.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-153">The TCP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="fa7a5-154">Wanneer de test is gemarkeerd als niet wordt uitgevoerd, is afhankelijk van het aantal mislukte test aanvragen die zijn geconfigureerd om te gaan beantwoorde voordat u markeert de test als niet wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-154">When the probe is marked as not running depends on the number of failed probe requests that were configured to go unanswered before marking the probe as not running.</span></span>
* <span data-ttu-id="fa7a5-155">De test ontvangt een opnieuw instellen van de rolinstantie TCP.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-155">The probe receives a TCP reset from the role instance.</span></span>

<span data-ttu-id="fa7a5-156">Zie voor meer informatie over het configureren van de statuscontrole van een HTTP- of een TCP-controle [een internetgerichte load balancer maken in Resource Manager, met behulp van PowerShell](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="fa7a5-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="fa7a5-157">In orde exemplaren weer in de load balancer rotatie toevoegen</span><span class="sxs-lookup"><span data-stu-id="fa7a5-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="fa7a5-158">TCP- en HTTP-tests worden beschouwd als in orde en markeert de rolinstantie als in orde wanneer:</span><span class="sxs-lookup"><span data-stu-id="fa7a5-158">TCP and HTTP probes are considered healthy and mark the role instance as healthy when:</span></span>

* <span data-ttu-id="fa7a5-159">De load balancer opgehaald uit een positief test de eerste keer dat de virtuele machine wordt opgestart.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-159">The load balancer gets a positive probe the first time the VM boots.</span></span>
* <span data-ttu-id="fa7a5-160">Het aantal SuccessFailCount (zoals eerder beschreven) definieert de waarde van geslaagde tests die nodig zijn voor de rolinstantie als goed markeren.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-160">The number SuccessFailCount (described earlier) defines the value of successful probes that are required to mark the role instance as healthy.</span></span> <span data-ttu-id="fa7a5-161">Als een rolinstantie werd verwijderd, moet het aantal geslaagde, opeenvolgende tests gelijk zijn aan of groter zijn dan de waarde van SuccessFailCount markeren van de rolinstantie als die wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-161">If a role instance was removed, the number of successful, successive probes must equal or exceed the value of SuccessFailCount to mark the role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="fa7a5-162">Als u de status van een rolinstantie is veranderen, wordt de load balancer meer wacht voordat u de rolinstantie terug in de status in orde.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-162">If the health of a role instance is fluctuating, the load balancer waits longer before putting the role instance back in the healthy state.</span></span> <span data-ttu-id="fa7a5-163">Dit wordt gedaan via beleid voor het beveiligen van de gebruiker en de infrastructuur.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-163">This is done via policy to protect the user and the infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="fa7a5-164">Log analytics gebruiken voor de Load Balancer</span><span class="sxs-lookup"><span data-stu-id="fa7a5-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="fa7a5-165">U kunt [analytics aanmelden voor de Load Balancer](load-balancer-monitor-log.md) bij het controleren van de status van de test en het aantal van de test.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) to check on the probe health status and probe count.</span></span> <span data-ttu-id="fa7a5-166">Logboekregistratie kan worden gebruikt met Power BI of Azure Operational Insights om statistieken over de status van de Load Balancer.</span><span class="sxs-lookup"><span data-stu-id="fa7a5-166">Logging can be used with Power BI or Azure Operational Insights to provide statistics about Load Balancer health status.</span></span>
