---
title: Door de gebruiker gedefinieerde routes en doorsturen via IP in Azure | Microsoft Docs
description: Meer informatie over het gebruik van door de gebruiker gedefinieerde routes (UDR-route) en doorsturen via IP om verkeer door te sturen naar virtuele apparaten in Azure.
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 6274e0101f6fb0864c8d1efaef7fcde78b8760c3
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="5d087-103">Door de gebruiker gedefinieerde routes en doorsturen via IP</span><span class="sxs-lookup"><span data-stu-id="5d087-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="5d087-104">Als u virtuele machines (VM's) aan een virtueel netwerk (VNet) in Azure toevoegt, ziet u dat de virtuele machines automatisch met elkaar kunnen communiceren via het netwerk.</span><span class="sxs-lookup"><span data-stu-id="5d087-104">When you add virtual machines (VMs) to a virtual network (VNet) in Azure, you will notice that the VMs are able to communicate with each other over the network, automatically.</span></span> <span data-ttu-id="5d087-105">U hoeft geen gateway op te geven, ook niet als de virtuele machines tot verschillende subnetten behoren.</span><span class="sxs-lookup"><span data-stu-id="5d087-105">You do not need to specify a gateway, even though the VMs are in different subnets.</span></span> <span data-ttu-id="5d087-106">Hetzelfde geldt voor de communicatie tussen VM's en internet. Als er een hybride verbinding is tussen Azure en uw eigen datacentrum, is er zelfs communicatie met uw on-premises netwerk mogelijk.</span><span class="sxs-lookup"><span data-stu-id="5d087-106">The same is true for communication from the VMs to the public Internet, and even to your on-premises network when a hybrid connection from Azure to your own datacenter is present.</span></span>

<span data-ttu-id="5d087-107">Deze communicatiestroom is mogelijk omdat de IP-verkeersstromen in Azure wordt gedefinieerd met behulp van een reeks systeemroutes.</span><span class="sxs-lookup"><span data-stu-id="5d087-107">This flow of communication is possible because Azure uses a series of system routes to define how IP traffic flows.</span></span> <span data-ttu-id="5d087-108">Systeemroutes bepalen de communicatiestroom in de volgende scenario's:</span><span class="sxs-lookup"><span data-stu-id="5d087-108">System routes control the flow of communication in the following scenarios:</span></span>

* <span data-ttu-id="5d087-109">Binnen een en hetzelfde subnet.</span><span class="sxs-lookup"><span data-stu-id="5d087-109">From within the same subnet.</span></span>
* <span data-ttu-id="5d087-110">Van het ene naar het andere subnet binnen een VNet.</span><span class="sxs-lookup"><span data-stu-id="5d087-110">From a subnet to another within a VNet.</span></span>
* <span data-ttu-id="5d087-111">Van virtuele machines naar internet.</span><span class="sxs-lookup"><span data-stu-id="5d087-111">From VMs to the Internet.</span></span>
* <span data-ttu-id="5d087-112">Van het ene naar het andere VNet via een VPN-gateway.</span><span class="sxs-lookup"><span data-stu-id="5d087-112">From a VNet to another VNet through a VPN gateway.</span></span>
* <span data-ttu-id="5d087-113">Van het ene naar het andere VNet via VNet-peering (servicechaining).</span><span class="sxs-lookup"><span data-stu-id="5d087-113">From a VNet to another VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="5d087-114">Van een VNet naar uw on-premises netwerk via een VPN-gateway.</span><span class="sxs-lookup"><span data-stu-id="5d087-114">From a VNet to your on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="5d087-115">In de afbeelding hieronder ziet u eenvoudige configuratie met een VNet, twee subnetten en enkele virtuele machines, plus de systeemroutes voor het toestaan van IP-verkeer.</span><span class="sxs-lookup"><span data-stu-id="5d087-115">The figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with the system routes that allow IP traffic to flow.</span></span>

![Systeemroutes in Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="5d087-117">Hoewel bij het gebruik van systeemroutes verkeer automatisch wordt gefaciliteerd voor uw implementatie, kunnen er gevallen zijn waarin u pakketten liever wilt routeren via een virtueel apparaat.</span><span class="sxs-lookup"><span data-stu-id="5d087-117">Although the use of system routes facilitates traffic automatically for your deployment, there are cases in which you want to control the routing of packets through a virtual appliance.</span></span> <span data-ttu-id="5d087-118">U kunt hiertoe door de gebruiker gedefinieerde routes maken waarin u de volgende hop voor pakketstromen naar een specifiek subnet opgeeft, zodat de pakketten worden doorgestuurd naar uw virtuele apparaat. Daarvoor schakelt u Doorsturen via IP in voor de virtuele machine die u gebruikt als virtueel apparaat.</span><span class="sxs-lookup"><span data-stu-id="5d087-118">You can do so by creating user defined routes that specify the next hop for packets flowing to a specific subnet to go to your virtual appliance instead, and enabling IP forwarding for the VM running as the virtual appliance.</span></span>

<span data-ttu-id="5d087-119">In de volgende afbeelding ziet u een voorbeeld van door de gebruiker gedefinieerde routes en doorsturen via IP om af te dwingen dat pakketten die van het ene naar het andere subnet worden verzonden, naar een virtueel apparaat op een derde subnet worden doorgestuurd.</span><span class="sxs-lookup"><span data-stu-id="5d087-119">The figure below shows an example of user defined routes and IP forwarding to force packets sent to one subnet from another to go through a virtual appliance on a third subnet.</span></span>

![Systeemroutes in Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="5d087-121">Door de gebruiker gedefinieerde routes worden toegepast op verkeer dat een subnet van een willekeurige resource (zoals netwerkinterfaces gekoppeld aan virtuele machines) in het subnet verlaat.</span><span class="sxs-lookup"><span data-stu-id="5d087-121">User-defined routes are applied to traffic leaving a subnet from any resource (such as network interfaces attached to VMs) in the subnet.</span></span> <span data-ttu-id="5d087-122">U kunt bijvoorbeeld geen routes maken om op te geven hoe verkeer vanaf internet in een subnet binnenkomt.</span><span class="sxs-lookup"><span data-stu-id="5d087-122">You cannot create routes to specify how traffic enters a subnet from the Internet, for instance.</span></span> <span data-ttu-id="5d087-123">Het apparaat waarnaar u verkeer doorstuurt, kan zich niet in hetzelfde subnet bevinden als waar het verkeer van afkomstig is.</span><span class="sxs-lookup"><span data-stu-id="5d087-123">The appliance you are forwarding traffic to cannot be in the same subnet where the traffic originates.</span></span> <span data-ttu-id="5d087-124">Maak altijd een apart subnet voor uw apparaten.</span><span class="sxs-lookup"><span data-stu-id="5d087-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="5d087-125">Bron routeren</span><span class="sxs-lookup"><span data-stu-id="5d087-125">Route resource</span></span>
<span data-ttu-id="5d087-126">Pakketten worden gerouteerd via een TCP/IP-netwerk op basis van een routetabel die op elk knooppunt van het fysieke netwerk is gedefinieerd.</span><span class="sxs-lookup"><span data-stu-id="5d087-126">Packets are routed over a TCP/IP network based on a route table defined at each node on the physical network.</span></span> <span data-ttu-id="5d087-127">Een routetabel is een verzameling van afzonderlijke routes waarmee wordt bepaald waarnaar pakketten worden doorgestuurd op basis van het doel-IP-adres.</span><span class="sxs-lookup"><span data-stu-id="5d087-127">A route table is a collection of individual routes used to decide where to forward packets based on the destination IP address.</span></span> <span data-ttu-id="5d087-128">Een route bestaat uit het volgende:</span><span class="sxs-lookup"><span data-stu-id="5d087-128">A route consists of the following:</span></span>

| <span data-ttu-id="5d087-129">Eigenschap</span><span class="sxs-lookup"><span data-stu-id="5d087-129">Property</span></span> | <span data-ttu-id="5d087-130">Beschrijving</span><span class="sxs-lookup"><span data-stu-id="5d087-130">Description</span></span> | <span data-ttu-id="5d087-131">Beperkingen</span><span class="sxs-lookup"><span data-stu-id="5d087-131">Constraints</span></span> | <span data-ttu-id="5d087-132">Overwegingen</span><span class="sxs-lookup"><span data-stu-id="5d087-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="5d087-133">Adresvoorvoegsel</span><span class="sxs-lookup"><span data-stu-id="5d087-133">Address Prefix</span></span> |<span data-ttu-id="5d087-134">De doel-CIDR waarop de route van toepassing is, zoals 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="5d087-134">The destination CIDR to which the route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="5d087-135">Dit moet een geldig CIDR-bereik zijn van adressen op internet, in een virtueel Azure-netwerk of in een on-premises datacentrum.</span><span class="sxs-lookup"><span data-stu-id="5d087-135">Must be a valid CIDR range representing addresses on the public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="5d087-136">Zorg ervoor dat het **adresvoorvoegsel** niet het adres voor het **Nexthop-adres** bevat, anders raken de pakketten in een lus van de bron naar de volgende hop zonder ooit hun doel te bereiken.</span><span class="sxs-lookup"><span data-stu-id="5d087-136">Make sure the **Address prefix** does not contain the address for the **Next hop address**, otherwise your packets will enter in a loop going from the source to the next hop without ever reaching the destination.</span></span> |
| <span data-ttu-id="5d087-137">Volgend hoptype</span><span class="sxs-lookup"><span data-stu-id="5d087-137">Next hop type</span></span> |<span data-ttu-id="5d087-138">Het type hop in Azure waarnaar het pakket moet worden doorgestuurd.</span><span class="sxs-lookup"><span data-stu-id="5d087-138">The type of Azure hop the packet should be sent to.</span></span> |<span data-ttu-id="5d087-139">Dit moet een van de volgende waarden zijn:</span><span class="sxs-lookup"><span data-stu-id="5d087-139">Must be one of the following values:</span></span> <br/> <span data-ttu-id="5d087-140">**Virtueel netwerk**.</span><span class="sxs-lookup"><span data-stu-id="5d087-140">**Virtual Network**.</span></span> <span data-ttu-id="5d087-141">Hiermee geeft u het lokale virtuele netwerk op.</span><span class="sxs-lookup"><span data-stu-id="5d087-141">Represents the local virtual network.</span></span> <span data-ttu-id="5d087-142">Als u bijvoorbeeld twee subnetten, 10.1.0.0/16 en 10.2.0.0/16, in hetzelfde virtuele netwerk hebt, heeft de route voor elk subnet in de routetabel de waarde *Virtueel netwerk* voor de volgende hop.</span><span class="sxs-lookup"><span data-stu-id="5d087-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in the same virtual network, the route for each subnet in the route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="5d087-143">**Gateway voor een virtueel netwerk**.</span><span class="sxs-lookup"><span data-stu-id="5d087-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="5d087-144">Hiermee geeft u een Azure S2S VPN-gateway op.</span><span class="sxs-lookup"><span data-stu-id="5d087-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="5d087-145">**Internet**.</span><span class="sxs-lookup"><span data-stu-id="5d087-145">**Internet**.</span></span> <span data-ttu-id="5d087-146">Hiermee geeft u de standaard-internetgateway van de Azure-infrastructuur op.</span><span class="sxs-lookup"><span data-stu-id="5d087-146">Represents the default Internet gateway provided by the Azure Infrastructure.</span></span> <br/> <span data-ttu-id="5d087-147">**Virtueel apparaat**.</span><span class="sxs-lookup"><span data-stu-id="5d087-147">**Virtual Appliance**.</span></span> <span data-ttu-id="5d087-148">Hiermee geeft u een virtueel apparaat op dat u hebt toegevoegd aan uw virtuele Azure-netwerk.</span><span class="sxs-lookup"><span data-stu-id="5d087-148">Represents a virtual appliance you added to your Azure virtual network.</span></span> <br/> <span data-ttu-id="5d087-149">**Geen**.</span><span class="sxs-lookup"><span data-stu-id="5d087-149">**None**.</span></span> <span data-ttu-id="5d087-150">Hiermee geeft u een black hole op.</span><span class="sxs-lookup"><span data-stu-id="5d087-150">Represents a black hole.</span></span> <span data-ttu-id="5d087-151">Pakketten die worden doorgestuurd naar een black hole, worden helemaal niet doorgestuurd.</span><span class="sxs-lookup"><span data-stu-id="5d087-151">Packets forwarded to a black hole will not be forwarded at all.</span></span> |<span data-ttu-id="5d087-152">Overweeg het gebruik van een **virtueel apparaat** om verkeer naar een intern IP-adres van een VM of Azure Load Balancer te leiden.</span><span class="sxs-lookup"><span data-stu-id="5d087-152">Consider using **Virtual Appliance** to direct traffic to a VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="5d087-153">Dit type staat de specificatie van een IP-adres toe, zoals hieronder wordt beschreven.</span><span class="sxs-lookup"><span data-stu-id="5d087-153">This type allows the specification of an IP address as described below.</span></span> <span data-ttu-id="5d087-154">Overweeg het gebruik van het type **Geen** als u het doorsturen van pakketten naar een bepaalde bestemming wilt stoppen.</span><span class="sxs-lookup"><span data-stu-id="5d087-154">Consider using a **None** type to stop packets from flowing to a given destination.</span></span> |
| <span data-ttu-id="5d087-155">Adres van de volgende hop</span><span class="sxs-lookup"><span data-stu-id="5d087-155">Next hop address</span></span> |<span data-ttu-id="5d087-156">Het adres voor de volgende hop bevat het IP-adres waarnaar pakketten moeten worden doorgestuurd.</span><span class="sxs-lookup"><span data-stu-id="5d087-156">The next hop address contains the IP address packets should be forwarded to.</span></span> <span data-ttu-id="5d087-157">Waarden voor de volgende hop zijn alleen toegestaan in routes waar het volgende hoptype *Virtueel apparaat* is.</span><span class="sxs-lookup"><span data-stu-id="5d087-157">Next hop values are only allowed in routes where the next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="5d087-158">Moet een IP-adres zijn dat bereikbaar is binnen het virtuele netwerk waar de door de gebruiker gedefinieerde route wordt toegepast, zonder via een **virtuele netwerkgateway** te gaan.</span><span class="sxs-lookup"><span data-stu-id="5d087-158">Must be an IP address that is reachable within the Virtual Network where the User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="5d087-159">Het IP-adres moet zich bevinden in hetzelfde virtuele netwerk als waar het wordt toegepast, of in een gekoppeld virtueel netwerk.</span><span class="sxs-lookup"><span data-stu-id="5d087-159">The IP address has to be on the same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="5d087-160">Als het IP-adres een VM vertegenwoordigt, moet u [Doorsturen via IP](#IP-forwarding) in Azure voor de VM inschakelen.</span><span class="sxs-lookup"><span data-stu-id="5d087-160">If the IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for the VM.</span></span> <span data-ttu-id="5d087-161">Als het IP-adres het interne IP-adres van een Azure Load Balancer vertegenwoordigt, zorg er dan voor dat u beschikt over een overeenkomende taakverdelingsregel voor elke poort die u wilt verdelen.</span><span class="sxs-lookup"><span data-stu-id="5d087-161">If the IP address represents the internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish to load balance.</span></span>|

<span data-ttu-id="5d087-162">Sommige van de NextHopType-waarden hebben verschillende namen in Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="5d087-162">In Azure PowerShell some of the "NextHopType" values have different names:</span></span>

* <span data-ttu-id="5d087-163">Virtueel netwerk is VnetLocal</span><span class="sxs-lookup"><span data-stu-id="5d087-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="5d087-164">De gateway van het virtuele netwerk is VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="5d087-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="5d087-165">Het virtuele apparaat is VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="5d087-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="5d087-166">Internet is Internet</span><span class="sxs-lookup"><span data-stu-id="5d087-166">Internet is Internet</span></span>
* <span data-ttu-id="5d087-167">Geen is Geen</span><span class="sxs-lookup"><span data-stu-id="5d087-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="5d087-168">Systeemroutes</span><span class="sxs-lookup"><span data-stu-id="5d087-168">System routes</span></span>
<span data-ttu-id="5d087-169">Elk subnet dat in een virtueel netwerk wordt gemaakt, wordt automatisch gekoppeld aan een routetabel met de volgende systeemrouteregels:</span><span class="sxs-lookup"><span data-stu-id="5d087-169">Every subnet created in a virtual network is automatically associated with a route table that contains the following system route rules:</span></span>

* <span data-ttu-id="5d087-170">**Lokale VNnet-regel**: deze regel wordt automatisch gemaakt voor elk subnet in een virtueel netwerk.</span><span class="sxs-lookup"><span data-stu-id="5d087-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="5d087-171">Hiermee wordt aangegeven dat er een directe koppeling tussen de VM's in het VNET is zonder tussenliggende volgende hop.</span><span class="sxs-lookup"><span data-stu-id="5d087-171">It specifies that there is a direct link between the VMs in the VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="5d087-172">**On-premises regel**: deze regel wordt toegepast op al het verkeer naar het on-premises adresbereik en maakt gebruik van VPN-gateway als bestemming voor de volgende hop.</span><span class="sxs-lookup"><span data-stu-id="5d087-172">**On-premises Rule**: This rule applies to all traffic destined to the on-premises address range and uses VPN gateway as the next hop destination.</span></span>
* <span data-ttu-id="5d087-173">**Internetregel**: met deze regel wordt al het verkeer afgehandeld dat bestemd is voor het openbare internet (adresvoorvoegsel 0.0.0.0/0) en wordt gebruikgemaakt van de internetgateway van de infrastructuur als de volgende hop voor al het verkeer dat bestemd is voor internet.</span><span class="sxs-lookup"><span data-stu-id="5d087-173">**Internet Rule**: This rule handles all traffic destined to the public Internet (address prefix 0.0.0.0/0) and uses the infrastructure internet gateway as the next hop for all traffic destined to the Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="5d087-174">Door de gebruiker gedefinieerde routes</span><span class="sxs-lookup"><span data-stu-id="5d087-174">User-defined routes</span></span>
<span data-ttu-id="5d087-175">Voor de meeste omgevingen hebt u alleen de systeemroutes nodig die al zijn gedefinieerd door Azure.</span><span class="sxs-lookup"><span data-stu-id="5d087-175">For most environments you will only need the system routes already defined by Azure.</span></span> <span data-ttu-id="5d087-176">In bepaalde gevallen moet u echter een routetabel maken en een of meer routes toevoegen, zoals bij:</span><span class="sxs-lookup"><span data-stu-id="5d087-176">However, you may need to create a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="5d087-177">Geforceerde tunneling naar internet via uw on-premises netwerk.</span><span class="sxs-lookup"><span data-stu-id="5d087-177">Force tunneling to the Internet via your on-premises network.</span></span>
* <span data-ttu-id="5d087-178">Gebruik van virtuele apparaten in uw Azure-omgeving.</span><span class="sxs-lookup"><span data-stu-id="5d087-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="5d087-179">In de bovenstaande gevallen moet u een routetabel maken en er door de gebruiker gedefinieerde routes aan toevoegen.</span><span class="sxs-lookup"><span data-stu-id="5d087-179">In the scenarios above, you will have to create a route table and add user defined routes to it.</span></span> <span data-ttu-id="5d087-180">U kunt meerdere routetabellen hebben en dezelfde routetabel kan worden gekoppeld aan een of meer subnetten.</span><span class="sxs-lookup"><span data-stu-id="5d087-180">You can have multiple route tables, and the same route table can be associated to one or more subnets.</span></span> <span data-ttu-id="5d087-181">Elk subnet kan slechts worden gekoppeld aan één routetabel.</span><span class="sxs-lookup"><span data-stu-id="5d087-181">And each subnet can only be associated to a single route table.</span></span> <span data-ttu-id="5d087-182">Voor alle VM's en cloudservices in een subnet wordt de routetabel gebruikt die is gekoppeld aan dat subnet.</span><span class="sxs-lookup"><span data-stu-id="5d087-182">All VMs and cloud services in a subnet use the route table associated to that subnet.</span></span>

<span data-ttu-id="5d087-183">Subnetten zijn afhankelijk van systeemroutes totdat er een routetabel aan het subnet gekoppeld is.</span><span class="sxs-lookup"><span data-stu-id="5d087-183">Subnets rely on system routes until a route table is associated to the subnet.</span></span> <span data-ttu-id="5d087-184">Zodra een dergelijke koppeling bestaat, vindt routering plaats op basis van het LPM (Longest Prefix Match, langste overeenkomende voorvoegsel) van door de gebruiker gedefinieerde routes en systeemroutes.</span><span class="sxs-lookup"><span data-stu-id="5d087-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="5d087-185">Als er meer dan één route met dezelfde overeenkomende LPM is, wordt een route geselecteerd op basis van de oorsprong in de volgende volgorde:</span><span class="sxs-lookup"><span data-stu-id="5d087-185">If there is more than one route with the same LPM match then a route is selected based on its origin in the following order:</span></span>

1. <span data-ttu-id="5d087-186">Door de gebruiker gedefinieerde route</span><span class="sxs-lookup"><span data-stu-id="5d087-186">User defined route</span></span>
2. <span data-ttu-id="5d087-187">BGP-route (wanneer u ExpressRoute gebruikt)</span><span class="sxs-lookup"><span data-stu-id="5d087-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="5d087-188">Systeemroute</span><span class="sxs-lookup"><span data-stu-id="5d087-188">System route</span></span>

<span data-ttu-id="5d087-189">Zie [Routes maken en 'Doorsturen via IP' inschakelen in Azure](virtual-network-create-udr-arm-template.md) voor meer informatie over het maken van door de gebruiker gedefinieerde routes.</span><span class="sxs-lookup"><span data-stu-id="5d087-189">To learn how to create user defined routes, see [How to Create Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5d087-190">Door de gebruiker gedefinieerde routes worden alleen toegepast op Azure VM's en cloudservices.</span><span class="sxs-lookup"><span data-stu-id="5d087-190">User defined routes are only applied to Azure VMs and cloud services.</span></span> <span data-ttu-id="5d087-191">Als u bijvoorbeeld een virtueel apparaat voor een firewall tussen uw on-premises netwerk en Azure wilt toevoegen, moet u een door de gebruiker gedefinieerde route voor uw Azure-routetabellen maken waarmee al het verkeer wordt doorgestuurd naar de on-premises adresruimte op het virtuele apparaat.</span><span class="sxs-lookup"><span data-stu-id="5d087-191">For instance, if you want to add a firewall virtual appliance between your on-premises network and Azure, you will have to create a user defined route for your Azure route tables that forwards all traffic going to the on-premises address space to the virtual appliance.</span></span> <span data-ttu-id="5d087-192">U kunt ook een door de gebruiker gedefinieerde route (UDR) toevoegen aan GatewaySubnet om al het on-premises verkeer via het de virtuele apparaat naar Azure door te sturen.</span><span class="sxs-lookup"><span data-stu-id="5d087-192">You can also add a user defined route (UDR) to the GatewaySubnet to forward all traffic from on-premises to Azure through the virtual appliance.</span></span> <span data-ttu-id="5d087-193">Dit is een recente toevoeging.</span><span class="sxs-lookup"><span data-stu-id="5d087-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="5d087-194">BGP-routes</span><span class="sxs-lookup"><span data-stu-id="5d087-194">BGP routes</span></span>
<span data-ttu-id="5d087-195">Als u een ExpressRoute-verbinding tussen uw on-premises netwerk en Azure hebt, kunt u BGP configureren voor het propageren van routes van uw on-premises netwerk naar Azure.</span><span class="sxs-lookup"><span data-stu-id="5d087-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP to propagate routes from your on-premises network to Azure.</span></span> <span data-ttu-id="5d087-196">Deze BGP-routes worden op dezelfde manier gebruikt als systeemroutes en door de gebruiker gedefinieerde routes in elk Azure-subnet.</span><span class="sxs-lookup"><span data-stu-id="5d087-196">These BGP routes are used in the same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="5d087-197">Zie [Inleiding tot ExpressRoute](../expressroute/expressroute-introduction.md) voor meer informatie.</span><span class="sxs-lookup"><span data-stu-id="5d087-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5d087-198">U kunt uw Azure-omgeving configureren voor het gebruik van geforceerde tunneling via uw on-premises netwerk door een door de gebruiker gedefinieerde route voor subnet 0.0.0.0/0 te maken waarin de VPN-gateway wordt gebruikt als de volgende hop.</span><span class="sxs-lookup"><span data-stu-id="5d087-198">You can configure your Azure environment to use force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses the VPN gateway as the next hop.</span></span> <span data-ttu-id="5d087-199">Dit werkt alleen als u een VPN-gateway gebruikt en niet ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="5d087-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="5d087-200">Voor ExpressRoute wordt geforceerde tunneling geconfigureerd via BGP.</span><span class="sxs-lookup"><span data-stu-id="5d087-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="5d087-201">Doorsturen via IP</span><span class="sxs-lookup"><span data-stu-id="5d087-201">IP forwarding</span></span>
<span data-ttu-id="5d087-202">Zoals hierboven beschreven, worden door de gebruiker gedefinieerde routes meestal gemaakt om verkeer door te sturen naar een virtueel apparaat.</span><span class="sxs-lookup"><span data-stu-id="5d087-202">As described above, one of the main reasons to create a user defined route is to forward traffic to a virtual appliance.</span></span> <span data-ttu-id="5d087-203">Een virtueel apparaat is niets meer dan een virtuele machine waarop een toepassing wordt uitgevoerd om netwerkverkeer op een bepaalde manier af te handelen, zoals een firewall of een NAT-apparaat.</span><span class="sxs-lookup"><span data-stu-id="5d087-203">A virtual appliance is nothing more than a VM that runs an application used to handle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="5d087-204">Deze VM op het virtuele apparaat moet in staat zijn om binnenkomend verkeer te ontvangen dat niet is geadresseerd aan zichzelf.</span><span class="sxs-lookup"><span data-stu-id="5d087-204">This virtual appliance VM must be able to receive incoming traffic that is not addressed to itself.</span></span> <span data-ttu-id="5d087-205">Om met een VM verkeer te kunnen ontvangen dat is geadresseerd aan andere bestemmingen, moet u Doorsturen via IP inschakelen voor die VM.</span><span class="sxs-lookup"><span data-stu-id="5d087-205">To allow a VM to receive traffic addressed to other destinations, you must enable IP Forwarding for the VM.</span></span> <span data-ttu-id="5d087-206">Dit is een Azure-instelling, niet een instelling in het gastbesturingssysteem.</span><span class="sxs-lookup"><span data-stu-id="5d087-206">This is an Azure setting, not a setting in the guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="5d087-207">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="5d087-207">Next steps</span></span>
* <span data-ttu-id="5d087-208">Ontdek hoe u [routes maakt in het implementatiemodel van Resource Manager](virtual-network-create-udr-arm-template.md) en deze koppelt aan subnetten.</span><span class="sxs-lookup"><span data-stu-id="5d087-208">Learn how to [create routes in the Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them to subnets.</span></span> 
* <span data-ttu-id="5d087-209">Ontdek hoe u [routes maakt in het klassieke implementatiemodel](virtual-network-create-udr-classic-ps.md) en deze koppelt aan subnetten.</span><span class="sxs-lookup"><span data-stu-id="5d087-209">Learn how to [create routes in the classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them to subnets.</span></span>

