---
title: aaaHybrid verbinding met 2-tier-toepassing | Microsoft Docs
description: Meer informatie over hoe toodeploy virtuele apparaten en UDR toocreate de omgeving van een toepassing met meerdere lagen in Azure
services: virtual-network
documentationcenter: na
author: jimdial
manager: carmonm
editor: tysonn
ms.assetid: 1f509bec-bdd1-470d-8aa4-3cf2bb7f6134
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/05/2016
ms.author: jdial
ms.openlocfilehash: 53599862289dbf9c6ab3289b0cb8dda6430f20f7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 10/06/2017
---
# <a name="virtual-appliance-scenario"></a><span data-ttu-id="2d157-103">Virtueel apparaat scenario</span><span class="sxs-lookup"><span data-stu-id="2d157-103">Virtual appliance scenario</span></span>
<span data-ttu-id="2d157-104">Een veelvoorkomend scenario tussen groter Azure klant is Hallo nodig tooprovide een toepassing met twee lagen die toegankelijk is toohello Internet, en tegelijkertijd toegang toohello back-laag van een on-premises datacenter.</span><span class="sxs-lookup"><span data-stu-id="2d157-104">A common scenario among larger Azure customer is hello need tooprovide a two-tiered application exposed toohello Internet, while allowing access toohello back tier from an on-premises datacenter.</span></span> <span data-ttu-id="2d157-105">Dit document begeleidt u stapsgewijs door een scenario waarbij de gebruiker gedefinieerde Routes (UDR), een VPN-Gateway en netwerk virtuele apparaten toodeploy een omgeving met twee lagen die voldoet aan Hallo volgens de vereisten:</span><span class="sxs-lookup"><span data-stu-id="2d157-105">This document will walk you through a scenario using User Defined Routes (UDR), a VPN Gateway, and network virtual appliances toodeploy a two-tier environment that meets hello following requirements:</span></span>

* <span data-ttu-id="2d157-106">Webtoepassing toegankelijk moet zijn vanop Hallo alleen het openbare Internet.</span><span class="sxs-lookup"><span data-stu-id="2d157-106">Web application must be accessible from hello public Internet only.</span></span>
* <span data-ttu-id="2d157-107">Hosting Hallo webtoepassing-server moet kunnen tooaccess een back-end-toepassingsserver.</span><span class="sxs-lookup"><span data-stu-id="2d157-107">Web server hosting hello application must be able tooaccess a backend application server.</span></span>
* <span data-ttu-id="2d157-108">Al het verkeer van Hallo Internet toohello webtoepassing moet via een virtueel firewallapparaat gaan.</span><span class="sxs-lookup"><span data-stu-id="2d157-108">All traffic from hello Internet toohello web application must go through a firewall virtual appliance.</span></span> <span data-ttu-id="2d157-109">Deze virtueel apparaat wordt gebruikt voor Internet-verkeer.</span><span class="sxs-lookup"><span data-stu-id="2d157-109">This virtual appliance will be used for Internet traffic only.</span></span>
* <span data-ttu-id="2d157-110">Alle verkeer dat hierheen gaat toohello toepassingsserver moet gaan via een firewall virtueel apparaat.</span><span class="sxs-lookup"><span data-stu-id="2d157-110">All traffic going toohello application server must go through a firewall virtual appliance.</span></span> <span data-ttu-id="2d157-111">Deze virtueel apparaat wordt gebruikt voor toegang tot toohello back-endserver en toegang afkomstig van Hallo on-premises netwerk via een VPN-Gateway.</span><span class="sxs-lookup"><span data-stu-id="2d157-111">This virtual appliance will be used for access toohello backend end server, and access coming in from hello on-premises network via a VPN Gateway.</span></span>
* <span data-ttu-id="2d157-112">Beheerders moeten kunnen toomanage Hallo firewall virtuele apparaten van hun lokale computers, met behulp van een derde firewall virtueel apparaat gebruikt uitsluitend voor beheerdoeleinden.</span><span class="sxs-lookup"><span data-stu-id="2d157-112">Administrators must be able toomanage hello firewall virtual appliances from their on-premises computers, by using a third firewall virtual appliance used exclusively for management purposes.</span></span>

<span data-ttu-id="2d157-113">Dit is een standaard DMZ scenario met een Perimeternetwerk en een beveiligd netwerk.</span><span class="sxs-lookup"><span data-stu-id="2d157-113">This is a standard DMZ scenario with a DMZ and a protected network.</span></span> <span data-ttu-id="2d157-114">Dergelijke scenario kan worden gemaakt in Azure met nsg's, firewall virtuele apparaten of een combinatie van beide.</span><span class="sxs-lookup"><span data-stu-id="2d157-114">Such scenario can be constructed in Azure by using NSGs, firewall virtual appliances, or a combination of both.</span></span> <span data-ttu-id="2d157-115">Hallo in de volgende tabel bevat enkele van Hallo-voor- en nadelen tussen nsg's en virtuele firewallapparaten.</span><span class="sxs-lookup"><span data-stu-id="2d157-115">hello table below shows some of hello pros and cons between NSGs and firewall virtual appliances.</span></span>

|  | <span data-ttu-id="2d157-116">Professionals</span><span class="sxs-lookup"><span data-stu-id="2d157-116">Pros</span></span> | <span data-ttu-id="2d157-117">Nadelen</span><span class="sxs-lookup"><span data-stu-id="2d157-117">Cons</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2d157-118">NSG</span><span class="sxs-lookup"><span data-stu-id="2d157-118">NSG</span></span> |<span data-ttu-id="2d157-119">Er zijn geen kosten.</span><span class="sxs-lookup"><span data-stu-id="2d157-119">No cost.</span></span> <br/><span data-ttu-id="2d157-120">Geïntegreerd in Azure RBAC.</span><span class="sxs-lookup"><span data-stu-id="2d157-120">Integrated into Azure RBAC.</span></span> <br/><span data-ttu-id="2d157-121">Regels kunnen worden gemaakt in ARM-sjablonen.</span><span class="sxs-lookup"><span data-stu-id="2d157-121">Rules can be created in ARM templates.</span></span> |<span data-ttu-id="2d157-122">Complexiteit kan variëren in grotere omgevingen.</span><span class="sxs-lookup"><span data-stu-id="2d157-122">Complexity could vary in larger environments.</span></span> |
| <span data-ttu-id="2d157-123">Firewall</span><span class="sxs-lookup"><span data-stu-id="2d157-123">Firewall</span></span> |<span data-ttu-id="2d157-124">Volledige controle over vlak van gegevens.</span><span class="sxs-lookup"><span data-stu-id="2d157-124">Full control over data plane.</span></span> <br/><span data-ttu-id="2d157-125">Centraal beheer via de firewall-console.</span><span class="sxs-lookup"><span data-stu-id="2d157-125">Central management through firewall console.</span></span> |<span data-ttu-id="2d157-126">Kosten van de firewall-apparaat.</span><span class="sxs-lookup"><span data-stu-id="2d157-126">Cost of firewall appliance.</span></span> <br/><span data-ttu-id="2d157-127">Niet geïntegreerd met Azure RBAC.</span><span class="sxs-lookup"><span data-stu-id="2d157-127">Not integrated with Azure RBAC.</span></span> |

<span data-ttu-id="2d157-128">Hallo oplossing onderstaande gebruikt firewall virtuele apparaten tooimplement een DMZ/beveiligd netwerk scenario.</span><span class="sxs-lookup"><span data-stu-id="2d157-128">hello solution below uses firewall virtual appliances tooimplement a DMZ/protected network scenario.</span></span>

## <a name="considerations"></a><span data-ttu-id="2d157-129">Overwegingen</span><span class="sxs-lookup"><span data-stu-id="2d157-129">Considerations</span></span>
<span data-ttu-id="2d157-130">U kunt Hallo-omgeving die hierboven worden uitgelegd in Azure met behulp van verschillende functies die beschikbaar zijn vandaag, als volgt implementeren.</span><span class="sxs-lookup"><span data-stu-id="2d157-130">You can deploy hello environment explained above in Azure using different features available today, as follows.</span></span>

* <span data-ttu-id="2d157-131">**Virtueel netwerk (VNet)**.</span><span class="sxs-lookup"><span data-stu-id="2d157-131">**Virtual network (VNet)**.</span></span> <span data-ttu-id="2d157-132">Een Azure VNet fungeert in vergelijkbare wijze tooan on-premises netwerk en kunnen worden gesegmenteerd in een of meer subnetten tooprovide verkeersisolatie en scheiding van problemen.</span><span class="sxs-lookup"><span data-stu-id="2d157-132">An Azure VNet acts in similar fashion tooan on-premises network, and can be segmented into one or more subnets tooprovide traffic isolation, and separation of concerns.</span></span>
* <span data-ttu-id="2d157-133">**Virtueel apparaat**.</span><span class="sxs-lookup"><span data-stu-id="2d157-133">**Virtual appliance**.</span></span> <span data-ttu-id="2d157-134">Diverse partners bieden virtuele apparaten in hello Azure Marketplace die kunnen worden gebruikt voor de drie firewalls Hallo die hierboven worden beschreven.</span><span class="sxs-lookup"><span data-stu-id="2d157-134">Several partners provide virtual appliances in hello Azure Marketplace that can be used for hello three firewalls described above.</span></span> 
* <span data-ttu-id="2d157-135">**De gebruiker gedefinieerde Routes (UDR)**.</span><span class="sxs-lookup"><span data-stu-id="2d157-135">**User Defined Routes (UDR)**.</span></span> <span data-ttu-id="2d157-136">Routetabellen kunnen udr's die worden gebruikt door Azure netwerken toocontrol Hallo stroom van pakketten binnen een VNet bevatten.</span><span class="sxs-lookup"><span data-stu-id="2d157-136">Route tables can contain UDRs used by Azure networking toocontrol hello flow of packets within a VNet.</span></span> <span data-ttu-id="2d157-137">Deze routetabellen kunnen worden toegepast toosubnets.</span><span class="sxs-lookup"><span data-stu-id="2d157-137">These route tables can be applied toosubnets.</span></span> <span data-ttu-id="2d157-138">Een van de nieuwste functies Hallo in Azure is Hallo mogelijkheid tooapply een route tabel toohello GatewaySubnet, bieden Hallo mogelijkheid tooforward al het verkeer afkomstig is van een virtueel apparaat voor hybride verbinding tooa in hello Azure VNet.</span><span class="sxs-lookup"><span data-stu-id="2d157-138">One of hello newest features in Azure is hello ability tooapply a route table toohello GatewaySubnet, providing hello ability tooforward all traffic coming into hello Azure VNet from a hybrid connection tooa virtual appliance.</span></span>
* <span data-ttu-id="2d157-139">**Doorsturen via IP**.</span><span class="sxs-lookup"><span data-stu-id="2d157-139">**IP Forwarding**.</span></span> <span data-ttu-id="2d157-140">Standaard hello Azure VPN-engine doorsturen van pakketten toovirtual netwerkinterfacekaarten (NIC's) alleen als Hallo pakket doel-IP-adres overeenkomt met de Hallo NIC IP-adres.</span><span class="sxs-lookup"><span data-stu-id="2d157-140">By default, hello Azure networking engine forward packets toovirtual network interface cards (NICs) only if hello packet destination IP address matches hello NIC IP address.</span></span> <span data-ttu-id="2d157-141">Als een UDR definieert een pakket tooa gegeven virtueel apparaat moet worden verzonden, zou hello Azure VPN-engine daarom dat pakket verwijderen.</span><span class="sxs-lookup"><span data-stu-id="2d157-141">Therefore, if a UDR defines that a packet must be sent tooa given virtual appliance, hello Azure networking engine would drop that packet.</span></span> <span data-ttu-id="2d157-142">tooensure hello pakket tooa VM (in dit geval een virtueel apparaat), die niet de werkelijke bestemming Hallo Hallo pakket wordt geleverd, moet u doorsturen via IP tooenable voor Hallo virtueel apparaat.</span><span class="sxs-lookup"><span data-stu-id="2d157-142">tooensure hello packet is delivered tooa VM (in this case a virtual appliance) that is not hello actual destination for hello packet, you need tooenable IP Forwarding for hello virtual appliance.</span></span>
* <span data-ttu-id="2d157-143">**Netwerkbeveiligingsgroepen (nsg's)**.</span><span class="sxs-lookup"><span data-stu-id="2d157-143">**Network Security Groups (NSGs)**.</span></span> <span data-ttu-id="2d157-144">Hallo in het volgende voorbeeld maakt geen gebruik van het nsg's, maar u kunt nsg's toegepast toohello subnetten en/of NIC's in deze oplossing toofurther filter Hallo binnenkomend en uitgaand verkeer die subnetten en NIC's.</span><span class="sxs-lookup"><span data-stu-id="2d157-144">hello example below does not make use of NSGs, but you could use NSGs applied toohello subnets and/or NICs in this solution toofurther filter hello traffic in and out of those subnets and NICs.</span></span>

![IPv6-connectiviteit](./media/virtual-network-scenario-udr-gw-nva/figure01.png)

<span data-ttu-id="2d157-146">In dit voorbeeld is er een abonnement dat Hallo volgende bevat:</span><span class="sxs-lookup"><span data-stu-id="2d157-146">In this example there is a subscription that contains hello following:</span></span>

* <span data-ttu-id="2d157-147">2 resourcegroepen, niet weergegeven in Hallo-diagram.</span><span class="sxs-lookup"><span data-stu-id="2d157-147">2 resource groups, not shown in hello diagram.</span></span> 
  * <span data-ttu-id="2d157-148">**ONPREMRG**.</span><span class="sxs-lookup"><span data-stu-id="2d157-148">**ONPREMRG**.</span></span> <span data-ttu-id="2d157-149">Bevat alle resources nodig toosimulate een on-premises netwerk.</span><span class="sxs-lookup"><span data-stu-id="2d157-149">Contains all resources necessary toosimulate an on-premises network.</span></span>
  * <span data-ttu-id="2d157-150">**AZURERG**.</span><span class="sxs-lookup"><span data-stu-id="2d157-150">**AZURERG**.</span></span> <span data-ttu-id="2d157-151">Bevat alle resources die nodig zijn voor Hallo virtueel netwerk van Azure-omgeving.</span><span class="sxs-lookup"><span data-stu-id="2d157-151">Contains all resources necessary for hello Azure virtual network environment.</span></span> 
* <span data-ttu-id="2d157-152">Een VNet met de naam **onpremvnet** toomimic een on-premises datacenter gesegmenteerde hieronder vermelde gebruikt.</span><span class="sxs-lookup"><span data-stu-id="2d157-152">A VNet named **onpremvnet** used toomimic an on-premises datacenter segmented as listed below.</span></span>
  * <span data-ttu-id="2d157-153">**onpremsn1**.</span><span class="sxs-lookup"><span data-stu-id="2d157-153">**onpremsn1**.</span></span> <span data-ttu-id="2d157-154">Subnet met een virtuele machine (VM) die met Ubuntu toomimic een on-premises server.</span><span class="sxs-lookup"><span data-stu-id="2d157-154">Subnet containing a virtual machine (VM) running Ubuntu toomimic an on-premises server.</span></span>
  * <span data-ttu-id="2d157-155">**onpremsn2**.</span><span class="sxs-lookup"><span data-stu-id="2d157-155">**onpremsn2**.</span></span> <span data-ttu-id="2d157-156">Subnet met een virtuele machine Ubuntu toomimic met een on-premises-computer die wordt gebruikt door een beheerder.</span><span class="sxs-lookup"><span data-stu-id="2d157-156">Subnet containing a VM running Ubuntu toomimic an on-premises computer used by an administrator.</span></span>
* <span data-ttu-id="2d157-157">Er is een firewall virtueel apparaat met de naam **OPFW** op **onpremvnet** toomaintain een tunnel te gebruikt**azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="2d157-157">There is one firewall virtual appliance named **OPFW** on **onpremvnet** used toomaintain a tunnel too**azurevnet**.</span></span>
* <span data-ttu-id="2d157-158">Een VNet met de naam **azurevnet** gesegmenteerde zoals hieronder weergegeven.</span><span class="sxs-lookup"><span data-stu-id="2d157-158">A VNet named **azurevnet** segmented as listed below.</span></span>
  * <span data-ttu-id="2d157-159">**azsn1**.</span><span class="sxs-lookup"><span data-stu-id="2d157-159">**azsn1**.</span></span> <span data-ttu-id="2d157-160">Externe firewall subnet uitsluitend voor Hallo externe firewall gebruikt.</span><span class="sxs-lookup"><span data-stu-id="2d157-160">External firewall subnet used exclusively for hello external firewall.</span></span> <span data-ttu-id="2d157-161">Al het internetverkeer wordt geleverd in via dit subnet.</span><span class="sxs-lookup"><span data-stu-id="2d157-161">All Internet traffic will come in through this subnet.</span></span> <span data-ttu-id="2d157-162">Dit subnet bevat alleen een gekoppelde NIC toohello externe firewall.</span><span class="sxs-lookup"><span data-stu-id="2d157-162">This subnet only contains a NIC linked toohello external firewall.</span></span>
  * <span data-ttu-id="2d157-163">**azsn2**.</span><span class="sxs-lookup"><span data-stu-id="2d157-163">**azsn2**.</span></span> <span data-ttu-id="2d157-164">Front-end-subnet die als host fungeert voor een virtuele machine wordt uitgevoerd als een webserver die kan worden bereikt vanaf Hallo Internet.</span><span class="sxs-lookup"><span data-stu-id="2d157-164">Front end subnet hosting a VM running as a web server that will be accessed from hello Internet.</span></span>
  * <span data-ttu-id="2d157-165">**azsn3**.</span><span class="sxs-lookup"><span data-stu-id="2d157-165">**azsn3**.</span></span> <span data-ttu-id="2d157-166">Back-end subnet die als host fungeert voor een virtuele machine een back-end-toepassingsserver die wordt geopend door Hallo front-end-webserver uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="2d157-166">Backend subnet hosting a VM running a backend application server that will be accessed by hello front end web server.</span></span>
  * <span data-ttu-id="2d157-167">**azsn4**.</span><span class="sxs-lookup"><span data-stu-id="2d157-167">**azsn4**.</span></span> <span data-ttu-id="2d157-168">Management subnet gebruikt uitsluitend tooprovide management toegang tooall firewall virtuele apparaten.</span><span class="sxs-lookup"><span data-stu-id="2d157-168">Management subnet used exclusively tooprovide management access tooall firewall virtual appliances.</span></span> <span data-ttu-id="2d157-169">Dit subnet bevat alleen een NIC voor elke firewall virtueel apparaat gebruikt voor Hallo-oplossing.</span><span class="sxs-lookup"><span data-stu-id="2d157-169">This subnet only contains a NIC for each firewall virtual appliance used in hello solution.</span></span>
  * <span data-ttu-id="2d157-170">**GatewaySubnet**.</span><span class="sxs-lookup"><span data-stu-id="2d157-170">**GatewaySubnet**.</span></span> <span data-ttu-id="2d157-171">Azure hybride verbinding subnet vereist voor de ExpressRoute- en VPN-Gateway tooprovide-connectiviteit tussen Azure VNets en andere netwerken.</span><span class="sxs-lookup"><span data-stu-id="2d157-171">Azure hybrid connection subnet required for ExpressRoute and VPN Gateway tooprovide connectivity between Azure VNets and other networks.</span></span> 
* <span data-ttu-id="2d157-172">Er zijn 3 firewall virtuele apparaten in Hallo **azurevnet** netwerk.</span><span class="sxs-lookup"><span data-stu-id="2d157-172">There are 3 firewall virtual appliances in hello **azurevnet** network.</span></span> 
  * <span data-ttu-id="2d157-173">**AZF1**.</span><span class="sxs-lookup"><span data-stu-id="2d157-173">**AZF1**.</span></span> <span data-ttu-id="2d157-174">Externe firewall blootgesteld toohello openbare Internet met behulp van een openbare IP-adres resource in Azure.</span><span class="sxs-lookup"><span data-stu-id="2d157-174">External firewall exposed toohello public Internet by using a public IP address resource in Azure.</span></span> <span data-ttu-id="2d157-175">U moet tooensure die u hebt een sjabloon van Hallo Marketplace, of rechtstreeks van de leverancier van uw apparaat, dat voorziet in een virtueel apparaat 3-NIC.</span><span class="sxs-lookup"><span data-stu-id="2d157-175">You need tooensure you have a template from hello Marketplace, or directly from your appliance vendor, that provisions a 3-NIC virtual appliance.</span></span>
  * <span data-ttu-id="2d157-176">**AZF2**.</span><span class="sxs-lookup"><span data-stu-id="2d157-176">**AZF2**.</span></span> <span data-ttu-id="2d157-177">Interne firewall gebruikt toocontrol verkeer tussen **azsn2** en **azsn3**.</span><span class="sxs-lookup"><span data-stu-id="2d157-177">Internal firewall used toocontrol traffic between **azsn2** and **azsn3**.</span></span> <span data-ttu-id="2d157-178">Dit is ook een 3-NIC virtueel apparaat.</span><span class="sxs-lookup"><span data-stu-id="2d157-178">This is also a 3-NIC virtual appliance.</span></span>
  * <span data-ttu-id="2d157-179">**AZF3**.</span><span class="sxs-lookup"><span data-stu-id="2d157-179">**AZF3**.</span></span> <span data-ttu-id="2d157-180">Beheer van firewall toegankelijk tooadministrators van Hallo on-premises datacenter, en verbonden tooa management subnet gebruikt toomanage alle firewallapparaten.</span><span class="sxs-lookup"><span data-stu-id="2d157-180">Management firewall accessible tooadministrators from hello on-premises datacenter, and connected tooa management subnet used toomanage all firewall appliances.</span></span> <span data-ttu-id="2d157-181">U kunt 2-NIC sjablonen voor virtueel apparaat vinden in Hallo Marketplace of aanvragen rechtstreeks bij de leverancier van uw apparaat.</span><span class="sxs-lookup"><span data-stu-id="2d157-181">You can find 2-NIC virtual appliance templates in hello Marketplace, or request one directly from your appliance vendor.</span></span>

## <a name="user-defined-routing-udr"></a><span data-ttu-id="2d157-182">Door de gebruiker gedefinieerde Routering</span><span class="sxs-lookup"><span data-stu-id="2d157-182">User Defined Routing (UDR)</span></span>
<span data-ttu-id="2d157-183">Elk subnet in Azure mag gekoppelde tooa UDR tabel die wordt gebruikt toodefine hoe in dat subnet gestart verkeer wordt gerouteerd.</span><span class="sxs-lookup"><span data-stu-id="2d157-183">Each subnet in Azure can be linked tooa UDR table used toodefine how traffic initiated in that subnet is routed.</span></span> <span data-ttu-id="2d157-184">Als er geen udr's zijn gedefinieerd, wordt standaard routes tooallow verkeer tooflow uit één subnet tooanother gebruikt in Azure.</span><span class="sxs-lookup"><span data-stu-id="2d157-184">If no UDRs are defined, Azure uses default routes tooallow traffic tooflow from one subnet tooanother.</span></span> <span data-ttu-id="2d157-185">toobetter udr's begrijpen, gaat u naar [wat de gebruiker gedefinieerde Routes en doorsturen via IP zijn](virtual-networks-udr-overview.md#ip-forwarding).</span><span class="sxs-lookup"><span data-stu-id="2d157-185">toobetter understand UDRs, visit [What are User Defined Routes and IP Forwarding](virtual-networks-udr-overview.md#ip-forwarding).</span></span>

<span data-ttu-id="2d157-186">tooensure communicatie vindt plaats via Hallo rechts firewallapparaat, op basis van de laatste vereiste Hallo hierboven, moet u toocreate Hallo volgende met udr's in de routetabel **azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="2d157-186">tooensure communication is done through hello right firewall appliance, based on hello last requirement above, you need toocreate hello following route table containing UDRs in **azurevnet**.</span></span>

### <a name="azgwudr"></a><span data-ttu-id="2d157-187">azgwudr</span><span class="sxs-lookup"><span data-stu-id="2d157-187">azgwudr</span></span>
<span data-ttu-id="2d157-188">Hallo alleen verkeer van de lokale tooAzure gebruikte toomanage Hallo firewalls door verbinding te maken in dit scenario**AZF3**, en dat verkeer Hallo interne firewall, moet via **AZF2**.</span><span class="sxs-lookup"><span data-stu-id="2d157-188">In this scenario, hello only traffic flowing from on-premises tooAzure will be used toomanage hello firewalls by connecting too**AZF3**, and that traffic must go through hello internal firewall, **AZF2**.</span></span> <span data-ttu-id="2d157-189">Slechts één route is daarom nodig in Hallo **GatewaySubnet** zoals hieronder wordt weergegeven.</span><span class="sxs-lookup"><span data-stu-id="2d157-189">Therefore, only one route is necessary in hello **GatewaySubnet** as shown below.</span></span>

| <span data-ttu-id="2d157-190">Doel</span><span class="sxs-lookup"><span data-stu-id="2d157-190">Destination</span></span> | <span data-ttu-id="2d157-191">Volgende hop</span><span class="sxs-lookup"><span data-stu-id="2d157-191">Next hop</span></span> | <span data-ttu-id="2d157-192">Uitleg</span><span class="sxs-lookup"><span data-stu-id="2d157-192">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2d157-193">10.0.4.0/24</span><span class="sxs-lookup"><span data-stu-id="2d157-193">10.0.4.0/24</span></span> |<span data-ttu-id="2d157-194">10.0.3.11</span><span class="sxs-lookup"><span data-stu-id="2d157-194">10.0.3.11</span></span> |<span data-ttu-id="2d157-195">Lokale verkeer tooreach management firewall kunt **AZF3**</span><span class="sxs-lookup"><span data-stu-id="2d157-195">Allows on-premises traffic tooreach management firewall **AZF3**</span></span> |

### <a name="azsn2udr"></a><span data-ttu-id="2d157-196">azsn2udr</span><span class="sxs-lookup"><span data-stu-id="2d157-196">azsn2udr</span></span>
| <span data-ttu-id="2d157-197">Doel</span><span class="sxs-lookup"><span data-stu-id="2d157-197">Destination</span></span> | <span data-ttu-id="2d157-198">Volgende hop</span><span class="sxs-lookup"><span data-stu-id="2d157-198">Next hop</span></span> | <span data-ttu-id="2d157-199">Uitleg</span><span class="sxs-lookup"><span data-stu-id="2d157-199">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2d157-200">10.0.3.0/24</span><span class="sxs-lookup"><span data-stu-id="2d157-200">10.0.3.0/24</span></span> |<span data-ttu-id="2d157-201">10.0.2.11</span><span class="sxs-lookup"><span data-stu-id="2d157-201">10.0.2.11</span></span> |<span data-ttu-id="2d157-202">Kan subnet voor back-end van verkeer toohello die als host fungeert voor de toepassingsserver Hallo via **AZF2**</span><span class="sxs-lookup"><span data-stu-id="2d157-202">Allows traffic toohello backend subnet hosting hello application server through **AZF2**</span></span> |
| <span data-ttu-id="2d157-203">0.0.0.0/0</span><span class="sxs-lookup"><span data-stu-id="2d157-203">0.0.0.0/0</span></span> |<span data-ttu-id="2d157-204">10.0.2.10</span><span class="sxs-lookup"><span data-stu-id="2d157-204">10.0.2.10</span></span> |<span data-ttu-id="2d157-205">Hiermee kunt u alle andere verkeer toobe doorgestuurd via **AZF1**</span><span class="sxs-lookup"><span data-stu-id="2d157-205">Allows all other traffic toobe routed through **AZF1**</span></span> |

### <a name="azsn3udr"></a><span data-ttu-id="2d157-206">azsn3udr</span><span class="sxs-lookup"><span data-stu-id="2d157-206">azsn3udr</span></span>
| <span data-ttu-id="2d157-207">Doel</span><span class="sxs-lookup"><span data-stu-id="2d157-207">Destination</span></span> | <span data-ttu-id="2d157-208">Volgende hop</span><span class="sxs-lookup"><span data-stu-id="2d157-208">Next hop</span></span> | <span data-ttu-id="2d157-209">Uitleg</span><span class="sxs-lookup"><span data-stu-id="2d157-209">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2d157-210">10.0.2.0/24</span><span class="sxs-lookup"><span data-stu-id="2d157-210">10.0.2.0/24</span></span> |<span data-ttu-id="2d157-211">10.0.3.10</span><span class="sxs-lookup"><span data-stu-id="2d157-211">10.0.3.10</span></span> |<span data-ttu-id="2d157-212">Gegevensverkeer te**azsn2** tooflow van app-server toohello webserver via **AZF2**</span><span class="sxs-lookup"><span data-stu-id="2d157-212">Allows traffic too**azsn2** tooflow from app server toohello webserver through **AZF2**</span></span> |

<span data-ttu-id="2d157-213">U moet ook routetabellen toocreate voor Hallo subnetten in **onpremvnet** toomimic Hallo lokale datacenter.</span><span class="sxs-lookup"><span data-stu-id="2d157-213">You also need toocreate route tables for hello subnets in **onpremvnet** toomimic hello on-premises datacenter.</span></span>

### <a name="onpremsn1udr"></a><span data-ttu-id="2d157-214">onpremsn1udr</span><span class="sxs-lookup"><span data-stu-id="2d157-214">onpremsn1udr</span></span>
| <span data-ttu-id="2d157-215">Doel</span><span class="sxs-lookup"><span data-stu-id="2d157-215">Destination</span></span> | <span data-ttu-id="2d157-216">Volgende hop</span><span class="sxs-lookup"><span data-stu-id="2d157-216">Next hop</span></span> | <span data-ttu-id="2d157-217">Uitleg</span><span class="sxs-lookup"><span data-stu-id="2d157-217">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2d157-218">192.168.2.0/24</span><span class="sxs-lookup"><span data-stu-id="2d157-218">192.168.2.0/24</span></span> |<span data-ttu-id="2d157-219">192.168.1.4</span><span class="sxs-lookup"><span data-stu-id="2d157-219">192.168.1.4</span></span> |<span data-ttu-id="2d157-220">Gegevensverkeer te**onpremsn2** via **OPFW**</span><span class="sxs-lookup"><span data-stu-id="2d157-220">Allows traffic too**onpremsn2** through **OPFW**</span></span> |

### <a name="onpremsn2udr"></a><span data-ttu-id="2d157-221">onpremsn2udr</span><span class="sxs-lookup"><span data-stu-id="2d157-221">onpremsn2udr</span></span>
| <span data-ttu-id="2d157-222">Doel</span><span class="sxs-lookup"><span data-stu-id="2d157-222">Destination</span></span> | <span data-ttu-id="2d157-223">Volgende hop</span><span class="sxs-lookup"><span data-stu-id="2d157-223">Next hop</span></span> | <span data-ttu-id="2d157-224">Uitleg</span><span class="sxs-lookup"><span data-stu-id="2d157-224">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="2d157-225">10.0.3.0/24</span><span class="sxs-lookup"><span data-stu-id="2d157-225">10.0.3.0/24</span></span> |<span data-ttu-id="2d157-226">192.168.2.4</span><span class="sxs-lookup"><span data-stu-id="2d157-226">192.168.2.4</span></span> |<span data-ttu-id="2d157-227">Kan verkeerssubnet toohello back in Azure maakt via **OPFW**</span><span class="sxs-lookup"><span data-stu-id="2d157-227">Allows traffic toohello backed subnet in Azure through **OPFW**</span></span> |
| <span data-ttu-id="2d157-228">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="2d157-228">192.168.1.0/24</span></span> |<span data-ttu-id="2d157-229">192.168.2.4</span><span class="sxs-lookup"><span data-stu-id="2d157-229">192.168.2.4</span></span> |<span data-ttu-id="2d157-230">Gegevensverkeer te**onpremsn1** via **OPFW**</span><span class="sxs-lookup"><span data-stu-id="2d157-230">Allows traffic too**onpremsn1** through **OPFW**</span></span> |

## <a name="ip-forwarding"></a><span data-ttu-id="2d157-231">Doorsturen via IP</span><span class="sxs-lookup"><span data-stu-id="2d157-231">IP Forwarding</span></span>
<span data-ttu-id="2d157-232">Zijn de functies die u in combinatie tooallow virtuele apparaten toobe gebruikt toocontrol netwerkverkeer in een Azure-VNet gebruiken kunt UDR en doorsturen via IP.</span><span class="sxs-lookup"><span data-stu-id="2d157-232">UDR and IP Forwarding are features that you can use in combination tooallow virtual appliances toobe used toocontrol traffic flow in an Azure VNet.</span></span>  <span data-ttu-id="2d157-233">Een virtueel apparaat is niets meer dan een virtuele machine die een toepassing die wordt gebruikt toohandle-netwerkverkeer in een bepaalde manier, zoals een firewall of een NAT-apparaat wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="2d157-233">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="2d157-234">Deze virtueel apparaat die VM kunnen tooreceive inkomend verkeer die moet worden verholpen niet tooitself.</span><span class="sxs-lookup"><span data-stu-id="2d157-234">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="2d157-235">een VM-verkeer tooreceive tooallow geadresseerd tooother bestemmingen, u moet voor Hallo VM doorsturen via IP inschakelen.</span><span class="sxs-lookup"><span data-stu-id="2d157-235">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="2d157-236">Dit is een Azure-instelling, niet een instelling in het gastbesturingssysteem Hallo.</span><span class="sxs-lookup"><span data-stu-id="2d157-236">This is an Azure setting, not a setting in hello guest operating system.</span></span> <span data-ttu-id="2d157-237">Uw nog steeds behoeften-toorun van virtueel apparaat, enkele toepassing toohandle type Hallo binnenkomend verkeer en op de juiste wijze omgeleid.</span><span class="sxs-lookup"><span data-stu-id="2d157-237">Your virtual appliance still needs toorun some type of application toohandle hello incoming traffic, and route it appropriately.</span></span>

<span data-ttu-id="2d157-238">toolearn meer informatie over het doorsturen via IP, gaat u naar [wat de gebruiker gedefinieerde Routes en doorsturen via IP zijn](virtual-networks-udr-overview.md#ip-forwarding).</span><span class="sxs-lookup"><span data-stu-id="2d157-238">toolearn more about IP Forwarding, visit [What are User Defined Routes and IP Forwarding](virtual-networks-udr-overview.md#ip-forwarding).</span></span>

<span data-ttu-id="2d157-239">Stel, dat u hebt Hallo na de installatie in een Azure vnet bijvoorbeeld:</span><span class="sxs-lookup"><span data-stu-id="2d157-239">As an example, imagine you have hello following setup in an Azure vnet:</span></span>

* <span data-ttu-id="2d157-240">Subnet **onpremsn1** bevat een virtuele machine met de naam **onpremvm1**.</span><span class="sxs-lookup"><span data-stu-id="2d157-240">Subnet **onpremsn1** contains a VM named **onpremvm1**.</span></span>
* <span data-ttu-id="2d157-241">Subnet **onpremsn2** bevat een virtuele machine met de naam **onpremvm2**.</span><span class="sxs-lookup"><span data-stu-id="2d157-241">Subnet **onpremsn2** contains a VM named **onpremvm2**.</span></span>
* <span data-ttu-id="2d157-242">Een virtueel apparaat met de naam **OPFW** te is verbonden**onpremsn1** en **onpremsn2**.</span><span class="sxs-lookup"><span data-stu-id="2d157-242">A virtual appliance named **OPFW** is connected too**onpremsn1** and **onpremsn2**.</span></span>
* <span data-ttu-id="2d157-243">Een door de gebruiker gedefinieerde route gekoppeld te**onpremsn1** geeft aan dat alle te verkeer**onpremsn2** te moeten worden verzonden**OPFW**.</span><span class="sxs-lookup"><span data-stu-id="2d157-243">A user defined route linked too**onpremsn1** specifies that all traffic too**onpremsn2** must be sent too**OPFW**.</span></span>

<span data-ttu-id="2d157-244">Op dit punt, als **onpremvm1** tooestablish probeert een verbinding met **onpremvm2**, hello UDR wordt gebruikt en verkeer te worden verzonden**OPFW** als Hallo volgende hop.</span><span class="sxs-lookup"><span data-stu-id="2d157-244">At this point, if **onpremvm1** tries tooestablish a connection with **onpremvm2**, hello UDR will be used and traffic will be sent too**OPFW** as hello next hop.</span></span> <span data-ttu-id="2d157-245">Houd er rekening mee dat het doel van de daadwerkelijke pakket Hallo wordt niet gewijzigd, wordt nog steeds aangegeven **onpremvm2** Hallo doel.</span><span class="sxs-lookup"><span data-stu-id="2d157-245">Keep in mind that hello actual packet destination is not being changed, it still says **onpremvm2** is hello destination.</span></span> 

<span data-ttu-id="2d157-246">Zonder de IP-doorsturen is ingeschakeld voor **OPFW**, hello Azure virtuele netwerken logica wordt hello-pakketten verwijderen, omdat alleen pakketten toobe verzonden tooa VM als hello van de virtuele machine IP-adres Hallo bestemming voor hello-pakket.</span><span class="sxs-lookup"><span data-stu-id="2d157-246">Without IP Forwarding enabled for **OPFW**, hello Azure virtual networking logic will drop hello packets, since it only allows packets toobe sent tooa VM if hello VM’s IP address is hello destination for hello packet.</span></span>

<span data-ttu-id="2d157-247">Met het doorsturen van IP-stuurt Hallo logica van de virtuele Azure-netwerk hello-pakketten tooOPFW, zonder dat u de oorspronkelijke doeladres wijzigt.</span><span class="sxs-lookup"><span data-stu-id="2d157-247">With IP Forwarding, hello Azure virtual network logic will forward hello packets tooOPFW, without changing its original destination address.</span></span> <span data-ttu-id="2d157-248">**OPFW** moet verwerken hello-pakketten en bepalen welke toodo mee.</span><span class="sxs-lookup"><span data-stu-id="2d157-248">**OPFW** must handle hello packets and determine what toodo with them.</span></span>

<span data-ttu-id="2d157-249">Voor de bovenstaande toowork Hallo scenario, moet u inschakelen op Hallo NIC's voor doorsturen via IP **OPFW**, **AZF1**, **AZF2**, en **AZF3** die worden gebruikt voor routering (alle NIC's, behalve Hallo die zijn gekoppeld toohello management subnet).</span><span class="sxs-lookup"><span data-stu-id="2d157-249">For hello scenario above toowork, you must enable IP Forwarding on hello NICs for **OPFW**, **AZF1**, **AZF2**, and **AZF3** that are used for routing (all NICs except hello ones linked toohello management subnet).</span></span> 

## <a name="firewall-rules"></a><span data-ttu-id="2d157-250">Firewallregels</span><span class="sxs-lookup"><span data-stu-id="2d157-250">Firewall Rules</span></span>
<span data-ttu-id="2d157-251">Zoals hierboven wordt beschreven, doorsturen via IP alleen zorgt ervoor dat pakketten toohello virtuele apparaten worden verzonden.</span><span class="sxs-lookup"><span data-stu-id="2d157-251">As described above, IP Forwarding only ensures packets are sent toohello virtual appliances.</span></span> <span data-ttu-id="2d157-252">Uw apparaat moet nog steeds toodecide welke toodo met deze pakketten.</span><span class="sxs-lookup"><span data-stu-id="2d157-252">Your appliance still needs toodecide what toodo with those packets.</span></span> <span data-ttu-id="2d157-253">Hallo bovenstaande scenario moet u toocreate Hallo regels in uw apparaten te volgen:</span><span class="sxs-lookup"><span data-stu-id="2d157-253">In hello scenario above, you will need toocreate hello following rules in your appliances:</span></span>

### <a name="opfw"></a><span data-ttu-id="2d157-254">OPFW</span><span class="sxs-lookup"><span data-stu-id="2d157-254">OPFW</span></span>
<span data-ttu-id="2d157-255">OPFW vertegenwoordigt een on-premises-apparaat met Hallo volgens de regels voor:</span><span class="sxs-lookup"><span data-stu-id="2d157-255">OPFW represents an on-premises device containing hello following rules:</span></span>

* <span data-ttu-id="2d157-256">**Route**: alle verkeer too10.0.0.0/16 (**azurevnet**) moet worden verzonden via de tunnel **ONPREMAZURE**.</span><span class="sxs-lookup"><span data-stu-id="2d157-256">**Route**: All traffic too10.0.0.0/16 (**azurevnet**) must be sent through tunnel **ONPREMAZURE**.</span></span>
* <span data-ttu-id="2d157-257">**Beleid**: alle bidirectionele verkeer tussen **port2** en **ONPREMAZURE**.</span><span class="sxs-lookup"><span data-stu-id="2d157-257">**Policy**: Allow all bidirectional traffic between **port2** and **ONPREMAZURE**.</span></span>

### <a name="azf1"></a><span data-ttu-id="2d157-258">AZF1</span><span class="sxs-lookup"><span data-stu-id="2d157-258">AZF1</span></span>
<span data-ttu-id="2d157-259">AZF1 vertegenwoordigt een Azure virtueel apparaat Hallo volgens de regels met:</span><span class="sxs-lookup"><span data-stu-id="2d157-259">AZF1 represents an Azure virtual appliance containing hello following rules:</span></span>

* <span data-ttu-id="2d157-260">**Beleid**: alle bidirectionele verkeer tussen **port1** en **port2**.</span><span class="sxs-lookup"><span data-stu-id="2d157-260">**Policy**: Allow all bidirectional traffic between **port1** and **port2**.</span></span>

### <a name="azf2"></a><span data-ttu-id="2d157-261">AZF2</span><span class="sxs-lookup"><span data-stu-id="2d157-261">AZF2</span></span>
<span data-ttu-id="2d157-262">AZF2 vertegenwoordigt een Azure virtueel apparaat Hallo volgens de regels met:</span><span class="sxs-lookup"><span data-stu-id="2d157-262">AZF2 represents an Azure virtual appliance containing hello following rules:</span></span>

* <span data-ttu-id="2d157-263">**Route**: alle verkeer too10.0.0.0/16 (**onpremvnet**) toohello Azure-gateway IP-adres (dat wil zeggen 10.0.0.1) moet worden verzonden via **port1**.</span><span class="sxs-lookup"><span data-stu-id="2d157-263">**Route**: All traffic too10.0.0.0/16 (**onpremvnet**) must be sent toohello Azure gateway IP address (i.e. 10.0.0.1) through **port1**.</span></span>
* <span data-ttu-id="2d157-264">**Beleid**: alle bidirectionele verkeer tussen **port1** en **port2**.</span><span class="sxs-lookup"><span data-stu-id="2d157-264">**Policy**: Allow all bidirectional traffic between **port1** and **port2**.</span></span>

## <a name="network-security-groups-nsgs"></a><span data-ttu-id="2d157-265">Netwerkbeveiligingsgroepen (nsg's)</span><span class="sxs-lookup"><span data-stu-id="2d157-265">Network Security Groups (NSGs)</span></span>
<span data-ttu-id="2d157-266">Nsg's worden in dit scenario wordt niet gebruikt.</span><span class="sxs-lookup"><span data-stu-id="2d157-266">In this scenario, NSGs are not being used.</span></span> <span data-ttu-id="2d157-267">U kunt echter nsg's tooeach subnet toorestrict binnenkomend en uitgaand verkeer toepassen.</span><span class="sxs-lookup"><span data-stu-id="2d157-267">However, you could apply NSGs tooeach subnet toorestrict incoming and outgoing traffic.</span></span> <span data-ttu-id="2d157-268">U kunt bijvoorbeeld Hallo volgende NSG-regels toohello externe FW subnet toepassen.</span><span class="sxs-lookup"><span data-stu-id="2d157-268">For instance, you could apply hello following NSG rules toohello external FW subnet.</span></span>

<span data-ttu-id="2d157-269">**Binnenkomende**</span><span class="sxs-lookup"><span data-stu-id="2d157-269">**Incoming**</span></span>

* <span data-ttu-id="2d157-270">Alle TCP-verkeer van Hallo Internet tooport 80 op elke virtuele machine in Hallo subnet toestaan.</span><span class="sxs-lookup"><span data-stu-id="2d157-270">Allow all TCP traffic from hello Internet tooport 80 on any VM in hello subnet.</span></span>
* <span data-ttu-id="2d157-271">Al het andere verkeer vanaf Hallo Internet weigeren.</span><span class="sxs-lookup"><span data-stu-id="2d157-271">Deny all other traffic from hello Internet.</span></span>

<span data-ttu-id="2d157-272">**Uitgaande**</span><span class="sxs-lookup"><span data-stu-id="2d157-272">**Outgoing**</span></span>

* <span data-ttu-id="2d157-273">Alle verkeer toohello Internet weigeren.</span><span class="sxs-lookup"><span data-stu-id="2d157-273">Deny all traffic toohello Internet.</span></span>

## <a name="high-level-steps"></a><span data-ttu-id="2d157-274">Hoog niveau stappen</span><span class="sxs-lookup"><span data-stu-id="2d157-274">High level steps</span></span>
<span data-ttu-id="2d157-275">toodeploy in dit scenario Hallo hoog niveau stappen hieronder.</span><span class="sxs-lookup"><span data-stu-id="2d157-275">toodeploy this scenario, follow hello high level steps below.</span></span>

1. <span data-ttu-id="2d157-276">Aanmelding tooyour Azure-abonnement.</span><span class="sxs-lookup"><span data-stu-id="2d157-276">Login tooyour Azure Subscription.</span></span>
2. <span data-ttu-id="2d157-277">Als u een VNet toomimic hello toodeploy lokale netwerk wilt, Hallo-resources die deel van uitmaken inrichten **ONPREMRG**.</span><span class="sxs-lookup"><span data-stu-id="2d157-277">If you want toodeploy a VNet toomimic hello on-premises network, provision hello resources that are part of **ONPREMRG**.</span></span>
3. <span data-ttu-id="2d157-278">Hallo-resources die deel van uitmaken inrichten **AZURERG**.</span><span class="sxs-lookup"><span data-stu-id="2d157-278">Provision hello resources that are part of **AZURERG**.</span></span>
4. <span data-ttu-id="2d157-279">Hallo-tunnel inrichten van **onpremvnet** te**azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="2d157-279">Provision hello tunnel from **onpremvnet** too**azurevnet**.</span></span>
5. <span data-ttu-id="2d157-280">Zodra alle resources zijn ingericht, meld u aan te**onpremvm2** en ping 10.0.3.101 tootest connectiviteit tussen **onpremsn2** en **azsn3**.</span><span class="sxs-lookup"><span data-stu-id="2d157-280">Once all resources are provisioned, log on too**onpremvm2** and ping 10.0.3.101 tootest connectivity between **onpremsn2** and **azsn3**.</span></span>

