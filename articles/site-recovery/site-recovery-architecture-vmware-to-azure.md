---
title: Hoe werkt VMware-replicatie naar Azure in Azure Site Recovery? | Microsoft Docs
description: "Dit artikel biedt een overzicht van de onderdelen en architectuur die worden gebruikt bij het repliceren van on-premises VMware-VM’s en fysieke servers naar Azure met de Azure Site Recovery-service"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 05/29/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: vmware-walkthrough-architecture
ms.openlocfilehash: 81f02c1277ae8a2c377ca0d6db67ec4211e9aa5e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="how-does-vmware-replication-to-azure-work-in-site-recovery"></a><span data-ttu-id="eefaf-104">Hoe werkt VMware-replicatie naar Azure in Site Recovery?</span><span class="sxs-lookup"><span data-stu-id="eefaf-104">How does VMware replication to Azure work in Site Recovery?</span></span>

<span data-ttu-id="eefaf-105">In dit artikel worden de onderdelen en processen beschreven die betrokken zijn bij het repliceren van on-premises virtuele VMware-machines en fysieke Windows- of Linux-servers naar Azure met de [Azure Site Recovery](site-recovery-overview.md)-service.</span><span class="sxs-lookup"><span data-stu-id="eefaf-105">This article describes the components and processes involved when replicating on-premises VMware virtual machines, and Windows/Linux physical servers, to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="eefaf-106">Wanneer u fysieke on-premises servers naar Azure wilt repliceren, gebruikt u dezelfde onderdelen en processen als bij VMware VM-replicatie. Houd echter de volgende verschillen in gedachten:</span><span class="sxs-lookup"><span data-stu-id="eefaf-106">When you replicate physical on-premises servers to Azure, replication uses also the same components and processes as VMware VM replication, with these differences:</span></span>

- <span data-ttu-id="eefaf-107">U kunt als configuratieserver een fysieke server gebruiken in plaats van een virtuele VMware-machine.</span><span class="sxs-lookup"><span data-stu-id="eefaf-107">You can use a physical server for the configuration server, instead of a VMware VM.</span></span>
- <span data-ttu-id="eefaf-108">U hebt een on-premises VMware-infrastructuur nodig voor failback.</span><span class="sxs-lookup"><span data-stu-id="eefaf-108">You will need an on-premises VMware infrastructure for failback.</span></span> <span data-ttu-id="eefaf-109">U kunt geen failback uitvoeren naar een fysieke computer.</span><span class="sxs-lookup"><span data-stu-id="eefaf-109">You can't fail back to a physical machine.</span></span>

<span data-ttu-id="eefaf-110">Eventuele opmerkingen kunt u onderaan dit artikel plaatsen of vragen stellen op het [Azure Recovery Services-forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="eefaf-110">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="eefaf-111">Architectuuronderdelen</span><span class="sxs-lookup"><span data-stu-id="eefaf-111">Architectural components</span></span>

<span data-ttu-id="eefaf-112">Er zijn een aantal onderdelen die zijn betrokken bij het repliceren van virtuele VMware-machines en fysieke servers naar Azure.</span><span class="sxs-lookup"><span data-stu-id="eefaf-112">There are a number of components involved when replicating VMware VMs and physical servers to Azure.</span></span>

<span data-ttu-id="eefaf-113">**Onderdeel**</span><span class="sxs-lookup"><span data-stu-id="eefaf-113">**Component**</span></span> | <span data-ttu-id="eefaf-114">**Locatie**</span><span class="sxs-lookup"><span data-stu-id="eefaf-114">**Location**</span></span> | <span data-ttu-id="eefaf-115">**Details**</span><span class="sxs-lookup"><span data-stu-id="eefaf-115">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="eefaf-116">**Azure**</span><span class="sxs-lookup"><span data-stu-id="eefaf-116">**Azure**</span></span> | <span data-ttu-id="eefaf-117">U hebt in Azure een Azure-account, een Azure-opslagaccount en een Azure-netwerk nodig.</span><span class="sxs-lookup"><span data-stu-id="eefaf-117">In Azure you need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="eefaf-118">Gerepliceerde gegevens worden opgeslagen in het opslagaccount. Azure-VM’s worden gemaakt met de gerepliceerde gegevens bij failover van uw on-premises site.</span><span class="sxs-lookup"><span data-stu-id="eefaf-118">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span> <span data-ttu-id="eefaf-119">De Azure-VM's maken verbinding met het virtuele Azure-netwerk wanneer ze worden gemaakt.</span><span class="sxs-lookup"><span data-stu-id="eefaf-119">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="eefaf-120">**Configuratieserver**</span><span class="sxs-lookup"><span data-stu-id="eefaf-120">**Configuration server**</span></span> | <span data-ttu-id="eefaf-121">Eén lokale beheerserver (VMWare VM) die alle voor de implementatie benodigde on-premises onderdelen uitvoert, met inbegrip van de configuratieserver, processerver, hoofddoelserver</span><span class="sxs-lookup"><span data-stu-id="eefaf-121">A single on-premises management server (VMWare VM) that runs all the on-premises components that are needed for the deployment, including the configuration server, process server, master target server</span></span> | <span data-ttu-id="eefaf-122">Het configuratieserveronderdeel coördineert de communicatie tussen on-premises en Azure, en beheert de gegevensreplicatie.</span><span class="sxs-lookup"><span data-stu-id="eefaf-122">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="eefaf-123">**Processerver**:</span><span class="sxs-lookup"><span data-stu-id="eefaf-123">**Process server**:</span></span>  | <span data-ttu-id="eefaf-124">standaard geïnstalleerd op de configuratieserver.</span><span class="sxs-lookup"><span data-stu-id="eefaf-124">Installed by default on the configuration server.</span></span> | <span data-ttu-id="eefaf-125">Fungeert als replicatiegateway.</span><span class="sxs-lookup"><span data-stu-id="eefaf-125">Acts as a replication gateway.</span></span> <span data-ttu-id="eefaf-126">Dit onderdeel ontvangt replicatiegegevens, optimaliseert de gegevens met caching, compressie en codering, en verzendt ze naar de Azure-opslag.</span><span class="sxs-lookup"><span data-stu-id="eefaf-126">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="eefaf-127">De processerver verwerkt ook de push-installatie van de Mobility-service naar beveiligde computers en voert automatische detectie van virtuele VMware-machines uit.</span><span class="sxs-lookup"><span data-stu-id="eefaf-127">The process server also handles push installation of the Mobility service to protected machines, and performs automatic discovery of VMware VMs.</span></span><br/><br/> <span data-ttu-id="eefaf-128">Naarmate uw implementatie groeit, kunt u extra, afzonderlijk toegewezen processervers toevoegen om het toenemende replicatieverkeer af te handelen.</span><span class="sxs-lookup"><span data-stu-id="eefaf-128">As your deployment grows you can add additional separate dedicated process servers to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="eefaf-129">**Hoofddoelserver**</span><span class="sxs-lookup"><span data-stu-id="eefaf-129">**Master target server**</span></span> | <span data-ttu-id="eefaf-130">Standaard geïnstalleerd op de on-premises configuratieserver.</span><span class="sxs-lookup"><span data-stu-id="eefaf-130">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="eefaf-131">Hier worden de replicatiegegevens tijdens de failback vanuit Azure afgehandeld.</span><span class="sxs-lookup"><span data-stu-id="eefaf-131">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="eefaf-132">Als de hoeveelheid failbackverkeer hoog is, kunt u een afzonderlijke hoofddoelserver voor failback implementeren.</span><span class="sxs-lookup"><span data-stu-id="eefaf-132">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="eefaf-133">**VMware-servers**</span><span class="sxs-lookup"><span data-stu-id="eefaf-133">**VMware servers**</span></span> | <span data-ttu-id="eefaf-134">Virtuele VMware-machines worden gehost op vSphere ESXi-servers. Het wordt aangeraden om een vCenter-server te gebruiken om de hosts te beheren.</span><span class="sxs-lookup"><span data-stu-id="eefaf-134">VMware VMs are hosted on vSphere ESXi servers, and we recommend a vCenter server to manage the hosts.</span></span> | <span data-ttu-id="eefaf-135">U voegt VMware-servers toe aan uw Recovery Services-kluis.</span><span class="sxs-lookup"><span data-stu-id="eefaf-135">You add VMware servers to your Recovery Services vault.</span></span>
<span data-ttu-id="eefaf-136">**Gerepliceerde machines**</span><span class="sxs-lookup"><span data-stu-id="eefaf-136">**Replicated machines**</span></span> | <span data-ttu-id="eefaf-137">De Mobility-service wordt geïnstalleerd op elke virtuele VMware-machine die u wilt repliceren.</span><span class="sxs-lookup"><span data-stu-id="eefaf-137">The Mobility service will be installed on each VMware VM you want to replicate.</span></span> <span data-ttu-id="eefaf-138">Deze kan handmatig worden geïnstalleerd op elke computer, of met een push-installatie van de processerver.</span><span class="sxs-lookup"><span data-stu-id="eefaf-138">It can be installed manually on each machine, or with a push installation from the process server.</span></span>

<span data-ttu-id="eefaf-139">Meer informatie over de implementatievereisten en de vereisten voor elk van deze onderdelen vindt u in de [ondersteuningsmatrix](site-recovery-support-matrix-to-azure.md).</span><span class="sxs-lookup"><span data-stu-id="eefaf-139">Learn about the deployment prerequisites and requirements for each of these components in the [support matrix](site-recovery-support-matrix-to-azure.md).</span></span>

<span data-ttu-id="eefaf-140">**Afbeelding 1: onderdelen van VMware naar Azure**</span><span class="sxs-lookup"><span data-stu-id="eefaf-140">**Figure 1: VMware to Azure components**</span></span>

![Onderdelen](./media/site-recovery-components/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="eefaf-142">Replicatieproces</span><span class="sxs-lookup"><span data-stu-id="eefaf-142">Replication process</span></span>

1. <span data-ttu-id="eefaf-143">U stelt de implementatie, met inbegrip van Azure-onderdelen, en een Recovery Services-kluis in.</span><span class="sxs-lookup"><span data-stu-id="eefaf-143">You set up the deployment, including Azure components, and a Recovery Services vault.</span></span> <span data-ttu-id="eefaf-144">In de kluis geeft u de replicatiebron en het replicatiedoel op, stelt u de configuratieserver in, voegt u VMware-servers toe, maakt u een replicatiebeleid, implementeert u de Mobility-service, schakelt u de replicatie in en voert u een failovertest uit.</span><span class="sxs-lookup"><span data-stu-id="eefaf-144">In the vault you specify the replication source and target, set up the configuration server, add VMware servers, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="eefaf-145">Machines beginnen met de replicatie volgens het replicatiebeleid. Een initiële kopie van de gegevens wordt gerepliceerd naar Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="eefaf-145">Machines start replicating in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
4. <span data-ttu-id="eefaf-146">De replicatie van deltaverschillen naar Azure begint nadat de initiële replicatie is voltooid.</span><span class="sxs-lookup"><span data-stu-id="eefaf-146">Replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="eefaf-147">Bijgehouden wijzigingen voor een machine worden opgeslagen in een .hrl-bestand.</span><span class="sxs-lookup"><span data-stu-id="eefaf-147">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="eefaf-148">Replicerende machines communiceren met de configuratieserver op inkomende HTTPS-poort 443 voor replicatie.</span><span class="sxs-lookup"><span data-stu-id="eefaf-148">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="eefaf-149">Replicerende machines verzenden replicatiegegevens naar de processerver op inkomende HTTPS-poort 9443 (kan worden geconfigureerd).</span><span class="sxs-lookup"><span data-stu-id="eefaf-149">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be configured).</span></span>
    - <span data-ttu-id="eefaf-150">De configuratieserver coördineert het replicatiebeheer met Azure via de uitgaande HTTPS-poort 443.</span><span class="sxs-lookup"><span data-stu-id="eefaf-150">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="eefaf-151">De processerver ontvangt gegevens van de bronmachines, optimaliseert en versleutelt deze gegevens en verzendt ze naar Azure Storage via de uitgaande poort 443.</span><span class="sxs-lookup"><span data-stu-id="eefaf-151">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="eefaf-152">Als u consistentie tussen meerdere VM's inschakelt, communiceren machines in de replicatiegroep met elkaar via poort 20004.</span><span class="sxs-lookup"><span data-stu-id="eefaf-152">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="eefaf-153">Meerdere VM’s worden gebruikt als u meerdere machines groepeert in de replicatiegroepen die crashconsistent en app-consistent herstelpunten delen bij failover.</span><span class="sxs-lookup"><span data-stu-id="eefaf-153">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="eefaf-154">Dit is handig als machines dezelfde workload gebruiken en consistent moeten zijn.</span><span class="sxs-lookup"><span data-stu-id="eefaf-154">This is useful if machines are running the same workload and need to be consistent.</span></span>
5. <span data-ttu-id="eefaf-155">Verkeer wordt via internet gerepliceerd naar de openbare eindpunten van Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="eefaf-155">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="eefaf-156">U kunt ook [openbare peering](../expressroute/expressroute-circuit-peerings.md#public-peering) van Azure ExpressRoute gebruiken.</span><span class="sxs-lookup"><span data-stu-id="eefaf-156">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="eefaf-157">Het repliceren van verkeer via een site-naar-site-VPN van een on-premises site naar Azure wordt niet ondersteund.</span><span class="sxs-lookup"><span data-stu-id="eefaf-157">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>

<span data-ttu-id="eefaf-158">**Afbeelding 2: replicatie van VMware naar Azure**</span><span class="sxs-lookup"><span data-stu-id="eefaf-158">**Figure 2: VMware to Azure replication**</span></span>

![Verbeterd](./media/site-recovery-components/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="eefaf-160">Failover- en failbackproces</span><span class="sxs-lookup"><span data-stu-id="eefaf-160">Failover and failback process</span></span>

1. <span data-ttu-id="eefaf-161">Wanneer u hebt gecontroleerd of de testfailover is geslaagd, kunt u naar behoefte niet-geplande failovers naar Azure uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="eefaf-161">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="eefaf-162">Geplande failover wordt niet ondersteund.</span><span class="sxs-lookup"><span data-stu-id="eefaf-162">Planned failover isn't supported.</span></span>
2. <span data-ttu-id="eefaf-163">U kunt een failover van één machine uitvoeren of [herstelplannen](site-recovery-create-recovery-plans.md) maken om failovers van meerdere virtuele machines uit te voeren.</span><span class="sxs-lookup"><span data-stu-id="eefaf-163">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple VMs.</span></span>
3. <span data-ttu-id="eefaf-164">Wanneer u een failover uitvoert, worden er replica-VM's gemaakt in Azure.</span><span class="sxs-lookup"><span data-stu-id="eefaf-164">When you run a failover, replica VMs are created in Azure.</span></span> <span data-ttu-id="eefaf-165">U geeft een failover toegang tot de workload via de replica van de Azure-VM.</span><span class="sxs-lookup"><span data-stu-id="eefaf-165">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
4. <span data-ttu-id="eefaf-166">Als uw primaire on-premises site weer beschikbaar is, kunt u een failback uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="eefaf-166">When your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="eefaf-167">U stelt een infrastructuur voor failback in, start de replicatie van de machine vanaf de secundaire site naar de primaire site en voert een niet-geplande failover uit vanaf de secundaire site.</span><span class="sxs-lookup"><span data-stu-id="eefaf-167">You set up a failback infrastructure, start replicating the machine from the secondary site to the primary, and run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="eefaf-168">Nadat u deze failover doorvoert, worden de gegevens teruggeplaatst op de on-premises site en moet u de replicatie naar Azure opnieuw inschakelen.</span><span class="sxs-lookup"><span data-stu-id="eefaf-168">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span> [<span data-ttu-id="eefaf-169">Meer informatie</span><span class="sxs-lookup"><span data-stu-id="eefaf-169">Learn more</span></span>](site-recovery-failback-azure-to-vmware.md)

<span data-ttu-id="eefaf-170">Er zijn enkele vereisten voor een failback:</span><span class="sxs-lookup"><span data-stu-id="eefaf-170">There are a few failback requirements:</span></span>


- <span data-ttu-id="eefaf-171">**Tijdelijke processerver in Azure**: als u na een failover een failback vanuit Azure wilt uitvoeren, moet u een virtuele Azure-machine hebben geconfigureerd als processerver, om de replicatie vanuit Azure af te handelen.</span><span class="sxs-lookup"><span data-stu-id="eefaf-171">**Temporary process server in Azure**: If you want to fail back from Azure after failover you'll need to set up an Azure VM configured as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="eefaf-172">U kunt deze virtuele machine verwijderen wanneer de failback is voltooid.</span><span class="sxs-lookup"><span data-stu-id="eefaf-172">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="eefaf-173">**VPN-verbinding**: voor de failback moet u een VPN-verbinding (of Azure ExpressRoute) hebben ingesteld van het Azure-netwerk naar de on-premises site.</span><span class="sxs-lookup"><span data-stu-id="eefaf-173">**VPN connection**: For failback you'll need a VPN connection (or Azure ExpressRoute) set up from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="eefaf-174">**Afzonderlijke on-premises hoofddoelserver**: op de on-premises hoofddoelserver wordt de failback afgehandeld.</span><span class="sxs-lookup"><span data-stu-id="eefaf-174">**Separate on-premises master target server**: The on-premises master target server handles failback.</span></span> <span data-ttu-id="eefaf-175">De hoofddoelserver wordt standaard op de beheerserver geïnstalleerd, maar als u een failback van grotere hoeveelheden verkeer uitvoert, kunt u voor dit doel beter een afzonderlijke on-premises hoofddoelserver instellen.</span><span class="sxs-lookup"><span data-stu-id="eefaf-175">The master target server is installed by default on the management server, but if you're failing back larger volumes of traffic you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="eefaf-176">**Failbackbeleid**: als u wilt repliceren naar de on-premises site, hebt u een failbackbeleid nodig.</span><span class="sxs-lookup"><span data-stu-id="eefaf-176">**Failback policy**: To replicate back to your on-premises site, you need a failback policy.</span></span> <span data-ttu-id="eefaf-177">Dit wordt automatisch gemaakt wanneer u uw replicatiebeleid maakt.</span><span class="sxs-lookup"><span data-stu-id="eefaf-177">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="eefaf-178">**VMware-infrastructuur**: u moet een failback uitvoeren naar een lokale virtuele VMware-machine.</span><span class="sxs-lookup"><span data-stu-id="eefaf-178">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="eefaf-179">Dit betekent dat u een on-premises VMware-infrastructuur nodig hebt, zelfs als u fysieke on-premises servers naar Azure repliceert.</span><span class="sxs-lookup"><span data-stu-id="eefaf-179">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="eefaf-180">**Afbeelding 3: failback van VMware/fysieke failback**</span><span class="sxs-lookup"><span data-stu-id="eefaf-180">**Figure 3: VMware/physical failback**</span></span>

![Failback](./media/site-recovery-components/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="eefaf-182">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="eefaf-182">Next steps</span></span>

<span data-ttu-id="eefaf-183">De [ondersteuningsmatrix](site-recovery-support-matrix-to-azure.md) controleren</span><span class="sxs-lookup"><span data-stu-id="eefaf-183">Review the [support matrix](site-recovery-support-matrix-to-azure.md)</span></span>
