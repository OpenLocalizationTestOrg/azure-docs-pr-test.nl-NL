---
title: Hoe werkt Hyper-V-replicatie naar Azure in Site Recovery? | Microsoft Docs
description: Dit artikel geeft een overzicht van de werking van Hyper-V-replicatie in Azure Site Recovery
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: jwhit
editor: 
ms.assetid: c413efcd-d750-4b22-b34b-15bcaa03934a
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 06/14/2017
ms.author: raynew
ROBOTS: NOINDEX, NOFOLLOW
redirect_url: site-recovery-architecture-hyper-v-to-azure
ms.openlocfilehash: 6fa952af93033f82effdef418903fc93d94dd05c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: nl-NL
ms.lasthandoff: 07/11/2017
---
# <a name="how-does-hyper-v-replication-to-azure-work"></a><span data-ttu-id="67217-104">Hoe werkt Hyper-V-replicatie naar Azure?</span><span class="sxs-lookup"><span data-stu-id="67217-104">How does Hyper-V replication to Azure work?</span></span>

<span data-ttu-id="67217-105">Lees dit artikel voor een beter begrip van de architectuur en werkstromen voor Hyper-V-replicatie naar Azure met behulp van de [Azure Site Recovery](site-recovery-overview.md)-service.</span><span class="sxs-lookup"><span data-stu-id="67217-105">Read this article to understand the architecture and workflows for Hyper-V replication to Azure using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="67217-106">U kunt onder aan dit artikel of op het [Azure Recovery Services-forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr) opmerkingen plaatsen.</span><span class="sxs-lookup"><span data-stu-id="67217-106">Post any comments at the bottom of this article, or in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>

<span data-ttu-id="67217-107">U kunt het volgende repliceren naar Azure:</span><span class="sxs-lookup"><span data-stu-id="67217-107">You can replicate the following to Azure:</span></span>
- <span data-ttu-id="67217-108">**Hyper-V met VMM**: VM's op on-premises Hyper-V-hosts die in System Center Virtual Machine Manager-clouds (VMM) worden beheerd.</span><span class="sxs-lookup"><span data-stu-id="67217-108">**Hyper-V with VMM**: VMs located on on-premises Hyper-V hosts managed in  System Center Virtual MAchine Manager (VMM) clouds.</span></span> <span data-ttu-id="67217-109">Hosts kunnen worden uitgevoerd op elk [ondersteund besturingssysteem](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span><span class="sxs-lookup"><span data-stu-id="67217-109">Hosts can be running any [supported operating system](site-recovery-support-matrix-to-azure.md#support-for-datacenter-management-servers).</span></span> <span data-ttu-id="67217-110">U kunt virtuele Hyper-V-machines repliceren waarop gastbesturingssystemen worden uitgevoerd die [worden ondersteund door Hyper-V en Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="67217-110">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>
- <span data-ttu-id="67217-111">**Hyper-V zonder VMM**: on-premises VM's op Hyper-V-hosts die niet worden beheerd in VMM-clouds.</span><span class="sxs-lookup"><span data-stu-id="67217-111">**Hyper-V without VMM**: On-premises VMs located on Hyper-V hosts that aren't managed in VMM clouds.</span></span> <span data-ttu-id="67217-112">Hosts kunnen elk van de [ondersteunde besturingssystemen](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions) uitvoeren.</span><span class="sxs-lookup"><span data-stu-id="67217-112">Hosts can run any of the [supported operating systems](site-recovery-support-matrix-to-azure.md#support-for-replicated-machine-os-versions).</span></span> <span data-ttu-id="67217-113">U kunt virtuele Hyper-V-machines repliceren waarop gastbesturingssystemen worden uitgevoerd die [worden ondersteund door Hyper-V en Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span><span class="sxs-lookup"><span data-stu-id="67217-113">You can replicate Hyper-V VMs running any guest operating system [supported by Hyper-V and Azure](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/supported-windows-guest-operating-systems-for-hyper-v-on-windows).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="67217-114">Architectuuronderdelen</span><span class="sxs-lookup"><span data-stu-id="67217-114">Architectural components</span></span>

<span data-ttu-id="67217-115">**Onderwerp**</span><span class="sxs-lookup"><span data-stu-id="67217-115">**Area**</span></span> | <span data-ttu-id="67217-116">**Onderdeel**</span><span class="sxs-lookup"><span data-stu-id="67217-116">**Component**</span></span> | <span data-ttu-id="67217-117">**Details**</span><span class="sxs-lookup"><span data-stu-id="67217-117">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="67217-118">**Azure**</span><span class="sxs-lookup"><span data-stu-id="67217-118">**Azure**</span></span> | <span data-ttu-id="67217-119">U hebt in Azure een Microsoft Azure-account, een Azure-opslagaccount en een Azure-netwerk nodig.</span><span class="sxs-lookup"><span data-stu-id="67217-119">In Azure you need a Microsoft Azure account, an Azure storage account, and a Azure network.</span></span> | <span data-ttu-id="67217-120">Opslag en netwerk kunnen Resource Manager-gebaseerd of klassieke accounts zijn.</span><span class="sxs-lookup"><span data-stu-id="67217-120">Storage and network can be Resource Manager-based, or classic accounts.</span></span><br/><br/> <span data-ttu-id="67217-121">Gerepliceerde gegevens worden opgeslagen in het opslagaccount. Azure-VM’s worden gemaakt met de gerepliceerde gegevens bij failover van uw on-premises site.</span><span class="sxs-lookup"><span data-stu-id="67217-121">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover from your on-premises site occurs.</span></span><br/><br/> <span data-ttu-id="67217-122">De Azure-VM's maken verbinding met het virtuele Azure-netwerk wanneer ze worden gemaakt.</span><span class="sxs-lookup"><span data-stu-id="67217-122">The Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="67217-123">**VMM-server**</span><span class="sxs-lookup"><span data-stu-id="67217-123">**VMM server**</span></span> | <span data-ttu-id="67217-124">Hyper-V-hosts die zich in VMM-clouds bevinden</span><span class="sxs-lookup"><span data-stu-id="67217-124">Hyper-V hosts located in VMM clouds</span></span> | <span data-ttu-id="67217-125">Als Hyper-V-hosts in VMM-clouds worden beheerd, kunt u de VMM-server registreren in de Recovery Services-kluis.</span><span class="sxs-lookup"><span data-stu-id="67217-125">If Hyper-V hosts are managed in VMM clouds, you register the VMM server in the Recovery Services vault.</span></span><br/><br/> <span data-ttu-id="67217-126">U installeert de Site Recovery-provider op de VMM-server om replicatie te beheren met Azure.</span><span class="sxs-lookup"><span data-stu-id="67217-126">On the VMM server you install the Site Recovery Provider to orchestrate replication with Azure.</span></span><br/><br/> <span data-ttu-id="67217-127">U hebt ingestelde logische en VM-netwerken nodig om netwerktoewijzing te configureren.</span><span class="sxs-lookup"><span data-stu-id="67217-127">You need logical and VM networks set up to configure network mapping.</span></span> <span data-ttu-id="67217-128">Een netwerk met virtuele machines moet zijn gekoppeld aan een logisch netwerk dat verbinding heeft met de cloud.</span><span class="sxs-lookup"><span data-stu-id="67217-128">A VM network should be linked to a logical network that's associated with the cloud.</span></span>
<span data-ttu-id="67217-129">**Hyper-V-host**</span><span class="sxs-lookup"><span data-stu-id="67217-129">**Hyper-V host**</span></span> | <span data-ttu-id="67217-130">Hyper-V-servers kunnen worden geïmplementeerd met of zonder de VMM-server.</span><span class="sxs-lookup"><span data-stu-id="67217-130">Hyper-V servers can be deployed with or without VMM server.</span></span> | <span data-ttu-id="67217-131">Als er geen VMM-server is, wordt de Site Recovery-provider geïnstalleerd op de host, zodat replicatie via internet kan worden beheerd met Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="67217-131">If there's no VMM server, the Site Recovery Provider is installed on the host to orchestrate replication with Site Recovery over the internet.</span></span> <span data-ttu-id="67217-132">Als er een VMM-server is, wordt de provider daarop geïnstalleerd en niet op de host.</span><span class="sxs-lookup"><span data-stu-id="67217-132">If there's a VMM server, the Provider is installed on it, and not on the host.</span></span><br/><br/> <span data-ttu-id="67217-133">De Recovery Services-agent wordt geïnstalleerd op de host om de gegevensreplicatie af te handelen.</span><span class="sxs-lookup"><span data-stu-id="67217-133">The Recovery Services agent is installed on the host to handle data replication.</span></span><br/><br/> <span data-ttu-id="67217-134">De communicatie vanuit zowel de Provider als de agent is beveiligd en versleuteld.</span><span class="sxs-lookup"><span data-stu-id="67217-134">Communications from both the Provider and the agent are secure and encrypted.</span></span> <span data-ttu-id="67217-135">De gerepliceerde gegevens in de Azure-opslag zijn eveneens versleuteld.</span><span class="sxs-lookup"><span data-stu-id="67217-135">Replicated data in Azure storage is also encrypted.</span></span>
<span data-ttu-id="67217-136">**Virtuele Hyper-V-machines**</span><span class="sxs-lookup"><span data-stu-id="67217-136">**Hyper-V VMs**</span></span> | <span data-ttu-id="67217-137">U hebt één of meer virtuele machines nodig op de Hyper-V-hostserver.</span><span class="sxs-lookup"><span data-stu-id="67217-137">You need one or more VMs on the Hyper-V host server.</span></span> | <span data-ttu-id="67217-138">Er hoeft niets verplicht op virtuele machines te worden geïnstalleerd</span><span class="sxs-lookup"><span data-stu-id="67217-138">Nothing needs to explicitly installed on VMs</span></span>

## <a name="deployment-steps"></a><span data-ttu-id="67217-139">Implementatiestappen</span><span class="sxs-lookup"><span data-stu-id="67217-139">Deployment steps</span></span>

1. <span data-ttu-id="67217-140">**Azure**: u stelt de Azure-onderdelen in.</span><span class="sxs-lookup"><span data-stu-id="67217-140">**Azure**: You set up the Azure components.</span></span> <span data-ttu-id="67217-141">Wij raden u aan om opslag- en netwerkaccounts in te stellen voordat u begint met de Site Recovery-implementatie.</span><span class="sxs-lookup"><span data-stu-id="67217-141">We recommend you set up storage and network accounts before you begin Site Recovery deployment.</span></span>
2. <span data-ttu-id="67217-142">**Kluis**: u maakt een Recovery Services-kluis voor Site Recovery en configureert de kluisinstellingen, met inbegrip van het configureren van de bron- en doelinstellingen, het instellen van een replicatiebeleid en het inschakelen van replicatie.</span><span class="sxs-lookup"><span data-stu-id="67217-142">**Vault**: You create a Recovery Services vault for Site Recovery, and configure vault settings, including configuring source and target settings, setting up a replication policy, and enabling replication.</span></span>
3. <span data-ttu-id="67217-143">**Bron en doel**:</span><span class="sxs-lookup"><span data-stu-id="67217-143">**Source and target**:</span></span>
    - <span data-ttu-id="67217-144">**Hyper-V-hosts in VMM-clouds**: als onderdeel van het opgeven van de broninstellingen downloadt en installeert u de Azure Site Recovery-provider op de VMM-server en de Azure Recovery Services-agent op elke Hyper-V-host.</span><span class="sxs-lookup"><span data-stu-id="67217-144">**Hyper-V hosts in VMM clouds**: As part of specifying source settings, you download and install the Azure Site Recovery Provider on the VMM server, and the Azure Recovery Services agent on each Hyper-V host.</span></span> <span data-ttu-id="67217-145">De bron is de VMM-server.</span><span class="sxs-lookup"><span data-stu-id="67217-145">The source will be the VMM server.</span></span> <span data-ttu-id="67217-146">Het doel is Azure.</span><span class="sxs-lookup"><span data-stu-id="67217-146">The target is Azure.</span></span>
    - <span data-ttu-id="67217-147">Hyper-V-hosts zonder VMM: wanneer u instellingen voor de bron opgeeft, downloadt en installeert u de provider en agent op elke Hyper-V-host.</span><span class="sxs-lookup"><span data-stu-id="67217-147">Hyper-V hosts without VMM: When you specify source settings, you download and install the Provider and agent on each Hyper-V host.</span></span> <span data-ttu-id="67217-148">Tijdens de implementatie verzamelt u de hosts op een Hyper-V-site en geeft u vervolgens deze site op als bron.</span><span class="sxs-lookup"><span data-stu-id="67217-148">During deployment you gather the hosts into a Hyper-V site, and specify this site as the source.</span></span> <span data-ttu-id="67217-149">Het doel is Azure.</span><span class="sxs-lookup"><span data-stu-id="67217-149">The target is Azure.</span></span>

    <span data-ttu-id="67217-150">![Hyper-V of VMM-replicatie naar Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V-site-replicatie naar Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span><span class="sxs-lookup"><span data-stu-id="67217-150">![Hyper-V/VMM replication to Azure](./media/site-recovery-components/arch-onprem-onprem-azure-vmm.png) ![Hyper-V site replication to Azure](./media/site-recovery-components/arch-onprem-azure-hypervsite.png)</span></span>


4. <span data-ttu-id="67217-151">**Replicatiebeleid**: u maakt een replicatiebeleid voor de Hyper-V-site of de VMM-cloud.</span><span class="sxs-lookup"><span data-stu-id="67217-151">**Replication policy**: You create a replication policy for the Hyper-V site or VMM cloud.</span></span> <span data-ttu-id="67217-152">Het beleid wordt toegepast op alle VM’s die zich op hosts in de site of de cloud bevinden.</span><span class="sxs-lookup"><span data-stu-id="67217-152">The policy is applied to all VMs located on hosts in the site or cloud.</span></span>
5. <span data-ttu-id="67217-153">**Replicatie inschakelen**: u schakelt replicatie voor virtuele Hyper-V-machines in.</span><span class="sxs-lookup"><span data-stu-id="67217-153">**Enable replication**: You enable replication for Hyper-V VMs.</span></span> <span data-ttu-id="67217-154">De initiële replicatie wordt uitgevoerd in overeenstemming met de instellingen van het replicatiebeleid.</span><span class="sxs-lookup"><span data-stu-id="67217-154">Initial replication occurs in accordance with the replication policy settings.</span></span> <span data-ttu-id="67217-155">Verschillen in de gegevens worden bijgehouden en de replicatie van deltaverschillen naar Azure begint nadat de initiële replicatie is voltooid.</span><span class="sxs-lookup"><span data-stu-id="67217-155">Data changes are tracked, and replication of delta changes to Azure begins after the initial replication finishes.</span></span> <span data-ttu-id="67217-156">Bijgehouden wijzigingen voor een item worden opgeslagen in een .hrl-bestand.</span><span class="sxs-lookup"><span data-stu-id="67217-156">Tracked changes for an item are held in a .hrl file.</span></span>
6. <span data-ttu-id="67217-157">**Testfailover**: u voert een testfailover uit om te controleren of alles werkt.</span><span class="sxs-lookup"><span data-stu-id="67217-157">**Test failover**:  You run a test failover to make sure everything's working as expected.</span></span>

<span data-ttu-id="67217-158">Meer informatie over implementatie:</span><span class="sxs-lookup"><span data-stu-id="67217-158">Learn more about deployment:</span></span>
- [<span data-ttu-id="67217-159">Aan de slag met replicatie van Hyper-V-VM's naar Azure (met VMM)</span><span class="sxs-lookup"><span data-stu-id="67217-159">Get started with Hyper-V VM replication to Azure - with VMM</span></span>](site-recovery-vmm-to-azure.md)
- [<span data-ttu-id="67217-160">Aan de slag met replicatie van Hyper-V-VM's naar Azure (zonder VMM)</span><span class="sxs-lookup"><span data-stu-id="67217-160">Get started with Hyper-V VM replication to Azure - without VMM</span></span>](site-recovery-hyper-v-site-to-azure.md)

## <a name="hyper-v-replication-workflow"></a><span data-ttu-id="67217-161">Werkstroom van de Hyper-V-replicatie</span><span class="sxs-lookup"><span data-stu-id="67217-161">Hyper-V replication workflow</span></span>

### <a name="enable-protection"></a><span data-ttu-id="67217-162">Beveiliging inschakelen</span><span class="sxs-lookup"><span data-stu-id="67217-162">Enable protection</span></span>

1. <span data-ttu-id="67217-163">Nadat u de beveiliging voor een Hyper-V-VM in Azure Portal of on-premises hebt ingeschakeld, start **Beveiliging inschakelen**.</span><span class="sxs-lookup"><span data-stu-id="67217-163">After you enable protection for a Hyper-V VM, in the Azure portal or on-premises, the **Enable protection** starts.</span></span>
2. <span data-ttu-id="67217-164">Met deze taak wordt gecontroleerd of de machine voldoet aan de vereisten. Hierna wordt [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx) aangeroepen om replicatie in te stellen op basis van de instellingen die u hebt geconfigureerd.</span><span class="sxs-lookup"><span data-stu-id="67217-164">The job checks that the machine complies with prerequisites, before invoking the [CreateReplicationRelationship](https://msdn.microsoft.com/library/hh850036.aspx), to set up replication with the settings you've configured.</span></span>
3. <span data-ttu-id="67217-165">De taak start initiële replicatie door de methode [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) aan te roepen om een volledige VM-replicatie te initialiseren en de virtuele schijven van de virtuele machine naar Azure te versturen.</span><span class="sxs-lookup"><span data-stu-id="67217-165">The job starts initial replication by invoking the [StartReplication](https://msdn.microsoft.com/library/hh850303.aspx) method, to initialize a full VM replication, and send the VM's virtual disks to Azure.</span></span>
4. <span data-ttu-id="67217-166">U kunt de voortgang van de taak controleren op het tabblad **Taken**.</span><span class="sxs-lookup"><span data-stu-id="67217-166">You can monitor the job in the **Jobs** tab.</span></span>
        <span data-ttu-id="67217-167">![Takenlijst](media/site-recovery-hyper-v-azure-architecture/image1.png)![Inzoomen op beveiliging inschakelen](media/site-recovery-hyper-v-azure-architecture/image2.png)</span><span class="sxs-lookup"><span data-stu-id="67217-167">![Jobs list](media/site-recovery-hyper-v-azure-architecture/image1.png) ![Enable protection drill down](media/site-recovery-hyper-v-azure-architecture/image2.png)</span></span>

### <a name="initial-replication"></a><span data-ttu-id="67217-168">Initiële replicatie</span><span class="sxs-lookup"><span data-stu-id="67217-168">Initial replication</span></span>

1. <span data-ttu-id="67217-169">Er wordt een [Hyper-V VM-momentopname](https://technet.microsoft.com/library/dd560637.aspx) gemaakt wanneer de initiële replicatie wordt geactiveerd.</span><span class="sxs-lookup"><span data-stu-id="67217-169">A [Hyper-V VM snapshot](https://technet.microsoft.com/library/dd560637.aspx) snapshot is taken when initial replication is triggered.</span></span>
2. <span data-ttu-id="67217-170">Virtuele harde schijven worden één voor één gerepliceerd totdat ze allemaal naar Azure zijn gekopieerd.</span><span class="sxs-lookup"><span data-stu-id="67217-170">Virtual hard disks are replicated one by one until they're all copied to Azure.</span></span> <span data-ttu-id="67217-171">Het kan even duren, afhankelijk van de VM-grootte en de netwerkbandbreedte.</span><span class="sxs-lookup"><span data-stu-id="67217-171">It could take a while, depending on the VM size, and network bandwidth.</span></span> <span data-ttu-id="67217-172">Zie [How to manage on-premises to Azure protection network bandwidth usage](https://support.microsoft.com/kb/3056159) (On-premises beheren aan de hand van de door Azure-beveiliging gebruikte netwerkbandbreedte) om uw netwerkgebruik te optimaliseren.</span><span class="sxs-lookup"><span data-stu-id="67217-172">To optimize your network usage, see [How to manage on-premises to Azure protection network bandwidth usage](https://support.microsoft.com/kb/3056159).</span></span>
3. <span data-ttu-id="67217-173">Als er tijdens de eerste replicatie schijfwijzigingen optreden, worden deze met de Hyper-V Replica-replicatietracker bijgehouden als Hyper-V-replicatielogboeken (.hrl).</span><span class="sxs-lookup"><span data-stu-id="67217-173">If disk changes occur while initial replication is in progress, the Hyper-V Replica Replication Tracker tracks those changes as Hyper-V Replication Logs (.hrl).</span></span> <span data-ttu-id="67217-174">Deze bestanden bevinden zich in dezelfde map als de schijven.</span><span class="sxs-lookup"><span data-stu-id="67217-174">These files are located in the same folder as the disks.</span></span> <span data-ttu-id="67217-175">Elke schijf heeft een eigen HRL-bestand dat naar de secundaire opslag wordt verzonden.</span><span class="sxs-lookup"><span data-stu-id="67217-175">Each disk has an associated .hrl file that will be sent to secondary storage.</span></span>
4. <span data-ttu-id="67217-176">De momentopname- en logboekbestanden nemen schijfbronnen in beslag terwijl de eerste replicatie wordt uitgevoerd.</span><span class="sxs-lookup"><span data-stu-id="67217-176">The snapshot and log files consume disk resources while initial replication is in progress.</span></span>
5. <span data-ttu-id="67217-177">Als de initiële replicatie is voltooid, wordt de VM-momentopname verwijderd.</span><span class="sxs-lookup"><span data-stu-id="67217-177">When the initial replication finishes, the VM snapshot is deleted.</span></span> <span data-ttu-id="67217-178">Verschillen in het logboek worden gesynchroniseerd en samengevoegd op de bovenliggende schijf.</span><span class="sxs-lookup"><span data-stu-id="67217-178">Delta disk changes in the log are synchronized and merged to the parent disk.</span></span>


### <a name="finalize-protection"></a><span data-ttu-id="67217-179">Beveiliging voltooien</span><span class="sxs-lookup"><span data-stu-id="67217-179">Finalize protection</span></span>

1. <span data-ttu-id="67217-180">Wanneer de eerste replicatie is voltooid, configureert de taak **Beveiliging van de virtuele machine voltooien** de netwerkinstellingen en overige instellingen na de replicatie zodanig dat de virtuele machine is beveiligd.</span><span class="sxs-lookup"><span data-stu-id="67217-180">After the initial replication finishes, the **Finalize protection on the virtual machine** job configures network and other post-replication settings, so that the virtual machine is protected.</span></span>
    <span data-ttu-id="67217-181">![Taak Beveiliging voltooien](media/site-recovery-hyper-v-azure-architecture/image3.png)</span><span class="sxs-lookup"><span data-stu-id="67217-181">![Finalize protection job](media/site-recovery-hyper-v-azure-architecture/image3.png)</span></span>
2. <span data-ttu-id="67217-182">Als u repliceert naar Azure, moet u mogelijk de instellingen voor de virtuele machine zo aanpassen dat deze gereed is voor failover.</span><span class="sxs-lookup"><span data-stu-id="67217-182">If you're replicating to Azure, you might need to tweak the settings for the virtual machine so that it's ready for failover.</span></span> <span data-ttu-id="67217-183">Nu kunt u een failovertest uitvoeren om te controleren of alles werkt zoals het hoort.</span><span class="sxs-lookup"><span data-stu-id="67217-183">At this point you can run a test failover to check everything is working as expected.</span></span>

### <a name="delta-replication"></a><span data-ttu-id="67217-184">Replicatie van verschillen</span><span class="sxs-lookup"><span data-stu-id="67217-184">Delta replication</span></span>

1. <span data-ttu-id="67217-185">Na de initiële replicatie start de deltasynchronisatie in overeenstemming met de replicatie-instellingen.</span><span class="sxs-lookup"><span data-stu-id="67217-185">After the initial replication, delta synchronization begins, in accordance with replication settings.</span></span>
2. <span data-ttu-id="67217-186">De Hyper-V Replica-replicatietracker houdt de wijzigingen op een virtuele harde schijf bij in .hrl-bestanden.</span><span class="sxs-lookup"><span data-stu-id="67217-186">The Hyper-V Replica Replication Tracker tracks the changes to a virtual hard disk as .hrl files.</span></span> <span data-ttu-id="67217-187">Elke schijf die voor replicatie is geconfigureerd, heeft een bijbehorend .hrl-bestand.</span><span class="sxs-lookup"><span data-stu-id="67217-187">Each disk that's configured for replication has an associated .hrl file.</span></span> <span data-ttu-id="67217-188">Dit logboek wordt naar het opslagaccount van de klant verzonden nadat de initiële replicatie is voltooid.</span><span class="sxs-lookup"><span data-stu-id="67217-188">This log is sent to the customer's storage account after initial replication is complete.</span></span> <span data-ttu-id="67217-189">Wanneer een logboek naar Azure wordt verzonden, worden de wijzigingen in de primaire schijf bijgehouden in een ander logboekbestand in dezelfde map.</span><span class="sxs-lookup"><span data-stu-id="67217-189">When a log is in transit to Azure, the changes in the primary disk are tracked in another log file, in the same directory.</span></span>
3. <span data-ttu-id="67217-190">Tijdens de initiële replicatie en replicatie van verschillen, kunt u de virtuele machine in de VM-weergave bewaken.</span><span class="sxs-lookup"><span data-stu-id="67217-190">During initial and delta replication, you can monitor the VM in the VM view.</span></span> <span data-ttu-id="67217-191">[Meer informatie](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span><span class="sxs-lookup"><span data-stu-id="67217-191">[Learn more](site-recovery-monitoring-and-troubleshooting.md#monitor-replication-health-for-virtual-machines).</span></span>  

### <a name="replication-synchronization"></a><span data-ttu-id="67217-192">Replicatiesynchronisatie</span><span class="sxs-lookup"><span data-stu-id="67217-192">Replication synchronization</span></span>

1. <span data-ttu-id="67217-193">Als de replicatie van verschillen mislukt en een volledige replicatie veel bandbreedte of tijd zou kosten, wordt de virtuele machine gemarkeerd voor hersynchronisatie.</span><span class="sxs-lookup"><span data-stu-id="67217-193">If delta replication fails, and a full replication would be costly in terms of bandwidth or time, then a VM is marked for resynchronization.</span></span> <span data-ttu-id="67217-194">Als de HRL-bestanden bijvoorbeeld 50% van de schijfgrootte in beslag nemen, wordt de virtuele machine gemarkeerd voor hersynchronisatie.</span><span class="sxs-lookup"><span data-stu-id="67217-194">For example, if the .hrl files reach 50% of the disk size, then the VM will be marked for resynchronization.</span></span>
2.  <span data-ttu-id="67217-195">Met een hersynchronisatie wordt de hoeveelheid verzonden gegevens geminimaliseerd door controlesommen van de bron- en doel-VM's te berekenen en alleen de verschilgegevens te verzenden.</span><span class="sxs-lookup"><span data-stu-id="67217-195">Resynchronization minimizes the amount of data sent by computing checksums of the source and target virtual machines, and sending only the delta data.</span></span> <span data-ttu-id="67217-196">Hersynchronisatie maakt gebruik van een vaste-blokalgoritme voor verdelen in segmenten, waarbij bron- en doelbestanden in vaste segmenten worden verdeeld.</span><span class="sxs-lookup"><span data-stu-id="67217-196">Resynchronization uses a fixed-block chunking algorithm where source and target files are divided into fixed chunks.</span></span> <span data-ttu-id="67217-197">Voor elk segment worden controlesommen gegenereerd en vervolgens vergeleken om te bepalen welke blokken van de bron op het doel moeten worden toegepast.</span><span class="sxs-lookup"><span data-stu-id="67217-197">Checksums for each chunk are generated and then compared to determine which blocks from the source need to be applied to the target.</span></span>
3. <span data-ttu-id="67217-198">Na hersynchronisatie moet de normale replicatie van verschillen worden hervat.</span><span class="sxs-lookup"><span data-stu-id="67217-198">After resynchronization finishes, normal delta replication should resume.</span></span> <span data-ttu-id="67217-199">Hersynchronisatie is standaard zo gepland dat deze automatisch buiten kantooruren wordt uitgevoerd, maar u kunt een virtuele machine ook handmatig opnieuw synchroniseren.</span><span class="sxs-lookup"><span data-stu-id="67217-199">By default resynchronization is scheduled to run automatically outside office hours, but you can resynchronize a virtual machine manually.</span></span> <span data-ttu-id="67217-200">U kunt de hersynchronisatie bijvoorbeeld hervatten als er een netwerkstoring of een andere storing optreedt.</span><span class="sxs-lookup"><span data-stu-id="67217-200">For example, you can resume resynchronization if a network outage or another outage occurs.</span></span> <span data-ttu-id="67217-201">Selecteer hiervoor de virtuele machine in de portal > **Opnieuw synchroniseren**.</span><span class="sxs-lookup"><span data-stu-id="67217-201">To do this, select the VM in the portal > **Resynchronize**.</span></span>

    ![Handmatig opnieuw synchroniseren](media/site-recovery-hyper-v-azure-architecture/image4.png)


### <a name="retries"></a><span data-ttu-id="67217-203">Nieuwe pogingen</span><span class="sxs-lookup"><span data-stu-id="67217-203">Retries</span></span>

<span data-ttu-id="67217-204">Als er een replicatiefout optreedt, wordt de replicatie automatisch opnieuw geprobeerd.</span><span class="sxs-lookup"><span data-stu-id="67217-204">If a replication error occurs, there's a built-in retry.</span></span> <span data-ttu-id="67217-205">Deze logica kan in twee categorieën worden ingedeeld:</span><span class="sxs-lookup"><span data-stu-id="67217-205">This logic can be classified into two categories:</span></span>

<span data-ttu-id="67217-206">**Categorie**</span><span class="sxs-lookup"><span data-stu-id="67217-206">**Category**</span></span> | <span data-ttu-id="67217-207">**Details**</span><span class="sxs-lookup"><span data-stu-id="67217-207">**Details**</span></span>
--- | ---
<span data-ttu-id="67217-208">**Niet-herstelbare fouten**</span><span class="sxs-lookup"><span data-stu-id="67217-208">**Non-recoverable errors**</span></span> | <span data-ttu-id="67217-209">Er wordt geen nieuwe poging gedaan.</span><span class="sxs-lookup"><span data-stu-id="67217-209">No retry is attempted.</span></span> <span data-ttu-id="67217-210">De status van de virtuele machine is **Kritiek** en tussenkomst van de beheerder is vereist.</span><span class="sxs-lookup"><span data-stu-id="67217-210">VM status will be **Critical**, and administrator intervention is required.</span></span> <span data-ttu-id="67217-211">Enkele voorbeelden van deze fouten zijn: verbroken VHD-keten; ongeldige status voor de replica-VM; netwerkverificatiefouten: autorisatiefouten; fouten in verband met een niet gevonden virtuele machine (voor zelfstandige Hyper-V-servers)</span><span class="sxs-lookup"><span data-stu-id="67217-211">Examples of these errors include: broken VHD chain; Invalid state for the replica VM; Network authentication errors: authorization errors; VM not found errors (for standalone Hyper-V servers)</span></span>
<span data-ttu-id="67217-212">**Herstelbare fouten**</span><span class="sxs-lookup"><span data-stu-id="67217-212">**Recoverable errors**</span></span> | <span data-ttu-id="67217-213">Nieuwe pogingen worden elk replicatie-interval uitgevoerd met behulp van een exponentiële uitstelbewerking die het interval voor nieuwe pogingen vanaf het begin van de eerste poging met 1, 2, 4, 8 en 10 minuten verhoogt.</span><span class="sxs-lookup"><span data-stu-id="67217-213">Retries occur every replication interval, using an exponential back-off that increases the retry interval from the start of the first attempt by 1, 2, 4, 8, and 10 minutes.</span></span> <span data-ttu-id="67217-214">Als een fout zich blijft voordoen, probeert u het om de 30 minuten opnieuw.</span><span class="sxs-lookup"><span data-stu-id="67217-214">If an error persists, retry every 30 minutes.</span></span> <span data-ttu-id="67217-215">Voorbeelden zijn onder meer: netwerkfouten; fouten in verband met weinig schijfruimte; weinig geheugenruimte</span><span class="sxs-lookup"><span data-stu-id="67217-215">Examples include: network errors; low disk  errors; low memory conditions</span></span> |

## <a name="protection-and-recovery-lifecycle"></a><span data-ttu-id="67217-216">Levenscyclus beveiliging en herstel</span><span class="sxs-lookup"><span data-stu-id="67217-216">Protection and recovery lifecycle</span></span>

![werkstroom](./media/site-recovery-components/arch-hyperv-azure-workflow.png)

## <a name="next-steps"></a><span data-ttu-id="67217-218">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="67217-218">Next steps</span></span>

- [<span data-ttu-id="67217-219">Vereisten voor implementatie controleren</span><span class="sxs-lookup"><span data-stu-id="67217-219">Check deployment prerequisites</span></span>](site-recovery-prereq.md)
- <span data-ttu-id="67217-220">Problemen oplossen met:</span><span class="sxs-lookup"><span data-stu-id="67217-220">Troubleshoot with:</span></span>
    - [<span data-ttu-id="67217-221">Beveiliging controleren en beveiligingsproblemen oplossen</span><span class="sxs-lookup"><span data-stu-id="67217-221">Monitor and troubleshoot protection</span></span>](site-recovery-monitoring-and-troubleshooting.md)
    - [<span data-ttu-id="67217-222">Hulp van Microsoft-ondersteuning</span><span class="sxs-lookup"><span data-stu-id="67217-222">Help from Microsoft support</span></span>](site-recovery-monitoring-and-troubleshooting.md#reach-out-for-microsoft-support)
    - [<span data-ttu-id="67217-223">Veelvoorkomende fouten en oplossingen</span><span class="sxs-lookup"><span data-stu-id="67217-223">Common errors and resolutions</span></span>](site-recovery-monitoring-and-troubleshooting.md#common-azure-site-recovery-errors-and-their-resolutions)
