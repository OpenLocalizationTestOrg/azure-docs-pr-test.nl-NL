# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="6e7f2-101">Back-up van Azure niet-beheerde VM-schijven met incrementele momentopnamen</span><span class="sxs-lookup"><span data-stu-id="6e7f2-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="6e7f2-102">Overzicht</span><span class="sxs-lookup"><span data-stu-id="6e7f2-102">Overview</span></span>
<span data-ttu-id="6e7f2-103">Azure-opslag biedt de mogelijkheid aan momentopnamen van blobs.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-103">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="6e7f2-104">De status van de blob vastleggen momentopnamen op dat moment.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-104">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="6e7f2-105">In dit artikel beschrijft we een scenario waarin u back-ups van de schijven van de virtuele machine met momentopnamen kunt onderhouden.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="6e7f2-106">U kunt deze methode wanneer u niet wilt gebruiken voor Azure Backup en Recovery-Service en voor het maken van een aangepaste back-upstrategie voor uw virtuele machine-schijven.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-106">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="6e7f2-107">Virtuele machine van Azure-schijven zijn opgeslagen als pagina-blobs in Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="6e7f2-108">Aangezien we beschrijving van een back-upstrategie voor virtuele-machineschijven in dit artikel, verwijzen we naar momentopnamen in de context van pagina-blobs.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer to snapshots in the context of page blobs.</span></span> <span data-ttu-id="6e7f2-109">Raadpleeg voor meer informatie over momentopnamen [maken van een momentopname van een Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span><span class="sxs-lookup"><span data-stu-id="6e7f2-109">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="6e7f2-110">Wat is er een momentopname?</span><span class="sxs-lookup"><span data-stu-id="6e7f2-110">What is a snapshot?</span></span>
<span data-ttu-id="6e7f2-111">Een blob-momentopname is een alleen-lezen-versie van een blob die is opgenomen op een punt in tijd.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="6e7f2-112">Wanneer een momentopname is gemaakt, kan deze worden gelezen, gekopieerd, of verwijderd, maar niet gewijzigd.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="6e7f2-113">Momentopnamen bieden een manier om back-up van een blob zoals deze wordt weergegeven op een moment.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-113">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="6e7f2-114">Pas REST versie 2015-04-05 moest u de mogelijkheid om te kopiëren van de volledige momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-114">Until REST version 2015-04-05, you had the ability to copy full snapshots.</span></span> <span data-ttu-id="6e7f2-115">Met de REST-versie 2015-07-08 en hoger, u kunt u ook incrementele momentopnamen kopiëren.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-115">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="6e7f2-116">Volledige momentopname kopiëren</span><span class="sxs-lookup"><span data-stu-id="6e7f2-116">Full snapshot copy</span></span>
<span data-ttu-id="6e7f2-117">Momentopnamen kunnen worden gekopieerd naar een ander opslagaccount als blob naar de back-ups van de basis blob houden.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-117">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="6e7f2-118">U kunt ook een momentopname kopiëren via de base blob, is vergelijkbaar met het herstellen van de blob naar een eerdere versie.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-118">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="6e7f2-119">Wanneer een momentopname van een opslagaccount wordt gekopieerd naar een andere, in beslag neemt de dezelfde naamruimte als de basis-pagina-blob.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-119">When a snapshot is copied from one storage account to another, it occupies the same space as the base page blob.</span></span> <span data-ttu-id="6e7f2-120">Daarom wordt het hele momentopnamen van één opslagaccount kopiëren naar de andere traag en verbruikt veel ruimte in de doel-opslagaccount.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-120">Therefore, copying whole snapshots from one storage account to another is slow and consumes much space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="6e7f2-121">Als u de basis blob naar een andere bestemming kopieert, worden de momentopnamen van de blob niet samen met het gekopieerd.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-121">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="6e7f2-122">Op dezelfde manier als u een basis blob met een kopie overschrijven, momentopnamen die zijn gekoppeld aan de basis blob worden niet beïnvloed door en onder de blobnaam van de basis intact blijven.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under the base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="6e7f2-123">Back-up van schijven met momentopnamen</span><span class="sxs-lookup"><span data-stu-id="6e7f2-123">Back up disks using snapshots</span></span>
<span data-ttu-id="6e7f2-124">Als een back-upstrategie voor uw virtuele machine-schijven, u kunt momentopnamen periodieke van de schijf of pagina-blob en kopieer ze naar een andere opslag rekening met hulpprogramma's als [Blob kopiëren](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) bewerking of [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="6e7f2-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="6e7f2-125">U kunt een momentopname kopiëren naar een doel-pagina-blob met een andere naam.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-125">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="6e7f2-126">De resulterende bestemmings-pagina-blob is een beschrijfbare pagina-blob en niet een momentopname.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-126">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="6e7f2-127">Verderop in dit artikel worden stappen beschreven om back-ups van de schijven van de virtuele machine met momentopnamen beschreven.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-127">Later in this article, we describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="6e7f2-128">Schijven met momentopnamen terugzetten</span><span class="sxs-lookup"><span data-stu-id="6e7f2-128">Restore disks using snapshots</span></span>
<span data-ttu-id="6e7f2-129">Wanneer het tijd om te zetten van de schijf op een stabiele versie die eerder is vastgelegd in een van de back-upmomentopnamen is, kunt u een momentopname via de basispagina blob kopiëren.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-129">When it is time to restore your disk to a stable version that was previously captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="6e7f2-130">Nadat de momentopname wordt gepromoveerd voor de basispagina blob, blijft van de momentopname, maar de bron wordt overschreven met een kopie die kan worden gelezen en geschreven.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-130">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="6e7f2-131">Verderop in dit artikel worden beschreven stappen voor het herstellen van een eerdere versie van de schijf van de momentopname is gemaakt.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-131">Later in this article we describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="6e7f2-132">Volledige snapshotkopieën implementeren</span><span class="sxs-lookup"><span data-stu-id="6e7f2-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="6e7f2-133">U kunt een kopie van de volledige momentopname implementeren door het volgende te doen</span><span class="sxs-lookup"><span data-stu-id="6e7f2-133">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="6e7f2-134">Eerst een momentopname van de basis blob met behulp van de [momentopname Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) bewerking.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-134">First, take a snapshot of the base blob using the [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="6e7f2-135">Kopieer vervolgens de momentopname naar een doel storage account met [Blob kopiëren](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="6e7f2-135">Then, copy the snapshot to a target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="6e7f2-136">Herhaal dit proces voor het onderhouden van de back-ups van uw base blob.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-136">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="6e7f2-137">Incrementele snapshotkopieën</span><span class="sxs-lookup"><span data-stu-id="6e7f2-137">Incremental snapshot copy</span></span>
<span data-ttu-id="6e7f2-138">De nieuwe functie in de [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API biedt een veel betere manier om back-up van de momentopnamen van uw pagina-blobs of de schijven.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-138">The new feature in the [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="6e7f2-139">De API retourneert de lijst met wijzigingen tussen de base blob en de momentopnamen die de hoeveelheid opslagruimte die wordt gebruikt voor de back-account reduceert.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-139">The API returns the list of changes between the base blob and the snapshots, which reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="6e7f2-140">De API biedt ondersteuning voor pagina-blobs in Premium-opslag, evenals de Standard-opslag.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-140">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="6e7f2-141">Deze API gebruikt, kunt u snellere en efficiëntere back-oplossingen bouwen voor Azure Virtual machines.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="6e7f2-142">Deze API is beschikbaar in de REST-versie 2015-07-08 en hoger.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-142">This API will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="6e7f2-143">Incrementele kopie van de momentopname kunt u vanuit één opslagaccount naar de andere kopiëren het verschil tussen,</span><span class="sxs-lookup"><span data-stu-id="6e7f2-143">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="6e7f2-144">Base blob en de momentopname of</span><span class="sxs-lookup"><span data-stu-id="6e7f2-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="6e7f2-145">De twee momentopnamen van de basis blob</span><span class="sxs-lookup"><span data-stu-id="6e7f2-145">Any two snapshots of the base blob</span></span>

<span data-ttu-id="6e7f2-146">De volgende voorwaarden wordt voldaan, opgegeven</span><span class="sxs-lookup"><span data-stu-id="6e7f2-146">Provided the following conditions are met,</span></span>

* <span data-ttu-id="6e7f2-147">De blob is gemaakt op Jan-1-2016 of hoger.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-147">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="6e7f2-148">De blob is niet overschreven met [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) of [Blob kopiëren](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) tussen twee momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-148">The blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="6e7f2-149">**Opmerking**: deze functie is beschikbaar voor Premium en Standard Azure-pagina-Blobs.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="6e7f2-150">Wanneer u een aangepaste back-upstrategie met momentopnamen hebt, kopiëren van de momentopnamen van één opslagaccount naar een andere kan traag zijn en hoeveel opslagruimte kan gebruiken.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-150">When you have a custom backup strategy using snapshots, copying the snapshots from one storage account to another can be slow and can consume much storage space.</span></span> <span data-ttu-id="6e7f2-151">In plaats van de volledige momentopname kopiëren naar een back-storage-account, kunt u het verschil tussen opeenvolgende momentopnamen om een back-pagina-blob te schrijven.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-151">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="6e7f2-152">Op deze manier wordt de tijd voor het kopiëren en de ruimte voor het opslaan van back-ups aanzienlijk verminderd.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-152">This way, the time to copy and the space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="6e7f2-153">Incrementele snapshotkopieën implementeren</span><span class="sxs-lookup"><span data-stu-id="6e7f2-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="6e7f2-154">U kunt incrementele snapshotkopieën implementeren door het volgende te doen</span><span class="sxs-lookup"><span data-stu-id="6e7f2-154">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="6e7f2-155">Een momentopname van het gebruik van de basis blob [momentopname Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span><span class="sxs-lookup"><span data-stu-id="6e7f2-155">Take a snapshot of the base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="6e7f2-156">Kopiëren van de momentopname met de doel-upopslag account via [Blob kopiëren](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="6e7f2-156">Copy the snapshot to the target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="6e7f2-157">Dit is de back-paginablob.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-157">This is the backup page blob.</span></span> <span data-ttu-id="6e7f2-158">Een momentopname van de back-pagina-blobs en sla deze op in het back-account.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-158">Take a snapshot of the backup page blob and store it in the backup account.</span></span>
* <span data-ttu-id="6e7f2-159">Maak nog een momentopname van de basis blob met momentopname Blob.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-159">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="6e7f2-160">Het verschil tussen de eerste en tweede momentopnamen van het gebruik van de basis blob ophalen [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span><span class="sxs-lookup"><span data-stu-id="6e7f2-160">Get the difference between the first and second snapshots of the base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="6e7f2-161">Gebruik de nieuwe parameter **prevsnapshot**, de DateTime-waarde van de momentopname die u wilt ophalen van het verschil met opgeven.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-161">Use the new parameter **prevsnapshot**, to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="6e7f2-162">Als deze parameter aanwezig is, betekent dit dat het antwoord REST alleen op de pagina's die zijn gewijzigd tussen doel momentopname en eerdere momentopname, met inbegrip van lege pagina's bevat.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-162">When this parameter is present, the REST response includes only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="6e7f2-163">Gebruik [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) deze wijzigingen toepassen op de back-paginablob.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="6e7f2-164">Ten slotte een momentopname van de back-pagina-blobs en sla het in het back-storage-account.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-164">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="6e7f2-165">In de volgende sectie wordt beschreven in meer detail hoe u back-ups van schijven met incrementele kopie van de momentopname kunt onderhouden</span><span class="sxs-lookup"><span data-stu-id="6e7f2-165">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="6e7f2-166">Scenario</span><span class="sxs-lookup"><span data-stu-id="6e7f2-166">Scenario</span></span>
<span data-ttu-id="6e7f2-167">In deze sectie beschrijven we een scenario waarbij een aangepaste back-upstrategie voor schijven van de virtuele machine met momentopnamen.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="6e7f2-168">U kunt een DS-serie Azure virtuele machine met een premium-opslag P30 schijf die is gekoppeld.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="6e7f2-169">De schijf P30 aangeroepen *mypremiumdisk* wordt opgeslagen in een premium storage-account genoemd *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-169">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="6e7f2-170">Standard-opslagaccount aangeroepen *mybackupstdaccount* wordt gebruikt voor het opslaan van de back-up van *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-170">A standard storage account called *mybackupstdaccount* is used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="6e7f2-171">Wij willen graag houden van een momentopname van *mypremiumdisk* elke 12 uur.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-171">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="6e7f2-172">Raadpleeg voor meer informatie over het maken van de storage-account en schijven te [over Azure storage-accounts](../articles/storage/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="6e7f2-172">To learn about creating storage account and disks, refer to [About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="6e7f2-173">Raadpleeg voor meer informatie over het back-ups van virtuele Azure-machines, [back-ups van virtuele machine van Azure plannen](../articles/backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="6e7f2-173">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="6e7f2-174">Stappen voor het beheren van back-ups van een schijf met een incrementele momentopnamen</span><span class="sxs-lookup"><span data-stu-id="6e7f2-174">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="6e7f2-175">De volgende stappen wordt beschreven hoe u momentopnamen van *mypremiumdisk* en onderhouden van de back-ups in *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-175">The following steps describe how to take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="6e7f2-176">De back-up is een standaard pagina-blob aangeroepen *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-176">The backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="6e7f2-177">De back-paginablob geeft altijd dezelfde toestand als de laatste momentopname van *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-177">The backup page blob always reflects the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="6e7f2-178">De back-pagina-blob voor de premium-opslag-schijf maken door het maken van een momentopname van *mypremiumdisk* aangeroepen *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-178">Create the backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="6e7f2-179">Deze momentopname als een pagina-blob aangeroepen kopiëren naar mybackupstdaccount *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-179">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="6e7f2-180">Een momentopname van *mybackupstdpageblob* aangeroepen *mybackupstdpageblob_ss1*met [momentopname Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) en op te slaan in *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="6e7f2-181">Tijdens het back-upvenster maken nog een momentopname van *mypremiumdisk*, spreek *mypremiumdisk_ss2*, en op te slaan in *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-181">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="6e7f2-182">Ophalen van de incrementele wijzigingen tussen de twee momentopnamen *mypremiumdisk_ss2* en *mypremiumdisk_ss1*met [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) op *mypremiumdisk_ ss2* met de **prevsnapshot** parameter ingesteld op de tijdstempel van *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-182">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with the **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="6e7f2-183">Deze incrementele wijzigingen geschreven naar de back-paginablob *mybackupstdpageblob* in *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-183">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="6e7f2-184">Als er in de incrementele wijzigingen verwijderde bereiken, moeten ze worden gewist van de back-paginablob.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-184">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="6e7f2-185">Gebruik [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) incrementele wijzigingen schrijven naar de back-paginablob.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="6e7f2-186">Een momentopname van de back-paginablob *mybackupstdpageblob*die *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-186">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="6e7f2-187">Verwijderen van de vorige momentopname *mypremiumdisk_ss1* van premium storage-account.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-187">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="6e7f2-188">Herhaal stap 4-6 elke back-upvenster.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="6e7f2-189">Op deze manier kunt u back-ups van blijven *mypremiumdisk* in een standard-opslagaccount.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Maak een back-up van schijf met behulp van incrementele momentopnamen](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="6e7f2-191">Stappen voor het herstellen van een schijf van momentopnamen</span><span class="sxs-lookup"><span data-stu-id="6e7f2-191">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="6e7f2-192">De volgende stappen beschrijven het herstellen van de schijf premium *mypremiumdisk* naar een eerdere momentopname van de back-upopslag account *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-192">The following steps, describe how to restore the premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="6e7f2-193">Het punt te identificeren in de tijd die u wilt de premium-schijf te herstellen.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-193">Identify the point in time that you wish to restore the premium disk to.</span></span> <span data-ttu-id="6e7f2-194">Stel de machine momentopnamen *mybackupstdpageblob_ss2*, die is opgeslagen in het account van de back-upopslag *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="6e7f2-195">In mybackupstdaccount, bevordering van de momentopname *mybackupstdpageblob_ss2* als de nieuwe back-up basispagina blob *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-195">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="6e7f2-196">Een momentopname van deze herstelde back-pagina-blob, aangeroepen *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="6e7f2-197">De herstelde paginablob kopiëren *mybackupstdpageblobrestored* van *mybackupstdaccount* naar *mypremiumaccount* als de nieuwe schijf met premium *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-197">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="6e7f2-198">Een momentopname van *mypremiumdiskrestored*die *mypremiumdiskrestored_ss1* voor toekomstige incrementele back-ups maken.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="6e7f2-199">De DS-serie VM verwijzen naar de teruggezette schijf *mypremiumdiskrestored* en loskoppelen van de oude *mypremiumdisk* van de virtuele machine.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-199">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="6e7f2-200">Beginnen met de back-up wordt beschreven in de vorige sectie voor de herstelde schijf *mypremiumdiskrestored*, waarbij de *mybackupstdpageblobrestored* als de back-pagina-blob.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-200">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![Schijf terugzetten van momentopnamen](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="6e7f2-202">Volgende stappen</span><span class="sxs-lookup"><span data-stu-id="6e7f2-202">Next Steps</span></span>
<span data-ttu-id="6e7f2-203">Gebruik de volgende koppelingen voor meer informatie over het maken van momentopnamen van een blob en het plannen van uw back-upinfrastructuur VM.</span><span class="sxs-lookup"><span data-stu-id="6e7f2-203">Use the following links to learn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="6e7f2-204">Maken van een momentopname van een Blob</span><span class="sxs-lookup"><span data-stu-id="6e7f2-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="6e7f2-205">Uw VM-back-infrastructuur plannen</span><span class="sxs-lookup"><span data-stu-id="6e7f2-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)

